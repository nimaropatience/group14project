import"./isEqual-DUAGDpZY.js";import{ElOption as e,ElSelect as t}from"./select-DBPzawsW.js";import"./_baseFindIndex-Ctm2P5pj.js";import"./isArrayLikeObject-DWAcihF8.js";import"./merge-XDSJ7w6H.js";import"./_baseIteratee-t-25AuYs.js";import{ElTable as n,ElTableColumn as r}from"./table-Db0XwM4K.js";import{ElDialog as i}from"./dialog-BxcJDRn2.js";import"./use-empty-values-iILzsRnu.js";import"./click-outside-CeocQVdO.js";import{ElCheckbox as a}from"./checkbox-C8nKweXK.js";import"./tag-ByueM0Jv.js";import{ElPopover as o}from"./popover-DFFV5wnj.js";import{$t as s,ElForm as c,ElFormItem as l,ElInput as u,Fragment as d,Transition as f,__plugin_vue_export_helper_default as p,addClass as m,computed as h,confirmEl as g,createApp as _,createBaseVNode as v,createBlock as y,createCommentVNode as b,createElementBlock as x,createTextVNode as S,createVNode as C,defineComponent as w,defineStore as T,error as E,getStyle as D,h as O,handler as k,hyphenate as A,isClient as j,isObject as M,isRef as N,isString as P,nextTick as F,normalizeClass as I,normalizeStyle as ee,onMounted as L,openBlock as R,reactive as z,ref as B,removeClass as V,renderList as H,resolveComponent as U,storeToRefs as W,success as te,toDisplayString as G,toRefs as ne,unref as K,useGlobalComponentSettings as re,vShow as q,withCtx as J,withDirectives as Y,withKeys as ie,withModifiers as ae}from"./app-ctFZFRv9.js";import{DatabaseType as X,isPGFamily as oe}from"./constants-36FjBj35.js";import{EscapedOption as se,getDefault as ce,isEmpty as le,isTrue as ue,wrapByDb as Z}from"./wrapper-D-Es_PY1.js";import{listenHeight as de}from"./common_view_utils-DtJZIhkt.js";import"./objectUtil-DGxGSfnv.js";import{ArrayUtil as fe}from"./arrayUtil-SL5L5q5A.js";import{getDialect as pe}from"./getDialect-DjAiU-Is.js";import{StringBuilder as Q}from"./stringBuilder-DX4xUSBl.js";import{codemirror_default as me}from"./codemirror-DjzVERIP.js";function he(e){let t,n=B(!1),r=z({...e,originalPosition:``,originalOverflow:``,visible:!1});function i(e){r.text=e}function a(){let e=r.parent,t=d.ns;if(!e.vLoadingAddClassList){let n=e.getAttribute(`loading-number`);n=Number.parseInt(n)-1,n?e.setAttribute(`loading-number`,n.toString()):(V(e,t.bm(`parent`,`relative`)),e.removeAttribute(`loading-number`)),V(e,t.bm(`parent`,`hidden`))}o(),u.unmount()}function o(){var e,t;(t=(e=d.$el)?.parentNode)==null||t.removeChild(d.$el)}function s(){var i;e.beforeClose&&!e.beforeClose()||(n.value=!0,clearTimeout(t),t=window.setTimeout(c,400),r.visible=!1,(i=e.closed)==null||i.call(e))}function c(){if(!n.value)return;let e=r.parent;n.value=!1,e.vLoadingAddClassList=void 0,a()}let l=w({name:`ElLoading`,setup(e,{expose:t}){let{ns:n,zIndex:i}=re(`loading`);return t({ns:n,zIndex:i}),()=>{let e=r.spinner||r.svg,t=O(`svg`,{class:`circular`,viewBox:r.svgViewBox?r.svgViewBox:`0 0 50 50`,...e?{innerHTML:e}:{}},[O(`circle`,{class:`path`,cx:`25`,cy:`25`,r:`20`,fill:`none`})]),i=r.text?O(`p`,{class:n.b(`text`)},[r.text]):void 0;return O(f,{name:n.b(`fade`),onAfterLeave:c},{default:J(()=>[Y(C(`div`,{style:{backgroundColor:r.background||``},class:[n.b(`mask`),r.customClass,r.fullscreen?`is-fullscreen`:``]},[O(`div`,{class:n.b(`spinner`)},[t,i])]),[[q,r.visible]])])})}}}),u=_(l),d=u.mount(document.createElement(`div`));return{...ne(r),setText:i,removeElLoadingChild:o,close:s,handleAfterLeave:c,vm:d,get $el(){return d.$el}}}let ge;const _e=function(e={}){if(!j)return;let t=ve(e);if(t.fullscreen&&ge)return ge;let n=he({...t,closed:()=>{var e;(e=t.closed)==null||e.call(t),t.fullscreen&&(ge=void 0)}});ye(t,t.parent,n),be(t,t.parent,n),t.parent.vLoadingAddClassList=()=>be(t,t.parent,n);let r=t.parent.getAttribute(`loading-number`);return r=r?`${Number.parseInt(r)+1}`:`1`,t.parent.setAttribute(`loading-number`,r),t.parent.appendChild(n.$el),F(()=>n.visible.value=t.visible),t.fullscreen&&(ge=n),n},ve=e=>{var t,n,r,i;let a;return a=P(e.target)?(t=document.querySelector(e.target))??document.body:e.target||document.body,{parent:a===document.body||e.body?document.body:a,background:e.background||``,svg:e.svg||``,svgViewBox:e.svgViewBox||``,spinner:e.spinner||!1,text:e.text||``,fullscreen:a===document.body&&((n=e.fullscreen)??!0),lock:(r=e.lock)??!1,customClass:e.customClass||``,visible:(i=e.visible)??!0,target:a}},ye=async(e,t,n)=>{let{nextZIndex:r}=n.vm.zIndex||n.vm._.exposed.zIndex,i={};if(e.fullscreen)n.originalPosition.value=D(document.body,`position`),n.originalOverflow.value=D(document.body,`overflow`),i.zIndex=r();else if(e.parent===document.body){n.originalPosition.value=D(document.body,`position`),await F();for(let t of[`top`,`left`]){let n=t===`top`?`scrollTop`:`scrollLeft`;i[t]=`${e.target.getBoundingClientRect()[t]+document.body[n]+document.documentElement[n]-Number.parseInt(D(document.body,`margin-${t}`),10)}px`}for(let t of[`height`,`width`])i[t]=`${e.target.getBoundingClientRect()[t]}px`}else n.originalPosition.value=D(t,`position`);for(let[e,t]of Object.entries(i))n.$el.style[e]=t},be=(e,t,n)=>{let r=n.vm.ns||n.vm._.exposed.ns;[`absolute`,`fixed`,`sticky`].includes(n.originalPosition.value)?V(t,r.bm(`parent`,`relative`)):m(t,r.bm(`parent`,`relative`)),e.fullscreen&&e.lock?m(t,r.bm(`parent`,`hidden`)):V(t,r.bm(`parent`,`hidden`))},xe=Symbol(`ElLoading`),Se=(e,t)=>{var n,r,i,a;let o=t.instance,s=e=>M(t.value)?t.value[e]:void 0,c=e=>{let t=P(e)&&o?.[e]||e;return t&&B(t)},l=t=>c(s(t)||e.getAttribute(`element-loading-${A(t)}`)),u=(n=s(`fullscreen`))??t.modifiers.fullscreen,d={text:l(`text`),svg:l(`svg`),svgViewBox:l(`svgViewBox`),spinner:l(`spinner`),background:l(`background`),customClass:l(`customClass`),fullscreen:u,target:(r=s(`target`))??(u?void 0:e),body:(i=s(`body`))??t.modifiers.body,lock:(a=s(`lock`))??t.modifiers.lock};e[xe]={options:d,instance:_e(d)}},Ce=(e,t)=>{for(let n of Object.keys(t))N(t[n])&&(t[n].value=e[n])},we={mounted(e,t){t.value&&Se(e,t)},updated(e,t){let n=e[xe];t.oldValue!==t.value&&(t.value&&!t.oldValue?Se(e,t):t.value&&t.oldValue?M(t.value)&&Ce(t.value,n.options):n?.instance.close())},unmounted(e){var t;(t=e[xe])==null||t.instance.close(),e[xe]=null}},Te=T(`design`,{state:()=>({schema:``,table:``,columns:[],tableMeta:{},dbType:X.MYSQL,dialect:null,remainHeight:0,activePanel:`column`}),getters:{canAlterTable(e){try{var t;return(t=e.dialect)?.updateColumn({oldRow:{}})!=null}catch(e){return console.error(`canAlterTable`,e),!0}},supportForeignKey(e){var t;return(t=e.dialect)?.showForeignKeys()},supportCheck(e){var t;return(t=e.dialect)?.showChecks()},supportTrigger(e){var t;return(t=e.dialect)?.showTriggers()},supportIndex(e){var t;return(t=e.dialect)?.showIndex()&&![X.SNOWFLAKE,X.DATABRICKS,X.ATHENA,X.BIG_QUERY,X.PRESTO,X.TRINO].includes(e.dbType)}},actions:{updateDBType(e){this.dbType=e},updateFullInfo(e){for(let t in e)this[t]=e[t]}}}),Ee={class:`design-toolbar`},De={class:`text-center`};var Oe=w({__name:`IndexPanel`,setup(o){let u=B([]),f=B([]),p=B(!0),m=Te(),{dbType:_,dialect:w,remainHeight:T,activePanel:E}=W(m),D={visible:!1,loading:!1,column:null,columns:null,type:`INDEX`},O=z({...D}),A=h(()=>{var e;return(e=O.columns)?.length>0?w.value.newIndex({...O}):``});L(()=>{k.on(`designMetaNext`,()=>{O.visible=!1,f.value=w.value.indexTypes(),j()}).on(`indexes`,e=>{u.value=e,p.value=!1}).on(`success`,e=>{e==`index`&&(O.loading=!1,O.visible=!1,j())}).on(`error`,()=>{O.loading=!1})});let j=()=>{k.emit(`indexes`),p.value=!0},M=()=>{Object.assign(O,D),O.visible=!0,O.loading=!1},N=e=>w.value.formatIndexType(e),P=()=>{O.loading=!0,k.emit(`execute`,{type:`index`,sql:A.value})},F=e=>{g(s(`design.deleteIndexConfirm`)).then(()=>{k.emit(`execute`,{type:`index`,sql:w.value.dropIndex(e.index_name)})})};return(o,h)=>{let g=U(`vsc-button`),w=U(`vsc-tooltip`),D=r,k=a,I=n,ee=U(`RedMark`),L=e,z=t,B=l,V=c,W=i,te=we;return R(),x(`div`,null,[v(`div`,Ee,[C(w,{title:K(s)(`common.new`)},{default:J(()=>[[`ClickHouse`].includes(K(_))?b(``,!0):(R(),y(g,{key:0,type:`icon`,icon:`codicon-add text-base`,onClick:M}))]),_:1},8,[`title`]),C(w,{title:K(s)(`common.refresh`)},{default:J(()=>[C(g,{type:`icon`,icon:`codicon-refresh text-base`,onClick:j})]),_:1},8,[`title`])]),K(E)==`index`?Y((R(),y(I,{key:0,data:u.value,height:K(T),border:``},{default:J(()=>[C(D,{resizable:!0,align:`center`,prop:`index_name`,label:K(s)(`design.indexName`),width:`200`},null,8,[`label`]),C(D,{resizable:!0,align:`center`,prop:`column_name`,label:K(s)(`design.column`),width:`200`},null,8,[`label`]),C(D,{align:`center`,prop:`isUnique`,label:K(s)(`design.unique`),width:`200`},{default:J(({row:e})=>[C(k,{disabled:``,"model-value":K(ue)(e.isUnique)},null,8,[`model-value`])]),_:1},8,[`label`]),C(D,{resizable:!0,align:`center`,prop:`index_type`,label:K(s)(`common.type`),width:`200`},{default:J(({row:e})=>[S(G(N(e)),1)]),_:1},8,[`label`]),K(oe)(K(_))?(R(),y(D,{key:0,resizable:!0,align:`center`,prop:`index_method`,label:K(s)(`design.indexMethod`),width:`200`},null,8,[`label`])):b(``,!0),[`ClickHouse`].includes(K(_))?b(``,!0):(R(),y(D,{key:1,label:K(s)(`design.operation`),width:`120`},{default:J(({row:e})=>[v(`div`,De,[C(g,{type:`icon`,icon:`el-icon-delete`,style:{color:`#f56c6c`},title:`delete`,onClick:t=>F(e)},null,8,[`onClick`])])]),_:1},8,[`label`]))]),_:1},8,[`data`,`height`])),[[te,p.value]]):b(``,!0),C(W,{modelValue:O.visible,"onUpdate:modelValue":h[3]||=e=>O.visible=e,"show-close":!1,title:K(s)(`design.newIndex`),width:`520px`,closeOnClickModal:!1,center:``},{footer:J(()=>[C(g,{type:`secondary`,onClick:h[2]||=e=>O.visible=!1},{default:J(()=>[S(G(K(s)(`common.cancel`)),1)]),_:1}),C(g,{type:`primary`,loading:O.loading,onClick:P},{default:J(()=>[S(G(K(s)(`common.ok`)),1)]),_:1},8,[`loading`]),h[4]||=v(`br`,null,null,-1),h[5]||=S(),h[6]||=v(`br`,null,null,-1),Y(C(me,{ref:`cmEditor`,value:A.value,readonly:!0},null,8,[`value`]),[[q,A.value]])]),default:J(()=>[C(V,{inline:!0,"label-width":`75px`,size:`small`},{default:J(()=>[C(B,null,{label:J(()=>[C(ee),S(G(K(s)(`design.column`)),1)]),default:J(()=>[C(z,{modelValue:O.columns,"onUpdate:modelValue":h[0]||=e=>O.columns=e,size:`small`,filterable:``,multiple:``,class:`!w-[150px]`},{default:J(()=>[(R(!0),x(d,null,H(K(m).columns,e=>(R(),y(L,{key:e.name,label:e.name,value:e.name},null,8,[`label`,`value`]))),128))]),_:1},8,[`modelValue`])]),_:1}),C(B,null,{label:J(()=>[C(ee),S(G(K(s)(`common.type`)),1)]),default:J(()=>[C(z,{modelValue:O.type,"onUpdate:modelValue":h[1]||=e=>O.type=e,size:`small`,class:`!w-[110px]`},{default:J(()=>[(R(!0),x(d,null,H(f.value,(e,t)=>(R(),y(L,{key:t,label:e.label,value:e.value},null,8,[`label`,`value`]))),128))]),_:1},8,[`modelValue`])]),_:1})]),_:1})]),_:1},8,[`modelValue`,`title`])])}}}),ke=Oe;const Ae={ref:`infoPanel`,class:`design-toolbar`};var je=w({__name:`DDL`,setup(e){let t=Te(),n=B(!1),r=B(``);L(()=>{k.on(`designMetaNext`,()=>{k.emit(`ddl`)}).on(`ddl`,({ddl:e})=>{n.value=!1,r.value=e})});let i=()=>{navigator.clipboard.writeText(r.value),te(`Copy DDL success!`)};return(e,a)=>{let o=U(`vsc-button`),s=U(`vsc-tooltip`),c=we;return Y((R(),x(`div`,null,[v(`div`,Ae,[C(s,{title:`Copy DDL`},{default:J(()=>[C(o,{type:`icon`,icon:`el-icon-document-copy text-base`,onClick:i})]),_:1}),C(s,{title:e.$t(`common.refresh`)},{default:J(()=>[C(o,{type:`icon`,icon:`codicon-refresh text-base`,onClick:a[0]||=e=>K(k).emit(`ddl`)})]),_:1},8,[`title`])],512),K(t).activePanel==`ddl`?(R(),y(me,{key:0,dbType:K(t).dbType,value:r.value,readonly:!0,style:ee({maxHeight:K(t).remainHeight+`px`,overflow:`auto`}),class:`large`},null,8,[`dbType`,`value`,`style`])):b(``,!0)])),[[c,n.value]])}}}),Me=je;const Ne={key:0,class:`design-toolbar`},Pe={class:`text-center`};var Fe=w({__name:`ForeignKey`,setup(a){let o=Te(),{dialect:f,canAlterTable:p,remainHeight:m,activePanel:_}=W(o),w=B([]),T=B([]),E=B([]),D=B([]),O=B(!0),A=z({visible:!1,loading:!1}),j={column:null,refTable:null,refColumn:null,foreignKeyName:null,onUpdate:`NO ACTION`,onDelete:`NO ACTION`},M=z({...j}),N=h(()=>{let{column:e,refTable:t,refColumn:n}=M;return e||t||n?f.value.newForeignKey(M):``});L(()=>{k.on(`designMetaNext`,()=>{A.visible=!1,D.value=f.value.strategies(),F(),k.emit(`tables`)}).on(`foreignKeys`,e=>{O.value=!1,w.value=e}).on(`columnsById`,e=>{M.refColumn=``,E.value=e}).on(`success`,e=>{e==`fk`&&(A.loading=!1,A.visible=!1,F())}).on(`error`,()=>{A.loading=!1}).on(`tables`,e=>{T.value=e})});let P=e=>{k.emit(`columnsById`,e)},F=()=>{let e=f.value.showForeignKeys();e&&(O.value=!0,k.emit(`foreignKeys`,e))},I=()=>{Object.assign(M,j),A.visible=!0,A.loading=!1},ee=()=>{A.loading=!0,k.emit(`execute`,{type:`fk`,sql:N.value})},V=e=>{g(s(`design.deleteFkConfirm`)).then(()=>{k.emit(`execute`,{type:`fk`,sql:f.value.dropForeignKey(e.constraint_name)})})};return(a,f)=>{let h=U(`vsc-button`),g=U(`vsc-tooltip`),k=r,j=n,L=U(`RedMark`),z=e,B=t,W=l,te=u,ne=c,re=i,ie=we;return R(),x(`div`,null,[K(p)?(R(),x(`div`,Ne,[C(g,{title:K(s)(`common.new`)},{default:J(()=>[C(h,{type:`icon`,icon:`codicon-add text-base`,onClick:I})]),_:1},8,[`title`]),C(g,{title:K(s)(`common.refresh`)},{default:J(()=>[C(h,{type:`icon`,icon:`codicon-refresh text-base`,onClick:F})]),_:1},8,[`title`])])):b(``,!0),K(_)==`foreignKey`?Y((R(),y(j,{key:1,data:w.value,style:{width:`100%`},height:K(m),border:``},{default:J(()=>[K(p)?(R(),y(k,{key:0,resizable:!0,align:`center`,prop:`constraint_name`,label:K(s)(`design.constraintName`),width:`150`},null,8,[`label`])):b(``,!0),C(k,{resizable:!0,align:`center`,prop:`column_name`,label:K(s)(`design.column`),width:`150`},null,8,[`label`]),C(k,{resizable:!0,align:`center`,prop:`referenced_table`,label:K(s)(`design.referencedTable`),width:`150`},null,8,[`label`]),C(k,{resizable:!0,align:`center`,prop:`referenced_column`,label:K(s)(`design.referencedColumn`),width:`155`},null,8,[`label`]),C(k,{align:`center`,prop:`updateRule`,label:K(s)(`design.updateRule`),width:`150`},null,8,[`label`]),C(k,{align:`center`,prop:`deleteRule`,label:K(s)(`design.deleteRule`),width:`150`},null,8,[`label`]),K(p)?(R(),y(k,{key:1,label:K(s)(`design.operation`),width:`120`},{default:J(({row:e})=>[v(`div`,Pe,[C(h,{type:`icon`,icon:`el-icon-delete`,style:{color:`#f56c6c`},title:`delete`,onClick:t=>V(e)},null,8,[`onClick`])])]),_:1},8,[`label`])):b(``,!0)]),_:1},8,[`data`,`height`])),[[ie,O.value]]):b(``,!0),C(re,{modelValue:A.visible,"onUpdate:modelValue":f[7]||=e=>A.visible=e,"show-close":!1,title:K(s)(`design.newForeignKey`),width:`780px`,closeOnClickModal:!1,"close-on-press-escape":!1,center:``},{footer:J(()=>[C(h,{type:`secondary`,onClick:f[6]||=e=>A.visible=!1},{default:J(()=>[S(G(K(s)(`common.cancel`)),1)]),_:1}),C(h,{type:`primary`,loading:A.loading,onClick:ee},{default:J(()=>[S(G(K(s)(`common.ok`)),1)]),_:1},8,[`loading`]),f[9]||=v(`br`,null,null,-1),f[10]||=S(),f[11]||=v(`br`,null,null,-1),Y(C(me,{ref:`cmEditor`,value:N.value,readonly:!0},null,8,[`value`]),[[q,N.value]])]),default:J(()=>[C(ne,{inline:!0,"label-width":`150px`,"label-position":`left`,size:`small`},{default:J(()=>[C(W,null,{label:J(()=>[C(L),S(G(K(s)(`design.column`)),1)]),default:J(()=>[C(B,{modelValue:M.column,"onUpdate:modelValue":f[0]||=e=>M.column=e,size:`small`,filterable:``,class:`!w-[170px] mr-4`},{default:J(()=>[(R(!0),x(d,null,H(K(o).columns,e=>(R(),y(z,{key:e.name,label:e.name,value:e.name},null,8,[`label`,`value`]))),128))]),_:1},8,[`modelValue`])]),_:1}),C(W,null,{label:J(()=>[S(G(K(s)(`design.constraintName`)),1)]),default:J(()=>[C(te,{modelValue:M.foreignKeyName,"onUpdate:modelValue":f[1]||=e=>M.foreignKeyName=e,class:`!w-[170px]`},null,8,[`modelValue`])]),_:1}),f[8]||=v(`br`,null,null,-1),C(W,null,{label:J(()=>[C(L),S(G(K(s)(`design.referencedTable`)),1)]),default:J(()=>[C(B,{modelValue:M.refTable,"onUpdate:modelValue":f[2]||=e=>M.refTable=e,size:`small`,filterable:``,class:`!w-[170px] mr-4`},{default:J(()=>[(R(!0),x(d,null,H(T.value,e=>(R(),y(z,{key:e.name,label:e.name,value:e.name,onClick:t=>P(e.id)},null,8,[`label`,`value`,`onClick`]))),128))]),_:1},8,[`modelValue`])]),_:1}),C(W,null,{label:J(()=>[C(L),S(G(K(s)(`design.referencedColumn`)),1)]),default:J(()=>[C(B,{modelValue:M.refColumn,"onUpdate:modelValue":f[3]||=e=>M.refColumn=e,size:`small`,filterable:``,class:`!w-[170px]`},{default:J(()=>[(R(!0),x(d,null,H(E.value,e=>(R(),y(z,{key:e.name,label:e.name,value:e.name},null,8,[`label`,`value`]))),128))]),_:1},8,[`modelValue`])]),_:1}),C(W,{label:`On Update`},{default:J(()=>[C(B,{modelValue:M.onUpdate,"onUpdate:modelValue":f[4]||=e=>M.onUpdate=e,size:`small`,filterable:``,class:`!w-[170px] mr-4`},{default:J(()=>[(R(!0),x(d,null,H(D.value,e=>(R(),y(z,{key:e,label:e,value:e},null,8,[`label`,`value`]))),128))]),_:1},8,[`modelValue`])]),_:1}),C(W,{label:`On Delete`},{default:J(()=>[C(B,{modelValue:M.onDelete,"onUpdate:modelValue":f[5]||=e=>M.onDelete=e,size:`small`,filterable:``,class:`!w-[170px]`},{default:J(()=>[(R(!0),x(d,null,H(D.value,e=>(R(),y(z,{key:e,label:e,value:e},null,8,[`label`,`value`]))),128))]),_:1},8,[`modelValue`])]),_:1})]),_:1})]),_:1},8,[`modelValue`,`title`])])}}}),Ie=Fe;const Le={key:0,ref:`infoPanel`,class:`design-toolbar`},Re=[`title`],ze={class:`text-center`},Be={class:`max-h-[300px] overflow-y-auto`},Ve=[`onClick`];var He=w({__name:`ColumnPanel`,setup(e){let t=Te(),{dbType:f,columns:p,dialect:m,canAlterTable:_,remainHeight:w,activePanel:T}=W(t),D=z({visible:!1,inputting:!1}),O=h(()=>m.value.columnTypes()),A=B([]),j=B(!1),M=B(!0),N=B([]),P={name:``,type:``,unsigned:null,zerofill:null,comment:null,isNotNull:null,defaultValue:null,useCurrentTimestamp:null},F=z({...P}),I=z({isNew:!0,editDisable:!1,editVisible:!1,editLoading:!1}),ee=h(()=>{var e,t;return ne.value&&((e=F.type)==null||(t=e.match)==null?void 0:t.call(e,/(\bint|decimal|float|double)/i))}),V=h(()=>{var e,t;return ne.value&&((e=F.type)==null||(t=e.match)==null?void 0:t.call(e,/timestamp/i))}),te=h(()=>window.innerWidth<=1200),ne=h(()=>[`MySQL`,`Doris`,`MariaDB`].includes(f.value)),re=h(()=>{let e=I.isNew?`design.newColumn`:`design.updateColumn`;return s(e)}),ae=h(()=>D.inputting&&F.type?O.value.filter(e=>(e.label||e).match(new RegExp(F.type,`i`))):O.value),oe=h(()=>{if(I.isNew){let{name:e,type:t}=F;return e&&t?m.value.newColumn(F):``}ee.value||(F.zerofill=!1,F.unsigned=!1),V.value||(F.useCurrentTimestamp=!1);try{return m.value.updateColumn({newColumnName:F.name,columnType:F.type,nullable:!F.isNotNull,...F})}catch(e){return console.error(e),I.editDisable=!0,e}}),se=h(()=>[X.MYSQL,X.MARIA_DB,X.PG,X.DB2].includes(f.value));L(()=>{k.on(`designMetaNext`,e=>{N.value=fe.clone(e.columns),I.editVisible=!1,M.value=!1}).on(`columns`,e=>{N.value=fe.clone(e),M.value=!1}).on(`indexes`,e=>{j.value=!0,A.value=e.filter(e=>ue(e.isUnique)).map(e=>e.column_name)}).on(`success`,e=>{e==`column`&&(I.editLoading=!1,I.editVisible=!1,de())}).on(`error`,()=>{I.editLoading=!1,de()})});let ce=(...e)=>!e.includes(f.value),le=e=>{e&&(F.defaultValue=`CURRENT_TIMESTAMP`)},Z=()=>{let e=ae.value[0];e&&(F.type=e.value||e,D.visible=!1)},de=()=>{k.emit(`columns`),M.value=!0},pe=()=>{Object.assign(F,P),I.isNew=!0,I.editVisible=!0},Q=e=>{Object.assign(F,{...e,columnName:e.name,oldRow:e}),I.isNew=!1,I.editVisible=!0,I.editDisable=!1,I.editLoading=!1},he=(e,t)=>{I.isNew=!1,Object.assign(F,{...e,columnName:e.name,oldRow:N.value[t]}),ge()},ge=()=>{if(!oe.value)return E(`No any change!`);if(I.editLoading=!0,I.isNew)return _e();try{k.emit(`execute`,{type:`column`,sql:oe.value})}catch(e){E(e.message),I.editLoading=!1}},_e=()=>{k.emit(`execute`,{type:`column`,sql:oe.value})},ve=e=>{g(s(`design.deleteColumnConfirm`)).then(()=>{k.emit(`execute`,{type:`column`,sql:m.value.dropColumn(e.name)})})};return(e,t)=>{let m=U(`vsc-button`),h=U(`vsc-tooltip`),g=r,E=a,O=n,k=U(`RedMark`),N=u,P=l,L=o,z=c,B=i,W=we;return R(),x(`div`,null,[K(_)?(R(),x(`div`,Le,[C(h,{title:K(s)(`common.new`)},{default:J(()=>[C(m,{type:`icon`,icon:`codicon-add text-base`,onClick:pe})]),_:1},8,[`title`]),C(h,{title:K(s)(`common.refresh`)},{default:J(()=>[C(m,{type:`icon`,icon:`codicon-refresh text-base`,onClick:de})]),_:1},8,[`title`])],512)):b(``,!0),K(T)==`column`?Y((R(),y(O,{key:1,data:K(p),height:K(w),border:``,onRowDblclick:Q},{default:J(()=>[C(g,{resizable:!0,align:`center`,prop:`name`,label:K(s)(`common.name`),width:`180`},null,8,[`label`]),C(g,{resizable:!0,align:`center`,prop:`type`,label:K(s)(`common.type`),width:te.value?100:130},null,8,[`label`,`width`]),C(g,{resizable:!0,align:`center`,prop:`maximum_length`,width:80,label:K(s)(`design.length`)},null,8,[`label`]),[`DuckDB`].includes(K(f))?b(``,!0):(R(),y(g,{key:0,resizable:!0,align:`center`,prop:`comment`,label:K(s)(`common.comment`),width:`100`},{default:J(({row:e})=>[v(`span`,{title:e?.comment},G(e?.comment),9,Re)]),_:1},8,[`label`])),C(g,{resizable:!0,align:`center`,prop:`defaultValue`,width:te.value?75:110,label:K(s)(`common.default`)},null,8,[`width`,`label`]),C(g,{align:`center`,label:`Not Null`,width:80},{default:J(({row:e,$index:t})=>[C(E,{modelValue:e.isNotNull,"onUpdate:modelValue":t=>e.isNotNull=t,onChange:n=>he(e,t)},null,8,[`modelValue`,`onUpdate:modelValue`,`onChange`])]),_:1}),C(g,{align:`center`,label:K(s)(`design.isPrimary`),width:110},{default:J(({row:e})=>[C(E,{disabled:``,"model-value":e.isPrimary},null,8,[`model-value`])]),_:1},8,[`label`]),j.value||[`MySQL`,`MariaDB`,`Doris`].includes(K(f))?(R(),y(g,{key:1,align:`center`,label:K(s)(`design.isUnique`),width:80},{default:J(({row:e})=>[C(E,{disabled:``,"model-value":e.isUnique||A.value.includes(e.name)},null,8,[`model-value`])]),_:1},8,[`label`])):b(``,!0),[`DuckDB`].includes(K(f))?b(``,!0):(R(),y(g,{key:2,align:`center`,label:K(s)(`design.isAutoIncrement`),width:`130`},{default:J(({row:e,$index:t})=>[C(E,{modelValue:e.isAutoIncrement,"onUpdate:modelValue":t=>e.isAutoIncrement=t,disabled:!e.isPrimary||!se.value,onChange:n=>he(e,t)},null,8,[`modelValue`,`onUpdate:modelValue`,`disabled`,`onChange`])]),_:1},8,[`label`])),[`SQLite`].includes(K(f))?b(``,!0):(R(),y(g,{key:3,label:K(s)(`design.operation`),width:`100`},{default:J(({row:e})=>[v(`div`,ze,[C(m,{type:`icon`,icon:`codicon-edit`,title:`edit`,onClick:t=>Q(e)},null,8,[`onClick`]),C(m,{type:`icon`,icon:`el-icon-delete`,style:{color:`#f56c6c`},title:`delete`,onClick:t=>ve(e)},null,8,[`onClick`])])]),_:1},8,[`label`])),ne.value?(R(),x(d,{key:4},[C(g,{align:`center`,label:`UNSIGNED`,width:`100`},{default:J(({row:e,$index:t})=>[C(E,{modelValue:e.unsigned,"onUpdate:modelValue":t=>e.unsigned=t,"true-value":`1`,"false-value":`0`,onChange:n=>he(e,t)},null,8,[`modelValue`,`onUpdate:modelValue`,`onChange`])]),_:1}),C(g,{align:`center`,label:`Zerofill`,width:`80`},{default:J(({row:e,$index:t})=>[C(E,{modelValue:e.zerofill,"onUpdate:modelValue":t=>e.zerofill=t,"true-value":`1`,"false-value":`0`,onChange:n=>he(e,t)},null,8,[`modelValue`,`onUpdate:modelValue`,`onChange`])]),_:1})],64)):b(``,!0)]),_:1},8,[`data`,`height`])),[[W,M.value]]):b(``,!0),C(B,{modelValue:I.editVisible,"onUpdate:modelValue":t[12]||=e=>I.editVisible=e,"show-close":!1,title:re.value,width:`680px`,closeOnClickModal:!1,"close-on-press-escape":!1,center:``},{footer:J(()=>[C(m,{type:`secondary`,onClick:t[11]||=e=>I.editVisible=!1},{default:J(()=>[S(G(K(s)(`common.cancel`)),1)]),_:1}),C(m,{type:`primary`,loading:I.editLoading,disabled:I.editDisable,onClick:ge},{default:J(()=>[S(G(K(s)(`common.ok`)),1)]),_:1},8,[`loading`,`disabled`]),t[14]||=v(`br`,null,null,-1),t[15]||=S(),t[16]||=v(`br`,null,null,-1),Y(C(me,{ref:`cmEditor`,value:oe.value,readonly:!0},null,8,[`value`]),[[q,oe.value]])]),default:J(()=>[C(z,{inline:!0,"label-width":`90px`,size:`small`},{default:J(()=>[C(P,null,{label:J(()=>[C(k),S(G(K(s)(`common.name`)),1)]),default:J(()=>[C(N,{modelValue:F.name,"onUpdate:modelValue":t[0]||=e=>F.name=e,size:`small`,fixed:``},null,8,[`modelValue`])]),_:1}),ee.value?(R(),y(P,{key:0,label:`ZEROFILL`},{default:J(()=>[C(E,{modelValue:F.zerofill,"onUpdate:modelValue":t[1]||=e=>F.zerofill=e,"true-value":`1`,"false-value":`0`},null,8,[`modelValue`])]),_:1})):b(``,!0),V.value?(R(),y(P,{key:1,label:`CURRENT_TIMESTAMP`,"label-width":`160px`},{default:J(()=>[C(E,{modelValue:F.useCurrentTimestamp,"onUpdate:modelValue":t[2]||=e=>F.useCurrentTimestamp=e,onChange:le},null,8,[`modelValue`])]),_:1})):b(``,!0),t[13]||=v(`br`,null,null,-1),C(P,null,{label:J(()=>[C(k),S(G(K(s)(`common.type`)),1)]),default:J(()=>[C(L,{visible:D.visible,"onUpdate:visible":t[6]||=e=>D.visible=e,placement:`bottom-start`,"popper-class":`!p-0`,trigger:`click`,tabindex:null},{reference:J(()=>[C(N,{modelValue:F.type,"onUpdate:modelValue":t[3]||=e=>F.type=e,size:`small`,fixed:``,onKeyup:ie(Z,[`enter`]),onInput:t[4]||=e=>{D.inputting=!0,D.visible=!0},onClick:t[5]||=e=>D.inputting=!1},null,8,[`modelValue`])]),default:J(()=>[v(`div`,Be,[(R(!0),x(d,null,H(ae.value,(e,t)=>(R(),x(d,null,[e==`hr`?(R(),x(`div`,{key:t,class:`w-full type-hr bg-bg`})):(R(),x(`div`,{key:1,class:`el-select-dropdown__item !h-6 min-w-[190px] bg-[var(--vscode-dropdown-background)]`,onClick:t=>{F.type=e.value||e,D.visible=!1}},G(e.label||e),9,Ve))],64))),256))])]),_:1},8,[`visible`])]),_:1}),ce(`ClickHouse`)?(R(),y(P,{key:2,label:K(s)(`design.isNotNull`)},{default:J(()=>[C(E,{modelValue:F.isNotNull,"onUpdate:modelValue":t[7]||=e=>F.isNotNull=e},null,8,[`modelValue`])]),_:1},8,[`label`])):b(``,!0),ee.value?(R(),y(P,{key:3,label:`UNSIGNED`},{default:J(()=>[C(E,{modelValue:F.unsigned,"onUpdate:modelValue":t[8]||=e=>F.unsigned=e,"true-value":`1`,"false-value":`0`},null,8,[`modelValue`])]),_:1})):b(``,!0),![`Snowflake`].includes(K(f))||I.isNew?(R(),y(P,{key:4,label:K(s)(`common.default`)},{default:J(()=>[C(N,{modelValue:F.defaultValue,"onUpdate:modelValue":t[9]||=e=>F.defaultValue=e,size:`small`,fixed:``},null,8,[`modelValue`])]),_:1},8,[`label`])):b(``,!0),[`DuckDB`].includes(K(f))?b(``,!0):(R(),y(P,{key:5,label:K(s)(`common.comment`)},{default:J(()=>[C(N,{modelValue:F.comment,"onUpdate:modelValue":t[10]||=e=>F.comment=e,size:`small`,fixed:``},null,8,[`modelValue`])]),_:1},8,[`label`]))]),_:1})]),_:1},8,[`modelValue`,`title`])])}}}),Ue=p(He,[[`__scopeId`,`data-v-ab428a54`]]);const We={class:`ml-4`},Ge={class:`flex flex-col gap-y-2`},Ke={class:`flex-wrap`},qe={class:`inline-block mr-5`},Je={class:`font-bold mr-5 inline-block`},Ye={class:`inline-block mr-5`},Xe={class:`font-bold mr-5 inline-block`},Ze={class:`flex-wrap`},Qe={key:0,class:`inline-block mr-5`},$e={class:`font-bold mr-5 inline-block`},et={key:1,class:`inline-block mr-5`},tt={class:`font-bold mr-5 inline-block`},nt={class:`inline-block pt-1`};var rt=w({__name:`InfoPanel`,setup(n){let r=Te(),{dialect:i}=W(r),a=B([]),o=z({name:null,schema:null,newTableName:null,comment:null,newComment:null,collation:null,newCollation:null});L(()=>{k.on(`designMetaNext`,e=>{o.name=e.table,o.schema=e.schema,o.newTableName=e.table,o.comment=e.comment,o.newComment=e.comment,o.collation=e.collation,o.newCollation=e.collation}).on(`collations`,e=>{a.value=e})});let s=()=>{let e={...o,table:o.name};k.emit(`updateTable`,e);let t=i.value.updateTable(e);t?k.emit(`execute`,{type:`table`,sql:t}):E(`No any change!`)};return(n,i)=>{let c=u,l=e,f=t,p=U(`vsc-button`);return R(),x(`div`,We,[v(`div`,Ge,[v(`div`,Ke,[v(`div`,qe,[v(`label`,Je,G(n.$t(`design.table`)),1),C(c,{modelValue:o.newTableName,"onUpdate:modelValue":i[0]||=e=>o.newTableName=e,class:`!w-48`,required:``,onKeyup:ie(s,[`enter`])},null,8,[`modelValue`])]),v(`div`,Ye,[v(`label`,Xe,G(n.$t(`common.comment`)),1),C(c,{modelValue:o.newComment,"onUpdate:modelValue":i[1]||=e=>o.newComment=e,class:`!w-48`,onKeyup:ie(s,[`enter`])},null,8,[`modelValue`])])]),v(`div`,Ze,[K(r).tableMeta.engine?(R(),x(`div`,Qe,[v(`label`,$e,G(n.$t(`design.engine`)),1),C(c,{value:K(r).tableMeta.engine,class:`!w-24`,disabled:``},null,8,[`value`])])):b(``,!0),o.collation&&a.value.length>0?(R(),x(`div`,et,[v(`label`,tt,G(n.$t(`design.collate`)),1),C(f,{modelValue:o.newCollation,"onUpdate:modelValue":i[2]||=e=>o.newCollation=e,size:`small`,filterable:``,class:`w-44`},{default:J(()=>[(R(!0),x(d,null,H(a.value,e=>(R(),y(l,{key:e.name,label:e.name,value:e.name},null,8,[`label`,`value`]))),128))]),_:1},8,[`modelValue`])])):b(``,!0),v(`div`,nt,[C(p,{type:`success`,onClick:s},{default:J(()=>[S(G(n.$t(`common.update`)),1)]),_:1})])])])])}}}),it=rt;const at={key:0,class:`design-toolbar`},ot={class:`text-center`};var st=w({__name:`Check`,setup(e){let t=Te(),{dialect:a,canAlterTable:o,remainHeight:d,activePanel:f}=W(t),p=B([]),m=B(!0),_=z({visible:!1,loading:!1}),w=z({clause:null}),T=h(()=>w.clause?a.value.newCheck(w.clause):``);L(()=>{k.on(`designMetaNext`,e=>{e.isSupportCheck&&(E(),_.visible=!1)}).on(`checks`,e=>{m.value=!1,p.value=e}).on(`success`,e=>{e==`check`&&(E(),_.visible=!1,_.loading=!1)}).on(`error`,()=>{_.loading=!1})});let E=()=>{let e=a.value.showChecks();if(!e){console.log(`This database type does not currently support check.`),m.value=!1;return}m.value=!0,k.emit(`checks`,e)},D=()=>{_.visible=!0,_.loading=!1,w.clause=null},O=()=>{_.loading=!0,k.emit(`execute`,{type:`check`,sql:T.value})},A=e=>{g(s(`design.deleteCheckConfirm`)).then(()=>{k.emit(`execute`,{type:`check`,sql:a.value.dropCheck(e.name)})})};return(e,t)=>{let a=U(`vsc-button`),h=U(`vsc-tooltip`),g=r,k=n,j=U(`RedMark`),M=u,N=l,P=c,F=i,I=we;return R(),x(`div`,null,[K(o)?(R(),x(`div`,at,[C(h,{title:K(s)(`common.new`)},{default:J(()=>[C(a,{type:`icon`,icon:`codicon-add text-base`,onClick:D})]),_:1},8,[`title`]),C(h,{title:K(s)(`common.refresh`)},{default:J(()=>[C(a,{type:`icon`,icon:`codicon-refresh text-base`,onClick:E})]),_:1},8,[`title`])])):b(``,!0),K(f)==`check`?Y((R(),y(k,{key:1,data:p.value,height:K(d),border:``},{default:J(()=>[K(o)?(R(),y(g,{key:0,resizable:!0,align:`center`,prop:`name`,label:K(s)(`design.constraintName`),width:`200`},null,8,[`label`])):b(``,!0),C(g,{resizable:!0,align:`center`,prop:`clause`,label:K(s)(`design.clause`),width:`200`},null,8,[`label`]),K(o)?(R(),y(g,{key:1,label:K(s)(`design.operation`),width:`100`},{default:J(({row:e})=>[v(`div`,ot,[C(a,{type:`icon`,icon:`el-icon-delete`,style:{color:`#f56c6c`},title:`delete`,onClick:t=>A(e)},null,8,[`onClick`])])]),_:1},8,[`label`])):b(``,!0)]),_:1},8,[`data`,`height`])),[[I,m.value]]):b(``,!0),C(F,{modelValue:_.visible,"onUpdate:modelValue":t[3]||=e=>_.visible=e,"show-close":!1,title:K(s)(`design.newCheck`),width:`430px`,closeOnClickModal:!1,"close-on-press-escape":!1,center:``},{footer:J(()=>[C(a,{type:`secondary`,onClick:t[2]||=e=>_.visible=!1},{default:J(()=>[S(G(K(s)(`common.cancel`)),1)]),_:1}),C(a,{type:`primary`,loading:_.loading,onClick:O},{default:J(()=>[S(G(K(s)(`common.ok`)),1)]),_:1},8,[`loading`]),t[4]||=v(`br`,null,null,-1),t[5]||=S(),t[6]||=v(`br`,null,null,-1),Y(C(me,{ref:`cmEditor`,value:T.value,readonly:!0},null,8,[`value`]),[[q,T.value]])]),default:J(()=>[C(P,{inline:!0,"label-width":`80px`,"label-position":`left`,onSubmit:t[1]||=ae(()=>{},[`prevent`]),onKeyup:ie(O,[`enter`])},{default:J(()=>[C(N,null,{label:J(()=>[C(j),S(G(K(s)(`design.clause`)),1)]),default:J(()=>[C(M,{modelValue:w.clause,"onUpdate:modelValue":t[0]||=e=>w.clause=e,class:`!w-[290px]`,size:`small`,placeholder:`e.g. id >20 and name!='admin'`},null,8,[`modelValue`])]),_:1})]),_:1})]),_:1},8,[`modelValue`,`title`])])}}}),ct=st;const lt={key:0,class:`design-toolbar`};var ut=w({__name:`Trigger`,setup(e){let t=Te(),{dialect:a,canAlterTable:o,remainHeight:d,activePanel:f}=W(t),p=B([]),m=B(!0),_=z({visible:!1,loading:!1}),w=z({clause:null}),T=h(()=>``);L(()=>{k.on(`designMetaNext`,()=>{E(),_.visible=!1}).on(`triggers`,e=>{m.value=!1,p.value=e}).on(`success`,e=>{e==`trigger`&&(E(),_.visible=!1,_.loading=!1)}).on(`error`,()=>{_.loading=!1})});let E=()=>{m.value=!0,k.emit(`triggers`)},D=()=>{_.visible=!0,_.loading=!1,w.clause=null},O=()=>{_.loading=!0,k.emit(`execute`,{type:`trigger`,sql:T.value})},A=e=>{g(s(`design.deleteTriggerConfirm`)).then(()=>{k.emit(`execute`,{type:`trigger`,sql:a.value.dropTrigger(e.name)})})};return(e,t)=>{let a=U(`vsc-button`),h=U(`vsc-tooltip`),g=r,D=n,k=U(`RedMark`),A=u,j=l,M=c,N=i,P=we;return R(),x(`div`,null,[K(o)?(R(),x(`div`,lt,[C(h,{title:K(s)(`common.refresh`)},{default:J(()=>[C(a,{type:`icon`,icon:`codicon-refresh text-base`,onClick:E})]),_:1},8,[`title`])])):b(``,!0),K(f)==`trigger`?Y((R(),y(D,{key:1,data:p.value,height:K(d),border:``},{default:J(()=>[C(g,{resizable:!0,align:`center`,prop:`trigger_name`,label:K(s)(`design.triggerName`),width:`200`},null,8,[`label`]),C(g,{resizable:!0,align:`center`,prop:`timing`,label:K(s)(`design.timing`),width:`200`},null,8,[`label`]),C(g,{resizable:!0,align:`center`,prop:`manipulation`,label:K(s)(`design.manipulation`),width:`200`},null,8,[`label`]),C(g,{resizable:!0,align:`center`,prop:`orientation`,label:K(s)(`design.orientation`),width:`200`},null,8,[`label`]),C(g,{resizable:!0,align:`center`,prop:`statement`,label:K(s)(`design.statement`),width:`200`},{default:J(e=>[S(G(e.row.source||e.row.statement),1)]),_:1},8,[`label`])]),_:1},8,[`data`,`height`])),[[P,m.value]]):b(``,!0),C(N,{modelValue:_.visible,"onUpdate:modelValue":t[3]||=e=>_.visible=e,"show-close":!1,title:K(s)(`design.newTrigger`),width:`430px`,closeOnClickModal:!1,"close-on-press-escape":!1,center:``},{footer:J(()=>[C(a,{type:`secondary`,onClick:t[2]||=e=>_.visible=!1},{default:J(()=>[S(G(K(s)(`common.cancel`)),1)]),_:1}),C(a,{type:`primary`,loading:_.loading,onClick:O},{default:J(()=>[S(G(K(s)(`common.ok`)),1)]),_:1},8,[`loading`]),t[4]||=v(`br`,null,null,-1),t[5]||=S(),t[6]||=v(`br`,null,null,-1),Y(C(me,{ref:`cmEditor`,value:T.value,readonly:!0},null,8,[`value`]),[[q,T.value]])]),default:J(()=>[C(M,{inline:!0,"label-width":`80px`,"label-position":`left`,onSubmit:t[1]||=ae(()=>{},[`prevent`]),onKeyup:ie(O,[`enter`])},{default:J(()=>[C(j,null,{label:J(()=>[C(k),S(G(K(s)(`design.clause`)),1)]),default:J(()=>[C(A,{modelValue:w.clause,"onUpdate:modelValue":t[0]||=e=>w.clause=e,class:`!w-[290px]`,size:`small`,placeholder:`e.g. AFTER INSERT ON table_name FOR EACH ROW`},null,8,[`modelValue`])]),_:1})]),_:1})]),_:1},8,[`modelValue`,`title`])])}}}),dt=ut,$=class{constructor(e){this.meta=e,this.dialect=pe(e.dbType),this.wrappedTable=Z(this.meta.table,this.meta.dbType,se.Always)}updateTable(e){return this.dialect.updateTable(e)}columnTypes(){return[`INTEGER`,{label:`VARCHAR`,value:`VARCHAR(255)`},{label:`CHAR`,value:`CHAR(50)`},`hr`,`DATE`,`TIMESTAMP`,`hr`,`BOOLEAN`,`FLOAT`,`DOUBLE`,`hr`,`TEXT`,`JSON`,`BLOB`]}strategies(){return[`RESTRICT`,`CASCADE`,`SET NULL`,`SET DEFAULT`,`NO ACTION`]}newColumn(e){let{name:t,type:n,isNotNull:r}=e,i=r?` NOT NULL`:``;return`ALTER TABLE ${this.wrappedTable} ADD COLUMN ${Z(t,this.meta.dbType)} ${n}${i}`}updateColumn(e){return this.dialect.updateColumnSql({...e,table:this.meta.table,tableMeta:this.meta,schema:this.meta.schema})}dropColumn(e){return`ALTER TABLE ${this.wrappedTable} DROP COLUMN ${Z(e,this.meta.dbType)}`}formatIndexType(e){return e.index_type}indexTypes(){return[{label:`INDEX`,value:`INDEX`},{label:`UNIQUE`,value:`UNIQUE`}]}newIndex(e){return`ALTER TABLE ${this.wrappedTable} ADD INDEX (${e.columns.join(`,`)})`}dropIndex(e){return this.dialect.dropIndex(this.wrappedTable,e)}dropTrigger(e){return this.dialect.dropTriggerTemplate(e,this.wrappedTable)}showChecks(){return this.dialect.showChecks(this.meta.schema,this.meta.table)}showTriggers(){return this.dialect.showTriggers(this.meta.schema,this.meta.table)}showIndex(){return this.dialect.showIndex(this.meta.schema,this.meta.table)}showForeignKeys(){return this.dialect.showForeignKeys(this.meta.schema,this.meta.table)}newForeignKey(e){let{column:t,foreignKeyName:n,refTable:r,refColumn:i,onUpdate:a,onDelete:o}=e,s=a==`NO ACTION`?``:` ON UPDATE ${a}`,c=o==`NO ACTION`?``:` ON DELETE ${o}`;return new Q(`ALTER TABLE "${this.meta.table}"`).if(n,()=>`ADD CONSTRAINT ${n}`).if(!n,`ADD`).append(`FOREIGN KEY ("${t}") REFERENCES "${r}"("${i}")${s}${c};`).toString()}dropForeignKey(e){return`ALTER TABLE "${this.meta.table}" DROP CONSTRAINT ${e};`}newCheck(e){return`ALTER TABLE ${this.wrappedTable} ADD CHECK (${e});`}dropCheck(e){return`ALTER TABLE ${this.wrappedTable} DROP CONSTRAINT ${e};`}splitColumn(e,t=`"`){return e.map(e=>t+e+t).join(`,`)}},ft=class extends ${columnTypes(){return[`Int32`,`String`,`Float32`,`hr`,`Date`,`DateTime`,`hr`,`BOOLEAN`,`UUID`,{label:`Array`,value:`Array(String)`},`hr`,`JSON`,{label:`Tuple`,value:`Tuple(String)`},{label:`Map`,value:`Map(String,String)`},`hr`,`Int8`,`Int16`,`Int64`,`Int128`,`Int256`,`UInt8`,`UInt16`,`UInt32`,`UInt64`,`UInt128`,`UInt256`,`hr`,`DateTime64`,`DateTime32`,`hr`,`Decimal32`,`Decimal64`,`Decimal128`,`Decimal256`,`hr`,`IPv4`,`IPv6`,`hr`,{label:`Enum8`,value:`Enum8('a'=1)`},{label:`Enum16`,value:`Enum16('a'=1)`},`hr`,{label:`FixedString`,value:`FixedString(100)`}]}newColumn(e){let{name:t,type:n,defaultValue:r,comment:i}=e;return new Q(`ALTER TABLE ${this.wrappedTable} ADD COLUMN "${t}" ${n}`).if(!le(r),`DEFAULT ${ce(r,n)}`).if(i,`COMMENT '${i}'`).toString()}newIndex(e){let{columns:t}=e;return`ALTER TABLE "${this.meta.table}" ADD INDEX ${t.join(``)}_${new Date().getTime()}_index expression TYPE type GRANULARITY value AFTER ${this.splitColumn(t)}`}showForeignKeys(){return null}showChecks(){return null}},pt=class extends ${newColumn(e){let{name:t,type:n,defaultValue:r,isNotNull:i}=e;return new Q(`ALTER TABLE "${this.meta.schema}".${Z(this.meta.table,this.meta.dbType)} ADD ${Z(t,this.meta.dbType)} ${n}`).if(i,`NOT NULL`).if(!le(r),`DEFAULT ${ce(r,n)}`).toString()}dropColumn(e){return`ALTER TABLE "${this.meta.schema}".${this.wrappedTable} DROP COLUMN ${Z(e,this.meta.dbType)}`}newIndex(e){let{table:t=this.meta.table,columns:n,type:r}=e,i=`${t}_${n.join(`_`)}_${new Date().getTime()}`,a=r==`UNIQUE`?`UNIQUE`:``;return`CREATE ${a} INDEX ${i} ON "${this.meta.schema}"."${t}"(${this.splitColumn(n)});`}newCheck(e){return`ALTER TABLE "${this.meta.schema}".${this.wrappedTable} ADD CHECK (${e});`}dropCheck(e){return`ALTER TABLE "${this.meta.schema}".${this.wrappedTable} DROP CONSTRAINT ${e};`}dropForeignKey(e){return`ALTER TABLE "${this.meta.schema}"."${this.meta.table}" DROP CONSTRAINT ${e};`}newForeignKey(e){return super.newForeignKey(e).replace(`"${this.meta.table}"`,`"${this.meta.schema}"."${this.meta.table}"`)}},mt=class extends ${indexTypes(){return[{label:`INDEX`,value:`INDEX`},{label:`UNIQUE`,value:`UNIQUE`},{label:`FULLTEXT`,value:`FULLTEXT`}]}columnTypes(){return[`INT`,{label:`VARCHAR`,value:`VARCHAR(255)`},{label:`CHAR`,value:`CHAR(50)`},`hr`,`DATETIME`,`TIMESTAMP`,`DATE`,`hr`,`BIT`,`FLOAT`,`DOUBLE`,{label:`DECIMAL`,value:`DECIMAL(10,2)`},`BIGINT`,`hr`,`TEXT`,`JSON`,`BLOB`,`BINARY`,`hr`,{label:`ENUM`,value:`ENUM('item')`},{label:`SET`,value:`SET('item')`},`hr`,`TINYINT`,`SMALLINT`,`MEDIUMINT`,`hr`,`TIME`,`YEAR`,`hr`,`VARBINARY`,`TINYBLOB`,`MEDIUMBLOB`,`LONGBLOB`,`TINYTEXT`,`MEDIUMTEXT`,`LONGTEXT`,`hr`,`GEOMETRY`,`POINT`,`LINESTRING`,`POLYGON`,`MULTIPOINT`,`MULTILINESTRING`,`MULTIPOLYGON`,`GEOMETRYCOLLECTION`]}newColumn(e){let{name:t,type:n,comment:r,defaultValue:i,isNotNull:a,unsigned:o,zerofill:s}=e;return console.log(e),new Q(`ALTER TABLE ${this.wrappedTable} ADD COLUMN \`${t}\` ${n}`).if(o&&o!=0,`UNSIGNED`).if(s,`ZEROFILL`).if(a,`NOT NULL`).if(r,`COMMENT '${r}'`).if(!le(i),`DEFAULT ${ce(i,n)}`).toString()}formatIndexType(e){let t=e.index_type.toUpperCase();return t==`BTREE`?e.index_name==`PRIMARY`?`PRIMARY`:ue(e.isUnique)?`UNIQUE`:`KEY`:t}newIndex(e){let{type:t=`key`,columns:n}=e;return`ALTER TABLE \`${this.meta.table}\` ADD ${t} (${this.splitColumn(n,"`")})`}newForeignKey(e){let{column:t,foreignKeyName:n,refTable:r,refColumn:i,onUpdate:a,onDelete:o}=e,s=a==`NO ACTION`?``:` ON UPDATE ${a}`,c=o==`NO ACTION`?``:` ON DELETE ${o}`;return new Q(`ALTER TABLE \`${this.meta.table}\``).if(n,()=>`ADD CONSTRAINT ${n}`).if(!n,`ADD`).append(`FOREIGN KEY (\`${t}\`) REFERENCES \`${r}\`(\`${i}\`)${s}${c};`).toString()}dropForeignKey(e){return`ALTER TABLE \`${this.meta.table}\` DROP FOREIGN KEY ${e};`}},ht=class extends ${newIndex(e){let{table:t=this.meta.table,columns:n,type:r}=e,i=`${t}_${n.join(`_`)}_${new Date().getTime()}`,a=r==`UNIQUE`?`UNIQUE`:``;return`CREATE ${a} INDEX ${i} ON "${t}"(${this.splitColumn(n)})`}newColumn(e){let{name:t,type:n,isNotNull:r,defaultValue:i,comment:a}=e;return new Q(`ALTER TABLE ${Z(this.meta.table,this.meta.dbType)} ADD ${t} ${n}`).if(!le(i),`DEFAULT ${ce(i,n)}`).if(r,`NOT NULL`).if(a,`;\nCOMMENT ON COLUMN ${this.wrappedTable}."${t.toUpperCase()}" is '${a}';`).toString()}newForeignKey(e){let{column:t,foreignKeyName:n,refTable:r,refColumn:i,onUpdate:a,onDelete:o}=e,s=a==`NO ACTION`?``:` ON UPDATE ${a}`,c=o==`NO ACTION`?``:` ON DELETE ${o}`,l=n||`${t}_${r}_${i}_fk_${Math.floor(Math.random()*30)}`;return`ALTER TABLE "${this.meta.table}" ADD CONSTRAINT ${l} FOREIGN KEY ("${t}") REFERENCES ${r}(${i})${s}${c};`}showForeignKeys(){var e;let{schema:t}=this.meta;return t?.toLowerCase()==(e=this.meta.user)?.toLowerCase()&&(t=void 0),this.dialect.showForeignKeys(t,this.meta.table)}columnTypes(){return[`INTEGER`,{label:`VARCHAR2`,value:`VARCHAR2(255)`},{label:`CHAR`,value:`CHAR(50)`},`hr`,`DATE`,`TIMESTAMP`,`hr`,`NUMBER`,`FLOAT`,`hr`,`CLOB`,`BLOB`,`hr`,`BINARY_FLOAT`,`BINARY_DOUBLE`,`hr`,`TIMESTAMP WITH TIME ZONE`,`TIMESTAMP WITH LOCAL TIME ZONE`,`hr`,`INTERVAL YEAR TO MONTH`,`INTERVAL DAY TO SECOND`,`hr`,`RAW`,`LONG RAW`,`LONG`,`hr`,`NCHAR`,`NVARCHAR2`,`NCLOB`,`hr`,`BFILE`,`ROWID`,`UROWID`]}},gt=class extends ${newColumn(e){let{name:t,type:n,comment:r,defaultValue:i,isNotNull:a}=e,o=this.wrappedTable;return new Q(`ALTER TABLE ${o} ADD COLUMN "${t}" ${n}`).if(a,`NOT NULL`).if(!le(i),`DEFAULT ${ce(i,n)}`).append(`;`).if(r,`\nCOMMENT ON COLUMN ${o}."${t}" is '${r}';`).toString()}columnTypes(){return[`INTEGER`,{label:`VARCHAR`,value:`VARCHAR(255)`},{label:`CHAR`,value:`CHAR(50)`},`TIMESTAMP`,`DATE`,`BOOLEAN`,`FLOAT`,`TEXT`,`JSON`,`BLOB`,`hr`,`SMALLINT`,`BIGINT`,`REAL`,`DOUBLE PRECISION`,`hr`,`BYTEA`,`XML`,`UUID`,`ARRAY`,`hr`,`NUMERIC`,`MONEY`,`INTERVAL`,`CIDR`,`INET`,`MACADDR`]}indexTypes(){return[{label:`INDEX`,value:`INDEX`},{label:`UNIQUE`,value:`UNIQUE`},{label:`HASH`,value:`HASH`}]}newIndex(e){let{table:t=this.meta.table,columns:n,type:r}=e,i=r==`HASH`?`hash`:`btree`,a=r==`UNIQUE`?`UNIQUE`:``;return`CREATE ${a} INDEX ${n.join(`_`)}_${new Date().getTime()}_index ON "${t}" USING ${i} (${this.splitColumn(n)});`}},_t=class extends ${newIndex(e){throw Error(`Method not implemented.`)}dropForeignKey(e){return`ALTER TABLE "${this.meta.table}" DROP CONSTRAINT "${e}";`}showForeignKeys(){return`select
       rco.constraint_name "constraint_name",
       rco.UPDATE_RULE "updateRule",
       rco.DELETE_RULE "deleteRule",
       pk_tco.table_name "referenced_table"
from information_schema.referential_constraints rco
    join information_schema.table_constraints fk_tco on fk_tco.constraint_name = rco.constraint_name and fk_tco.constraint_schema = rco.constraint_schema
    join information_schema.table_constraints pk_tco on pk_tco.constraint_name = rco.unique_constraint_name and pk_tco.constraint_schema = rco.unique_constraint_schema
    WHERE fk_tco.TABLE_SCHEMA='${this.meta.schema}' and fk_tco.table_name='${this.meta.table}' 
    ORDER BY rco.CREATED`}},vt=class extends ${newIndex(e){let{table:t=this.meta.table,columns:n}=e,r=`${t}_${n.join(`_`)}_${new Date().getTime()}`;return`CREATE INDEX ${r} ON "${t}"(${this.splitColumn(n)});`}showForeignKeys(){return`SELECT "from" column_name, "table" referenced_table, "to" referenced_column,
        on_update, on_delete 
        FROM pragma_foreign_key_list('${this.meta.table}');`}showChecks(){return null}},yt=class extends ${newColumn(e){let{type:t,defaultValue:n}=e;return new Q(super.newColumn(e)).if(!le(n),`DEFAULT ${ce(n,t)}`).toString()}newIndex(e){let{table:t=this.meta.table,columns:n}=e,r=`${t}_${n.join(`_`)}_${new Date().getTime()}`;return`CREATE INDEX ${r} ON "${t}"(${this.splitColumn(n)});`}showForeignKeys(){return`SELECT constraint_column_names "column_name" FROM duckdb_constraints()
        WHERE constraint_type='FOREIGN KEY' and database_name not in ('system','temp') and schema_name='${this.meta.schema}' and table_name='${this.meta.table}'`}showChecks(){return null}},bt=class extends pt{columnTypes(){return[`INTEGER`,{label:`VARCHAR`,value:`VARCHAR(255)`},{label:`CHAR`,value:`CHAR(50)`},`hr`,`DATE`,`TIMESTAMP`,`TIME`,`hr`,`BOOLEAN`,`FLOAT`,`DOUBLE`,`hr`,`TEXT`,`BLOB`,`hr`,`SMALLINT`,`BIGINT`,`DECFLOAT`,`hr`,`TIMESTAMP WITH TIME ZONE`,`TIME WITH TIME ZONE`,`hr`,`XML`,`GRAPHIC`,`VARGRAPHIC`,`hr`,`DBCLOB`,`CLOB`]}},xt=class extends pt{columnTypes(){return`INTEGER.TEXT.hr.DATE.TIMESTAMP.hr.BOOLEAN.FLOAT.DOUBLE.hr.BLOB.hr.BIGINT.SMALLINT.TINYINT.VARINT.hr.TIME.TIMEUUID.hr.DECIMAL.COUNTER.hr.UUID.INET.ASCII.DURATION`.split(`.`)}dropColumn(e){return`ALTER TABLE ${this.wrappedTable} DROP ${Z(e,this.meta.dbType)}`}};function St(e){switch(e.dbType){case X.PG:case X.REDSHIFT:case X.KINGBASE:case X.GAUSS_DB:case X.COCKROACH:return new gt(e);case X.DM:case X.ORACLE:return new ht(e);case X.DB2:return new bt(e);case X.CASSANDRA:return new xt(e);case X.SQLServer:return new pt(e);case X.SNOWFLAKE:return new _t(e);case X.CLICKHOUSE:return new ft(e);case X.DUCK_DB:return new yt(e);case X.D1:case X.libSQL:case X.SQLITE:return new vt(e);case X.MYSQL:case X.MARIA_DB:case X.DATABRICKS:return new mt(e);default:return new $(e)}}const Ct={class:`mt-2 design-container`},wt={id:`infoPanel`},Tt={class:`tab`},Et=[`onClick`],Dt={class:`design-data-container`};var Ot=w({__name:`design`,setup(e){let t=B(!1),n=Te(),r=h(()=>n.activePanel),i=h(()=>[{id:`ddl`,i18n:`design.ddl`,icon:`codicon-edit green`},{id:`column`,i18n:`design.column`,icon:`codicon-symbol-field blue`},{id:`foreignKey`,i18n:`design.foreignKey`,icon:`codicon-symbol-class yellow`,hidden:h(()=>!n.supportForeignKey)},{id:`index`,i18n:`design.index`,icon:`codicon-github-action purple`,hidden:h(()=>!n.supportIndex)},{id:`trigger`,i18n:`design.trigger`,icon:`codicon-github-action orange`,hidden:h(()=>!n.supportTrigger)},{id:`check`,i18n:`design.check`,icon:`codicon-tools red`,hidden:h(()=>!n.supportCheck||!t.value)}].filter(e=>{var t;return(e==null||(t=e.hidden)==null?void 0:t.value)!=1}));L(()=>{k.on(`dbType`,e=>{n.updateDBType(e)}).on(`designMeta`,e=>{t.value=e.isSupportCheck,n.dialect=St(e),n.updateFullInfo(e),k.emitImmediately(`designMetaNext`,e)}).on(`success`,()=>{te(s(`design.updateSuccess`))}).on(`error`,e=>{E(e)}).on(`refresh_design`,()=>{a()}),a(),de(55,[`tableTab`,`infoPanel`],e=>{n.remainHeight=e})});let a=()=>{k.emit(`init`,{type:`design`})};return(e,t)=>(R(),x(`div`,Ct,[v(`div`,wt,[C(it),v(`ul`,Tt,[(R(!0),x(d,null,H(i.value,(e,t)=>(R(),x(`li`,{key:t,class:I([`tab__item`,{"tab__item--active":r.value==e.id}]),onClick:t=>K(n).activePanel=e.id},[e.icon?(R(),x(`i`,{key:0,type:`icon`,class:I(e.icon),style:{position:`relative`,top:`3px`}},null,2)):b(``,!0),S(` `+G(K(s)(e.i18n)),1)],10,Et))),128))])]),v(`div`,Dt,[Y(C(Me,null,null,512),[[q,r.value==`ddl`]]),Y(C(Ue,null,null,512),[[q,r.value==`column`]]),Y(C(Ie,null,null,512),[[q,r.value==`foreignKey`]]),Y(C(ke,null,null,512),[[q,r.value==`index`]]),Y(C(dt,null,null,512),[[q,r.value==`trigger`]]),Y(C(ct,null,null,512),[[q,r.value==`check`]])])]))}}),kt=p(Ot,[[`__scopeId`,`data-v-68f3d12d`]]);export{kt as default};