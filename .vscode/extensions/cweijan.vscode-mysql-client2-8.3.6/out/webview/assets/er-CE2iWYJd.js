import{__export as e}from"./chunk-CYDSZ_fb.js";import{_SetCache_default as t,_cacheHas_default as n,debounce_default as r,isEqual_default as i,toNumber_default as a}from"./isEqual-DUAGDpZY.js";import{_arrayIncludesWith_default as o,_arrayIncludes_default as s,_baseUniq_default as c,union_default as l}from"./union-BGbNc9gG.js";import"./_baseFindIndex-Ctm2P5pj.js";import{_baseRest_default as u,isArrayLikeObject_default as d}from"./isArrayLikeObject-DWAcihF8.js";import{_baseEach_default as f,_baseMap_default as p,_baseMerge_default as m,_createAssigner_default as h,_isIterateeCall_default as g,isPlainObject_default as _,merge_default as v}from"./merge-XDSJ7w6H.js";import{cloneDeep_default as y}from"./cloneDeep-CaMXGqpU.js";import{_baseIteratee_default as b}from"./_baseIteratee-t-25AuYs.js";import{ElDialog as x}from"./dialog-BxcJDRn2.js";import{ElRadioButton as S,ElRadioGroup as C}from"./radio-DiiA3Vy3.js";import{Fragment as ee,Teleport as w,__plugin_vue_export_helper_default as T,_apply_default as E,_arrayMap_default as te,_baseAssignValue_default as ne,_baseFlatten_default as re,_baseGetTag_default as ie,_baseGet_default as ae,_baseKeys_default as oe,_baseUnary_default as se,_getTag_default as ce,_hasPath_default as le,_isPrototype_default as ue,clone_default as de,createApp as fe,createBaseVNode as D,createBlock as pe,createCommentVNode as me,createElementBlock as he,createTextVNode as ge,createVNode as _e,defineComponent as ve,eq_default as ye,h as be,handler as xe,identity_default as Se,inject as Ce,isArguments_default as we,isArrayLike_default as Te,isArray_default as Ee,isBuffer_default as De,isObjectLike_default as Oe,isObject_default as ke,isSymbol_default as Ae,isTypedArray_default as je,keysIn_default as Me,markRaw as Ne,normalizeClass as Pe,onMounted as Fe,openBlock as Ie,reactive as Le,ref as Re,renderList as ze,renderSlot as Be,resolveComponent as Ve,toDisplayString as He,toString_default as Ue,unref as We,useCoreStore as Ge,withCtx as Ke}from"./app-ctFZFRv9.js";import"./constants-36FjBj35.js";import"./wrapper-D-Es_PY1.js";import{listenHeight as qe}from"./common_view_utils-DtJZIhkt.js";import"./objectUtil-DGxGSfnv.js";import{ArrayUtil as Je}from"./arrayUtil-SL5L5q5A.js";function Ye(e,t,n){var r=-1,i=e.length;t<0&&(t=-t>i?0:i+t),n=n>i?i:n,n<0&&(n+=i),i=t>n?0:n-t>>>0,t>>>=0;for(var a=Array(i);++r<i;)a[r]=e[r+t];return a}var Xe=Ye;function Ze(e,t,n){var r=e.length;return n=n===void 0?r:n,!t&&n>=r?e:Xe(e,t,n)}var Qe=Ze,$e=`\\ud800-\\udfff`,et=`\\u0300-\\u036f`,tt=`\\ufe20-\\ufe2f`,nt=`\\u20d0-\\u20ff`,rt=et+tt+nt,it=`\\ufe0e\\ufe0f`,at=`\\u200d`,ot=RegExp(`[`+at+$e+rt+it+`]`);function st(e){return ot.test(e)}var ct=st;function lt(e){return e.split(``)}var ut=lt,dt=`\\ud800-\\udfff`,ft=`\\u0300-\\u036f`,pt=`\\ufe20-\\ufe2f`,mt=`\\u20d0-\\u20ff`,ht=ft+pt+mt,gt=`\\ufe0e\\ufe0f`,_t=`[`+dt+`]`,vt=`[`+ht+`]`,yt=`\\ud83c[\\udffb-\\udfff]`,bt=`(?:`+vt+`|`+yt+`)`,xt=`[^`+dt+`]`,St=`(?:\\ud83c[\\udde6-\\uddff]){2}`,Ct=`[\\ud800-\\udbff][\\udc00-\\udfff]`,wt=`\\u200d`,Tt=bt+`?`,Et=`[`+gt+`]?`,Dt=`(?:`+wt+`(?:`+[xt,St,Ct].join(`|`)+`)`+Et+Tt+`)*`,Ot=Et+Tt+Dt,kt=`(?:`+[xt+vt+`?`,vt,St,Ct,_t].join(`|`)+`)`,At=RegExp(yt+`(?=`+yt+`)|`+kt+Ot,`g`);function jt(e){return e.match(At)||[]}var Mt=jt;function Nt(e){return ct(e)?Mt(e):ut(e)}var Pt=Nt;function Ft(e){return function(t){t=Ue(t);var n=ct(t)?Pt(t):void 0,r=n?n[0]:t.charAt(0),i=n?Qe(n,1).join(``):t.slice(1);return r[e]()+i}}var It=Ft,Lt=It(`toUpperCase`),Rt=Lt;function zt(e){return Rt(Ue(e).toLowerCase())}var Bt=zt;function Vt(e,t,n,r){var i=-1,a=e==null?0:e.length;for(r&&a&&(n=e[++i]);++i<a;)n=t(n,e[i],i,e);return n}var Ht=Vt;function Ut(e){return function(t){return e?.[t]}}var Wt=Ut,Gt={À:`A`,Á:`A`,Â:`A`,Ã:`A`,Ä:`A`,Å:`A`,à:`a`,á:`a`,â:`a`,ã:`a`,ä:`a`,å:`a`,Ç:`C`,ç:`c`,Ð:`D`,ð:`d`,È:`E`,É:`E`,Ê:`E`,Ë:`E`,è:`e`,é:`e`,ê:`e`,ë:`e`,Ì:`I`,Í:`I`,Î:`I`,Ï:`I`,ì:`i`,í:`i`,î:`i`,ï:`i`,Ñ:`N`,ñ:`n`,Ò:`O`,Ó:`O`,Ô:`O`,Õ:`O`,Ö:`O`,Ø:`O`,ò:`o`,ó:`o`,ô:`o`,õ:`o`,ö:`o`,ø:`o`,Ù:`U`,Ú:`U`,Û:`U`,Ü:`U`,ù:`u`,ú:`u`,û:`u`,ü:`u`,Ý:`Y`,ý:`y`,ÿ:`y`,Æ:`Ae`,æ:`ae`,Þ:`Th`,þ:`th`,ß:`ss`,Ā:`A`,Ă:`A`,Ą:`A`,ā:`a`,ă:`a`,ą:`a`,Ć:`C`,Ĉ:`C`,Ċ:`C`,Č:`C`,ć:`c`,ĉ:`c`,ċ:`c`,č:`c`,Ď:`D`,Đ:`D`,ď:`d`,đ:`d`,Ē:`E`,Ĕ:`E`,Ė:`E`,Ę:`E`,Ě:`E`,ē:`e`,ĕ:`e`,ė:`e`,ę:`e`,ě:`e`,Ĝ:`G`,Ğ:`G`,Ġ:`G`,Ģ:`G`,ĝ:`g`,ğ:`g`,ġ:`g`,ģ:`g`,Ĥ:`H`,Ħ:`H`,ĥ:`h`,ħ:`h`,Ĩ:`I`,Ī:`I`,Ĭ:`I`,Į:`I`,İ:`I`,ĩ:`i`,ī:`i`,ĭ:`i`,į:`i`,ı:`i`,Ĵ:`J`,ĵ:`j`,Ķ:`K`,ķ:`k`,ĸ:`k`,Ĺ:`L`,Ļ:`L`,Ľ:`L`,Ŀ:`L`,Ł:`L`,ĺ:`l`,ļ:`l`,ľ:`l`,ŀ:`l`,ł:`l`,Ń:`N`,Ņ:`N`,Ň:`N`,Ŋ:`N`,ń:`n`,ņ:`n`,ň:`n`,ŋ:`n`,Ō:`O`,Ŏ:`O`,Ő:`O`,ō:`o`,ŏ:`o`,ő:`o`,Ŕ:`R`,Ŗ:`R`,Ř:`R`,ŕ:`r`,ŗ:`r`,ř:`r`,Ś:`S`,Ŝ:`S`,Ş:`S`,Š:`S`,ś:`s`,ŝ:`s`,ş:`s`,š:`s`,Ţ:`T`,Ť:`T`,Ŧ:`T`,ţ:`t`,ť:`t`,ŧ:`t`,Ũ:`U`,Ū:`U`,Ŭ:`U`,Ů:`U`,Ű:`U`,Ų:`U`,ũ:`u`,ū:`u`,ŭ:`u`,ů:`u`,ű:`u`,ų:`u`,Ŵ:`W`,ŵ:`w`,Ŷ:`Y`,ŷ:`y`,Ÿ:`Y`,Ź:`Z`,Ż:`Z`,Ž:`Z`,ź:`z`,ż:`z`,ž:`z`,Ĳ:`IJ`,ĳ:`ij`,Œ:`Oe`,œ:`oe`,ŉ:`'n`,ſ:`s`},Kt=Wt(Gt),qt=Kt,Jt=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,Yt=`\\u0300-\\u036f`,Xt=`\\ufe20-\\ufe2f`,Zt=`\\u20d0-\\u20ff`,Qt=Yt+Xt+Zt,$t=`[`+Qt+`]`,en=RegExp($t,`g`);function tn(e){return e=Ue(e),e&&e.replace(Jt,qt).replace(en,``)}var nn=tn,rn=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g;function an(e){return e.match(rn)||[]}var on=an,sn=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/;function cn(e){return sn.test(e)}var ln=cn,un=`\\ud800-\\udfff`,dn=`\\u0300-\\u036f`,fn=`\\ufe20-\\ufe2f`,pn=`\\u20d0-\\u20ff`,mn=dn+fn+pn,hn=`\\u2700-\\u27bf`,gn=`a-z\\xdf-\\xf6\\xf8-\\xff`,_n=`\\xac\\xb1\\xd7\\xf7`,vn=`\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf`,yn=`\\u2000-\\u206f`,bn=` \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000`,xn=`A-Z\\xc0-\\xd6\\xd8-\\xde`,Sn=`\\ufe0e\\ufe0f`,Cn=_n+vn+yn+bn,wn=`['’]`,Tn=`[`+Cn+`]`,En=`[`+mn+`]`,Dn=`\\d+`,On=`[`+hn+`]`,kn=`[`+gn+`]`,An=`[^`+un+Cn+Dn+hn+gn+xn+`]`,jn=`\\ud83c[\\udffb-\\udfff]`,Mn=`(?:`+En+`|`+jn+`)`,Nn=`[^`+un+`]`,Pn=`(?:\\ud83c[\\udde6-\\uddff]){2}`,Fn=`[\\ud800-\\udbff][\\udc00-\\udfff]`,In=`[`+xn+`]`,Ln=`\\u200d`,Rn=`(?:`+kn+`|`+An+`)`,zn=`(?:`+In+`|`+An+`)`,Bn=`(?:`+wn+`(?:d|ll|m|re|s|t|ve))?`,Vn=`(?:`+wn+`(?:D|LL|M|RE|S|T|VE))?`,Hn=Mn+`?`,Un=`[`+Sn+`]?`,Wn=`(?:`+Ln+`(?:`+[Nn,Pn,Fn].join(`|`)+`)`+Un+Hn+`)*`,Gn=`\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])`,Kn=`\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])`,qn=Un+Hn+Wn,Jn=`(?:`+[On,Pn,Fn].join(`|`)+`)`+qn,Yn=RegExp([In+`?`+kn+`+`+Bn+`(?=`+[Tn,In,`$`].join(`|`)+`)`,zn+`+`+Vn+`(?=`+[Tn,In+Rn,`$`].join(`|`)+`)`,In+`?`+Rn+`+`+Bn,In+`+`+Vn,Kn,Gn,Dn,Jn].join(`|`),`g`);function Xn(e){return e.match(Yn)||[]}var Zn=Xn;function Qn(e,t,n){return e=Ue(e),t=n?void 0:t,t===void 0?ln(e)?Zn(e):on(e):e.match(t)||[]}var $n=Qn,er=`['’]`,tr=RegExp(er,`g`);function nr(e){return function(t){return Ht($n(nn(t).replace(tr,``)),e,``)}}var rr=nr,ir=rr(function(e,t,n){return t=t.toLowerCase(),e+(n?Bt(t):t)}),ar=ir;function or(e,t,n){return e===e&&(n!==void 0&&(e=e<=n?e:n),t!==void 0&&(e=e>=t?e:t)),e}var sr=or;function cr(e,t,n){return n===void 0&&(n=t,t=void 0),n!==void 0&&(n=a(n),n=n===n?n:0),t!==void 0&&(t=a(t),t=t===t?t:0),sr(a(e),t,n)}var lr=cr;function ur(e,t,n,r){for(var i=-1,a=e==null?0:e.length;++i<a;){var o=e[i];t(r,o,n(o),e)}return r}var dr=ur;function fr(e,t,n,r){return f(e,function(e,i,a){t(r,e,n(e),a)}),r}var pr=fr;function mr(e,t){return function(n,r){var i=Ee(n)?dr:pr,a=t?t():{};return i(n,e,b(r,2),a)}}var hr=mr,gr=Object.prototype,_r=gr.hasOwnProperty,vr=u(function(e,t){e=Object(e);var n=-1,r=t.length,i=r>2?t[2]:void 0;for(i&&g(t[0],t[1],i)&&(r=1);++n<r;)for(var a=t[n],o=Me(a),s=-1,c=o.length;++s<c;){var l=o[s],u=e[l];(u===void 0||ye(u,gr[l])&&!_r.call(e,l))&&(e[l]=a[l])}return e}),yr=vr;function br(e,t,n,r,i,a){return ke(e)&&ke(t)&&(a.set(t,e),m(e,t,void 0,br,a),a.delete(t)),e}var xr=br,Sr=h(function(e,t,n,r){m(e,t,n,r)}),Cr=Sr,wr=u(function(e){return e.push(void 0,xr),E(Cr,void 0,e)}),Tr=wr,Er=200;function Dr(e,r,i,a){var c=-1,l=s,u=!0,d=e.length,f=[],p=r.length;if(!d)return f;i&&(r=te(r,se(i))),a?(l=o,u=!1):r.length>=Er&&(l=n,u=!1,r=new t(r));outer:for(;++c<d;){var m=e[c],h=i==null?m:i(m);if(m=a||m!==0?m:0,u&&h===h){for(var g=p;g--;)if(r[g]===h)continue outer;f.push(m)}else l(r,h,a)||f.push(m)}return f}var Or=Dr,kr=u(function(e,t){return d(e)?Or(e,re(t,1,d,!0)):[]}),Ar=kr,jr=Object.prototype,Mr=jr.hasOwnProperty,Nr=hr(function(e,t,n){Mr.call(e,n)?e[n].push(t):ne(e,n,[t])}),Pr=Nr;function Fr(e,t){return e>t}var Ir=Fr,Lr=Object.prototype,Rr=Lr.hasOwnProperty;function zr(e,t){return e!=null&&Rr.call(e,t)}var Br=zr;function Vr(e,t){return e!=null&&le(e,t,Br)}var Hr=Vr,Ur=`[object Map]`,Wr=`[object Set]`,Gr=Object.prototype,Kr=Gr.hasOwnProperty;function qr(e){if(e==null)return!0;if(Te(e)&&(Ee(e)||typeof e==`string`||typeof e.splice==`function`||De(e)||je(e)||we(e)))return!e.length;var t=ce(e);if(t==Ur||t==Wr)return!e.size;if(ue(e))return!oe(e).length;for(var n in e)if(Kr.call(e,n))return!1;return!0}var Jr=qr,Yr=`[object Number]`;function Xr(e){return typeof e==`number`||Oe(e)&&ie(e)==Yr}var Zr=Xr,Qr=rr(function(e,t,n){return e+(n?` `:``)+t.toLowerCase()}),$r=Qr,ei=It(`toLowerCase`),ti=ei;function ni(e,t,n){for(var r=-1,i=e.length;++r<i;){var a=e[r],o=t(a);if(o!=null&&(s===void 0?o===o&&!Ae(o):n(o,s)))var s=o,c=a}return c}var ri=ni;function ii(e){return e&&e.length?ri(e,Se,Ir):void 0}var ai=ii;function oi(e,t){var n=e.length;for(e.sort(t);n--;)e[n]=e[n].value;return e}var si=oi;function ci(e,t){if(e!==t){var n=e!==void 0,r=e===null,i=e===e,a=Ae(e),o=t!==void 0,s=t===null,c=t===t,l=Ae(t);if(!s&&!l&&!a&&e>t||a&&o&&c&&!s&&!l||r&&o&&c||!n&&c||!i)return 1;if(!r&&!a&&!l&&e<t||l&&n&&i&&!r&&!a||s&&n&&i||!o&&i||!c)return-1}return 0}var li=ci;function ui(e,t,n){for(var r=-1,i=e.criteria,a=t.criteria,o=i.length,s=n.length;++r<o;){var c=li(i[r],a[r]);if(c){if(r>=s)return c;var l=n[r];return c*(l==`desc`?-1:1)}}return e.index-t.index}var di=ui;function fi(e,t,n){t=t.length?te(t,function(e){return Ee(e)?function(t){return ae(t,e.length===1?e[0]:e)}:e}):[Se];var r=-1;t=te(t,se(b));var i=p(e,function(e,n,i){var a=te(t,function(t){return t(e)});return{criteria:a,index:++r,value:e}});return si(i,function(e,t){return di(e,t,n)})}var pi=fi,mi=u(function(e,t){if(e==null)return[];var n=t.length;return n>1&&g(e,t[0],t[1])?t=[]:n>2&&g(t[0],t[1],t[2])&&(t=[t[0]]),pi(e,re(t,1),[])}),hi=mi,gi=4294967295,_i=gi-1,vi=Math.floor,yi=Math.min;function bi(e,t,n,r){var i=0,a=e==null?0:e.length;if(a===0)return 0;t=n(t);for(var o=t!==t,s=t===null,c=Ae(t),l=t===void 0;i<a;){var u=vi((i+a)/2),d=n(e[u]),f=d!==void 0,p=d===null,m=d===d,h=Ae(d);if(o)var g=r||m;else g=l?m&&(r||f):s?m&&f&&(r||!p):c?m&&f&&!p&&(r||!h):p||h?!1:r?d<=t:d<t;g?i=u+1:a=u}return yi(a,_i)}var xi=bi,Si=4294967295,Ci=Si>>>1;function wi(e,t,n){var r=0,i=e==null?r:e.length;if(typeof t==`number`&&t===t&&i<=Ci){for(;r<i;){var a=r+i>>>1,o=e[a];o!==null&&!Ae(o)&&(n?o<=t:o<t)?r=a+1:i=a}return i}return xi(e,t,Se,n)}var Ti=wi;function Ei(e,t){return Ti(e,t)}var Di=Ei;function Oi(e,t,n){return xi(e,t,b(n,2))}var ki=Oi,Ai=rr(function(e,t,n){return e+(n?` `:``)+Rt(t)}),ji=Ai,Mi=`Expected a function`;function Ni(e,t,n){var i=!0,a=!0;if(typeof e!=`function`)throw TypeError(Mi);return ke(n)&&(i=`leading`in n?!!n.leading:i,a=`trailing`in n?!!n.trailing:a),r(e,t,{leading:i,maxWait:t,trailing:a})}var Pi=Ni;function Fi(e){return e&&e.length?c(e):[]}var Ii=Fi,Li=rr(function(e,t,n){return e+(n?` `:``)+t.toUpperCase()}),Ri=Li;typeof window==`object`&&window.NodeList&&!NodeList.prototype.forEach&&(NodeList.prototype.forEach=Array.prototype.forEach),typeof window<`u`&&function(e){e.forEach(e=>{Object.prototype.hasOwnProperty.call(e,`append`)||Object.defineProperty(e,`append`,{configurable:!0,enumerable:!0,writable:!0,value(...e){let t=document.createDocumentFragment();e.forEach(e=>{let n=e instanceof Node;t.appendChild(n?e:document.createTextNode(String(e)))}),this.appendChild(t)}})})}([Element.prototype,Document.prototype,DocumentFragment.prototype]);var zi=class{get disposed(){return this._disposed===!0}dispose(){this._disposed=!0}};(function(e){function t(){return(e,t,n)=>{let r=n.value,i=e.__proto__;n.value=function(...e){this.disposed||(r.call(this,...e),i.dispose.call(this))}}}e.dispose=t})(zi||={});var Bi=class{constructor(){this.isDisposed=!1,this.items=new Set}get disposed(){return this.isDisposed}dispose(){this.isDisposed||(this.isDisposed=!0,this.items.forEach(e=>{e.dispose()}),this.items.clear())}contains(e){return this.items.has(e)}add(e){this.items.add(e)}remove(e){this.items.delete(e)}clear(){this.items.clear()}};(function(e){function t(t){let n=new e;return t.forEach(e=>{n.add(e)}),n}e.from=t})(Bi||={});function Vi(e,t,n){if(n)switch(n.length){case 0:return e.call(t);case 1:return e.call(t,n[0]);case 2:return e.call(t,n[0],n[1]);case 3:return e.call(t,n[0],n[1],n[2]);case 4:return e.call(t,n[0],n[1],n[2],n[3]);case 5:return e.call(t,n[0],n[1],n[2],n[3],n[4]);case 6:return e.call(t,n[0],n[1],n[2],n[3],n[4],n[5]);default:return e.apply(t,n)}return e.call(t)}function O(e,t,...n){return Vi(e,t,n)}function Hi(e){return typeof e==`object`&&e.then&&typeof e.then==`function`}function Ui(e){return e!=null&&(e instanceof Promise||Hi(e))}function Wi(...e){let t=[];e.forEach(e=>{Array.isArray(e)?t.push(...e):t.push(e)});let n=t.some(e=>Ui(e));if(n){let e=t.map(e=>Ui(e)?e:Promise.resolve(e!==!1));return Promise.all(e).then(e=>e.reduce((e,t)=>t!==!1&&e,!0))}return t.every(e=>e!==!1)}function Gi(e,t){let n=[];for(let r=0;r<e.length;r+=2){let i=e[r],a=e[r+1],o=Array.isArray(t)?t:[t],s=Vi(i,a,o);n.push(s)}return Wi(n)}var Ki=class{constructor(){this.listeners={}}on(e,t,n){if(t==null)return this;this.listeners[e]||(this.listeners[e]=[]);let r=this.listeners[e];return r.push(t,n),this}once(e,t,n){let r=(...i)=>(this.off(e,r),Gi([t,n],i));return this.on(e,r,this)}off(e,t,n){if(!(e||t||n))return this.listeners={},this;let r=this.listeners,i=e?[e]:Object.keys(r);return i.forEach(e=>{let i=r[e];if(i){if(!(t||n)){delete r[e];return}for(let e=i.length-2;e>=0;e-=2)t&&i[e]!==t||n&&i[e+1]!==n||i.splice(e,2)}}),this}trigger(e,...t){let n=!0;if(e!==`*`){let r=this.listeners[e];r!=null&&(n=Gi([...r],t))}let r=this.listeners[`*`];return r==null?n:Wi([n,Gi([...r],[e,...t])])}emit(e,...t){return this.trigger(e,...t)}};function qi(e,...t){t.forEach(t=>{Object.getOwnPropertyNames(t.prototype).forEach(n=>{n!==`constructor`&&Object.defineProperty(e.prototype,n,Object.getOwnPropertyDescriptor(t.prototype,n))})})}const Ji=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(let n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])};function Yi(e,t){Ji(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}var Xi=class{};const Zi=/^\s*class\s+/.test(`${Xi}`)||/^\s*class\s*\{/.test(`${class{}}`);function Qi(e,t){let n;return Zi?n=class extends t{}:(n=function(){return t.apply(this,arguments)},Yi(n,t)),Object.defineProperty(n,`name`,{value:e}),n}function $i(e){return e===`__proto__`}function ea(e,t,n=`/`){let r,i=Array.isArray(t)?t:t.split(n);if(i.length)for(r=e;i.length;){let e=i.shift();if(Object(r)===r&&e&&e in r)r=r[e];else return}return r}function ta(e,t,n,r=`/`){let i=Array.isArray(t)?t:t.split(r),a=i.pop();if(a&&!$i(a)){let t=e;i.forEach(e=>{$i(e)||(t[e]??(t[e]={}),t=t[e])}),t[a]=n}return e}function na(e,t,n=`/`){let r=Array.isArray(t)?t.slice():t.split(n),i=r.pop();if(i)if(r.length>0){let t=ea(e,r);t&&delete t[i]}else delete e[i];return e}var ra=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},ia=class extends Ki{dispose(){this.off()}};ra([zi.dispose()],ia.prototype,`dispose`,null),function(e){e.dispose=zi.dispose}(ia||={}),qi(ia,zi);const aa=e=>{let t=Object.create(null);return n=>{let r=t[n];return r||(t[n]=e(n))}},oa=aa(e=>e.replace(/\B([A-Z])/g,`-$1`).toLowerCase()),sa=aa(e=>ji(ar(e)).replace(/ /g,``)),ca=aa(e=>Ri(e).replace(/ /g,`_`)),la=aa(e=>$r(e).replace(/ /g,`.`)),ua=aa(e=>$r(e).replace(/ /g,`/`)),da=aa(e=>Rt($r(e))),fa=aa(e=>ji(ar(e)));function pa(e){let t=2166136261,n=!1,r=e;for(let e=0,i=r.length;e<i;e+=1){let i=r.charCodeAt(e);i>127&&!n&&(r=unescape(encodeURIComponent(r)),i=r.charCodeAt(e),n=!0),t^=i,t+=(t<<1)+(t<<4)+(t<<7)+(t<<8)+(t<<24)}return t>>>0}function ma(){let e=``,t=`xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx`;for(let n=0,r=t.length;n<r;n+=1){let r=t[n],i=Math.random()*16|0,a=r===`x`?i:r===`y`?i&3|8:r;e+=a.toString(16)}return e}function ha(e,t,n){let r=Math.min(2,Math.floor(e.length*.34)),i=Math.floor(e.length*.4)+1,a,o=!1,s=e.toLowerCase();for(let c of t){let t=n(c);if(t!==void 0&&Math.abs(t.length-s.length)<=r){let n=t.toLowerCase();if(n===s){if(t===e)continue;return c}if(o||t.length<3)continue;let r=ga(s,n,i-1);if(r===void 0)continue;r<3?(o=!0,a=c):(i=r,a=c)}}return a}function ga(e,t,n){let r=Array(t.length+1),i=Array(t.length+1),a=n+1;for(let e=0;e<=t.length;e+=1)r[e]=e;for(let o=1;o<=e.length;o+=1){let s=e.charCodeAt(o-1),c=o>n?o-n:1,l=t.length>n+o?n+o:t.length;i[0]=o;let u=o;for(let e=1;e<c;e+=1)i[e]=a;for(let e=c;e<=l;e+=1){let n=s===t.charCodeAt(e-1)?r[e-1]:Math.min(r[e]+1,i[e-1]+1,r[e-1]+2);i[e]=n,u=Math.min(u,n)}for(let e=l+1;e<=t.length;e+=1)i[e]=a;if(u>n)return;let d=r;r=i,i=d}let o=r[t.length];return o>n?void 0:o}function _a(e){return typeof e==`string`&&e.slice(-1)===`%`}function va(e,t){if(e==null)return 0;let n;if(typeof e==`string`){if(n=parseFloat(e),_a(e)&&(n/=100,Number.isFinite(n)))return n*t}else n=e;return Number.isFinite(n)?n>0&&n<1?n*t:n:0}function ya(e){if(typeof e==`object`){let t=0,n=0,r=0,i=0;return e.vertical!=null&&Number.isFinite(e.vertical)&&(n=i=e.vertical),e.horizontal!=null&&Number.isFinite(e.horizontal)&&(r=t=e.horizontal),e.left!=null&&Number.isFinite(e.left)&&(t=e.left),e.top!=null&&Number.isFinite(e.top)&&(n=e.top),e.right!=null&&Number.isFinite(e.right)&&(r=e.right),e.bottom!=null&&Number.isFinite(e.bottom)&&(i=e.bottom),{top:n,right:r,bottom:i,left:t}}let t=0;return e!=null&&Number.isFinite(e)&&(t=e),{top:t,right:t,bottom:t,left:t}}let ba=!1,xa=!1,Sa=!1,Ca=!1,wa=!1,Ta=!1,Ea=!1,Da=!1,Oa=!1,ka=!1,Aa=!1,ja=!1,Ma=!1,Na=!1,Pa=!1,Fa=!1;if(typeof navigator==`object`){let e=navigator.userAgent;ba=e.indexOf(`Macintosh`)>=0,xa=!!e.match(/(iPad|iPhone|iPod)/g),Sa=e.indexOf(`Windows`)>=0,Ca=e.indexOf(`MSIE`)>=0,wa=!!e.match(/Trident\/7\./),Ta=!!e.match(/Edge\//),Ea=e.indexOf(`Mozilla/`)>=0&&e.indexOf(`MSIE`)<0&&e.indexOf(`Edge/`)<0,Oa=e.indexOf(`Chrome/`)>=0&&e.indexOf(`Edge/`)<0,ka=e.indexOf(`Opera/`)>=0||e.indexOf(`OPR/`)>=0,Aa=e.indexOf(`Firefox/`)>=0,ja=e.indexOf(`AppleWebKit/`)>=0&&e.indexOf(`Chrome/`)<0&&e.indexOf(`Edge/`)<0,typeof document==`object`&&(Fa=!document.createElementNS||`${document.createElementNS(`http://www.w3.org/2000/svg`,`foreignObject`)}`!=`[object SVGForeignObjectElement]`||e.indexOf(`Opera/`)>=0)}if(typeof window==`object`&&(Da=window.chrome!=null&&window.chrome.app!=null&&window.chrome.app.runtime!=null,Na=window.PointerEvent!=null&&!ba),typeof document==`object`){Ma=`ontouchstart`in document.documentElement;try{let e=Object.defineProperty({},`passive`,{get(){Pa=!0}}),t=document.createElement(`div`);t.addEventListener&&t.addEventListener(`click`,()=>{},e)}catch{}}var Ia;(function(e){e.IS_MAC=ba,e.IS_IOS=xa,e.IS_WINDOWS=Sa,e.IS_IE=Ca,e.IS_IE11=wa,e.IS_EDGE=Ta,e.IS_NETSCAPE=Ea,e.IS_CHROME_APP=Da,e.IS_CHROME=Oa,e.IS_OPERA=ka,e.IS_FIREFOX=Aa,e.IS_SAFARI=ja,e.SUPPORT_TOUCH=Ma,e.SUPPORT_POINTER=Na,e.SUPPORT_PASSIVE=Pa,e.NO_FOREIGNOBJECT=Fa,e.SUPPORT_FOREIGNOBJECT=!e.NO_FOREIGNOBJECT})(Ia||={}),function(e){function t(){let e=window.module;return e!=null&&e.hot!=null&&e.hot.status!=null?e.hot.status():`unkonwn`}e.getHMRStatus=t;function n(){return t()===`apply`}e.isApplyingHMR=n;let r={select:`input`,change:`input`,submit:`form`,reset:`form`,error:`img`,load:`img`,abort:`img`};function i(e){let t=document.createElement(r[e]||`div`),n=`on${e}`,i=n in t;return i||(t.setAttribute(n,`return;`),i=typeof t[n]==`function`),i}e.isEventSupported=i}(Ia||={});const La=/[\t\r\n\f]/g,Ra=/\S+/g,za=e=>` ${e} `;function Ba(e){return e&&e.getAttribute&&e.getAttribute(`class`)||``}function Va(e,t){if(e==null||t==null)return!1;let n=za(Ba(e)),r=za(t);return e.nodeType===1?n.replace(La,` `).includes(r):!1}function k(e,t){if(!(e==null||t==null)){if(typeof t==`function`)return k(e,t(Ba(e)));if(typeof t==`string`&&e.nodeType===1){let n=t.match(Ra)||[],r=za(Ba(e)).replace(La,` `),i=n.reduce((e,t)=>e.indexOf(za(t))<0?`${e}${t} `:e,r);i=i.trim(),r!==i&&e.setAttribute(`class`,i)}}}function Ha(e,t){if(e!=null){if(typeof t==`function`)return Ha(e,t(Ba(e)));if((!t||typeof t==`string`)&&e.nodeType===1){let n=(t||``).match(Ra)||[],r=za(Ba(e)).replace(La,` `),i=n.reduce((e,t)=>{let n=za(t);return e.indexOf(n)>-1?e.replace(n,` `):e},r);i=t?i.trim():``,r!==i&&e.setAttribute(`class`,i)}}}function Ua(e,t,n){if(!(e==null||t==null)){if(n!=null&&typeof t==`string`){n?k(e,t):Ha(e,t);return}if(typeof t==`function`)return Ua(e,t(Ba(e),n),n);if(typeof t==`string`){let n=t.match(Ra)||[];n.forEach(t=>{Va(e,t)?Ha(e,t):k(e,t)})}}}let Wa=0;function Ga(){return Wa+=1,`v${Wa}`}function Ka(e){return(e.id==null||e.id===``)&&(e.id=Ga()),e.id}function qa(e){return e==null?!1:typeof e.getScreenCTM==`function`&&e instanceof SVGElement}const A={svg:`http://www.w3.org/2000/svg`,xmlns:`http://www.w3.org/2000/xmlns/`,xml:`http://www.w3.org/XML/1998/namespace`,xlink:`http://www.w3.org/1999/xlink`,xhtml:`http://www.w3.org/1999/xhtml`},Ja=`1.1`;function Ya(e,t=document){return t.createElement(e)}function Xa(e,t=A.xhtml,n=document){return n.createElementNS(t,e)}function Za(e,t=document){return Xa(e,A.svg,t)}function Qa(e){if(e){let t=`<svg xmlns="${A.svg}" xmlns:xlink="${A.xlink}" version="${Ja}">${e}</svg>`,{documentElement:n}=$a(t,{async:!1});return n}let t=document.createElementNS(A.svg,`svg`);return t.setAttributeNS(A.xmlns,`xmlns:xlink`,A.xlink),t.setAttribute(`version`,Ja),t}function $a(e,t={}){let n;try{let r=new DOMParser;if(t.async!=null){let e=r;e.async=t.async}n=r.parseFromString(e,t.mimeType||`text/xml`)}catch{n=void 0}if(!n||n.getElementsByTagName(`parsererror`).length)throw Error(`Invalid XML: ${e}`);return n}function eo(e,t=!0){let n=e.nodeName;return t?n.toLowerCase():n.toUpperCase()}function to(e){let t=0,n=e.previousSibling;for(;n;)n.nodeType===1&&(t+=1),n=n.previousSibling;return t}function no(e,t){return e.querySelectorAll(t)}function ro(e,t){return e.querySelector(t)}function io(e,t,n){let r=e.ownerSVGElement,i=e.parentNode;for(;i&&i!==n&&i!==r;){if(Va(i,t))return i;i=i.parentNode}return null}function ao(e,t){let n=t&&t.parentNode;return e===n||!!(n&&n.nodeType===1&&e.compareDocumentPosition(n)&16)}function oo(e){if(e){let t=Array.isArray(e)?e:[e];t.forEach(e=>{e.parentNode&&e.parentNode.removeChild(e)})}}function so(e){for(;e.firstChild;)e.removeChild(e.firstChild)}function co(e,t){let n=Array.isArray(t)?t:[t];n.forEach(t=>{t!=null&&e.appendChild(t)})}function lo(e,t){let n=e.firstChild;return n?uo(n,t):co(e,t)}function uo(e,t){let n=e.parentNode;if(n){let r=Array.isArray(t)?t:[t];r.forEach(t=>{t!=null&&n.insertBefore(t,e)})}}function fo(e,t){t?.appendChild(e)}function po(e){return!!e&&e.nodeType===1}function mo(e){try{return e instanceof HTMLElement}catch{return typeof e==`object`&&e.nodeType===1&&typeof e.style==`object`&&typeof e.ownerDocument==`object`}}const ho=[`viewBox`,`attributeName`,`attributeType`,`repeatCount`,`textLength`,`lengthAdjust`,`gradientUnits`];function go(e,t){return e.getAttribute(t)}function _o(e,t){let n=bo(t);n.ns?e.hasAttributeNS(n.ns,n.local)&&e.removeAttributeNS(n.ns,n.local):e.hasAttribute(t)&&e.removeAttribute(t)}function vo(e,t,n){if(n==null)return _o(e,t);let r=bo(t);r.ns&&typeof n==`string`?e.setAttributeNS(r.ns,t,n):t===`id`?e.id=`${n}`:e.setAttribute(t,`${n}`)}function yo(e,t){Object.keys(t).forEach(n=>{vo(e,n,t[n])})}function j(e,t,n){if(t==null){let t=e.attributes,n={};for(let e=0;e<t.length;e+=1)n[t[e].name]=t[e].value;return n}if(typeof t==`string`&&n===void 0)return e.getAttribute(t);typeof t==`object`?yo(e,t):vo(e,t,n)}function bo(e){if(e.indexOf(`:`)!==-1){let t=e.split(`:`);return{ns:A[t[0]],local:t[1]}}return{ns:null,local:e}}function xo(e){let t={};return Object.keys(e).forEach(n=>{let r=ho.includes(n)?n:oa(n);t[r]=e[n]}),t}function So(e){let t={},n=e.split(`;`);return n.forEach(e=>{let n=e.trim();if(n){let e=n.split(`=`);e.length&&(t[e[0].trim()]=e[1]?e[1].trim():``)}}),t}function Co(e,t){return Object.keys(t).forEach(n=>{if(n===`class`)e[n]=e[n]?`${e[n]} ${t[n]}`:t[n];else if(n===`style`){let r=typeof e[n]==`object`,i=typeof t[n]==`object`,a,o;r&&i?(a=e[n],o=t[n]):r?(a=e[n],o=So(t[n])):i?(a=So(e[n]),o=t[n]):(a=So(e[n]),o=So(t[n])),e[n]=Co(a,o)}else e[n]=t[n]}),e}function wo(e,t,n={}){let r=n.offset||0,i=[],a=[],o,s,c=null;for(let l=0;l<e.length;l+=1){o=a[l]=e[l];for(let i=0,s=t.length;i<s;i+=1){let s=t[i],c=s.start+r,u=s.end+r;l>=c&&l<u&&(typeof o==`string`?o=a[l]={t:e[l],attrs:s.attrs}:o.attrs=Co(Co({},o.attrs),s.attrs),n.includeAnnotationIndices&&(o.annotations??=[],o.annotations.push(i)))}s=a[l-1],s?ke(o)&&ke(s)?(c=c,JSON.stringify(o.attrs)===JSON.stringify(s.attrs)?c.t+=o.t:(i.push(c),c=o)):ke(o)||ke(s)?(c=c,i.push(c),c=o):c=(c||``)+o:c=o}return c!=null&&i.push(c),i}function To(e){return e.replace(/ /g,`\xA0`)}var Eo;(function(e){function t(e){let t=`data:`;return e.substr(0,t.length)===t}e.isDataUrl=t;function n(e,n){if(!e||t(e)){setTimeout(()=>n(null,e));return}let r=()=>{n(Error(`Failed to load image: ${e}`))},i=window.FileReader?e=>{if(e.status===200){let t=new FileReader;t.onload=e=>{let t=e.target.result;n(null,t)},t.onerror=r,t.readAsDataURL(e.response)}else r()}:t=>{let i=e=>{let t=32768,n=[];for(let r=0;r<e.length;r+=t)n.push(String.fromCharCode.apply(null,e.subarray(r,r+t)));return n.join(``)};if(t.status===200){let r=e.split(`.`).pop()||`png`;r===`svg`&&(r=`svg+xml`);let a=`data:image/${r};base64,`,o=new Uint8Array(t.response),s=a+btoa(i(o));n(null,s)}else r()},a=new XMLHttpRequest;a.responseType=window.FileReader?`blob`:`arraybuffer`,a.open(`GET`,e,!0),a.addEventListener(`error`,r),a.addEventListener(`load`,()=>i(a)),a.send()}e.imageToDataUri=n;function r(e){let t=e.replace(/\s/g,``);t=decodeURIComponent(t);let n=t.indexOf(`,`),r=t.slice(0,n),i=r.split(`:`)[1].split(`;`)[0],a=t.slice(n+1),o;o=r.indexOf(`base64`)>=0?atob(a):unescape(encodeURIComponent(a));let s=new Uint8Array(o.length);for(let e=0;e<o.length;e+=1)s[e]=o.charCodeAt(e);return new Blob([s],{type:i})}e.dataUriToBlob=r;function i(e,t){let n=window.navigator.msSaveBlob;if(n)n(e,t);else{let n=window.URL.createObjectURL(e),r=document.createElement(`a`);r.href=n,r.download=t,document.body.appendChild(r),r.click(),document.body.removeChild(r),window.URL.revokeObjectURL(n)}}e.downloadBlob=i;function a(e,t){let n=r(e);i(n,t)}e.downloadDataUri=a;function o(e){let t=e.match(/<svg[^>]*viewBox\s*=\s*(["']?)(.+?)\1[^>]*>/i);return t&&t[2]?t[2].replace(/\s+/,` `).split(` `):null}function s(e){let t=parseFloat(e);return Number.isNaN(t)?null:t}function c(e,t={}){let n=null,r=t=>(n??=o(e),n==null?null:s(n[t])),i=t=>{let n=e.match(t);return n&&n[2]?s(n[2]):null},a=t.width;if(a??=i(/<svg[^>]*width\s*=\s*(["']?)(.+?)\1[^>]*>/i),a??=r(2),a==null)throw Error(`Can not parse width from svg string`);let c=t.height;if(c??=i(/<svg[^>]*height\s*=\s*(["']?)(.+?)\1[^>]*>/i),c??=r(3),c==null)throw Error(`Can not parse height from svg string`);let l=encodeURIComponent(e).replace(/'/g,`%27`).replace(/"/g,`%22`),u=`data:image/svg+xml`,d=`${u},${l}`;return d}e.svgToDataUrl=c})(Eo||={});let Do;const Oo={px(e){return e},mm(e){return Do*e},cm(e){return Do*e*10},in(e){return Do*e*25.4},pt(e){return Do*(25.4*e/72)},pc(e){return Do*(25.4*e/6)}};var ko;(function(e){function t(e,t,n){let r=document.createElement(`div`),i=r.style;i.display=`inline-block`,i.position=`absolute`,i.left=`-15000px`,i.top=`-15000px`,i.width=e+(n||`px`),i.height=t+(n||`px`),document.body.appendChild(r);let a=r.getBoundingClientRect(),o={width:a.width||0,height:a.height||0};return document.body.removeChild(r),o}e.measure=t;function n(e,n){Do??=t(`1`,`1`,`mm`).width;let r=n?Oo[n]:null;return r?r(e):e}e.toPx=n})(ko||={});const Ao=/-(.)/g;function jo(e){return e.replace(Ao,(e,t)=>t.toUpperCase())}const Mo={},No=[`webkit`,`ms`,`moz`,`o`],Po=typeof document<`u`?document.createElement(`div`).style:{};function Fo(e){for(let t=0;t<No.length;t+=1){let n=No[t]+e;if(n in Po)return n}return null}function Io(e){let t=jo(e);if(Mo[t]==null){let e=t.charAt(0).toUpperCase()+t.slice(1);Mo[t]=t in Po?t:Fo(e)}return Mo[t]}function Lo(e,t){let n=e.ownerDocument&&e.ownerDocument.defaultView&&e.ownerDocument.defaultView.opener?e.ownerDocument.defaultView.getComputedStyle(e,null):window.getComputedStyle(e,null);return n&&t?n.getPropertyValue(t)||n[t]:n}const Ro=function(){if(typeof document>`u`)return function(){};let e=document;return e.selection?function(){e.selection.empty()}:window.getSelection?function(){let e=window.getSelection();e&&(e.empty?e.empty():e.removeAllRanges&&e.removeAllRanges())}:function(){}}(),zo={animationIterationCount:!0,columnCount:!0,flexGrow:!0,flexShrink:!0,fontWeight:!0,gridArea:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnStart:!0,gridRow:!0,gridRowEnd:!0,gridRowStart:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,widows:!0,zIndex:!0};function Bo(e){return/^--/.test(e)}function Vo(e,t,n){let r=window.getComputedStyle(e,null);return n?r.getPropertyValue(t)||void 0:r[t]||e.style[t]}function Ho(e,t){return parseInt(Vo(e,t),10)||0}function Uo(e,t){return!zo[e]&&typeof t==`number`?`${t}px`:t}function Wo(e,t,n){if(typeof t==`string`){let r=Bo(t);if(r||(t=Io(t)),n===void 0)return Vo(e,t,r);r||(n=Uo(t,n));let i=e.style;r?i.setProperty(t,n):i[t]=n;return}for(let n in t)Wo(e,n,t[n])}const Go=new WeakMap;function Ko(e,t){let n=ar(t),r=Go.get(e);if(r)return r[n]}function qo(e,t,n){let r=ar(t),i=Go.get(e);i?i[r]=n:Go.set(e,{[r]:n})}function Jo(e,t,n){if(!t){let t={};return Object.keys(Go).forEach(n=>{t[n]=Ko(e,n)}),t}if(typeof t==`string`){if(n===void 0)return Ko(e,t);qo(e,t,n);return}for(let n in t)Jo(e,n,t[n])}var M=class e{get[Symbol.toStringTag](){return e.toStringTag}get type(){return this.node.nodeName}get id(){return this.node.id}set id(e){this.node.id=e}constructor(t,n,r){if(!t)throw TypeError(`Invalid element to create vector`);let i;if(e.isVector(t))i=t.node;else if(typeof t==`string`)if(t.toLowerCase()===`svg`)i=Qa();else if(t[0]===`<`){let e=Qa(t);i=document.importNode(e.firstChild,!0)}else i=document.createElementNS(A.svg,t);else i=t;this.node=i,n&&this.setAttributes(n),r&&this.append(r)}transform(e,t){return e==null?Ms(this.node):(Ms(this.node,e,t),this)}translate(e,t=0,n={}){return e==null?Ns(this.node):(Ns(this.node,e,t,n),this)}rotate(e,t,n,r={}){return e==null?Ps(this.node):(Ps(this.node,e,t,n,r),this)}scale(e,t){return e==null?Fs(this.node):(Fs(this.node,e,t),this)}getTransformToElement(t){let n=e.toNode(t);return Is(this.node,n)}removeAttribute(e){return _o(this.node,e),this}getAttribute(e){return go(this.node,e)}setAttribute(e,t){return vo(this.node,e,t),this}setAttributes(e){return yo(this.node,e),this}attr(e,t){return e==null?j(this.node):typeof e==`string`&&t===void 0?j(this.node,e):(typeof e==`object`?j(this.node,e):j(this.node,e,t),this)}svg(){return this.node instanceof SVGSVGElement?this:e.create(this.node.ownerSVGElement)}defs(){let t=this.svg()||this,n=t.node.getElementsByTagName(`defs`)[0];return n?e.create(n):e.create(`defs`).appendTo(t)}text(e,t={}){return es(this.node,e,t),this}tagName(){return eo(this.node)}clone(){return e.create(this.node.cloneNode(!0))}remove(){return oo(this.node),this}empty(){return so(this.node),this}append(t){return co(this.node,e.toNodes(t)),this}appendTo(t){return fo(this.node,e.isVector(t)?t.node:t),this}prepend(t){return lo(this.node,e.toNodes(t)),this}before(t){return uo(this.node,e.toNodes(t)),this}replace(t){return this.node.parentNode&&this.node.parentNode.replaceChild(e.toNode(t),this.node),e.create(t)}first(){return this.node.firstChild?e.create(this.node.firstChild):null}last(){return this.node.lastChild?e.create(this.node.lastChild):null}get(t){let n=this.node.childNodes[t];return n?e.create(n):null}indexOf(t){let n=Array.prototype.slice.call(this.node.childNodes);return n.indexOf(e.toNode(t))}find(t){let n=[],r=no(this.node,t);if(r)for(let t=0,i=r.length;t<i;t+=1)n.push(e.create(r[t]));return n}findOne(t){let n=ro(this.node,t);return n?e.create(n):null}findParentByClass(t,n){let r=io(this.node,t,n);return r?e.create(r):null}matches(e){let t=this.node,n=this.node.matches,r=t.matches||t.matchesSelector||t.msMatchesSelector||t.mozMatchesSelector||t.webkitMatchesSelector||t.oMatchesSelector||null;return r&&r.call(t,e)}contains(t){return ao(this.node,e.isVector(t)?t.node:t)}wrap(t){let n=e.create(t),r=this.node.parentNode;return r?.insertBefore(n.node,this.node),n.append(this)}parent(t){let n=this;if(n.node.parentNode==null)return null;if(n=e.create(n.node.parentNode),t==null)return n;do if(typeof t==`string`?n.matches(t):n instanceof t)return n;while(n=e.create(n.node.parentNode));return n}children(){let t=this.node.childNodes,n=[];for(let r=0;r<t.length;r+=1){let i=t[r];i.nodeType===1&&n.push(e.create(t[r]))}return n}eachChild(e,t){let n=this.children();for(let r=0,i=n.length;r<i;r+=1)e.call(n[r],n[r],r,n),t&&n[r].eachChild(e,t);return this}index(){return to(this.node)}hasClass(e){return Va(this.node,e)}addClass(e){return k(this.node,e),this}removeClass(e){return Ha(this.node,e),this}toggleClass(e,t){return Ua(this.node,e,t),this}toLocalPoint(e,t){return Rs(this.node,e,t)}sample(e=1){return this.node instanceof SVGPathElement?ss(this.node,e):[]}toPath(){return e.create(_s(this.node))}toPathData(){return vs(this.node)}};(function(e){e.toStringTag=`X6.${e.name}`;function t(t){if(t==null)return!1;if(t instanceof e)return!0;let n=t[Symbol.toStringTag],r=t;return(n==null||n===e.toStringTag)&&r.node instanceof SVGElement&&typeof r.sample==`function`&&typeof r.toPath==`function`}e.isVector=t;function n(t,n,r){return new e(t,n,r)}e.create=n;function r(e){if(e[0]===`<`){let t=Qa(e),r=[];for(let e=0,i=t.childNodes.length;e<i;e+=1){let i=t.childNodes[e];r.push(n(document.importNode(i,!0)))}return r}return[n(e)]}e.createVectors=r;function i(e){return t(e)?e.node:e}e.toNode=i;function a(e){return Array.isArray(e)?e.map(e=>i(e)):[i(e)]}e.toNodes=a})(M||={});function Yo(e,t){let n=M.create(t),r=M.create(`textPath`),i=e.d;if(i&&e[`xlink:href`]===void 0){let e=M.create(`path`).attr(`d`,i).appendTo(n.defs());r.attr(`xlink:href`,`#${e.id}`)}return typeof e==`object`&&r.attr(e),r.node}function Xo(e,t,n){let r=n.eol,i=n.baseSize,a=n.lineHeight,o=0,s,c={},l=t.length-1;for(let a=0;a<=l;a+=1){let c=t[a],u=null;if(typeof c==`object`){let e=c.attrs,t=M.create(`tspan`,e);s=t.node;let d=c.t;r&&a===l&&(d+=r),s.textContent=d;let f=e.class;f&&t.addClass(f),n.includeAnnotationIndices&&t.attr(`annotations`,c.annotations.join(`,`)),u=parseFloat(e[`font-size`]),u===void 0&&(u=i),u&&u>o&&(o=u)}else r&&a===l&&(c+=r),s=document.createTextNode(c||` `),i&&i>o&&(o=i);e.appendChild(s)}return o&&(c.maxFontSize=o),a?c.lineHeight=a:o&&(c.lineHeight=o*1.2),c}const Zo=/em$/;function Qo(e,t){let n=parseFloat(e);return Zo.test(e)?n*t:n}function $o(e,t,n,r){if(!Array.isArray(t))return 0;let i=t.length;if(!i)return 0;let a=t[0],o=Qo(a.maxFontSize,n)||n,s=0,c=Qo(r,n);for(let e=1;e<i;e+=1){a=t[e];let r=Qo(a.lineHeight,n)||c;s+=r}let l=Qo(a.maxFontSize,n)||n,u;switch(e){case`middle`:u=o/2-.15*l-s/2;break;case`bottom`:u=-(.25*l)-s;break;case`top`:default:u=.8*o;break}return u}function es(e,t,n={}){t=To(t);let r=n.eol,i=n.textPath,a=n.textVerticalAnchor,o=a===`middle`||a===`bottom`||a===`top`,s=n.x;s===void 0&&(s=e.getAttribute(`x`)||0);let c=n.includeAnnotationIndices,l=n.annotations;l&&!Array.isArray(l)&&(l=[l]);let u=n.lineHeight,d=u===`auto`,f=d?`1.5em`:u||`1em`,p=!0,m=e.childNodes;if(m.length===1){let e=m[0];e&&e.tagName.toUpperCase()===`TITLE`&&(p=!1)}p&&so(e),j(e,{"xml:space":`preserve`,display:t||n.displayEmpty?null:`none`});let h=j(e,`font-size`),g=parseFloat(h);g||(g=16,(o||l)&&!h&&j(e,`font-size`,`${g}`));let _;i?(typeof i==`string`&&(i={d:i}),_=Yo(i,e)):_=document.createDocumentFragment();let v,y=0,b,x=t.split(`
`),S=[],C=x.length-1;for(let e=0;e<=C;e+=1){v=f;let t=`v-line`,n=Za(`tspan`),a,o=x[e];if(o)if(l){let t=wo(o,l,{offset:-y,includeAnnotationIndices:c});a=Xo(n,t,{eol:e!==C&&r,baseSize:g,lineHeight:d?null:f,includeAnnotationIndices:c});let i=a.lineHeight;i&&d&&e!==0&&(v=i),e===0&&(b=a.maxFontSize*.8)}else r&&e!==C&&(o+=r),n.textContent=o;else{n.textContent=`-`,t+=` v-empty-line`;let e=n.style;e.fillOpacity=0,e.strokeOpacity=0,l&&(a={})}a&&S.push(a),e>0&&n.setAttribute(`dy`,v),(e>0||i)&&n.setAttribute(`x`,s),n.className.baseVal=t,_.appendChild(n),y+=o.length+1}if(o)if(l)v=$o(a,S,g,f);else if(a===`top`)v=`0.8em`;else{let e;switch(C>0?(e=parseFloat(f)||1,e*=C,Zo.test(f)||(e/=g)):e=0,a){case`middle`:v=`${.3-e/2}em`;break;case`bottom`:v=`${-e-.3}em`;break;default:break}}else a===0?v=`0em`:a?v=a:(v=0,e.getAttribute(`y`)??e.setAttribute(`y`,`${b||`0.8em`}`));let ee=_.firstChild;ee.setAttribute(`dy`,v),e.appendChild(_)}function ts(e,t={}){let n=document.createElement(`canvas`).getContext(`2d`);if(!e)return{width:0};let r=[],i=t[`font-size`]?`${parseFloat(t[`font-size`])}px`:`14px`;return r.push(t[`font-style`]||`normal`),r.push(t[`font-variant`]||`normal`),r.push(t[`font-weight`]||400),r.push(i),r.push(t[`font-family`]||`sans-serif`),n.font=r.join(` `),n.measureText(e)}function ns(e,t,n,r={}){if(t>=n)return[e,``];let i=e.length,a={},o=Math.round(t/n*i-1);for(o<0&&(o=0);o>=0&&o<i;){let n=e.slice(0,o),i=a[n]||ts(n,r).width,s=e.slice(0,o+1),c=a[s]||ts(s,r).width;if(a[n]=i,a[s]=c,i>t)--o;else if(c<=t)o+=1;else break}return[e.slice(0,o),e.slice(o)]}function rs(e,t,n={},r={}){let i=t.width,a=t.height,o=r.eol||`
`,s=n.fontSize||14,c=n.lineHeight?parseFloat(n.lineHeight):Math.ceil(s*1.4),l=Math.floor(a/c);if(e.indexOf(o)>-1){let i=ma(),a=[];return e.split(o).map(e=>{let o=rs(e,Object.assign(Object.assign({},t),{height:2**53-1}),n,Object.assign(Object.assign({},r),{eol:i}));o&&a.push(...o.split(i))}),a.slice(0,l).join(o)}let{width:u}=ts(e,n);if(u<i)return e;let d=[],f=e,p=u,m=r.ellipsis,h=0;m&&(typeof m!=`string`&&(m=`…`),h=ts(m,n).width);for(let e=0;e<l;e+=1)if(p>i){let t=e===l-1;if(t){let[e]=ns(f,i-h,p,n);d.push(m?`${e}${m}`:e)}else{let[e,t]=ns(f,i,p,n);d.push(e),f=t,p=ts(f,n).width}}else{d.push(f);break}return d.join(o)}const os=.551784;function N(e,t,n=NaN){let r=e.getAttribute(t);if(r==null)return n;let i=parseFloat(r);return Number.isNaN(i)?n:i}function ss(e,t=1){let n=e.getTotalLength(),r=[],i=0,a;for(;i<n;)a=e.getPointAtLength(i),r.push({distance:i,x:a.x,y:a.y}),i+=t;return r}function cs(e){return[`M`,N(e,`x1`),N(e,`y1`),`L`,N(e,`x2`),N(e,`y2`)].join(` `)}function ls(e){let t=fs(e);return t.length===0?null:`${ds(t)} Z`}function us(e){let t=fs(e);return t.length===0?null:ds(t)}function ds(e){let t=e.map(e=>`${e.x} ${e.y}`);return`M ${t.join(` L`)}`}function fs(e){let t=[],n=e.points;if(n)for(let e=0,r=n.numberOfItems;e<r;e+=1)t.push(n.getItem(e));return t}function ps(e){let t=N(e,`cx`,0),n=N(e,`cy`,0),r=N(e,`r`),i=r*os;return[`M`,t,n-r,`C`,t+i,n-r,t+r,n-i,t+r,n,`C`,t+r,n+i,t+i,n+r,t,n+r,`C`,t-i,n+r,t-r,n+i,t-r,n,`C`,t-r,n-i,t-i,n-r,t,n-r,`Z`].join(` `)}function ms(e){let t=N(e,`cx`,0),n=N(e,`cy`,0),r=N(e,`rx`),i=N(e,`ry`)||r,a=r*os,o=i*os,s=[`M`,t,n-i,`C`,t+a,n-i,t+r,n-o,t+r,n,`C`,t+r,n+o,t+a,n+i,t,n+i,`C`,t-a,n+i,t-r,n+o,t-r,n,`C`,t-r,n-o,t-a,n-i,t,n-i,`Z`].join(` `);return s}function hs(e){return gs({x:N(e,`x`,0),y:N(e,`y`,0),width:N(e,`width`,0),height:N(e,`height`,0),rx:N(e,`rx`,0),ry:N(e,`ry`,0)})}function gs(e){let t,n=e.x,r=e.y,i=e.width,a=e.height,o=Math.min(e.rx||e[`top-rx`]||0,i/2),s=Math.min(e.rx||e[`bottom-rx`]||0,i/2),c=Math.min(e.ry||e[`top-ry`]||0,a/2),l=Math.min(e.ry||e[`bottom-ry`]||0,a/2);return t=o||s||c||l?[`M`,n,r+c,`v`,a-c-l,`a`,s,l,0,0,0,s,l,`h`,i-2*s,`a`,s,l,0,0,0,s,-l,`v`,-(a-l-c),`a`,o,c,0,0,0,-o,-c,`h`,-(i-2*o),`a`,o,c,0,0,0,-o,c,`Z`]:[`M`,n,r,`H`,n+i,`V`,r+a,`H`,n,`V`,r,`Z`],t.join(` `)}function _s(e){let t=Za(`path`);j(t,j(e));let n=vs(e);return n&&t.setAttribute(`d`,n),t}function vs(e){let t=e.tagName.toLowerCase();switch(t){case`path`:return e.getAttribute(`d`);case`line`:return cs(e);case`polygon`:return ls(e);case`polyline`:return us(e);case`ellipse`:return ms(e);case`circle`:return ps(e);case`rect`:return hs(e);default:break}throw Error(`"${t}" cannot be converted to svg path element.`)}const ys=/(\w+)\(([^,)]+),?([^)]+)?\)/gi,bs=/[ ,]+/,xs=/^(\w+)\((.*)\)/;function Ss(e,t){let n=Za(`svg`),r=n.createSVGPoint();return r.x=e,r.y=t,r}function P(e){let t=Za(`svg`),n=t.createSVGMatrix();if(e!=null){let t=e,r=n;for(let e in t)r[e]=t[e]}return n}function Cs(e){let t=Za(`svg`);return e==null?t.createSVGTransform():(e instanceof DOMMatrix||(e=P(e)),t.createSVGTransformFromMatrix(e))}function ws(e){let t=P(),n=e!=null&&e.match(ys);if(!n)return t;for(let e=0,r=n.length;e<r;e+=1){let r=n[e],i=r.match(xs);if(i){let e,n,r,a,o,s=P(),c=i[2].split(bs);switch(i[1].toLowerCase()){case`scale`:e=parseFloat(c[0]),n=c[1]===void 0?e:parseFloat(c[1]),s=s.scaleNonUniform(e,n);break;case`translate`:r=parseFloat(c[0]),a=parseFloat(c[1]),s=s.translate(r,a);break;case`rotate`:o=parseFloat(c[0]),r=parseFloat(c[1])||0,a=parseFloat(c[2])||0,s=r!==0||a!==0?s.translate(r,a).rotate(o).translate(-r,-a):s.rotate(o);break;case`skewx`:o=parseFloat(c[0]),s=s.skewX(o);break;case`skewy`:o=parseFloat(c[0]),s=s.skewY(o);break;case`matrix`:s.a=parseFloat(c[0]),s.b=parseFloat(c[1]),s.c=parseFloat(c[2]),s.d=parseFloat(c[3]),s.e=parseFloat(c[4]),s.f=parseFloat(c[5]);break;default:continue}t=t.multiply(s)}}return t}function Ts(e){let t=e||{},n=t.a==null?1:t.a,r=t.b==null?0:t.b,i=t.c==null?0:t.c,a=t.d==null?1:t.d,o=t.e==null?0:t.e,s=t.f==null?0:t.f;return`matrix(${n},${r},${i},${a},${o},${s})`}function Es(e){let t,n,r;if(e){let i=bs;if(e.trim().indexOf(`matrix`)>=0){let i=ws(e),a=Os(i);t=[a.translateX,a.translateY],n=[a.rotation],r=[a.scaleX,a.scaleY];let o=[];(t[0]!==0||t[1]!==0)&&o.push(`translate(${t.join(`,`)})`),(r[0]!==1||r[1]!==1)&&o.push(`scale(${r.join(`,`)})`),n[0]!==0&&o.push(`rotate(${n[0]})`),e=o.join(` `)}else{let a=e.match(/translate\((.*?)\)/);a&&(t=a[1].split(i));let o=e.match(/rotate\((.*?)\)/);o&&(n=o[1].split(i));let s=e.match(/scale\((.*?)\)/);s&&(r=s[1].split(i))}}let i=r&&r[0]?parseFloat(r[0]):1;return{raw:e||``,translation:{tx:t&&t[0]?parseInt(t[0],10):0,ty:t&&t[1]?parseInt(t[1],10):0},rotation:{angle:n&&n[0]?parseInt(n[0],10):0,cx:n&&n[1]?parseInt(n[1],10):void 0,cy:n&&n[2]?parseInt(n[2],10):void 0},scale:{sx:i,sy:r&&r[1]?parseFloat(r[1]):i}}}function Ds(e,t){let n=t.x*e.a+t.y*e.c+0,r=t.x*e.b+t.y*e.d+0;return{x:n,y:r}}function Os(e){let t=Ds(e,{x:0,y:1}),n=Ds(e,{x:1,y:0}),r=180/Math.PI*Math.atan2(t.y,t.x)-90,i=180/Math.PI*Math.atan2(n.y,n.x);return{skewX:r,skewY:i,translateX:e.e,translateY:e.f,scaleX:Math.sqrt(e.a*e.a+e.b*e.b),scaleY:Math.sqrt(e.c*e.c+e.d*e.d),rotation:r}}function ks(e){let t,n,r,i;return e?(t=e.a==null?1:e.a,i=e.d==null?1:e.d,n=e.b,r=e.c):t=i=1,{sx:n?Math.sqrt(t*t+n*n):t,sy:r?Math.sqrt(r*r+i*i):i}}function As(e){let t={x:0,y:1};e&&(t=Ds(e,t));let n=180*Math.atan2(t.y,t.x)/Math.PI%360-90,r=n%360+(n<0?360:0);return{angle:r}}function js(e){return{tx:e&&e.e||0,ty:e&&e.f||0}}function Ms(e,t,n={}){if(t==null)return ws(j(e,`transform`));if(n.absolute){e.setAttribute(`transform`,Ts(t));return}let r=e.transform,i=Cs(t);r.baseVal.appendItem(i)}function Ns(e,t,n=0,r={}){let i=j(e,`transform`),a=Es(i);if(t==null)return a.translation;i=a.raw,i=i.replace(/translate\([^)]*\)/g,``).trim();let o=r.absolute?t:a.translation.tx+t,s=r.absolute?n:a.translation.ty+n,c=`translate(${o},${s})`;e.setAttribute(`transform`,`${c} ${i}`.trim())}function Ps(e,t,n,r,i={}){let a=j(e,`transform`),o=Es(a);if(t==null)return o.rotation;a=o.raw,a=a.replace(/rotate\([^)]*\)/g,``).trim(),t%=360;let s=i.absolute?t:o.rotation.angle+t,c=n!=null&&r!=null?`,${n},${r}`:``,l=`rotate(${s}${c})`;e.setAttribute(`transform`,`${a} ${l}`.trim())}function Fs(e,t,n){let r=j(e,`transform`),i=Es(r);if(t==null)return i.scale;n??=t,r=i.raw,r=r.replace(/scale\([^)]*\)/g,``).trim();let a=`scale(${t},${n})`;e.setAttribute(`transform`,`${r} ${a}`.trim())}function Is(e,t){if(qa(t)&&qa(e)){let n=t.getScreenCTM(),r=e.getScreenCTM();if(n&&r)return n.inverse().multiply(r)}return P()}function Ls(e,t){let n=P();if(qa(t)&&qa(e)){let r=e,i=[];for(;r&&r!==t;){let e=r.getAttribute(`transform`)||null,t=ws(e);i.push(t),r=r.parentNode}i.reverse().forEach(e=>{n=n.multiply(e)})}return n}function Rs(e,t,n){let r=e instanceof SVGSVGElement?e:e.ownerSVGElement,i=r.createSVGPoint();i.x=t,i.y=n;try{let t=r.getScreenCTM(),n=i.matrixTransform(t.inverse()),a=Is(e,r).inverse();return n.matrixTransform(a)}catch{return i}}var zs;(function(e){let t={};function n(e){return t[e]||{}}e.get=n;function r(e,n){t[e]=n}e.register=r;function i(e){delete t[e]}e.unregister=i})(zs||={});var Bs;(function(e){let t=new WeakMap;function n(e){return t.has(e)||t.set(e,{events:Object.create(null)}),t.get(e)}e.ensure=n;function r(e){return t.get(e)}e.get=r;function i(e){return t.delete(e)}e.remove=i})(Bs||={});var F;(function(e){e.returnTrue=()=>!0,e.returnFalse=()=>!1;function t(e){e.stopPropagation()}e.stopPropagationCallback=t;function n(e,t,n){e.addEventListener!=null&&e.addEventListener(t,n)}e.addEventListener=n;function r(e,t,n){e.removeEventListener!=null&&e.removeEventListener(t,n)}e.removeEventListener=r})(F||={}),function(e){let t=/[^\x20\t\r\n\f]+/g,n=/^([^.]*)(?:\.(.+)|)/;function r(e){return(e||``).match(t)||[``]}e.splitType=r;function i(e){let t=n.exec(e)||[];return{originType:t[1]?t[1].trim():t[1],namespaces:t[2]?t[2].split(`.`).map(e=>e.trim()).sort():[]}}e.normalizeType=i;function a(e){return e.nodeType===1||e.nodeType===9||!+e.nodeType}e.isValidTarget=a;function o(e,t){if(t){let n=e;return n.querySelector!=null&&n.querySelector(t)!=null}return!0}e.isValidSelector=o}(F||={}),function(e){let t=0,n=new WeakMap;function r(e){return n.has(e)||(n.set(e,t),t+=1),n.get(e)}e.ensureHandlerId=r;function i(e){return n.get(e)}e.getHandlerId=i;function a(e){return n.delete(e)}e.removeHandlerId=a;function o(e,t){return n.set(e,t)}e.setHandlerId=o}(F||={}),function(e){function t(e,t){let n=[],r=Bs.get(e),i=r&&r.events&&r.events[t.type],a=i&&i.handlers||[],o=i?i.delegateCount:0;if(o>0&&!(t.type===`click`&&typeof t.button==`number`&&t.button>=1)){for(let r=t.target;r!==e;r=r.parentNode||e)if(r.nodeType===1&&!(t.type===`click`&&r.disabled===!0)){let t=[],i={};for(let n=0;n<o;n+=1){let o=a[n],s=o.selector;if(s!=null&&i[s]==null){let t=e,n=[];t.querySelectorAll(s).forEach(e=>{n.push(e)}),i[s]=n.includes(r)}i[s]&&t.push(o)}t.length&&n.push({elem:r,handlers:t})}}return o<a.length&&n.push({elem:e,handlers:a.slice(o)}),n}e.getHandlerQueue=t}(F||={}),function(e){function t(e){return e!=null&&e===e.window}e.isWindow=t}(F||={}),function(e){function t(e,t){let n=e.nodeType===9?e.documentElement:e,r=t&&t.parentNode;return e===r||!!(r&&r.nodeType===1&&(n.contains?n.contains(r):e.compareDocumentPosition&&e.compareDocumentPosition(r)&16))}e.contains=t}(F||={});var Vs=class{constructor(e,t){this.isDefaultPrevented=F.returnFalse,this.isPropagationStopped=F.returnFalse,this.isImmediatePropagationStopped=F.returnFalse,this.isSimulated=!1,this.preventDefault=()=>{let e=this.originalEvent;this.isDefaultPrevented=F.returnTrue,e&&!this.isSimulated&&e.preventDefault()},this.stopPropagation=()=>{let e=this.originalEvent;this.isPropagationStopped=F.returnTrue,e&&!this.isSimulated&&e.stopPropagation()},this.stopImmediatePropagation=()=>{let e=this.originalEvent;this.isImmediatePropagationStopped=F.returnTrue,e&&!this.isSimulated&&e.stopImmediatePropagation(),this.stopPropagation()},typeof e==`string`?this.type=e:e.type&&(this.originalEvent=e,this.type=e.type,this.isDefaultPrevented=e.defaultPrevented?F.returnTrue:F.returnFalse,this.target=e.target,this.currentTarget=e.currentTarget,this.relatedTarget=e.relatedTarget,this.timeStamp=e.timeStamp),t&&Object.assign(this,t),this.timeStamp||=Date.now()}};(function(e){function t(t){return t instanceof e?t:new e(t)}e.create=t})(Vs||={}),function(e){function t(t,n){Object.defineProperty(e.prototype,t,{enumerable:!0,configurable:!0,get:typeof n==`function`?function(){if(this.originalEvent)return n(this.originalEvent)}:function(){if(this.originalEvent)return this.originalEvent[t]},set(e){Object.defineProperty(this,t,{enumerable:!0,configurable:!0,writable:!0,value:e})}})}e.addProperty=t}(Vs||={}),function(e){let t={bubbles:!0,cancelable:!0,eventPhase:!0,detail:!0,view:!0,button:!0,buttons:!0,clientX:!0,clientY:!0,offsetX:!0,offsetY:!0,pageX:!0,pageY:!0,screenX:!0,screenY:!0,toElement:!0,pointerId:!0,pointerType:!0,char:!0,code:!0,charCode:!0,key:!0,keyCode:!0,touches:!0,changedTouches:!0,targetTouches:!0,which:!0,altKey:!0,ctrlKey:!0,metaKey:!0,shiftKey:!0};Object.keys(t).forEach(n=>e.addProperty(n,t[n]))}(Vs||={});var Hs;(function(e){zs.register(`load`,{noBubble:!0})})(Hs||={}),function(e){zs.register(`beforeunload`,{postDispatch(e,t){t.result!==void 0&&t.originalEvent&&(t.originalEvent.returnValue=t.result)}})}(Hs||={}),function(e){zs.register(`mouseenter`,{delegateType:`mouseover`,bindType:`mouseover`,handle(e,t){let n,r=t.relatedTarget,i=t.handleObj;return(!r||r!==e&&!F.contains(e,r))&&(t.type=i.originType,n=i.handler.call(e,t),t.type=`mouseover`),n}}),zs.register(`mouseleave`,{delegateType:`mouseout`,bindType:`mouseout`,handle(e,t){let n,r=t.relatedTarget,i=t.handleObj;return(!r||r!==e&&!F.contains(e,r))&&(t.type=i.originType,n=i.handler.call(e,t),t.type=`mouseout`),n}})}(Hs||={});var Us=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(e!=null&&typeof Object.getOwnPropertySymbols==`function`)for(var i=0,r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]]);return n},Ws;(function(e){let t;function n(e,n,r,a,o){if(!F.isValidTarget(e))return;let s;if(typeof r!=`function`){let{handler:e,selector:t}=r,n=Us(r,[`handler`,`selector`]);r=e,o=t,s=n}let c=Bs.ensure(e),l=c.handler;l??=c.handler=function(n,...r){return t===n.type?void 0:i(e,n,...r)};let u=F.ensureHandlerId(r);F.splitType(n).forEach(t=>{let{originType:n,namespaces:i}=F.normalizeType(t);if(!n)return;let d=n,f=zs.get(d);d=(o?f.delegateType:f.bindType)||d,f=zs.get(d);let p=Object.assign({type:d,originType:n,data:a,selector:o,guid:u,handler:r,namespace:i.join(`.`)},s),m=c.events,h=m[d];h||(h=m[d]={handlers:[],delegateCount:0},(!f.setup||f.setup(e,a,i,l)===!1)&&F.addEventListener(e,d,l)),f.add&&(F.removeHandlerId(p.handler),f.add(e,p),F.setHandlerId(p.handler,u)),o?(h.handlers.splice(h.delegateCount,0,p),h.delegateCount+=1):h.handlers.push(p)})}e.on=n;function r(e,t,n,i,a){let o=Bs.get(e);if(!o)return;let s=o.events;s&&(F.splitType(t).forEach(t=>{let{originType:c,namespaces:l}=F.normalizeType(t);if(!c){Object.keys(s).forEach(a=>{r(e,a+t,n,i,!0)});return}let u=c,d=zs.get(u);u=(i?d.delegateType:d.bindType)||u;let f=s[u];if(!f)return;let p=l.length>0?RegExp(`(^|\\.)${l.join(`\\.(?:.*\\.|)`)}(\\.|$)`):null,m=f.handlers.length;for(let t=f.handlers.length-1;t>=0;--t){let r=f.handlers[t];(a||c===r.originType)&&(!n||F.getHandlerId(n)===r.guid)&&(p==null||r.namespace&&p.test(r.namespace))&&(i==null||i===r.selector||i===`**`&&r.selector)&&(f.handlers.splice(t,1),r.selector&&--f.delegateCount,d.remove&&d.remove(e,r))}m&&f.handlers.length===0&&((!d.teardown||d.teardown(e,l,o.handler)===!1)&&F.removeEventListener(e,u,o.handler),delete s[u])}),Object.keys(s).length===0&&Bs.remove(e))}e.off=r;function i(e,t,...n){let r=Vs.create(t);r.delegateTarget=e;let i=zs.get(r.type);if(i.preDispatch&&i.preDispatch(e,r)===!1)return;let a=F.getHandlerQueue(e,r);for(let e=0,t=a.length;e<t&&!r.isPropagationStopped();e+=1){let t=a[e];r.currentTarget=t.elem;for(let e=0,i=t.handlers.length;e<i&&!r.isImmediatePropagationStopped();e+=1){let i=t.handlers[e];if(r.rnamespace==null||i.namespace&&r.rnamespace.test(i.namespace)){r.handleObj=i,r.data=i.data;let e=zs.get(i.originType).handle,a=e?e(t.elem,r,...n):i.handler.call(t.elem,r,...n);a!==void 0&&(r.result=a,a===!1&&(r.preventDefault(),r.stopPropagation()))}}}return i.postDispatch&&i.postDispatch(e,r),r.result}e.dispatch=i;function a(e,n,r,i){let a=e,o=typeof e==`string`?e:e.type,s=typeof e==`string`||a.namespace==null?[]:a.namespace.split(`.`),c=r;if(c.nodeType===3||c.nodeType===8)return;o.indexOf(`.`)>-1&&(s=o.split(`.`),o=s.shift(),s.sort());let l=o.indexOf(`:`)<0&&`on${o}`;a=e instanceof Vs?e:new Vs(o,typeof e==`object`?e:null),a.namespace=s.join(`.`),a.rnamespace=a.namespace?RegExp(`(^|\\.)${s.join(`\\.(?:.*\\.|)`)}(\\.|$)`):null,a.result=void 0,a.target||=c;let u=[a];Array.isArray(n)?u.push(...n):u.push(n);let d=zs.get(o);if(!i&&d.trigger&&d.trigger(c,a,n)===!1)return;let f,p=[c];if(!i&&!d.noBubble&&!F.isWindow(c)){f=d.delegateType||o;let e=c,t=c.parentNode;for(;t!=null;)p.push(t),e=t,t=t.parentNode;let n=c.ownerDocument||document;if(e===n){let t=e.defaultView||e.parentWindow||window;p.push(t)}}let m=c;for(let e=0,t=p.length;e<t&&!a.isPropagationStopped();e+=1){let t=p[e];m=t,a.type=e>1?f:d.bindType||o;let n=Bs.get(t);n&&n.events[a.type]&&n.handler&&n.handler.call(t,...u);let r=l&&t[l]||null;r&&F.isValidTarget(t)&&(a.result=r.call(t,...u),a.result===!1&&a.preventDefault())}if(a.type=o,!i&&!a.isDefaultPrevented()){let e=d.preventDefault;if((e==null||e(p.pop(),a,n)===!1)&&F.isValidTarget(c)&&l&&typeof c[o]==`function`&&!F.isWindow(c)){let e=c[l];e&&(c[l]=null),t=o,a.isPropagationStopped()&&m.addEventListener(o,F.stopPropagationCallback),c[o](),a.isPropagationStopped()&&m.removeEventListener(o,F.stopPropagationCallback),t=void 0,e&&(c[l]=e)}}return a.result}e.trigger=a})(Ws||={});var I;(function(e){function t(e,t,n,r,i){return Gs.on(e,t,n,r,i),e}e.on=t;function n(e,t,n,r,i){return Gs.on(e,t,n,r,i,!0),e}e.once=n;function r(e,t,n,r){return Gs.off(e,t,n,r),e}e.off=r;function i(e,t,n,r){return Ws.trigger(t,n,e,r),e}e.trigger=i})(I||={});var Gs;(function(e){function t(n,r,i,a,o,s){if(typeof r==`object`){typeof i!=`string`&&(a||=i,i=void 0),Object.keys(r).forEach(e=>t(n,e,i,a,r[e],s));return}if(a==null&&o==null?(o=i,a=i=void 0):o??(typeof i==`string`?(o=a,a=void 0):(o=a,a=i,i=void 0)),o===!1)o=F.returnFalse;else if(!o)return;if(s){let t=o;o=function(r,...i){return e.off(n,r),t.call(this,r,...i)},F.setHandlerId(o,F.ensureHandlerId(t))}Ws.on(n,r,o,a,i)}e.on=t;function n(e,t,r,i){let a=t;if(a&&a.preventDefault!=null&&a.handleObj!=null){let e=a.handleObj;n(a.delegateTarget,e.namespace?`${e.originType}.${e.namespace}`:e.originType,e.selector,e.handler);return}if(typeof t==`object`){let i=t;Object.keys(i).forEach(t=>n(e,t,r,i[t]));return}(r===!1||typeof r==`function`)&&(i=r,r=void 0),i===!1&&(i=F.returnFalse),Ws.off(e,t,i,r)}e.off=n})(Gs||={});var Ks=class{constructor(e,t,n){this.animationFrameId=0,this.deltaX=0,this.deltaY=0,this.eventName=Ia.isEventSupported(`wheel`)?`wheel`:`mousewheel`,this.target=e,this.onWheelCallback=t,this.onWheelGuard=n,this.onWheel=this.onWheel.bind(this),this.didWheel=this.didWheel.bind(this)}enable(){this.target.addEventListener(this.eventName,this.onWheel,{passive:!1})}disable(){this.target.removeEventListener(this.eventName,this.onWheel)}onWheel(e){if(this.onWheelGuard!=null&&!this.onWheelGuard(e))return;this.deltaX+=e.deltaX,this.deltaY+=e.deltaY,e.preventDefault();let t;(this.deltaX!==0||this.deltaY!==0)&&(e.stopPropagation(),t=!0),t===!0&&this.animationFrameId===0&&(this.animationFrameId=requestAnimationFrame(()=>{this.didWheel(e)}))}didWheel(e){this.animationFrameId=0,this.onWheelCallback(e,this.deltaX,this.deltaY),this.deltaX=0,this.deltaY=0}};function qs(e){let t=e.getBoundingClientRect(),n=e.ownerDocument.defaultView;return{top:t.top+n.pageYOffset,left:t.left+n.pageXOffset}}function Js(e){let t=Vo(e,`position`)===`fixed`,n;if(t){let t=e.getBoundingClientRect();n={left:t.left,top:t.top}}else n=qs(e);if(!t){let t=e.ownerDocument,r=e.offsetParent||t.documentElement;for(;(r===t.body||r===t.documentElement)&&Vo(r,`position`)===`static`;)r=r.parentNode;if(r!==e&&po(r)){let e=qs(r);n.top-=e.top+Ho(r,`borderTopWidth`),n.left-=e.left+Ho(r,`borderLeftWidth`)}}return{top:n.top-Ho(e,`marginTop`),left:n.left-Ho(e,`marginLeft`)}}function Ys(e,t=60){let n=null;return(...r)=>{n&&clearTimeout(n),n=window.setTimeout(()=>{e.apply(this,r)},t)}}function Xs(e){let t=null,n=[],r=()=>{if(getComputedStyle(e).position===`static`){let t=e.style;t.position=`relative`}let t=document.createElement(`object`);return t.onload=()=>{t.contentDocument.defaultView.addEventListener(`resize`,i),i()},t.style.display=`block`,t.style.position=`absolute`,t.style.top=`0`,t.style.left=`0`,t.style.height=`100%`,t.style.width=`100%`,t.style.overflow=`hidden`,t.style.pointerEvents=`none`,t.style.zIndex=`-1`,t.style.opacity=`0`,t.setAttribute(`tabindex`,`-1`),t.type=`text/html`,e.appendChild(t),t.data=`about:blank`,t},i=Ys(()=>{n.forEach(t=>t(e))}),a=e=>{t||=r(),n.indexOf(e)===-1&&n.push(e)},o=()=>{t&&t.parentNode&&(t.contentDocument&&t.contentDocument.defaultView.removeEventListener(`resize`,i),t.parentNode.removeChild(t),t=null,n=[])},s=e=>{let r=n.indexOf(e);r!==-1&&n.splice(r,1),n.length===0&&t&&o()};return{element:e,bind:a,destroy:o,unbind:s}}function Zs(e){let t=null,n=[],r=Ys(()=>{n.forEach(t=>{t(e)})}),i=()=>{let t=new ResizeObserver(r);return t.observe(e),r(),t},a=e=>{t||=i(),n.indexOf(e)===-1&&n.push(e)},o=()=>{t&&(t.disconnect(),n=[],t=null)},s=e=>{let r=n.indexOf(e);r!==-1&&n.splice(r,1),n.length===0&&t&&o()};return{element:e,bind:a,destroy:o,unbind:s}}const Qs=typeof ResizeObserver<`u`?Zs:Xs;var $s;(function(e){let t=new WeakMap;function n(e){let n=t.get(e);return n||(n=Qs(e),t.set(e,n),n)}function r(e){e.destroy(),t.delete(e.element)}e.bind=(e,t)=>{let r=n(e);return r.bind(t),()=>r.unbind(t)},e.clear=e=>{let t=n(e);r(t)}})($s||={});var ec=class e{constructor(t={}){this.comparator=t.comparator||e.defaultComparator,this.index={},this.data=t.data||[],this.heapify()}isEmpty(){return this.data.length===0}insert(e,t,n){let r={priority:e,value:t},i=this.data.length;return n&&(r.id=n,this.index[n]=i),this.data.push(r),this.bubbleUp(i),this}peek(){return this.data[0]?this.data[0].value:null}peekPriority(){return this.data[0]?this.data[0].priority:null}updatePriority(e,t){let n=this.index[e];if(n===void 0)throw Error(`Node with id '${e}' was not found in the heap.`);let r=this.data,i=r[n].priority,a=this.comparator(t,i);a<0?(r[n].priority=t,this.bubbleUp(n)):a>0&&(r[n].priority=t,this.bubbleDown(n))}remove(){let e=this.data,t=e[0],n=e.pop();return t.id&&delete this.index[t.id],e.length>0&&(e[0]=n,n.id&&(this.index[n.id]=0),this.bubbleDown(0)),t?t.value:null}heapify(){for(let e=0;e<this.data.length;e+=1)this.bubbleUp(e)}bubbleUp(e){let t=this.data,n,r,i=e;for(;i>0&&(r=i-1>>>1,this.comparator(t[i].priority,t[r].priority)<0);){n=t[r],t[r]=t[i];let e=t[i].id;e!=null&&(this.index[e]=r),t[i]=n,e=t[i].id,e!=null&&(this.index[e]=i),i=r}}bubbleDown(e){let t=this.data,n=t.length-1,r=e;for(;;){let e=(r<<1)+1,i=e+1,a=r;if(e<=n&&this.comparator(t[e].priority,t[a].priority)<0&&(a=e),i<=n&&this.comparator(t[i].priority,t[a].priority)<0&&(a=i),a!==r){let e=t[a];t[a]=t[r];let n=t[r].id;n!=null&&(this.index[n]=a),t[r]=e,n=t[r].id,n!=null&&(this.index[n]=r),r=a}else break}}};(function(e){e.defaultComparator=(e,t)=>e-t})(ec||={});var tc;(function(e){function t(e,t,n=(e,t)=>1){let r={},i={},a={},o=new ec;for(r[t]=0,Object.keys(e).forEach(e=>{e!==t&&(r[e]=1/0),o.insert(r[e],e,e)});!o.isEmpty();){let t=o.remove();a[t]=!0;let s=e[t]||[];for(let e=0;e<s.length;e+=1){let c=s[e];if(!a[c]){let e=r[t]+n(t,c);e<r[c]&&(r[c]=e,i[c]=t,o.updatePriority(c,e))}}}return i}e.run=t})(tc||={});var nc=class e{constructor(t,n,r,i){if(t==null)return this.set(255,255,255,1);if(typeof t==`number`)return this.set(t,n,r,i);if(typeof t==`string`)return e.fromString(t)||this;if(Array.isArray(t))return this.set(t);this.set(t.r,t.g,t.b,t.a==null?1:t.a)}blend(e,t,n){this.set(e.r+(t.r-e.r)*n,e.g+(t.g-e.g)*n,e.b+(t.b-e.b)*n,e.a+(t.a-e.a)*n)}lighten(t){let n=e.lighten(this.toArray(),t);this.r=n[0],this.g=n[1],this.b=n[2],this.a=n[3]}darken(e){this.lighten(-e)}set(e,t,n,r){let i=Array.isArray(e)?e[0]:e,a=Array.isArray(e)?e[1]:t,o=Array.isArray(e)?e[2]:n,s=Array.isArray(e)?e[3]:r;return this.r=Math.round(lr(i,0,255)),this.g=Math.round(lr(a,0,255)),this.b=Math.round(lr(o,0,255)),this.a=s==null?1:lr(s,0,1),this}toHex(){let e=[`r`,`g`,`b`].map(e=>{let t=this[e].toString(16);return t.length<2?`0${t}`:t});return`#${e.join(``)}`}toRGBA(){return this.toArray()}toHSLA(){return e.rgba2hsla(this.r,this.g,this.b,this.a)}toCSS(e){let t=`${this.r},${this.g},${this.b},`;return e?`rgb(${t})`:`rgba(${t},${this.a})`}toGrey(){return e.makeGrey(Math.round((this.r+this.g+this.b)/3),this.a)}toArray(){return[this.r,this.g,this.b,this.a]}toString(){return this.toCSS()}};(function(e){function t(t){return new e(t)}e.fromArray=t;function n(t){return new e([...m(t),1])}e.fromHex=n;function r(t){let n=t.toLowerCase().match(/^rgba?\(([\s.,0-9]+)\)/);if(n){let t=n[1].split(/\s*,\s*/).map(e=>parseInt(e,10));return new e(t)}return null}e.fromRGBA=r;function i(e,t,n){n<0&&++n,n>1&&--n;let r=6*n;return r<1?e+(t-e)*r:2*n<1?t:3*n<2?e+(t-e)*(2/3-n)*6:e}function a(t){let n=t.toLowerCase().match(/^hsla?\(([\s.,0-9]+)\)/);if(n){let t=n[2].split(/\s*,\s*/),r=(parseFloat(t[0])%360+360)%360/360,i=parseFloat(t[1])/100,a=parseFloat(t[2])/100,o=t[3]==null?1:parseInt(t[3],10);return new e(l(r,i,a,o))}return null}e.fromHSLA=a;function o(t){if(t.startsWith(`#`))return n(t);if(t.startsWith(`rgb`))return r(t);let i=e.named[t];return i?n(i):a(t)}e.fromString=o;function s(t,n){return e.fromArray([t,t,t,n])}e.makeGrey=s;function c(e,t,n,r){let i=Array.isArray(e)?e[0]:e,a=Array.isArray(e)?e[1]:t,o=Array.isArray(e)?e[2]:n,s=Array.isArray(e)?e[3]:r,c=Math.max(i,a,o),l=Math.min(i,a,o),u=(c+l)/2,d=0,f=0;if(l!==c){let e=c-l;switch(f=u>.5?e/(2-c-l):e/(c+l),c){case i:d=(a-o)/e+(a<o?6:0);break;case a:d=(o-i)/e+2;break;case o:d=(i-a)/e+4;break;default:break}d/=6}return[d,f,u,s??1]}e.rgba2hsla=c;function l(e,t,n,r){let a=Array.isArray(e)?e[0]:e,o=Array.isArray(e)?e[1]:t,s=Array.isArray(e)?e[2]:n,c=Array.isArray(e)?e[3]:r,l=s<=.5?s*(o+1):s+o-s*o,u=2*s-l;return[i(u,l,a+1/3)*256,i(u,l,a)*256,i(u,l,a-1/3)*256,c??1]}e.hsla2rgba=l;function u(t){return new e(Math.round(Math.random()*256),Math.round(Math.random()*256),Math.round(Math.random()*256),t?void 0:parseFloat(Math.random().toFixed(2)))}e.random=u;function d(){let e=`0123456789ABCDEF`,t=`#`;for(let n=0;n<6;n+=1)t+=e[Math.floor(Math.random()*16)];return t}e.randomHex=d;function f(e){return u(e).toString()}e.randomRGBA=f;function p(e,t){if(typeof e==`string`){let n=e[0]===`#`,[r,i,a]=m(e);return t?r*.299+i*.587+a*.114>186?`#000000`:`#ffffff`:`${n?`#`:``}${h(255-r,255-i,255-a)}`}let n=e[0],r=e[1],i=e[2],a=e[3];return t?n*.299+r*.587+i*.114>186?[0,0,0,a]:[255,255,255,a]:[255-n,255-r,255-i,a]}e.invert=p;function m(e){let t=e.indexOf(`#`)===0?e:`#${e}`,n=Number(`0x${t.substr(1)}`);if(!(t.length===4||t.length===7)||Number.isNaN(n))throw Error(`Invalid hex color.`);let r=t.length===4?4:8,i=(1<<r)-1,a=[`b`,`g`,`r`].map(()=>{let e=n&i;return n>>=r,r===4?17*e:e});return[a[2],a[1],a[0]]}function h(e,t,n){let r=e=>e.length<2?`0${e}`:e;return`${r(e.toString(16))}${r(t.toString(16))}${r(n.toString(16))}`}function g(e,t){return v(e,t)}e.lighten=g;function _(e,t){return v(e,-t)}e.darken=_;function v(e,t){if(typeof e==`string`){let n=e[0]===`#`,r=parseInt(n?e.substr(1):e,16),i=lr((r>>16)+t,0,255),a=lr((r>>8&255)+t,0,255),o=lr((r&255)+t,0,255);return`${n?`#`:``}${(o|a<<8|i<<16).toString(16)}`}let n=h(e[0],e[1],e[2]),r=m(v(n,t));return[r[0],r[1],r[2],e[3]]}})(nc||={}),function(e){e.named={aliceblue:`#f0f8ff`,antiquewhite:`#faebd7`,aqua:`#00ffff`,aquamarine:`#7fffd4`,azure:`#f0ffff`,beige:`#f5f5dc`,bisque:`#ffe4c4`,black:`#000000`,blanchedalmond:`#ffebcd`,blue:`#0000ff`,blueviolet:`#8a2be2`,brown:`#a52a2a`,burlywood:`#deb887`,burntsienna:`#ea7e5d`,cadetblue:`#5f9ea0`,chartreuse:`#7fff00`,chocolate:`#d2691e`,coral:`#ff7f50`,cornflowerblue:`#6495ed`,cornsilk:`#fff8dc`,crimson:`#dc143c`,cyan:`#00ffff`,darkblue:`#00008b`,darkcyan:`#008b8b`,darkgoldenrod:`#b8860b`,darkgray:`#a9a9a9`,darkgreen:`#006400`,darkgrey:`#a9a9a9`,darkkhaki:`#bdb76b`,darkmagenta:`#8b008b`,darkolivegreen:`#556b2f`,darkorange:`#ff8c00`,darkorchid:`#9932cc`,darkred:`#8b0000`,darksalmon:`#e9967a`,darkseagreen:`#8fbc8f`,darkslateblue:`#483d8b`,darkslategray:`#2f4f4f`,darkslategrey:`#2f4f4f`,darkturquoise:`#00ced1`,darkviolet:`#9400d3`,deeppink:`#ff1493`,deepskyblue:`#00bfff`,dimgray:`#696969`,dimgrey:`#696969`,dodgerblue:`#1e90ff`,firebrick:`#b22222`,floralwhite:`#fffaf0`,forestgreen:`#228b22`,fuchsia:`#ff00ff`,gainsboro:`#dcdcdc`,ghostwhite:`#f8f8ff`,gold:`#ffd700`,goldenrod:`#daa520`,gray:`#808080`,green:`#008000`,greenyellow:`#adff2f`,grey:`#808080`,honeydew:`#f0fff0`,hotpink:`#ff69b4`,indianred:`#cd5c5c`,indigo:`#4b0082`,ivory:`#fffff0`,khaki:`#f0e68c`,lavender:`#e6e6fa`,lavenderblush:`#fff0f5`,lawngreen:`#7cfc00`,lemonchiffon:`#fffacd`,lightblue:`#add8e6`,lightcoral:`#f08080`,lightcyan:`#e0ffff`,lightgoldenrodyellow:`#fafad2`,lightgray:`#d3d3d3`,lightgreen:`#90ee90`,lightgrey:`#d3d3d3`,lightpink:`#ffb6c1`,lightsalmon:`#ffa07a`,lightseagreen:`#20b2aa`,lightskyblue:`#87cefa`,lightslategray:`#778899`,lightslategrey:`#778899`,lightsteelblue:`#b0c4de`,lightyellow:`#ffffe0`,lime:`#00ff00`,limegreen:`#32cd32`,linen:`#faf0e6`,magenta:`#ff00ff`,maroon:`#800000`,mediumaquamarine:`#66cdaa`,mediumblue:`#0000cd`,mediumorchid:`#ba55d3`,mediumpurple:`#9370db`,mediumseagreen:`#3cb371`,mediumslateblue:`#7b68ee`,mediumspringgreen:`#00fa9a`,mediumturquoise:`#48d1cc`,mediumvioletred:`#c71585`,midnightblue:`#191970`,mintcream:`#f5fffa`,mistyrose:`#ffe4e1`,moccasin:`#ffe4b5`,navajowhite:`#ffdead`,navy:`#000080`,oldlace:`#fdf5e6`,olive:`#808000`,olivedrab:`#6b8e23`,orange:`#ffa500`,orangered:`#ff4500`,orchid:`#da70d6`,palegoldenrod:`#eee8aa`,palegreen:`#98fb98`,paleturquoise:`#afeeee`,palevioletred:`#db7093`,papayawhip:`#ffefd5`,peachpuff:`#ffdab9`,peru:`#cd853f`,pink:`#ffc0cb`,plum:`#dda0dd`,powderblue:`#b0e0e6`,purple:`#800080`,rebeccapurple:`#663399`,red:`#ff0000`,rosybrown:`#bc8f8f`,royalblue:`#4169e1`,saddlebrown:`#8b4513`,salmon:`#fa8072`,sandybrown:`#f4a460`,seagreen:`#2e8b57`,seashell:`#fff5ee`,sienna:`#a0522d`,silver:`#c0c0c0`,skyblue:`#87ceeb`,slateblue:`#6a5acd`,slategray:`#708090`,slategrey:`#708090`,snow:`#fffafa`,springgreen:`#00ff7f`,steelblue:`#4682b4`,tan:`#d2b48c`,teal:`#008080`,thistle:`#d8bfd8`,tomato:`#ff6347`,turquoise:`#40e0d0`,violet:`#ee82ee`,wheat:`#f5deb3`,white:`#ffffff`,whitesmoke:`#f5f5f5`,yellow:`#ffff00`,yellowgreen:`#9acd32`}}(nc||={});var rc=class{constructor(){this.clear()}clear(){this.map=new WeakMap,this.arr=[]}has(e){return this.map.has(e)}get(e){return this.map.get(e)}set(e,t){this.map.set(e,t),this.arr.push(e)}delete(e){let t=this.arr.indexOf(e);t>=0&&this.arr.splice(t,1);let n=this.map.get(e);return this.map.delete(e),n}each(e){this.arr.forEach(t=>{let n=this.map.get(t);e(n,t)})}dispose(){this.clear()}},ic;(function(e){function t(e){let t=[],n=[];return Array.isArray(e)?t.push(...e):e.split(`|`).forEach(e=>{e.indexOf(`&`)===-1?t.push(e):n.push(...e.split(`&`))}),{or:t,and:n}}e.parse=t;function n(e,n){if(e!=null&&n!=null){let r=t(e),i=t(n),a=r.or.sort(),o=i.or.sort(),s=r.and.sort(),c=i.and.sort(),l=(e,t)=>e.length===t.length&&(e.length===0||e.every((e,n)=>e===t[n]));return l(a,o)&&l(s,c)}return e==null&&n==null}e.equals=n;function r(e,n,r){if(n==null||Array.isArray(n)&&n.length===0)return r?e.altKey!==!0&&e.ctrlKey!==!0&&e.metaKey!==!0&&e.shiftKey!==!0:!0;let{or:i,and:a}=t(n),o=t=>{let n=`${t.toLowerCase()}Key`;return e[n]===!0};return i.some(e=>o(e))&&a.every(e=>o(e))}e.isMatch=r})(ic||={});var ac;(function(e){e.linear=e=>e,e.quad=e=>e*e,e.cubic=e=>e*e*e,e.inout=e=>{if(e<=0)return 0;if(e>=1)return 1;let t=e*e,n=t*e;return 4*(e<.5?n:3*(e-t)+n-.75)},e.exponential=e=>2**(10*(e-1)),e.bounce=e=>{for(let t=0,n=1;;t+=n,n/=2)if(e>=(7-4*t)/11){let r=(11-6*t-11*e)/4;return-r*r+n*n}}})(ac||={}),function(e){e.decorators={reverse(e){return t=>1-e(1-t)},reflect(e){return t=>.5*(t<.5?e(2*t):2-e(2-2*t))},clamp(e,t=0,n=1){return r=>{let i=e(r);return i<t?t:i>n?n:i}},back(e=1.70158){return t=>t*t*((e+1)*t-e)},elastic(e=1.5){return t=>2**(10*(t-1))*Math.cos(20*Math.PI*e/3*t)}}}(ac||={}),function(e){function t(e){return-1*Math.cos(e*(Math.PI/2))+1}e.easeInSine=t;function n(e){return Math.sin(e*(Math.PI/2))}e.easeOutSine=n;function r(e){return-.5*(Math.cos(Math.PI*e)-1)}e.easeInOutSine=r;function i(e){return e*e}e.easeInQuad=i;function a(e){return e*(2-e)}e.easeOutQuad=a;function o(e){return e<.5?2*e*e:-1+(4-2*e)*e}e.easeInOutQuad=o;function s(e){return e*e*e}e.easeInCubic=s;function c(e){let t=e-1;return t*t*t+1}e.easeOutCubic=c;function l(e){return e<.5?4*e*e*e:(e-1)*(2*e-2)*(2*e-2)+1}e.easeInOutCubic=l;function u(e){return e*e*e*e}e.easeInQuart=u;function d(e){let t=e-1;return 1-t*t*t*t}e.easeOutQuart=d;function f(e){let t=e-1;return e<.5?8*e*e*e*e:1-8*t*t*t*t}e.easeInOutQuart=f;function p(e){return e*e*e*e*e}e.easeInQuint=p;function m(e){let t=e-1;return 1+t*t*t*t*t}e.easeOutQuint=m;function h(e){let t=e-1;return e<.5?16*e*e*e*e*e:1+16*t*t*t*t*t}e.easeInOutQuint=h;function g(e){return e===0?0:2**(10*(e-1))}e.easeInExpo=g;function _(e){return e===1?1:-(2**(-10*e))+1}e.easeOutExpo=_;function v(e){if(e===0||e===1)return e;let t=e*2,n=t-1;return t<1?.5*2**(10*n):.5*(-(2**(-10*n))+2)}e.easeInOutExpo=v;function y(e){let t=e/1;return-1*(Math.sqrt(1-t*e)-1)}e.easeInCirc=y;function b(e){let t=e-1;return Math.sqrt(1-t*t)}e.easeOutCirc=b;function x(e){let t=e*2,n=t-2;return t<1?-.5*(Math.sqrt(1-t*t)-1):.5*(Math.sqrt(1-n*n)+1)}e.easeInOutCirc=x;function S(e,t=1.70158){return e*e*((t+1)*e-t)}e.easeInBack=S;function C(e,t=1.70158){let n=e/1-1;return n*n*((t+1)*n+t)+1}e.easeOutBack=C;function ee(e,t=1.70158){let n=e*2,r=n-2,i=t*1.525;return n<1?.5*n*n*((i+1)*n-i):.5*(r*r*((i+1)*r+i)+2)}e.easeInOutBack=ee;function w(e,t=.7){if(e===0||e===1)return e;let n=e/1,r=n-1,i=1-t,a=i/(2*Math.PI)*Math.asin(1);return-(2**(10*r)*Math.sin((r-a)*(2*Math.PI)/i))}e.easeInElastic=w;function T(e,t=.7){let n=1-t,r=e*2;if(e===0||e===1)return e;let i=n/(2*Math.PI)*Math.asin(1);return 2**(-10*r)*Math.sin((r-i)*(2*Math.PI)/n)+1}e.easeOutElastic=T;function E(e,t=.65){let n=1-t;if(e===0||e===1)return e;let r=e*2,i=r-1,a=n/(2*Math.PI)*Math.asin(1);return r<1?-.5*(2**(10*i)*Math.sin((i-a)*(2*Math.PI)/n)):2**(-10*i)*Math.sin((i-a)*(2*Math.PI)/n)*.5+1}e.easeInOutElastic=E;function te(e){let t=e/1;if(t<1/2.75)return 7.5625*t*t;if(t<2/2.75){let e=t-1.5/2.75;return 7.5625*e*e+.75}if(t<2.5/2.75){let e=t-2.25/2.75;return 7.5625*e*e+.9375}{let e=t-2.625/2.75;return 7.5625*e*e+.984375}}e.easeOutBounce=te;function ne(e){return 1-te(1-e)}e.easeInBounce=ne;function re(e){return e<.5?ne(e*2)*.5:te(e*2-1)*.5+.5}e.easeInOutBounce=re}(ac||={});var oc;(function(e){e.number=(e,t)=>{let n=t-e;return t=>e+n*t},e.object=(e,t)=>{let n=Object.keys(e);return r=>{let i={};for(let a=n.length-1;a!==-1;--a){let o=n[a];i[o]=e[o]+(t[o]-e[o])*r}return i}},e.unit=(e,t)=>{let n=/(-?[0-9]*.[0-9]*)(px|em|cm|mm|in|pt|pc|%)/,r=n.exec(e),i=n.exec(t),a=i?i[1]:``,o=r?+r[1]:0,s=i?+i[1]:0,c=a.indexOf(`.`),l=c>0?a[1].length-c-1:0,u=s-o,d=r?r[2]:``;return e=>(o+u*e).toFixed(l)+d},e.color=(e,t)=>{let n=parseInt(e.slice(1),16),r=parseInt(t.slice(1),16),i=n&255,a=(r&255)-i,o=n&65280,s=(r&65280)-o,c=n&16711680,l=(r&16711680)-c;return e=>{let t=i+a*e&255,n=o+s*e&65280,r=c+l*e&16711680;return`#${(1<<24|t|n|r).toString(16).slice(1)}`}}})(oc||={});const sc=[];function cc(e,t){let n=sc.find(t=>t.name===e);if(!(n&&(n.loadTimes+=1,n.loadTimes>1))&&!Ia.isApplyingHMR()){let n=document.createElement(`style`);n.setAttribute(`type`,`text/css`),n.textContent=t;let r=document.querySelector(`head`);r&&r.insertBefore(n,r.firstChild),sc.push({name:e,loadTimes:1,styleElement:n})}}function lc(e){let t=sc.findIndex(t=>t.name===e);if(t>-1){let e=sc[t];if(--e.loadTimes,e.loadTimes>0)return;let n=e.styleElement;n&&n.parentNode&&n.parentNode.removeChild(n),n=null,sc.splice(t,1)}}var L;(function(e){function t(e){return 180*e/Math.PI%360}e.toDeg=t,e.toRad=function(e,t=!1){let n=t?e:e%360;return n*Math.PI/180};function n(e){return e%360+(e<0?360:0)}e.normalize=n})(L||={});var R;(function(e){function t(e,t=0){return Number.isInteger(e)?e:+e.toFixed(t)}e.round=t;function n(e,t){let n,r;if(t==null?(r=e??1,n=0):(r=t,n=e??0),r<n){let e=n;n=r,r=e}return Math.floor(Math.random()*(r-n+1)+n)}e.random=n;function r(e,t,n){return Number.isNaN(e)?NaN:Number.isNaN(t)||Number.isNaN(n)?0:t<n?e<t?t:e>n?n:e:e<n?n:e>t?t:e}e.clamp=r;function i(e,t){return t*Math.round(e/t)}e.snapToGrid=i;function a(e,t){return t!=null&&e!=null&&t.x>=e.x&&t.x<=e.x+e.width&&t.y>=e.y&&t.y<=e.y+e.height}e.containsPoint=a;function o(e,t){let n=e.x-t.x,r=e.y-t.y;return n*n+r*r}e.squaredLength=o})(R||={});var uc=class{valueOf(){return this.toJSON()}toString(){return JSON.stringify(this.toJSON())}},z=class e extends uc{constructor(e,t){super(),this.x=e??0,this.y=t??0}round(e=0){return this.x=R.round(this.x,e),this.y=R.round(this.y,e),this}add(t,n){let r=e.create(t,n);return this.x+=r.x,this.y+=r.y,this}update(t,n){let r=e.create(t,n);return this.x=r.x,this.y=r.y,this}translate(t,n){let r=e.create(t,n);return this.x+=r.x,this.y+=r.y,this}rotate(t,n){let r=e.rotate(this,t,n);return this.x=r.x,this.y=r.y,this}scale(t,n,r=new e){let i=e.create(r);return this.x=i.x+t*(this.x-i.x),this.y=i.y+n*(this.y-i.y),this}closest(t){if(t.length===1)return e.create(t[0]);let n=null,r=1/0;return t.forEach(e=>{let t=this.squaredDistance(e);t<r&&(n=e,r=t)}),n?e.create(n):null}distance(e){return Math.sqrt(this.squaredDistance(e))}squaredDistance(t){let n=e.create(t),r=this.x-n.x,i=this.y-n.y;return r*r+i*i}manhattanDistance(t){let n=e.create(t);return Math.abs(n.x-this.x)+Math.abs(n.y-this.y)}magnitude(){return Math.sqrt(this.x*this.x+this.y*this.y)||.01}theta(t=new e){let n=e.create(t),r=-(n.y-this.y),i=n.x-this.x,a=Math.atan2(r,i);return a<0&&(a=2*Math.PI+a),180*a/Math.PI}angleBetween(e,t){if(this.equals(e)||this.equals(t))return NaN;let n=this.theta(t)-this.theta(e);return n<0&&(n+=360),n}vectorAngle(t){let n=new e(0,0);return n.angleBetween(this,t)}toPolar(t){return this.update(e.toPolar(this,t)),this}changeInAngle(t,n,r=new e){return this.clone().translate(-t,-n).theta(r)-this.theta(r)}adhereToRect(e){return R.containsPoint(e,this)||(this.x=Math.min(Math.max(this.x,e.x),e.x+e.width),this.y=Math.min(Math.max(this.y,e.y),e.y+e.height)),this}bearing(t){let n=e.create(t),r=L.toRad(this.y),i=L.toRad(n.y),a=this.x,o=n.x,s=L.toRad(o-a),c=Math.sin(s)*Math.cos(i),l=Math.cos(r)*Math.sin(i)-Math.sin(r)*Math.cos(i)*Math.cos(s),u=L.toDeg(Math.atan2(c,l)),d=[`NE`,`E`,`SE`,`S`,`SW`,`W`,`NW`,`N`],f=u-22.5;return f<0&&(f+=360),f=parseInt(f/45,10),d[f]}cross(t,n){if(t!=null&&n!=null){let r=e.create(t),i=e.create(n);return(i.x-this.x)*(r.y-this.y)-(i.y-this.y)*(r.x-this.x)}return NaN}dot(t){let n=e.create(t);return this.x*n.x+this.y*n.y}diff(t,n){if(typeof t==`number`)return new e(this.x-t,this.y-n);let r=e.create(t);return new e(this.x-r.x,this.y-r.y)}lerp(t,n){let r=e.create(t);return new e((1-n)*this.x+n*r.x,(1-n)*this.y+n*r.y)}normalize(e=1){let t=e/this.magnitude();return this.scale(t,t)}move(t,n){let r=e.create(t),i=L.toRad(r.theta(this));return this.translate(Math.cos(i)*n,-Math.sin(i)*n)}reflection(t){return e.create(t).move(this,this.distance(t))}snapToGrid(e,t){return this.x=R.snapToGrid(this.x,e),this.y=R.snapToGrid(this.y,t??e),this}equals(t){let n=e.create(t);return n!=null&&n.x===this.x&&n.y===this.y}clone(){return e.clone(this)}toJSON(){return e.toJSON(this)}serialize(){return`${this.x} ${this.y}`}};(function(e){function t(t){return t!=null&&t instanceof e}e.isPoint=t})(z||={}),function(e){function t(e){return typeof e==`object`&&!!e&&typeof e.x==`number`&&typeof e.y==`number`}e.isPointLike=t;function n(e){return e!=null&&Array.isArray(e)&&e.length===2&&typeof e[0]==`number`&&typeof e[1]==`number`}e.isPointData=n}(z||={}),function(e){function t(t,r){return t==null||typeof t==`number`?new e(t,r):n(t)}e.create=t;function n(t){return e.isPoint(t)?new e(t.x,t.y):Array.isArray(t)?new e(t[0],t[1]):new e(t.x,t.y)}e.clone=n;function r(t){return e.isPoint(t)?{x:t.x,y:t.y}:Array.isArray(t)?{x:t[0],y:t[1]}:{x:t.x,y:t.y}}e.toJSON=r;function i(t,r,i=new e){let a=Math.abs(t*Math.cos(r)),o=Math.abs(t*Math.sin(r)),s=n(i),c=L.normalize(L.toDeg(r));return c<90?o=-o:c<180?(a=-a,o=-o):c<270&&(a=-a),new e(s.x+a,s.y+o)}e.fromPolar=i;function a(t,r=new e){let i=n(t),a=n(r),o=i.x-a.x,s=i.y-a.y;return new e(Math.sqrt(o*o+s*s),L.toRad(a.theta(i)))}e.toPolar=a;function o(e,t){return e===t?!0:e!=null&&t!=null?e.x===t.x&&e.y===t.y:!1}e.equals=o;function s(e,t){if(e==null&&t!=null||e!=null&&t==null||e!=null&&t!=null&&e.length!==t.length)return!1;if(e!=null&&t!=null){for(let n=0,r=e.length;n<r;n+=1)if(!o(e[n],t[n]))return!1}return!0}e.equalPoints=s;function c(t,n,r,i){return new e(R.random(t,n),R.random(r,i))}e.random=c;function l(e,t,n){let r=L.toRad(L.normalize(-t)),i=Math.sin(r),a=Math.cos(r);return u(e,a,i,n)}e.rotate=l;function u(t,r,i,a=new e){let o=n(t),s=n(a),c=o.x-s.x,l=o.y-s.y,u=c*r-l*i,d=l*r+c*i;return new e(u+s.x,d+s.y)}e.rotateEx=u}(z||={});var B=class e extends uc{get left(){return this.x}get top(){return this.y}get right(){return this.x+this.width}get bottom(){return this.y+this.height}get origin(){return new z(this.x,this.y)}get topLeft(){return new z(this.x,this.y)}get topCenter(){return new z(this.x+this.width/2,this.y)}get topRight(){return new z(this.x+this.width,this.y)}get center(){return new z(this.x+this.width/2,this.y+this.height/2)}get bottomLeft(){return new z(this.x,this.y+this.height)}get bottomCenter(){return new z(this.x+this.width/2,this.y+this.height)}get bottomRight(){return new z(this.x+this.width,this.y+this.height)}get corner(){return new z(this.x+this.width,this.y+this.height)}get rightMiddle(){return new z(this.x+this.width,this.y+this.height/2)}get leftMiddle(){return new z(this.x,this.y+this.height/2)}get topLine(){return new V(this.topLeft,this.topRight)}get rightLine(){return new V(this.topRight,this.bottomRight)}get bottomLine(){return new V(this.bottomLeft,this.bottomRight)}get leftLine(){return new V(this.topLeft,this.bottomLeft)}constructor(e,t,n,r){super(),this.x=e??0,this.y=t??0,this.width=n??0,this.height=r??0}getOrigin(){return this.origin}getTopLeft(){return this.topLeft}getTopCenter(){return this.topCenter}getTopRight(){return this.topRight}getCenter(){return this.center}getCenterX(){return this.x+this.width/2}getCenterY(){return this.y+this.height/2}getBottomLeft(){return this.bottomLeft}getBottomCenter(){return this.bottomCenter}getBottomRight(){return this.bottomRight}getCorner(){return this.corner}getRightMiddle(){return this.rightMiddle}getLeftMiddle(){return this.leftMiddle}getTopLine(){return this.topLine}getRightLine(){return this.rightLine}getBottomLine(){return this.bottomLine}getLeftLine(){return this.leftLine}bbox(t){if(!t)return this.clone();let n=L.toRad(t),r=Math.abs(Math.sin(n)),i=Math.abs(Math.cos(n)),a=this.width*i+this.height*r,o=this.width*r+this.height*i;return new e(this.x+(this.width-a)/2,this.y+(this.height-o)/2,a,o)}round(e=0){return this.x=R.round(this.x,e),this.y=R.round(this.y,e),this.width=R.round(this.width,e),this.height=R.round(this.height,e),this}add(t,n,r,i){let a=e.create(t,n,r,i),o=Math.min(this.x,a.x),s=Math.min(this.y,a.y),c=Math.max(this.x+this.width,a.x+a.width),l=Math.max(this.y+this.height,a.y+a.height);return this.x=o,this.y=s,this.width=c-o,this.height=l-s,this}update(t,n,r,i){let a=e.create(t,n,r,i);return this.x=a.x,this.y=a.y,this.width=a.width,this.height=a.height,this}inflate(e,t){let n=e,r=t??e;return this.x-=n,this.y-=r,this.width+=2*n,this.height+=2*r,this}snapToGrid(e,t){let n=this.origin.snapToGrid(e,t),r=this.corner.snapToGrid(e,t);return this.x=n.x,this.y=n.y,this.width=r.x-n.x,this.height=r.y-n.y,this}translate(e,t){let n=z.create(e,t);return this.x+=n.x,this.y+=n.y,this}scale(e,t,n=new z){let r=this.origin.scale(e,t,n);return this.x=r.x,this.y=r.y,this.width*=e,this.height*=t,this}rotate(t,n=this.getCenter()){if(t!==0){let r=L.toRad(t),i=Math.cos(r),a=Math.sin(r),o=this.getOrigin(),s=this.getTopRight(),c=this.getBottomRight(),l=this.getBottomLeft();o=z.rotateEx(o,i,a,n),s=z.rotateEx(s,i,a,n),c=z.rotateEx(c,i,a,n),l=z.rotateEx(l,i,a,n);let u=new e(o.x,o.y,0,0);u.add(s.x,s.y,0,0),u.add(c.x,c.y,0,0),u.add(l.x,l.y,0,0),this.update(u)}return this}rotate90(){let e=(this.width-this.height)/2;this.x+=e,this.y-=e;let t=this.width;return this.width=this.height,this.height=t,this}moveAndExpand(t){let n=e.clone(t);return this.x+=n.x||0,this.y+=n.y||0,this.width+=n.width||0,this.height+=n.height||0,this}getMaxScaleToFit(t,n=this.center){let r=e.clone(t),i=n.x,a=n.y,o=1/0,s=1/0,c=1/0,l=1/0,u=1/0,d=1/0,f=1/0,p=1/0,m=r.topLeft;m.x<i&&(o=(this.x-i)/(m.x-i)),m.y<a&&(u=(this.y-a)/(m.y-a));let h=r.bottomRight;h.x>i&&(s=(this.x+this.width-i)/(h.x-i)),h.y>a&&(d=(this.y+this.height-a)/(h.y-a));let g=r.topRight;g.x>i&&(c=(this.x+this.width-i)/(g.x-i)),g.y<a&&(f=(this.y-a)/(g.y-a));let _=r.bottomLeft;return _.x<i&&(l=(this.x-i)/(_.x-i)),_.y>a&&(p=(this.y+this.height-a)/(_.y-a)),{sx:Math.min(o,s,c,l),sy:Math.min(u,d,f,p)}}getMaxUniformScaleToFit(e,t=this.center){let n=this.getMaxScaleToFit(e,t);return Math.min(n.sx,n.sy)}containsPoint(e,t){return R.containsPoint(this,z.create(e,t))}containsRect(t,n,r,i){let a=e.create(t,n,r,i),o=this.x,s=this.y,c=this.width,l=this.height,u=a.x,d=a.y,f=a.width,p=a.height;return c===0||l===0||f===0||p===0?!1:u>=o&&d>=s&&u+f<=o+c&&d+p<=s+l}intersectsWithLine(e){let t=[this.topLine,this.rightLine,this.bottomLine,this.leftLine],n=[],r=[];return t.forEach(t=>{let i=e.intersectsWithLine(t);i!==null&&r.indexOf(i.toString())<0&&(n.push(i),r.push(i.toString()))}),n.length>0?n:null}intersectsWithLineFromCenterToPoint(e,t){let n=z.clone(e),r=this.center,i=null;t!=null&&t!==0&&n.rotate(t,r);let a=[this.topLine,this.rightLine,this.bottomLine,this.leftLine],o=new V(r,n);for(let e=a.length-1;e>=0;--e){let t=a[e].intersectsWithLine(o);if(t!==null){i=t;break}}return i&&t!=null&&t!==0&&i.rotate(-t,r),i}intersectsWithRect(t,n,r,i){let a=e.create(t,n,r,i);if(!this.isIntersectWithRect(a))return null;let o=this.origin,s=this.corner,c=a.origin,l=a.corner,u=Math.max(o.x,c.x),d=Math.max(o.y,c.y);return new e(u,d,Math.min(s.x,l.x)-u,Math.min(s.y,l.y)-d)}isIntersectWithRect(t,n,r,i){let a=e.create(t,n,r,i),o=this.origin,s=this.corner,c=a.origin,l=a.corner;return!(l.x<=o.x||l.y<=o.y||c.x>=s.x||c.y>=s.y)}normalize(){let e=this.x,t=this.y,n=this.width,r=this.height;return this.width<0&&(e=this.x+this.width,n=-this.width),this.height<0&&(t=this.y+this.height,r=-this.height),this.x=e,this.y=t,this.width=n,this.height=r,this}union(t){let n=e.clone(t),r=this.origin,i=this.corner,a=n.origin,o=n.corner,s=Math.min(r.x,a.x),c=Math.min(r.y,a.y),l=Math.max(i.x,o.x),u=Math.max(i.y,o.y);return new e(s,c,l-s,u-c)}getNearestSideToPoint(e){let t=z.clone(e),n=t.x-this.x,r=this.x+this.width-t.x,i=t.y-this.y,a=this.y+this.height-t.y,o=n,s=`left`;return r<o&&(o=r,s=`right`),i<o&&(o=i,s=`top`),a<o&&(s=`bottom`),s}getNearestPointToPoint(e){let t=z.clone(e);if(this.containsPoint(t)){let e=this.getNearestSideToPoint(t);if(e===`left`)return new z(this.x,t.y);if(e===`top`)return new z(t.x,this.y);if(e===`right`)return new z(this.x+this.width,t.y);if(e===`bottom`)return new z(t.x,this.y+this.height)}return t.adhereToRect(this)}equals(e){return e!=null&&e.x===this.x&&e.y===this.y&&e.width===this.width&&e.height===this.height}clone(){return new e(this.x,this.y,this.width,this.height)}toJSON(){return{x:this.x,y:this.y,width:this.width,height:this.height}}serialize(){return`${this.x} ${this.y} ${this.width} ${this.height}`}};(function(e){function t(t){return t!=null&&t instanceof e}e.isRectangle=t})(B||={}),function(e){function t(e){return typeof e==`object`&&!!e&&typeof e.x==`number`&&typeof e.y==`number`&&typeof e.width==`number`&&typeof e.height==`number`}e.isRectangleLike=t}(B||={}),function(e){function t(t,r,i,a){return t==null||typeof t==`number`?new e(t,r,i,a):n(t)}e.create=t;function n(t){return e.isRectangle(t)?t.clone():Array.isArray(t)?new e(t[0],t[1],t[2],t[3]):new e(t.x,t.y,t.width,t.height)}e.clone=n;function r(t){return new e(t.x-t.a,t.y-t.b,2*t.a,2*t.b)}e.fromEllipse=r;function i(t){return new e(0,0,t.width,t.height)}e.fromSize=i;function a(t,n){return new e(t.x,t.y,n.width,n.height)}e.fromPositionAndSize=a}(B||={});var V=class e extends uc{get center(){return new z((this.start.x+this.end.x)/2,(this.start.y+this.end.y)/2)}constructor(e,t,n,r){super(),typeof e==`number`&&typeof t==`number`?(this.start=new z(e,t),this.end=new z(n,r)):(this.start=z.create(e),this.end=z.create(t))}getCenter(){return this.center}round(e=0){return this.start.round(e),this.end.round(e),this}translate(e,t){return typeof e==`number`?(this.start.translate(e,t),this.end.translate(e,t)):(this.start.translate(e),this.end.translate(e)),this}rotate(e,t){return this.start.rotate(e,t),this.end.rotate(e,t),this}scale(e,t,n){return this.start.scale(e,t,n),this.end.scale(e,t,n),this}length(){return Math.sqrt(this.squaredLength())}squaredLength(){let e=this.start.x-this.end.x,t=this.start.y-this.end.y;return e*e+t*t}setLength(e){let t=this.length();if(!t)return this;let n=e/t;return this.scale(n,n,this.start)}parallel(e){let t=this.clone();if(!t.isDifferentiable())return t;let{start:n,end:r}=t,i=n.clone().rotate(270,r),a=r.clone().rotate(90,n);return n.move(a,e),r.move(i,e),t}vector(){return new z(this.end.x-this.start.x,this.end.y-this.start.y)}angle(){let e=new z(this.start.x+1,this.start.y);return this.start.angleBetween(this.end,e)}bbox(){let e=Math.min(this.start.x,this.end.x),t=Math.min(this.start.y,this.end.y),n=Math.max(this.start.x,this.end.x),r=Math.max(this.start.y,this.end.y);return new B(e,t,n-e,r-t)}bearing(){return this.start.bearing(this.end)}closestPoint(e){return this.pointAt(this.closestPointNormalizedLength(e))}closestPointLength(e){return this.closestPointNormalizedLength(e)*this.length()}closestPointTangent(e){return this.tangentAt(this.closestPointNormalizedLength(e))}closestPointNormalizedLength(t){let n=this.vector().dot(new e(this.start,t).vector()),r=Math.min(1,Math.max(0,n/this.squaredLength()));return Number.isNaN(r)?0:r}pointAt(e){let t=this.start,n=this.end;return e<=0?t.clone():e>=1?n.clone():t.lerp(n,e)}pointAtLength(e){let t=this.start,n=this.end,r=!0;e<0&&(r=!1,e=-e);let i=this.length();if(e>=i)return r?n.clone():t.clone();let a=(r?e:i-e)/i;return this.pointAt(a)}divideAt(t){let n=this.pointAt(t);return[new e(this.start,n),new e(n,this.end)]}divideAtLength(t){let n=this.pointAtLength(t);return[new e(this.start,n),new e(n,this.end)]}containsPoint(t){let n=this.start,r=this.end;if(n.cross(t,r)!==0)return!1;let i=this.length();return!(new e(n,t).length()>i||new e(t,r).length()>i)}intersect(e,t){let n=e.intersectsWithLine(this,t);return n?Array.isArray(n)?n:[n]:null}intersectsWithLine(e){let t=new z(this.end.x-this.start.x,this.end.y-this.start.y),n=new z(e.end.x-e.start.x,e.end.y-e.start.y),r=t.x*n.y-t.y*n.x,i=new z(e.start.x-this.start.x,e.start.y-this.start.y),a=i.x*n.y-i.y*n.x,o=i.x*t.y-i.y*t.x;if(r===0||a*r<0||o*r<0)return null;if(r>0){if(a>r||o>r)return null}else if(a<r||o<r)return null;return new z(this.start.x+a*t.x/r,this.start.y+a*t.y/r)}isDifferentiable(){return!this.start.equals(this.end)}pointOffset(e){let t=z.clone(e),n=this.start,r=this.end,i=(r.x-n.x)*(t.y-n.y)-(r.y-n.y)*(t.x-n.x);return i/this.length()}pointSquaredDistance(e,t){let n=z.create(e,t);return this.closestPoint(n).squaredDistance(n)}pointDistance(e,t){let n=z.create(e,t);return this.closestPoint(n).distance(n)}tangentAt(t){if(!this.isDifferentiable())return null;let n=this.start,r=this.end,i=this.pointAt(t),a=new e(n,r);return a.translate(i.x-n.x,i.y-n.y),a}tangentAtLength(t){if(!this.isDifferentiable())return null;let n=this.start,r=this.end,i=this.pointAtLength(t),a=new e(n,r);return a.translate(i.x-n.x,i.y-n.y),a}relativeCcw(e,t){let n=z.create(e,t),r=n.x-this.start.x,i=n.y-this.start.y,a=this.end.x-this.start.x,o=this.end.y-this.start.y,s=r*o-i*a;return s===0&&(s=r*a+i*o,s>0&&(r-=a,i-=o,s=r*a+i*o,s<0&&(s=0))),s<0?-1:s>0?1:0}equals(e){return e!=null&&this.start.x===e.start.x&&this.start.y===e.start.y&&this.end.x===e.end.x&&this.end.y===e.end.y}clone(){return new e(this.start,this.end)}toJSON(){return{start:this.start.toJSON(),end:this.end.toJSON()}}serialize(){return[this.start.serialize(),this.end.serialize()].join(` `)}};(function(e){function t(t){return t!=null&&t instanceof e}e.isLine=t})(V||={});var dc=class e extends uc{get center(){return new z(this.x,this.y)}constructor(e,t,n,r){super(),this.x=e??0,this.y=t??0,this.a=n??0,this.b=r??0}bbox(){return B.fromEllipse(this)}getCenter(){return this.center}inflate(e,t){let n=e,r=t??e;return this.a+=2*n,this.b+=2*r,this}normalizedDistance(e,t){let n=z.create(e,t),r=n.x-this.x,i=n.y-this.y,a=this.a,o=this.b;return r*r/(a*a)+i*i/(o*o)}containsPoint(e,t){return this.normalizedDistance(e,t)<=1}intersectsWithLine(e){let t=[],n=this.a,r=this.b,i=e.start,a=e.end,o=e.vector(),s=i.diff(new z(this.x,this.y)),c=new z(o.x/(n*n),o.y/(r*r)),l=new z(s.x/(n*n),s.y/(r*r)),u=o.dot(c),d=o.dot(l),f=s.dot(l)-1,p=d*d-u*f;if(p<0)return null;if(p>0){let e=Math.sqrt(p),n=(-d-e)/u,r=(-d+e)/u;if((n<0||n>1)&&(r<0||r>1))return null;n>=0&&n<=1&&t.push(i.lerp(a,n)),r>=0&&r<=1&&t.push(i.lerp(a,r))}else{let e=-d/u;if(e>=0&&e<=1)t.push(i.lerp(a,e));else return null}return t}intersectsWithLineFromCenterToPoint(e,t=0){let n=z.clone(e);t&&n.rotate(t,this.getCenter());let r=n.x-this.x,i=n.y-this.y,a;if(r===0)return a=this.bbox().getNearestPointToPoint(n),t?a.rotate(-t,this.getCenter()):a;let o=i/r,s=o*o,c=this.a*this.a,l=this.b*this.b,u=Math.sqrt(1/(1/c+s/l));u=r<0?-u:u;let d=o*u;return a=new z(this.x+u,this.y+d),t?a.rotate(-t,this.getCenter()):a}tangentTheta(e){let t=z.clone(e),n=t.x,r=t.y,i=this.a,a=this.b,o=this.bbox().center,s=o.x,c=o.y,l=30,u=n>o.x+i/2,d=n<o.x-i/2,f,p;return u||d?(p=n>o.x?r-l:r+l,f=i*i/(n-s)-i*i*(r-c)*(p-c)/(a*a*(n-s))+s):(f=r>o.y?n+l:n-l,p=a*a/(r-c)-a*a*(n-s)*(f-s)/(i*i*(r-c))+c),new z(f,p).theta(t)}scale(e,t){return this.a*=e,this.b*=t,this}rotate(t,n){let r=B.fromEllipse(this);r.rotate(t,n);let i=e.fromRect(r);return this.a=i.a,this.b=i.b,this.x=i.x,this.y=i.y,this}translate(e,t){let n=z.create(e,t);return this.x+=n.x,this.y+=n.y,this}equals(e){return e!=null&&e.x===this.x&&e.y===this.y&&e.a===this.a&&e.b===this.b}clone(){return new e(this.x,this.y,this.a,this.b)}toJSON(){return{x:this.x,y:this.y,a:this.a,b:this.b}}serialize(){return`${this.x} ${this.y} ${this.a} ${this.b}`}};(function(e){function t(t){return t!=null&&t instanceof e}e.isEllipse=t})(dc||={}),function(e){function t(t,r,i,a){return t==null||typeof t==`number`?new e(t,r,i,a):n(t)}e.create=t;function n(t){return e.isEllipse(t)?t.clone():Array.isArray(t)?new e(t[0],t[1],t[2],t[3]):new e(t.x,t.y,t.a,t.b)}e.parse=n;function r(t){let n=t.center;return new e(n.x,n.y,t.width/2,t.height/2)}e.fromRect=r}(dc||={});const fc=RegExp(`^[\\s\\dLMCZz,.]*$`);function pc(e){return typeof e==`string`?fc.test(e):!1}function mc(e,t){return(e%t+t)%t}function hc(e,t,n,r,i){let a=[],o=e[e.length-1],s=t!=null&&t>0,c=t||0;if(r&&s){e=e.slice();let t=e[0],n=new z(o.x+(t.x-o.x)/2,o.y+(t.y-o.y)/2);e.splice(0,0,n)}let l=e[0],u=1;for(n?a.push(`M`,l.x,l.y):a.push(`L`,l.x,l.y);u<(r?e.length:e.length-1);){let t=e[mc(u,e.length)],n=l.x-t.x,r=l.y-t.y;if(s&&(n!==0||r!==0)&&(i==null||i.indexOf(u-1)<0)){let i=Math.sqrt(n*n+r*r),o=n*Math.min(c,i/2)/i,s=r*Math.min(c,i/2)/i,l=t.x+o,d=t.y+s;a.push(`L`,l,d);let f=e[mc(u+1,e.length)];for(;u<e.length-2&&Math.round(f.x-t.x)===0&&Math.round(f.y-t.y)===0;)f=e[mc(u+2,e.length)],u+=1;n=f.x-t.x,r=f.y-t.y,i=Math.max(1,Math.sqrt(n*n+r*r));let p=n*Math.min(c,i/2)/i,m=r*Math.min(c,i/2)/i,h=t.x+p,g=t.y+m;a.push(`Q`,t.x,t.y,h,g),t=new z(h,g)}else a.push(`L`,t.x,t.y);l=t,u+=1}return r?a.push(`Z`):a.push(`L`,o.x,o.y),a.map(e=>typeof e==`string`?e:+e.toFixed(3)).join(` `)}function gc(e,t={}){let n=[];return e&&e.length&&e.forEach(e=>{Array.isArray(e)?n.push({x:e[0],y:e[1]}):n.push({x:e.x,y:e.y})}),hc(n,t.round,t.initialMove==null||t.initialMove,t.close,t.exclude)}function _c(e,t,n,r,i=0,a=0,o=0,s,c){if(n===0||r===0)return[];s-=e,c-=t,n=Math.abs(n),r=Math.abs(r);let l=-s/2,u=-c/2,d=Math.cos(i*Math.PI/180),f=Math.sin(i*Math.PI/180),p=d*l+f*u,m=-1*f*l+d*u,h=p*p,g=m*m,_=n*n,v=r*r,y=h/_+g/v,b;if(y>1)n=Math.sqrt(y)*n,r=Math.sqrt(y)*r,b=0;else{let e=1;a===o&&(e=-1),b=e*Math.sqrt((_*v-_*g-v*h)/(_*g+v*h))}let x=b*n*m/r,S=-1*b*r*p/n,C=d*x-f*S+s/2,ee=f*x+d*S+c/2,w=Math.atan2((m-S)/r,(p-x)/n)-Math.atan2(0,1),T=w>=0?w:2*Math.PI+w;w=Math.atan2((-m-S)/r,(-p-x)/n)-Math.atan2((m-S)/r,(p-x)/n);let E=w>=0?w:2*Math.PI+w;o===0&&E>0?E-=2*Math.PI:o!==0&&E<0&&(E+=2*Math.PI);let te=E*2/Math.PI,ne=Math.ceil(te<0?-1*te:te),re=E/ne,ie=8/3*Math.sin(re/4)*Math.sin(re/4)/Math.sin(re/2),ae=d*n,oe=d*r,se=f*n,ce=f*r,le=Math.cos(T),ue=Math.sin(T),de=-ie*(ae*ue+ce*le),fe=-ie*(se*ue-oe*le),D=0,pe=0,me=[];for(let n=0;n<ne;n+=1){T+=re,le=Math.cos(T),ue=Math.sin(T),D=ae*le-ce*ue+C,pe=se*le+oe*ue+ee;let r=-ie*(ae*ue+ce*le),i=-ie*(se*ue-oe*le),a=n*6;me[a]=Number(de+e),me[a+1]=Number(fe+t),me[a+2]=Number(D-r+e),me[a+3]=Number(pe-i+t),me[a+4]=Number(D+e),me[a+5]=Number(pe+t),de=D+r,fe=pe+i}return me.map(e=>+e.toFixed(2))}function vc(e,t,n,r,i=0,a=0,o=0,s,c){let l=[],u=_c(e,t,n,r,i,a,o,s,c);if(u!=null)for(let e=0,t=u.length;e<t;e+=6)l.push(`C`,u[e],u[e+1],u[e+2],u[e+3],u[e+4],u[e+5]);return l.join(` `)}var yc=class e extends uc{get start(){return this.points[0]||null}get end(){return this.points[this.points.length-1]||null}constructor(t){if(super(),t!=null){if(typeof t==`string`)return e.parse(t);this.points=t.map(e=>z.create(e))}else this.points=[]}scale(e,t,n=new z){return this.points.forEach(r=>r.scale(e,t,n)),this}rotate(e,t){return this.points.forEach(n=>n.rotate(e,t)),this}translate(e,t){let n=z.create(e,t);return this.points.forEach(e=>e.translate(n.x,n.y)),this}round(e=0){return this.points.forEach(t=>t.round(e)),this}bbox(){if(this.points.length===0)return new B;let e=1/0,t=-1/0,n=1/0,r=-1/0,i=this.points;for(let a=0,o=i.length;a<o;a+=1){let o=i[a],s=o.x,c=o.y;s<e&&(e=s),s>t&&(t=s),c<n&&(n=c),c>r&&(r=c)}return new B(e,n,t-e,r-n)}closestPoint(e){let t=this.closestPointLength(e);return this.pointAtLength(t)}closestPointLength(e){let t=this.points,n=t.length;if(n===0||n===1)return 0;let r=0,i=0,a=1/0;for(let o=0,s=n-1;o<s;o+=1){let n=new V(t[o],t[o+1]),s=n.length(),c=n.closestPointNormalizedLength(e),l=n.pointAt(c),u=l.squaredDistance(e);u<a&&(a=u,i=r+c*s),r+=s}return i}closestPointNormalizedLength(e){let t=this.length();if(t===0)return 0;let n=this.closestPointLength(e);return n/t}closestPointTangent(e){let t=this.closestPointLength(e);return this.tangentAtLength(t)}containsPoint(e){if(this.points.length===0)return!1;let t=z.clone(e),n=t.x,r=t.y,i=this.points,a=i.length,o=a-1,s=0;for(let c=0;c<a;c+=1){let a=i[o],l=i[c];if(t.equals(a))return!0;let u=new V(a,l);if(u.containsPoint(e))return!0;if(r<=a.y&&r>l.y||r>a.y&&r<=l.y){let t=a.x-n>l.x-n?a.x-n:l.x-n;if(t>=0){let i=new z(n+t,r),a=new V(e,i);u.intersectsWithLine(a)&&(s+=1)}}o=c}return s%2==1}intersectsWithLine(e){let t=[];for(let n=0,r=this.points.length-1;n<r;n+=1){let r=this.points[n],i=this.points[n+1],a=e.intersectsWithLine(new V(r,i));a&&t.push(a)}return t.length>0?t:null}isDifferentiable(){for(let e=0,t=this.points.length-1;e<t;e+=1){let t=this.points[e],n=this.points[e+1],r=new V(t,n);if(r.isDifferentiable())return!0}return!1}length(){let e=0;for(let t=0,n=this.points.length-1;t<n;t+=1){let n=this.points[t],r=this.points[t+1];e+=n.distance(r)}return e}pointAt(e){let t=this.points,n=t.length;if(n===0)return null;if(n===1||e<=0)return t[0].clone();if(e>=1)return t[n-1].clone();let r=this.length(),i=r*e;return this.pointAtLength(i)}pointAtLength(e){let t=this.points,n=t.length;if(n===0)return null;if(n===1)return t[0].clone();let r=!0;e<0&&(r=!1,e=-e);let i=0;for(let a=0,o=n-1;a<o;a+=1){let n=r?a:o-1-a,s=t[n],c=t[n+1],l=new V(s,c),u=s.distance(c);if(e<=i+u)return l.pointAtLength((r?1:-1)*(e-i));i+=u}let a=r?t[n-1]:t[0];return a.clone()}tangentAt(e){let t=this.points,n=t.length;if(n===0||n===1)return null;e<0&&(e=0),e>1&&(e=1);let r=this.length(),i=r*e;return this.tangentAtLength(i)}tangentAtLength(e){let t=this.points,n=t.length;if(n===0||n===1)return null;let r=!0;e<0&&(r=!1,e=-e);let i,a=0;for(let o=0,s=n-1;o<s;o+=1){let n=r?o:s-1-o,c=t[n],l=t[n+1],u=new V(c,l),d=c.distance(l);if(u.isDifferentiable()){if(e<=a+d)return u.tangentAtLength((r?1:-1)*(e-a));i=u}a+=d}if(i){let e=r?1:0;return i.tangentAt(e)}return null}simplify(e={}){let t=this.points;if(t.length<3)return this;let n=e.threshold||0,r=0;for(;t[r+2];){let e=r,i=r+1,a=r+2,o=t[e],s=t[i],c=t[a],l=new V(o,c),u=l.closestPoint(s),d=u.distance(s);d<=n?t.splice(i,1):r+=1}return this}toHull(){let t=this.points,n=t.length;if(n===0)return new e;let r=t[0];for(let e=1;e<n;e+=1)(t[e].y<r.y||t[e].y===r.y&&t[e].x>r.x)&&(r=t[e]);let i=[];for(let e=0;e<n;e+=1){let n=r.theta(t[e]);n===0&&(n=360),i.push([t[e],e,n])}if(i.sort((e,t)=>{let n=e[2]-t[2];return n===0&&(n=t[1]-e[1]),n}),i.length>2){let e=i[i.length-1];i.unshift(e)}let a={},o=[],s=e=>`${e[0].toString()}@${e[1]}`;for(;i.length!==0;){let e=i.pop(),t=e[0];if(a[s(e)])continue;let n=!1;for(;!n;)if(o.length<2)o.push(e),n=!0;else{let r=o.pop(),c=r[0],l=o.pop(),u=l[0],d=u.cross(c,t);if(d<0)o.push(l),o.push(r),o.push(e),n=!0;else if(d===0){let e=1e-10,n=c.angleBetween(u,t);Math.abs(n-180)<e||c.equals(t)||u.equals(c)?(a[s(r)]=c,o.push(l)):Math.abs((n+1)%360-1)<e&&(o.push(l),i.push(r))}else a[s(r)]=c,o.push(l)}}o.length>2&&o.pop();let c,l=-1;for(let e=0,t=o.length;e<t;e+=1){let t=o[e][1];(c===void 0||t<c)&&(c=t,l=e)}let u=[];if(l>0){let e=o.slice(l),t=o.slice(0,l);u=e.concat(t)}else u=o;let d=[];for(let e=0,t=u.length;e<t;e+=1)d.push(u[e][0]);return new e(d)}equals(e){return e==null||e.points.length!==this.points.length?!1:e.points.every((e,t)=>e.equals(this.points[t]))}clone(){return new e(this.points.map(e=>e.clone()))}toJSON(){return this.points.map(e=>e.toJSON())}serialize(){return this.points.map(e=>`${e.serialize()}`).join(` `)}};(function(e){function t(t){return t!=null&&t instanceof e}e.isPolyline=t})(yc||={}),function(e){function t(t){let n=t.trim();if(n===``)return new e;let r=[],i=n.split(/\s*,\s*|\s+/);for(let e=0,t=i.length;e<t;e+=2)r.push({x:+i[e],y:+i[e+1]});return new e(r)}e.parse=t}(yc||={});var bc=class e extends uc{constructor(e,t,n,r){super(),this.PRECISION=3,this.start=z.create(e),this.controlPoint1=z.create(t),this.controlPoint2=z.create(n),this.end=z.create(r)}bbox(){let e=this.start,t=this.controlPoint1,n=this.controlPoint2,r=this.end,i=e.x,a=e.y,o=t.x,s=t.y,c=n.x,l=n.y,u=r.x,d=r.y,f=[],p=[],m=[[],[]],h,g,_,v,y,b,x,S;for(let e=0;e<2;e+=1){if(e===0?(g=6*i-12*o+6*c,h=-3*i+9*o-9*c+3*u,_=3*o-3*i):(g=6*a-12*s+6*l,h=-3*a+9*s-9*l+3*d,_=3*s-3*a),Math.abs(h)<1e-12){if(Math.abs(g)<1e-12)continue;v=-_/g,v>0&&v<1&&p.push(v);continue}x=g*g-4*_*h,S=Math.sqrt(x),!(x<0)&&(y=(-g+S)/(2*h),y>0&&y<1&&p.push(y),b=(-g-S)/(2*h),b>0&&b<1&&p.push(b))}let C,ee,w,T=p.length,E=T;for(;T;)--T,v=p[T],w=1-v,C=w*w*w*i+3*w*w*v*o+3*w*v*v*c+v*v*v*u,m[0][T]=C,ee=w*w*w*a+3*w*w*v*s+3*w*v*v*l+v*v*v*d,m[1][T]=ee,f[T]={X:C,Y:ee};p[E]=0,p[E+1]=1,f[E]={X:i,Y:a},f[E+1]={X:u,Y:d},m[0][E]=i,m[1][E]=a,m[0][E+1]=u,m[1][E+1]=d,p.length=E+2,m[0].length=E+2,m[1].length=E+2,f.length=E+2;let te=Math.min.apply(null,m[0]),ne=Math.min.apply(null,m[1]),re=Math.max.apply(null,m[0]),ie=Math.max.apply(null,m[1]);return new B(te,ne,re-te,ie-ne)}closestPoint(e,t={}){return this.pointAtT(this.closestPointT(e,t))}closestPointLength(e,t={}){let n=this.getOptions(t);return this.lengthAtT(this.closestPointT(e,n),n)}closestPointNormalizedLength(e,t={}){let n=this.getOptions(t),r=this.closestPointLength(e,n);if(!r)return 0;let i=this.length(n);return i===0?0:r/i}closestPointT(e,t={}){let n=this.getPrecision(t),r=this.getDivisions(t),i=10**-n,a=null,o=0,s=0,c=0,l=0,u=0,d=null,f=r.length,p=f>0?1/f:0;for(r.forEach((t,n)=>{let r=t.start.distance(e),i=t.end.distance(e),f=r+i;(d==null||f<d)&&(a=t,o=n*p,s=(n+1)*p,c=r,l=i,d=f,u=t.endpointDistance())});;){let t=c?Math.abs(c-l)/c:0,n=l==null?0:Math.abs(c-l)/l,r=t<i||n<i,d=c?c<u*i:!0,f=l?l<u*i:!0,m=d||f;if(r||m)return c<=l?o:s;let h=a.divide(.5);p/=2;let g=h[0].start.distance(e),_=h[0].end.distance(e),v=g+_,y=h[1].start.distance(e),b=h[1].end.distance(e),x=y+b;v<=x?(a=h[0],s-=p,c=g,l=_):(a=h[1],o+=p,c=y,l=b)}}closestPointTangent(e,t={}){return this.tangentAtT(this.closestPointT(e,t))}containsPoint(e,t={}){let n=this.toPolyline(t);return n.containsPoint(e)}divideAt(e,t={}){if(e<=0)return this.divideAtT(0);if(e>=1)return this.divideAtT(1);let n=this.tAt(e,t);return this.divideAtT(n)}divideAtLength(e,t={}){let n=this.tAtLength(e,t);return this.divideAtT(n)}divide(e){return this.divideAtT(e)}divideAtT(t){let n=this.start,r=this.controlPoint1,i=this.controlPoint2,a=this.end;if(t<=0)return[new e(n,n,n,n),new e(n,r,i,a)];if(t>=1)return[new e(n,r,i,a),new e(a,a,a,a)];let o=this.getSkeletonPoints(t),s=o.startControlPoint1,c=o.startControlPoint2,l=o.divider,u=o.dividerControlPoint1,d=o.dividerControlPoint2;return[new e(n,s,c,l),new e(l,u,d,a)]}endpointDistance(){return this.start.distance(this.end)}getSkeletonPoints(e){let t=this.start,n=this.controlPoint1,r=this.controlPoint2,i=this.end;if(e<=0)return{startControlPoint1:t.clone(),startControlPoint2:t.clone(),divider:t.clone(),dividerControlPoint1:n.clone(),dividerControlPoint2:r.clone()};if(e>=1)return{startControlPoint1:n.clone(),startControlPoint2:r.clone(),divider:i.clone(),dividerControlPoint1:i.clone(),dividerControlPoint2:i.clone()};let a=new V(t,n).pointAt(e),o=new V(n,r).pointAt(e),s=new V(r,i).pointAt(e),c=new V(a,o).pointAt(e),l=new V(o,s).pointAt(e),u=new V(c,l).pointAt(e);return{startControlPoint1:a,startControlPoint2:c,divider:u,dividerControlPoint1:l,dividerControlPoint2:s}}getSubdivisions(t={}){let n=this.getPrecision(t),r=[new e(this.start,this.controlPoint1,this.controlPoint2,this.end)];if(n===0)return r;let i=this.endpointDistance(),a=10**-n,o=0;for(;;){o+=1;let e=[];r.forEach(t=>{let n=t.divide(.5);e.push(n[0],n[1])});let t=e.reduce((e,t)=>e+t.endpointDistance(),0),n=t===0?0:(t-i)/t;if(o>1&&n<a)return e;r=e,i=t}}length(e={}){let t=this.getDivisions(e);return t.reduce((e,t)=>e+t.endpointDistance(),0)}lengthAtT(e,t={}){if(e<=0)return 0;let n=t.precision===void 0?this.PRECISION:t.precision,r=this.divide(e)[0];return r.length({precision:n})}pointAt(e,t={}){if(e<=0)return this.start.clone();if(e>=1)return this.end.clone();let n=this.tAt(e,t);return this.pointAtT(n)}pointAtLength(e,t={}){let n=this.tAtLength(e,t);return this.pointAtT(n)}pointAtT(e){return e<=0?this.start.clone():e>=1?this.end.clone():this.getSkeletonPoints(e).divider}isDifferentiable(){let e=this.start,t=this.controlPoint1,n=this.controlPoint2,r=this.end;return!(e.equals(t)&&t.equals(n)&&n.equals(r))}tangentAt(e,t={}){if(!this.isDifferentiable())return null;e<0?e=0:e>1&&(e=1);let n=this.tAt(e,t);return this.tangentAtT(n)}tangentAtLength(e,t={}){if(!this.isDifferentiable())return null;let n=this.tAtLength(e,t);return this.tangentAtT(n)}tangentAtT(e){if(!this.isDifferentiable())return null;e<0&&(e=0),e>1&&(e=1);let t=this.getSkeletonPoints(e),n=t.startControlPoint2,r=t.dividerControlPoint1,i=t.divider,a=new V(n,r);return a.translate(i.x-n.x,i.y-n.y),a}getPrecision(e={}){return e.precision==null?this.PRECISION:e.precision}getDivisions(e={}){if(e.subdivisions!=null)return e.subdivisions;let t=this.getPrecision(e);return this.getSubdivisions({precision:t})}getOptions(e={}){let t=this.getPrecision(e),n=this.getDivisions(e);return{precision:t,subdivisions:n}}tAt(e,t={}){if(e<=0)return 0;if(e>=1)return 1;let n=this.getOptions(t),r=this.length(n),i=r*e;return this.tAtLength(i,n)}tAtLength(e,t={}){let n=!0;e<0&&(n=!1,e=-e);let r=this.getPrecision(t),i=this.getDivisions(t),a={precision:r,subdivisions:i},o=null,s,c,l=0,u=0,d=0,f=i.length,p=f>0?1/f:0;for(let t=0;t<f;t+=1){let r=n?t:f-1-t,a=i[t],m=a.endpointDistance();if(e<=d+m){o=a,s=r*p,c=(r+1)*p,l=n?e-d:m+d-e,u=n?m+d-e:e-d;break}d+=m}if(o==null)return n?1:0;let m=this.length(a),h=10**-r;for(;;){let e;if(e=m===0?0:l/m,e<h)return s;if(e=m===0?0:u/m,e<h)return c;let t,n,r=o.divide(.5);p/=2;let i=r[0].endpointDistance(),a=r[1].endpointDistance();l<=i?(o=r[0],c-=p,t=l,n=i-t):(o=r[1],s+=p,t=l-i,n=a-t),l=t,u=n}}toPoints(e={}){let t=this.getDivisions(e),n=[t[0].start.clone()];return t.forEach(e=>n.push(e.end.clone())),n}toPolyline(e={}){return new yc(this.toPoints(e))}scale(e,t,n){return this.start.scale(e,t,n),this.controlPoint1.scale(e,t,n),this.controlPoint2.scale(e,t,n),this.end.scale(e,t,n),this}rotate(e,t){return this.start.rotate(e,t),this.controlPoint1.rotate(e,t),this.controlPoint2.rotate(e,t),this.end.rotate(e,t),this}translate(e,t){return typeof e==`number`?(this.start.translate(e,t),this.controlPoint1.translate(e,t),this.controlPoint2.translate(e,t),this.end.translate(e,t)):(this.start.translate(e),this.controlPoint1.translate(e),this.controlPoint2.translate(e),this.end.translate(e)),this}equals(e){return e!=null&&this.start.equals(e.start)&&this.controlPoint1.equals(e.controlPoint1)&&this.controlPoint2.equals(e.controlPoint2)&&this.end.equals(e.end)}clone(){return new e(this.start,this.controlPoint1,this.controlPoint2,this.end)}toJSON(){return{start:this.start.toJSON(),controlPoint1:this.controlPoint1.toJSON(),controlPoint2:this.controlPoint2.toJSON(),end:this.end.toJSON()}}serialize(){return[this.start.serialize(),this.controlPoint1.serialize(),this.controlPoint2.serialize(),this.end.serialize()].join(` `)}};(function(e){function t(t){return t!=null&&t instanceof e}e.isCurve=t})(bc||={}),function(e){function t(e){let t=e.length,n=[],r=[],i=2;n[0]=e[0]/i;for(let a=1;a<t;a+=1)r[a]=1/i,i=(a<t-1?4:3.5)-r[a],n[a]=(e[a]-n[a-1])/i;for(let e=1;e<t;e+=1)n[t-e-1]-=r[t-e]*n[t-e];return n}function n(e){let n=e.map(e=>z.clone(e)),r=[],i=[],a=n.length-1;if(a===1)return r[0]=new z((2*n[0].x+n[1].x)/3,(2*n[0].y+n[1].y)/3),i[0]=new z(2*r[0].x-n[0].x,2*r[0].y-n[0].y),[r,i];let o=[];for(let e=1;e<a-1;e+=1)o[e]=4*n[e].x+2*n[e+1].x;o[0]=n[0].x+2*n[1].x,o[a-1]=(8*n[a-1].x+n[a].x)/2;let s=t(o);for(let e=1;e<a-1;e+=1)o[e]=4*n[e].y+2*n[e+1].y;o[0]=n[0].y+2*n[1].y,o[a-1]=(8*n[a-1].y+n[a].y)/2;let c=t(o);for(let e=0;e<a;e+=1)r.push(new z(s[e],c[e])),e<a-1?i.push(new z(2*n[e+1].x-s[e+1],2*n[e+1].y-c[e+1])):i.push(new z((n[a].x+s[a-1])/2,(n[a].y+c[a-1])/2));return[r,i]}function r(t){if(t==null||Array.isArray(t)&&t.length<2)throw Error(`At least 2 points are required`);let r=n(t),i=[];for(let n=0,a=r[0].length;n<a;n+=1){let a=new z(r[0][n].x,r[0][n].y),o=new z(r[1][n].x,r[1][n].y);i.push(new e(t[n],a,o,t[n+1]))}return i}e.throughPoints=r}(bc||={});var xc=class extends uc{constructor(){super(...arguments),this.isVisible=!0,this.isSegment=!0,this.isSubpathStart=!1}get end(){return this.endPoint}get start(){if(this.previousSegment==null)throw Error(`Missing previous segment. (This segment cannot be the first segment of a path, or segment has not yet been added to a path.)`);return this.previousSegment.end}closestPointT(e,t){if(this.closestPointNormalizedLength)return this.closestPointNormalizedLength(e);throw Error("Neither `closestPointT` nor `closestPointNormalizedLength` method is implemented.")}lengthAtT(e,t){if(e<=0)return 0;let n=this.length();return e>=1?n:n*e}divideAtT(e){if(this.divideAt)return this.divideAt(e);throw Error("Neither `divideAtT` nor `divideAt` method is implemented.")}pointAtT(e){if(this.pointAt)return this.pointAt(e);throw Error("Neither `pointAtT` nor `pointAt` method is implemented.")}tangentAtT(e){if(this.tangentAt)return this.tangentAt(e);throw Error("Neither `tangentAtT` nor `tangentAt` method is implemented.")}},Sc=class e extends xc{constructor(e,t){super(),V.isLine(e)?this.endPoint=e.end.clone().round(2):this.endPoint=z.create(e,t).round(2)}get type(){return`L`}get line(){return new V(this.start,this.end)}bbox(){return this.line.bbox()}closestPoint(e){return this.line.closestPoint(e)}closestPointLength(e){return this.line.closestPointLength(e)}closestPointNormalizedLength(e){return this.line.closestPointNormalizedLength(e)}closestPointTangent(e){return this.line.closestPointTangent(e)}length(){return this.line.length()}divideAt(t){let n=this.line.divideAt(t);return[new e(n[0]),new e(n[1])]}divideAtLength(t){let n=this.line.divideAtLength(t);return[new e(n[0]),new e(n[1])]}getSubdivisions(){return[]}pointAt(e){return this.line.pointAt(e)}pointAtLength(e){return this.line.pointAtLength(e)}tangentAt(e){return this.line.tangentAt(e)}tangentAtLength(e){return this.line.tangentAtLength(e)}isDifferentiable(){return this.previousSegment==null?!1:!this.start.equals(this.end)}clone(){return new e(this.end)}scale(e,t,n){return this.end.scale(e,t,n),this}rotate(e,t){return this.end.rotate(e,t),this}translate(e,t){return typeof e==`number`?this.end.translate(e,t):this.end.translate(e),this}equals(e){return this.type===e.type&&this.start.equals(e.start)&&this.end.equals(e.end)}toJSON(){return{type:this.type,start:this.start.toJSON(),end:this.end.toJSON()}}serialize(){let e=this.end;return`${this.type} ${e.x} ${e.y}`}};(function(e){function t(...t){let n=t.length,r=t[0];if(V.isLine(r))return new e(r);if(z.isPointLike(r))return n===1?new e(r):t.map(t=>new e(t));if(n===2)return new e(+t[0],+t[1]);let i=[];for(let r=0;r<n;r+=2){let n=+t[r],a=+t[r+1];i.push(new e(n,a))}return i}e.create=t})(Sc||={});var Cc=class e extends xc{get end(){if(!this.subpathStartSegment)throw Error(`Missing subpath start segment. (This segment needs a subpath start segment (e.g. MoveTo), or segment has not yet been added to a path.)`);return this.subpathStartSegment.end}get type(){return`Z`}get line(){return new V(this.start,this.end)}bbox(){return this.line.bbox()}closestPoint(e){return this.line.closestPoint(e)}closestPointLength(e){return this.line.closestPointLength(e)}closestPointNormalizedLength(e){return this.line.closestPointNormalizedLength(e)}closestPointTangent(e){return this.line.closestPointTangent(e)}length(){return this.line.length()}divideAt(e){let t=this.line.divideAt(e);return[t[1].isDifferentiable()?new Sc(t[0]):this.clone(),new Sc(t[1])]}divideAtLength(e){let t=this.line.divideAtLength(e);return[t[1].isDifferentiable()?new Sc(t[0]):this.clone(),new Sc(t[1])]}getSubdivisions(){return[]}pointAt(e){return this.line.pointAt(e)}pointAtLength(e){return this.line.pointAtLength(e)}tangentAt(e){return this.line.tangentAt(e)}tangentAtLength(e){return this.line.tangentAtLength(e)}isDifferentiable(){return!this.previousSegment||!this.subpathStartSegment?!1:!this.start.equals(this.end)}scale(){return this}rotate(){return this}translate(){return this}equals(e){return this.type===e.type&&this.start.equals(e.start)&&this.end.equals(e.end)}clone(){return new e}toJSON(){return{type:this.type,start:this.start.toJSON(),end:this.end.toJSON()}}serialize(){return this.type}};(function(e){function t(){return new e}e.create=t})(Cc||={});var wc=class e extends xc{constructor(e,t){super(),this.isVisible=!1,this.isSubpathStart=!0,V.isLine(e)||bc.isCurve(e)?this.endPoint=e.end.clone().round(2):this.endPoint=z.create(e,t).round(2)}get start(){throw Error(`Illegal access. Moveto segments should not need a start property.`)}get type(){return`M`}bbox(){return null}closestPoint(){return this.end.clone()}closestPointLength(){return 0}closestPointNormalizedLength(){return 0}closestPointT(){return 1}closestPointTangent(){return null}length(){return 0}lengthAtT(){return 0}divideAt(){return[this.clone(),this.clone()]}divideAtLength(){return[this.clone(),this.clone()]}getSubdivisions(){return[]}pointAt(){return this.end.clone()}pointAtLength(){return this.end.clone()}pointAtT(){return this.end.clone()}tangentAt(){return null}tangentAtLength(){return null}tangentAtT(){return null}isDifferentiable(){return!1}scale(e,t,n){return this.end.scale(e,t,n),this}rotate(e,t){return this.end.rotate(e,t),this}translate(e,t){return typeof e==`number`?this.end.translate(e,t):this.end.translate(e),this}clone(){return new e(this.end)}equals(e){return this.type===e.type&&this.end.equals(e.end)}toJSON(){return{type:this.type,end:this.end.toJSON()}}serialize(){let e=this.end;return`${this.type} ${e.x} ${e.y}`}};(function(e){function t(...t){let n=t.length,r=t[0];if(V.isLine(r)||bc.isCurve(r))return new e(r);if(z.isPointLike(r)){if(n===1)return new e(r);let i=[];for(let r=0;r<n;r+=1)r===0?i.push(new e(t[r])):i.push(new Sc(t[r]));return i}if(n===2)return new e(+t[0],+t[1]);let i=[];for(let r=0;r<n;r+=2){let n=+t[r],a=+t[r+1];r===0?i.push(new e(n,a)):i.push(new Sc(n,a))}return i}e.create=t})(wc||={});var Tc=class e extends xc{constructor(e,t,n,r,i,a){super(),bc.isCurve(e)?(this.controlPoint1=e.controlPoint1.clone().round(2),this.controlPoint2=e.controlPoint2.clone().round(2),this.endPoint=e.end.clone().round(2)):typeof e==`number`?(this.controlPoint1=new z(e,t).round(2),this.controlPoint2=new z(n,r).round(2),this.endPoint=new z(i,a).round(2)):(this.controlPoint1=z.create(e).round(2),this.controlPoint2=z.create(t).round(2),this.endPoint=z.create(n).round(2))}get type(){return`C`}get curve(){return new bc(this.start,this.controlPoint1,this.controlPoint2,this.end)}bbox(){return this.curve.bbox()}closestPoint(e){return this.curve.closestPoint(e)}closestPointLength(e){return this.curve.closestPointLength(e)}closestPointNormalizedLength(e){return this.curve.closestPointNormalizedLength(e)}closestPointTangent(e){return this.curve.closestPointTangent(e)}length(){return this.curve.length()}divideAt(t,n={}){let r=this.curve.divideAt(t,n);return[new e(r[0]),new e(r[1])]}divideAtLength(t,n={}){let r=this.curve.divideAtLength(t,n);return[new e(r[0]),new e(r[1])]}divideAtT(t){let n=this.curve.divideAtT(t);return[new e(n[0]),new e(n[1])]}getSubdivisions(){return[]}pointAt(e){return this.curve.pointAt(e)}pointAtLength(e){return this.curve.pointAtLength(e)}tangentAt(e){return this.curve.tangentAt(e)}tangentAtLength(e){return this.curve.tangentAtLength(e)}isDifferentiable(){if(!this.previousSegment)return!1;let e=this.start,t=this.controlPoint1,n=this.controlPoint2,r=this.end;return!(e.equals(t)&&t.equals(n)&&n.equals(r))}scale(e,t,n){return this.controlPoint1.scale(e,t,n),this.controlPoint2.scale(e,t,n),this.end.scale(e,t,n),this}rotate(e,t){return this.controlPoint1.rotate(e,t),this.controlPoint2.rotate(e,t),this.end.rotate(e,t),this}translate(e,t){return typeof e==`number`?(this.controlPoint1.translate(e,t),this.controlPoint2.translate(e,t),this.end.translate(e,t)):(this.controlPoint1.translate(e),this.controlPoint2.translate(e),this.end.translate(e)),this}equals(e){return this.start.equals(e.start)&&this.end.equals(e.end)&&this.controlPoint1.equals(e.controlPoint1)&&this.controlPoint2.equals(e.controlPoint2)}clone(){return new e(this.controlPoint1,this.controlPoint2,this.end)}toJSON(){return{type:this.type,start:this.start.toJSON(),controlPoint1:this.controlPoint1.toJSON(),controlPoint2:this.controlPoint2.toJSON(),end:this.end.toJSON()}}serialize(){let e=this.controlPoint1,t=this.controlPoint2,n=this.end;return[this.type,e.x,e.y,t.x,t.y,n.x,n.y].join(` `)}};(function(e){function t(...t){let n=t.length,r=t[0];if(bc.isCurve(r))return new e(r);if(z.isPointLike(r)){if(n===3)return new e(t[0],t[1],t[2]);let r=[];for(let i=0;i<n;i+=3)r.push(new e(t[i],t[i+1],t[i+2]));return r}if(n===6)return new e(t[0],t[1],t[2],t[3],t[4],t[5]);let i=[];for(let r=0;r<n;r+=6)i.push(new e(t[r],t[r+1],t[r+2],t[r+3],t[r+4],t[r+5]));return i}e.create=t})(Tc||={});function Ec(e,t,n){return{x:e*Math.cos(n)-t*Math.sin(n),y:e*Math.sin(n)+t*Math.cos(n)}}function Dc(e,t,n,r,i,a){let o=1/3,s=2/3;return[o*e+s*n,o*t+s*r,o*i+s*n,o*a+s*r,i,a]}function Oc(e,t,n,r,i,a,o,s,c,l){let u=Math.PI*120/180,d=Math.PI/180*(+i||0),f=[],p,m,h,g,_;if(l)m=l[0],h=l[1],g=l[2],_=l[3];else{p=Ec(e,t,-d),e=p.x,t=p.y,p=Ec(s,c,-d),s=p.x,c=p.y;let i=(e-s)/2,l=(t-c)/2,u=i*i/(n*n)+l*l/(r*r);u>1&&(u=Math.sqrt(u),n=u*n,r=u*r);let f=n*n,v=r*r,y=(a===o?-1:1)*Math.sqrt(Math.abs((f*v-f*l*l-v*i*i)/(f*l*l+v*i*i)));g=y*n*l/r+(e+s)/2,_=y*-r*i/n+(t+c)/2,m=Math.asin((t-_)/r),h=Math.asin((c-_)/r),m=e<g?Math.PI-m:m,h=s<g?Math.PI-h:h,m<0&&(m=Math.PI*2+m),h<0&&(h=Math.PI*2+h),o&&m>h&&(m-=Math.PI*2),!o&&h>m&&(h-=Math.PI*2)}let v=h-m;if(Math.abs(v)>u){let e=h,t=s,a=c;h=m+u*(o&&h>m?1:-1),s=g+n*Math.cos(h),c=_+r*Math.sin(h),f=Oc(s,c,n,r,i,0,o,t,a,[h,e,g,_])}v=h-m;let y=Math.cos(m),b=Math.sin(m),x=Math.cos(h),S=Math.sin(h),C=Math.tan(v/4),ee=4/3*(n*C),w=4/3*(r*C),T=[e,t],E=[e+ee*b,t-w*y],te=[s+ee*S,c-w*x],ne=[s,c];if(E[0]=2*T[0]-E[0],E[1]=2*T[1]-E[1],l)return[E,te,ne].concat(f);{f=[E,te,ne].concat(f).join().split(`,`);let e=[],t=f.length;for(let n=0;n<t;n+=1)e[n]=n%2?Ec(+f[n-1],+f[n],d).y:Ec(+f[n],+f[n+1],d).x;return e}}function kc(e){if(!e)return null;let t=`	
\v\f\r \xA0 ᠎             　\u2028\u2029`,n=RegExp(`([a-z])[${t},]*((-?\\d*\\.?\\d*(?:e[\\-+]?\\d+)?[${t}]*,?[${t}]*)+)`,`ig`),r=RegExp(`(-?\\d*\\.?\\d*(?:e[\\-+]?\\d+)?)[${t}]*,?[${t}]*`,`ig`),i={a:7,c:6,h:1,l:2,m:2,q:4,s:4,t:2,v:1,z:0},a=[];return e.replace(n,(e,t,n)=>{let o=[],s=t.toLowerCase();n.replace(r,(e,t)=>(t&&o.push(+t),e)),s===`m`&&o.length>2&&(a.push([t,...o.splice(0,2)]),s=`l`,t=t===`m`?`l`:`L`);let c=i[s];for(;o.length>=c&&(a.push([t,...o.splice(0,c)]),c););return e}),a}function Ac(e){let t=kc(e);if(!t||!t.length)return[[`M`,0,0]];let n=0,r=0,i=0,a=0,o=[];for(let e=0,s=t.length;e<s;e+=1){let s=[];o.push(s);let c=t[e],l=c[0];if(l!==l.toUpperCase())switch(s[0]=l.toUpperCase(),s[0]){case`A`:s[1]=c[1],s[2]=c[2],s[3]=c[3],s[4]=c[4],s[5]=c[5],s[6]=+c[6]+n,s[7]=+c[7]+r;break;case`V`:s[1]=+c[1]+r;break;case`H`:s[1]=+c[1]+n;break;case`M`:i=+c[1]+n,a=+c[2]+r;for(let e=1,t=c.length;e<t;e+=1)s[e]=+c[e]+(e%2?n:r);break;default:for(let e=1,t=c.length;e<t;e+=1)s[e]=+c[e]+(e%2?n:r);break}else for(let e=0,t=c.length;e<t;e+=1)s[e]=c[e];switch(s[0]){case`Z`:n=+i,r=+a;break;case`H`:n=s[1];break;case`V`:r=s[1];break;case`M`:i=s[s.length-2],a=s[s.length-1],n=s[s.length-2],r=s[s.length-1];break;default:n=s[s.length-2],r=s[s.length-1];break}}return o}function jc(e){let t=Ac(e),n={x:0,y:0,bx:0,by:0,X:0,Y:0,qx:null,qy:null};function r(e,t,n){let r,i;if(!e)return[`C`,t.x,t.y,t.x,t.y,t.x,t.y];switch(e[0]in{T:1,Q:1}||(t.qx=null,t.qy=null),e[0]){case`M`:t.X=e[1],t.Y=e[2];break;case`A`:return parseFloat(e[1])===0||parseFloat(e[2])===0?[`L`,e[6],e[7]]:[`C`].concat(Oc.apply(0,[t.x,t.y].concat(e.slice(1))));case`S`:return n===`C`||n===`S`?(r=t.x*2-t.bx,i=t.y*2-t.by):(r=t.x,i=t.y),[`C`,r,i].concat(e.slice(1));case`T`:return n===`Q`||n===`T`?(t.qx=t.x*2-t.qx,t.qy=t.y*2-t.qy):(t.qx=t.x,t.qy=t.y),[`C`].concat(Dc(t.x,t.y,t.qx,t.qy,e[1],e[2]));case`Q`:return t.qx=e[1],t.qy=e[2],[`C`].concat(Dc(t.x,t.y,e[1],e[2],e[3],e[4]));case`H`:return[`L`].concat(e[1],t.y);case`V`:return[`L`].concat(t.x,e[1]);case`L`:break;case`Z`:break;default:break}return e}function i(e,n){if(e[n].length>7){e[n].shift();let r=e[n];for(;r.length;)a[n]=`A`,n+=1,e.splice(n,0,[`C`].concat(r.splice(0,6)));e.splice(n,1),s=t.length}}let a=[],o=``,s=t.length;for(let e=0;e<s;e+=1){let s=``;t[e]&&(s=t[e][0]),s!==`C`&&(a[e]=s,e>0&&(o=a[e-1])),t[e]=r(t[e],n,o),a[e]!==`A`&&s===`C`&&(a[e]=`C`),i(t,e);let c=t[e],l=c.length;n.x=c[l-2],n.y=c[l-1],n.bx=parseFloat(c[l-4])||n.x,n.by=parseFloat(c[l-3])||n.y}return(!t[0][0]||t[0][0]!==`M`)&&t.unshift([`M`,0,0]),t}function Mc(e){return jc(e).map(e=>e.map(e=>typeof e==`string`?e:R.round(e,2))).join(`,`).split(`,`).join(` `)}var H=class e extends uc{constructor(t){if(super(),this.PRECISION=3,this.segments=[],Array.isArray(t))if(V.isLine(t[0])||bc.isCurve(t[0])){let n=null,r=t;r.forEach((t,r)=>{r===0&&this.appendSegment(e.createSegment(`M`,t.start)),n!=null&&!n.end.equals(t.start)&&this.appendSegment(e.createSegment(`M`,t.start)),V.isLine(t)?this.appendSegment(e.createSegment(`L`,t.end)):bc.isCurve(t)&&this.appendSegment(e.createSegment(`C`,t.controlPoint1,t.controlPoint2,t.end)),n=t})}else{let e=t;e.forEach(e=>{e.isSegment&&this.appendSegment(e)})}else t!=null&&(V.isLine(t)?(this.appendSegment(e.createSegment(`M`,t.start)),this.appendSegment(e.createSegment(`L`,t.end))):bc.isCurve(t)?(this.appendSegment(e.createSegment(`M`,t.start)),this.appendSegment(e.createSegment(`C`,t.controlPoint1,t.controlPoint2,t.end))):yc.isPolyline(t)?t.points&&t.points.length&&t.points.forEach((t,n)=>{let r=n===0?e.createSegment(`M`,t):e.createSegment(`L`,t);this.appendSegment(r)}):t.isSegment&&this.appendSegment(t))}get start(){let e=this.segments,t=e.length;if(t===0)return null;for(let n=0;n<t;n+=1){let t=e[n];if(t.isVisible)return t.start}return e[t-1].end}get end(){let e=this.segments,t=e.length;if(t===0)return null;for(let n=t-1;n>=0;--n){let t=e[n];if(t.isVisible)return t.end}return e[t-1].end}moveTo(...e){return this.appendSegment(wc.create.call(null,...e))}lineTo(...e){return this.appendSegment(Sc.create.call(null,...e))}curveTo(...e){return this.appendSegment(Tc.create.call(null,...e))}arcTo(e,t,n,r,i,a,o){let s=this.end||new z,c=typeof a==`number`?_c(s.x,s.y,e,t,n,r,i,a,o):_c(s.x,s.y,e,t,n,r,i,a.x,a.y);if(c!=null)for(let e=0,t=c.length;e<t;e+=6)this.curveTo(c[e],c[e+1],c[e+2],c[e+3],c[e+4],c[e+5]);return this}quadTo(t,n,r,i){let a=this.end||new z,o=[`M`,a.x,a.y];if(typeof t==`number`)o.push(`Q`,t,n,r,i);else{let e=n;o.push(`Q`,t.x,t.y,e.x,e.y)}let s=e.parse(o.join(` `));return this.appendSegment(s.segments.slice(1)),this}close(){return this.appendSegment(Cc.create())}drawPoints(t,n={}){let r=gc(t,n),i=e.parse(r);i&&i.segments&&this.appendSegment(i.segments)}bbox(){let e=this.segments,t=e.length;if(t===0)return null;let n;for(let r=0;r<t;r+=1){let t=e[r];if(t.isVisible){let e=t.bbox();e!=null&&(n=n?n.union(e):e)}}if(n!=null)return n;let r=e[t-1];return new B(r.end.x,r.end.y,0,0)}appendSegment(e){let t=this.segments.length,n=t===0?null:this.segments[t-1],r,i=null;if(Array.isArray(e))for(let t=0,a=e.length;t<a;t+=1){let a=e[t];r=this.prepareSegment(a,n,i),this.segments.push(r),n=r}else e!=null&&e.isSegment&&(r=this.prepareSegment(e,n,i),this.segments.push(r));return this}insertSegment(e,t){let n=this.segments.length;if(e<0&&(e=n+e+1),e>n||e<0)throw Error(`Index out of range.`);let r,i=null,a=null;if(n!==0&&(e>=1?(i=this.segments[e-1],a=i.nextSegment):(i=null,a=this.segments[0])),!Array.isArray(t))r=this.prepareSegment(t,i,a),this.segments.splice(e,0,r);else for(let n=0,o=t.length;n<o;n+=1){let o=t[n];r=this.prepareSegment(o,i,a),this.segments.splice(e+n,0,r),i=r}return this}removeSegment(e){let t=this.fixIndex(e),n=this.segments.splice(t,1)[0],r=n.previousSegment,i=n.nextSegment;return r&&(r.nextSegment=i),i&&(i.previousSegment=r),n.isSubpathStart&&i&&this.updateSubpathStartSegment(i),n}replaceSegment(e,t){let n=this.fixIndex(e),r,i=this.segments[n],a=i.previousSegment,o=i.nextSegment,s=i.isSubpathStart;if(!Array.isArray(t))r=this.prepareSegment(t,a,o),this.segments.splice(n,1,r),s&&r.isSubpathStart&&(s=!1);else{this.segments.splice(e,1);for(let n=0,i=t.length;n<i;n+=1){let i=t[n];r=this.prepareSegment(i,a,o),this.segments.splice(e+n,0,r),a=r,s&&r.isSubpathStart&&(s=!1)}}s&&o&&this.updateSubpathStartSegment(o)}getSegment(e){let t=this.fixIndex(e);return this.segments[t]}fixIndex(e){let t=this.segments.length;if(t===0)throw Error(`Path has no segments.`);let n=e;for(;n<0;)n=t+n;if(n>=t||n<0)throw Error(`Index out of range.`);return n}segmentAt(e,t={}){let n=this.segmentIndexAt(e,t);return n?this.getSegment(n):null}segmentAtLength(e,t={}){let n=this.segmentIndexAtLength(e,t);return n?this.getSegment(n):null}segmentIndexAt(e,t={}){if(this.segments.length===0)return null;let n=R.clamp(e,0,1),r=this.getOptions(t),i=this.length(r),a=i*n;return this.segmentIndexAtLength(a,r)}segmentIndexAtLength(e,t={}){let n=this.segments.length;if(n===0)return null;let r=!0;e<0&&(r=!1,e=-e);let i=this.getPrecision(t),a=this.getSubdivisions(t),o=0,s=null;for(let t=0;t<n;t+=1){let c=r?t:n-1-t,l=this.segments[c],u=a[c],d=l.length({precision:i,subdivisions:u});if(l.isVisible){if(e<=o+d)return c;s=c}o+=d}return s}getSegmentSubdivisions(e={}){let t=this.getPrecision(e),n=[];for(let e=0,r=this.segments.length;e<r;e+=1){let r=this.segments[e],i=r.getSubdivisions({precision:t});n.push(i)}return n}updateSubpathStartSegment(e){let t=e.previousSegment,n=e;for(;n&&!n.isSubpathStart;)t==null?n.subpathStartSegment=null:n.subpathStartSegment=t.subpathStartSegment,t=n,n=n.nextSegment}prepareSegment(e,t,n){e.previousSegment=t,e.nextSegment=n,t!=null&&(t.nextSegment=e),n!=null&&(n.previousSegment=e);let r=e;return e.isSubpathStart&&(e.subpathStartSegment=e,r=n),r!=null&&this.updateSubpathStartSegment(r),e}closestPoint(e,t={}){let n=this.closestPointT(e,t);return n?this.pointAtT(n):null}closestPointLength(e,t={}){let n=this.getOptions(t),r=this.closestPointT(e,n);return r?this.lengthAtT(r,n):0}closestPointNormalizedLength(e,t={}){let n=this.getOptions(t),r=this.closestPointLength(e,n);if(r===0)return 0;let i=this.length(n);return i===0?0:r/i}closestPointT(e,t={}){if(this.segments.length===0)return null;let n=this.getPrecision(t),r=this.getSubdivisions(t),i,a=1/0;for(let t=0,o=this.segments.length;t<o;t+=1){let o=this.segments[t],s=r[t];if(o.isVisible){let r=o.closestPointT(e,{precision:n,subdivisions:s}),c=o.pointAtT(r),l=R.squaredLength(c,e);l<a&&(i={segmentIndex:t,value:r},a=l)}}return i||{segmentIndex:this.segments.length-1,value:1}}closestPointTangent(e,t={}){if(this.segments.length===0)return null;let n=this.getPrecision(t),r=this.getSubdivisions(t),i,a=1/0;for(let t=0,o=this.segments.length;t<o;t+=1){let o=this.segments[t],s=r[t];if(o.isDifferentiable()){let t=o.closestPointT(e,{precision:n,subdivisions:s}),r=o.pointAtT(t),c=R.squaredLength(r,e);c<a&&(i=o.tangentAtT(t),a=c)}}return i||null}containsPoint(e,t={}){let n=this.toPolylines(t);if(!n)return!1;let r=0;for(let t=0,i=n.length;t<i;t+=1){let i=n[t];i.containsPoint(e)&&(r+=1)}return r%2==1}pointAt(e,t={}){if(this.segments.length===0)return null;if(e<=0)return this.start.clone();if(e>=1)return this.end.clone();let n=this.getOptions(t),r=this.length(n),i=r*e;return this.pointAtLength(i,n)}pointAtLength(e,t={}){if(this.segments.length===0)return null;if(e===0)return this.start.clone();let n=!0;e<0&&(n=!1,e=-e);let r=this.getPrecision(t),i=this.getSubdivisions(t),a,o=0;for(let t=0,s=this.segments.length;t<s;t+=1){let c=n?t:s-1-t,l=this.segments[c],u=i[c],d=l.length({precision:r,subdivisions:u});if(l.isVisible){if(e<=o+d)return l.pointAtLength((n?1:-1)*(e-o),{precision:r,subdivisions:u});a=l}o+=d}if(a)return n?a.end:a.start;let s=this.segments[this.segments.length-1];return s.end.clone()}pointAtT(e){let t=this.segments,n=t.length;if(n===0)return null;let r=e.segmentIndex;if(r<0)return t[0].pointAtT(0);if(r>=n)return t[n-1].pointAtT(1);let i=R.clamp(e.value,0,1);return t[r].pointAtT(i)}divideAt(e,t={}){if(this.segments.length===0)return null;let n=R.clamp(e,0,1),r=this.getOptions(t),i=this.length(r),a=i*n;return this.divideAtLength(a,r)}divideAtLength(t,n={}){if(this.segments.length===0)return null;let r=!0;t<0&&(r=!1,t=-t);let i=this.getPrecision(n),a=this.getSubdivisions(n),o=0,s,c,l,u,d;for(let e=0,n=this.segments.length;e<n;e+=1){let d=r?e:n-1-e,f=this.getSegment(d),p=a[d],m={precision:i,subdivisions:p},h=f.length(m);if(f.isDifferentiable()&&(l=f,u=d,t<=o+h)){c=d,s=f.divideAtLength((r?1:-1)*(t-o),m);break}o+=h}if(!l)return null;s||(c=u,d=r?1:0,s=l.divideAtT(d));let f=this.clone(),p=c;f.replaceSegment(p,s);let m=p,h=p+1,g=p+2;s[0].isDifferentiable()||(f.removeSegment(m),--h,--g);let _=f.getSegment(h).start;f.insertSegment(h,e.createSegment(`M`,_)),g+=1,s[1].isDifferentiable()||(f.removeSegment(g-1),--g);let v=g-m-1;for(let t=g,n=f.segments.length;t<n;t+=1){let n=this.getSegment(t-v),r=f.getSegment(t);if(r.type===`Z`&&!n.subpathStartSegment.end.equals(r.subpathStartSegment.end)){let r=e.createSegment(`L`,n.end);f.replaceSegment(t,r)}}let y=new e(f.segments.slice(0,h)),b=new e(f.segments.slice(h));return[y,b]}intersectsWithLine(e,t={}){let n=this.toPolylines(t);if(n==null)return null;let r=null;for(let t=0,i=n.length;t<i;t+=1){let i=n[t],a=e.intersect(i);a&&(r??=[],Array.isArray(a)?r.push(...a):r.push(a))}return r}isDifferentiable(){for(let e=0,t=this.segments.length;e<t;e+=1){let t=this.segments[e];if(t.isDifferentiable())return!0}return!1}isValid(){let e=this.segments,t=e.length===0||e[0].type===`M`;return t}length(e={}){if(this.segments.length===0)return 0;let t=this.getSubdivisions(e),n=0;for(let e=0,r=this.segments.length;e<r;e+=1){let r=this.segments[e],i=t[e];n+=r.length({subdivisions:i})}return n}lengthAtT(e,t={}){let n=this.segments.length;if(n===0)return 0;let r=e.segmentIndex;if(r<0)return 0;let i=R.clamp(e.value,0,1);r>=n&&(r=n-1,i=1);let a=this.getPrecision(t),o=this.getSubdivisions(t),s=0;for(let e=0;e<r;e+=1){let t=this.segments[e],n=o[e];s+=t.length({precision:a,subdivisions:n})}let c=this.segments[r],l=o[r];return s+=c.lengthAtT(i,{precision:a,subdivisions:l}),s}tangentAt(e,t={}){if(this.segments.length===0)return null;let n=R.clamp(e,0,1),r=this.getOptions(t),i=this.length(r),a=i*n;return this.tangentAtLength(a,r)}tangentAtLength(e,t={}){if(this.segments.length===0)return null;let n=!0;e<0&&(n=!1,e=-e);let r=this.getPrecision(t),i=this.getSubdivisions(t),a,o=0;for(let t=0,s=this.segments.length;t<s;t+=1){let c=n?t:s-1-t,l=this.segments[c],u=i[c],d=l.length({precision:r,subdivisions:u});if(l.isDifferentiable()){if(e<=o+d)return l.tangentAtLength((n?1:-1)*(e-o),{precision:r,subdivisions:u});a=l}o+=d}if(a){let e=n?1:0;return a.tangentAtT(e)}return null}tangentAtT(e){let t=this.segments.length;if(t===0)return null;let n=e.segmentIndex;if(n<0)return this.segments[0].tangentAtT(0);if(n>=t)return this.segments[t-1].tangentAtT(1);let r=R.clamp(e.value,0,1);return this.segments[n].tangentAtT(r)}getPrecision(e={}){return e.precision==null?this.PRECISION:e.precision}getSubdivisions(e={}){if(e.segmentSubdivisions==null){let t=this.getPrecision(e);return this.getSegmentSubdivisions({precision:t})}return e.segmentSubdivisions}getOptions(e={}){let t=this.getPrecision(e),n=this.getSubdivisions(e);return{precision:t,segmentSubdivisions:n}}toPoints(e={}){let t=this.segments,n=t.length;if(n===0)return null;let r=this.getSubdivisions(e),i=[],a=[];for(let e=0;e<n;e+=1){let n=t[e];if(n.isVisible){let t=r[e];t.length>0?t.forEach(e=>a.push(e.start)):a.push(n.start)}else a.length>0&&(a.push(t[e-1].end),i.push(a),a=[])}return a.length>0&&(a.push(this.end),i.push(a)),i}toPolylines(e={}){let t=this.toPoints(e);return t?t.map(e=>new yc(e)):null}scale(e,t,n){return this.segments.forEach(r=>r.scale(e,t,n)),this}rotate(e,t){return this.segments.forEach(n=>n.rotate(e,t)),this}translate(e,t){return typeof e==`number`?this.segments.forEach(n=>n.translate(e,t)):this.segments.forEach(t=>t.translate(e)),this}clone(){let t=new e;return this.segments.forEach(e=>t.appendSegment(e.clone())),t}equals(e){if(e==null)return!1;let t=this.segments,n=e.segments,r=t.length;if(n.length!==r)return!1;for(let e=0;e<r;e+=1){let r=t[e],i=n[e];if(r.type!==i.type||!r.equals(i))return!1}return!0}toJSON(){return this.segments.map(e=>e.toJSON())}serialize(){if(!this.isValid())throw Error(`Invalid path segments.`);return this.segments.map(e=>e.serialize()).join(` `)}toString(){return this.serialize()}};(function(e){function t(t){return t!=null&&t instanceof e}e.isPath=t})(H||={}),function(e){function t(t){if(!t)return new e;let r=new e,i=/(?:[a-zA-Z] *)(?:(?:-?\d+(?:\.\d+)?(?:e[-+]?\d+)? *,? *)|(?:-?\.\d+ *,? *))+|(?:[a-zA-Z] *)(?! |\d|-|\.)/g,a=e.normalize(t).match(i);if(a!=null)for(let e=0,t=a.length;e<t;e+=1){let t=a[e],i=/(?:[a-zA-Z])|(?:(?:-?\d+(?:\.\d+)?(?:e[-+]?\d+)?))|(?:(?:-?\.\d+))/g,o=t.match(i);if(o!=null){let e=o[0],t=o.slice(1).map(e=>+e),i=n.call(null,e,...t);r.appendSegment(i)}}return r}e.parse=t;function n(e,...t){if(e===`M`)return wc.create.call(null,...t);if(e===`L`)return Sc.create.call(null,...t);if(e===`C`)return Tc.create.call(null,...t);if(e===`z`||e===`Z`)return Cc.create();throw Error(`Invalid path segment type "${e}"`)}e.createSegment=n}(H||={}),function(e){e.normalize=Mc,e.isValid=pc,e.drawArc=vc,e.drawPoints=gc,e.arcToCurves=_c}(H||={});var U=class{constructor(e){this.options=Object.assign({},e),this.data=this.options.data||{},this.register=this.register.bind(this),this.unregister=this.unregister.bind(this)}get names(){return Object.keys(this.data)}register(e,t,n=!1){if(typeof e==`object`){Object.entries(e).forEach(([e,n])=>{this.register(e,n,t)});return}this.exist(e)&&!n&&!Ia.isApplyingHMR()&&this.onDuplicated(e);let r=this.options.process,i=r?O(r,this,e,t):t;return this.data[e]=i,i}unregister(e){let t=e?this.data[e]:null;return delete this.data[e],t}get(e){return e?this.data[e]:null}exist(e){return e?this.data[e]!=null:!1}onDuplicated(e){try{throw this.options.onConflict&&O(this.options.onConflict,this,e),Error(`${Rt(this.options.type)} with name '${e}' already registered.`)}catch(e){throw e}}onNotFound(e,t){throw Error(this.getSpellingSuggestion(e,t))}getSpellingSuggestion(e,t){let n=this.getSpellingSuggestionForName(e),r=t?`${t} ${ti(this.options.type)}`:this.options.type;return`${Rt(r)} with name '${e}' does not exist.${n?` Did you mean '${n}'?`:``}`}getSpellingSuggestionForName(e){return ha(e,Object.keys(this.data),e=>e)}};(function(e){function t(t){return new e(t)}e.create=t})(U||={});const Nc={color:`#aaaaaa`,thickness:1,markup:`rect`,update(e,t){let n=t.thickness*t.sx,r=t.thickness*t.sy;j(e,{width:n,height:r,rx:n,ry:r,fill:t.color})}},Pc={color:`#aaaaaa`,thickness:1,markup:`rect`,update(e,t){let n=t.sx<=1?t.thickness*t.sx:t.thickness;j(e,{width:n,height:n,rx:n,ry:n,fill:t.color})}},Fc={color:`rgba(224,224,224,1)`,thickness:1,markup:`path`,update(e,t){let n,r=t.width,i=t.height,a=t.thickness;n=r-a>=0&&i-a>=0?[`M`,r,0,`H0 M0 0 V0`,i].join(` `):`M 0 0 0 0`,j(e,{d:n,stroke:t.color,"stroke-width":t.thickness})}},Ic=[{color:`rgba(224,224,224,1)`,thickness:1,markup:`path`,update(e,t){let n,r=t.width,i=t.height,a=t.thickness;n=r-a>=0&&i-a>=0?[`M`,r,0,`H0 M0 0 V0`,i].join(` `):`M 0 0 0 0`,j(e,{d:n,stroke:t.color,"stroke-width":t.thickness})}},{color:`rgba(224,224,224,0.2)`,thickness:3,factor:4,markup:`path`,update(e,t){let n,r=t.factor||1,i=t.width*r,a=t.height*r,o=t.thickness;n=i-o>=0&&a-o>=0?[`M`,i,0,`H0 M0 0 V0`,a].join(` `):`M 0 0 0 0`,t.width=i,t.height=a,j(e,{d:n,stroke:t.color,"stroke-width":t.thickness})}}];var Lc={};e(Lc,{dot:()=>Nc,doubleMesh:()=>Ic,fixedDot:()=>Pc,mesh:()=>Fc});var Rc=class{constructor(){this.patterns={},this.root=M.create(Qa(),{width:`100%`,height:`100%`},[Za(`defs`)]).node}add(e,t){let n=this.root.childNodes[0];n&&n.appendChild(t),this.patterns[e]=t,M.create(`rect`,{width:`100%`,height:`100%`,fill:`url(#${e})`}).appendTo(this.root)}get(e){return this.patterns[e]}has(e){return this.patterns[e]!=null}};(function(e){e.presets=Lc,e.registry=U.create({type:`grid`}),e.registry.register(e.presets,!0)})(Rc||={});const zc=function(e){let t=document.createElement(`canvas`),n=e.width,r=e.height;t.width=n*2,t.height=r;let i=t.getContext(`2d`);return i.drawImage(e,0,0,n,r),i.translate(2*n,0),i.scale(-1,1),i.drawImage(e,0,0,n,r),t},Bc=function(e){let t=document.createElement(`canvas`),n=e.width,r=e.height;t.width=n,t.height=r*2;let i=t.getContext(`2d`);return i.drawImage(e,0,0,n,r),i.translate(0,2*r),i.scale(1,-1),i.drawImage(e,0,0,n,r),t},Vc=function(e){let t=document.createElement(`canvas`),n=e.width,r=e.height;t.width=2*n,t.height=2*r;let i=t.getContext(`2d`);return i.drawImage(e,0,0,n,r),i.setTransform(-1,0,0,-1,t.width,t.height),i.drawImage(e,0,0,n,r),i.setTransform(-1,0,0,1,t.width,0),i.drawImage(e,0,0,n,r),i.setTransform(1,0,0,-1,0,t.height),i.drawImage(e,0,0,n,r),t},Hc=function(e,t){let n=e.width,r=e.height,i=document.createElement(`canvas`);i.width=n*3,i.height=r*3;let a=i.getContext(`2d`),o=t.angle==null?-20:-t.angle,s=L.toRad(o),c=i.width/4,l=i.height/4;for(let t=0;t<4;t+=1)for(let i=0;i<4;i+=1)(t+i)%2>0&&(a.setTransform(1,0,0,1,(2*t-1)*c,(2*i-1)*l),a.rotate(s),a.drawImage(e,-n/2,-r/2,n,r));return i};var Uc={};e(Uc,{flipX:()=>zc,flipXY:()=>Vc,flipY:()=>Bc,watermark:()=>Hc});var Wc;(function(e){e.presets=Object.assign({},Uc),e.presets[`flip-x`]=zc,e.presets[`flip-y`]=Bc,e.presets[`flip-xy`]=Vc,e.registry=U.create({type:`background pattern`}),e.registry.register(e.presets,!0)})(Wc||={});function Gc(e,t){return e??t}function W(e,t){return e!=null&&Number.isFinite(e)?e:t}function Kc(e={}){let t=Gc(e.color,`blue`),n=W(e.width,1),r=W(e.margin,2),i=W(e.opacity,1),a=r,o=r+n;return`
    <filter>
      <feFlood flood-color="${t}" flood-opacity="${i}" result="colored"/>
      <feMorphology in="SourceAlpha" result="morphedOuter" operator="dilate" radius="${o}" />
      <feMorphology in="SourceAlpha" result="morphedInner" operator="dilate" radius="${a}" />
      <feComposite result="morphedOuterColored" in="colored" in2="morphedOuter" operator="in"/>
      <feComposite operator="xor" in="morphedOuterColored" in2="morphedInner" result="outline"/>
      <feMerge>
        <feMergeNode in="outline"/>
        <feMergeNode in="SourceGraphic"/>
      </feMerge>
    </filter>
  `.trim()}function qc(e={}){let t=Gc(e.color,`red`),n=W(e.blur,0),r=W(e.width,1),i=W(e.opacity,1);return`
      <filter>
        <feFlood flood-color="${t}" flood-opacity="${i}" result="colored"/>
        <feMorphology result="morphed" in="SourceGraphic" operator="dilate" radius="${r}"/>
        <feComposite result="composed" in="colored" in2="morphed" operator="in"/>
        <feGaussianBlur result="blured" in="composed" stdDeviation="${n}"/>
        <feBlend in="SourceGraphic" in2="blured" mode="normal"/>
      </filter>
    `.trim()}function Jc(e={}){let t=W(e.x,2),n=e.y!=null&&Number.isFinite(e.y)?[t,e.y]:t;return`
    <filter>
      <feGaussianBlur stdDeviation="${n}"/>
    </filter>
  `.trim()}function Yc(e={}){let t=W(e.dx,0),n=W(e.dy,0),r=Gc(e.color,`black`),i=W(e.blur,4),a=W(e.opacity,1);return`SVGFEDropShadowElement`in window?`<filter>
         <feDropShadow stdDeviation="${i}" dx="${t}" dy="${n}" flood-color="${r}" flood-opacity="${a}" />
       </filter>`.trim():`<filter>
         <feGaussianBlur in="SourceAlpha" stdDeviation="${i}" />
         <feOffset dx="${t}" dy="${n}" result="offsetblur" />
         <feFlood flood-color="${r}" />
         <feComposite in2="offsetblur" operator="in" />
         <feComponentTransfer>
           <feFuncA type="linear" slope="${a}" />
         </feComponentTransfer>
         <feMerge>
           <feMergeNode/>
           <feMergeNode in="SourceGraphic"/>
         </feMerge>
       </filter>`.trim()}function Xc(e={}){let t=W(e.amount,1),n=.2126+.7874*(1-t),r=.7152-.7152*(1-t),i=.0722-.0722*(1-t),a=.2126-.2126*(1-t),o=.7152+.2848*(1-t),s=.0722-.0722*(1-t),c=.2126-.2126*(1-t),l=.0722+.9278*(1-t);return`
    <filter>
      <feColorMatrix type="matrix" values="${n} ${r} ${i} 0 0 ${a} ${o} ${s} 0 0 ${c} ${r} ${l} 0 0 0 0 0 1 0"/>
    </filter>
  `.trim()}function Zc(e={}){let t=W(e.amount,1),n=.393+.607*(1-t),r=.769-.769*(1-t),i=.189-.189*(1-t),a=.349-.349*(1-t),o=.686+.314*(1-t),s=.168-.168*(1-t),c=.272-.272*(1-t),l=.534-.534*(1-t),u=.131+.869*(1-t);return`
      <filter>
        <feColorMatrix type="matrix" values="${n} ${r} ${i} 0 0 ${a} ${o} ${s} 0 0 ${c} ${l} ${u} 0 0 0 0 0 1 0"/>
      </filter>
    `.trim()}function Qc(e={}){let t=W(e.amount,1);return`
      <filter>
        <feColorMatrix type="saturate" values="${1-t}"/>
      </filter>
    `.trim()}function $c(e={}){let t=W(e.angle,0);return`
      <filter>
        <feColorMatrix type="hueRotate" values="${t}"/>
      </filter>
    `.trim()}function el(e={}){let t=W(e.amount,1),n=1-t;return`
      <filter>
        <feComponentTransfer>
          <feFuncR type="table" tableValues="${t} ${n}"/>
          <feFuncG type="table" tableValues="${t} ${n}"/>
          <feFuncB type="table" tableValues="${t} ${n}"/>
        </feComponentTransfer>
      </filter>
    `.trim()}function tl(e={}){let t=W(e.amount,1);return`
    <filter>
      <feComponentTransfer>
        <feFuncR type="linear" slope="${t}"/>
        <feFuncG type="linear" slope="${t}"/>
        <feFuncB type="linear" slope="${t}"/>
      </feComponentTransfer>
    </filter>
  `.trim()}function nl(e={}){let t=W(e.amount,1),n=.5-t/2;return`
    <filter>
     <feComponentTransfer>
        <feFuncR type="linear" slope="${t}" intercept="${n}"/>
        <feFuncG type="linear" slope="${t}" intercept="${n}"/>
        <feFuncB type="linear" slope="${t}" intercept="${n}"/>
      </feComponentTransfer>
    </filter>
  `.trim()}var rl={};e(rl,{blur:()=>Jc,brightness:()=>tl,contrast:()=>nl,dropShadow:()=>Yc,grayScale:()=>Xc,highlight:()=>qc,hueRotate:()=>$c,invert:()=>el,outline:()=>Kc,saturate:()=>Qc,sepia:()=>Zc});var il;(function(e){e.presets=rl,e.registry=U.create({type:`filter`}),e.registry.register(e.presets,!0)})(il||={});const al={xlinkHref:`xlink:href`,xlinkShow:`xlink:show`,xlinkRole:`xlink:role`,xlinkType:`xlink:type`,xlinkArcrole:`xlink:arcrole`,xlinkTitle:`xlink:title`,xlinkActuate:`xlink:actuate`,xmlSpace:`xml:space`,xmlBase:`xml:base`,xmlLang:`xml:lang`,preserveAspectRatio:`preserveAspectRatio`,requiredExtension:`requiredExtension`,requiredFeatures:`requiredFeatures`,systemLanguage:`systemLanguage`,externalResourcesRequired:`externalResourceRequired`},ol={},sl={position:Al(`x`,`width`,`origin`)},cl={position:Al(`y`,`height`,`origin`)},ll={position:Al(`x`,`width`,`corner`)},ul={position:Al(`y`,`height`,`corner`)},dl={set:jl(`width`,`width`)},fl={set:jl(`height`,`height`)},pl={set:jl(`rx`,`width`)},ml={set:jl(`ry`,`height`)},hl={set:(e=>{let t=jl(e,`width`),n=jl(e,`height`);return function(e,r){let i=r.refBBox,a=i.height>i.width?t:n;return O(a,this,e,r)}})(`r`)},gl={set(e,{refBBox:t}){let n=parseFloat(e),r=_a(e);r&&(n/=100);let i=Math.sqrt(t.height*t.height+t.width*t.width),a;return Number.isFinite(n)&&(a=r||n>=0&&n<=1?n*i:Math.max(n+i,0)),{r:a}}},_l={set:jl(`cx`,`width`)},vl={set:jl(`cy`,`height`)},yl={set:Nl({resetOffset:!0})},bl={set:Nl({resetOffset:!1})},xl={set:Pl({resetOffset:!0})},Sl={set:Pl({resetOffset:!1})},Cl=hl,wl=yl,Tl=xl,El=sl,Dl=cl,Ol=dl,kl=fl;function Al(e,t,n){return(r,{refBBox:i})=>{if(r==null)return null;let a=parseFloat(r),o=_a(r);o&&(a/=100);let s;if(Number.isFinite(a)){let r=i[n];s=o||a>0&&a<1?r[e]+i[t]*a:r[e]+a}let c=new z;return c[e]=s||0,c}}function jl(e,t){return function(n,{refBBox:r}){let i=parseFloat(n),a=_a(n);a&&(i/=100);let o={};if(Number.isFinite(i)){let n=a||i>=0&&i<=1?i*r[t]:Math.max(i+r[t],0);o[e]=n}return o}}function Ml(e,t){let n=`x6-shape`,r=t&&t.resetOffset;return function(t,{elem:i,refBBox:a}){let o=Jo(i,n);if(!o||o.value!==t){let r=e(t);o={value:t,shape:r,shapeBBox:r.bbox()},Jo(i,n,o)}let s=o.shape.clone(),c=o.shapeBBox.clone(),l=c.getOrigin(),u=a.getOrigin();c.x=u.x,c.y=u.y;let d=a.getMaxScaleToFit(c,u),f=c.width===0||a.width===0?1:d.sx,p=c.height===0||a.height===0?1:d.sy;return s.scale(f,p,l),r&&s.translate(-l.x,-l.y),s}}function Nl(e){function t(e){return H.parse(e)}let n=Ml(t,e);return(e,t)=>{let r=n(e,t);return{d:r.serialize()}}}function Pl(e){let t=Ml(e=>new yc(e),e);return(e,n)=>{let r=t(e,n);return{points:r.serialize()}}}const Fl={qualify:_,set(e,{view:t}){return`url(#${t.graph.defineGradient(e)})`}},Il={qualify:_,set(e,{view:t}){let n=t.cell,r=Object.assign({},e);if(n.isEdge()&&r.type===`linearGradient`){let e=t,i=e.sourcePoint,a=e.targetPoint;r.id=`gradient-${r.type}-${n.id}`,r.attrs=Object.assign(Object.assign({},r.attrs),{x1:i.x,y1:i.y,x2:a.x,y2:a.y,gradientUnits:`userSpaceOnUse`}),t.graph.defs.remove(r.id)}return`url(#${t.graph.defineGradient(r)})`}},Ll={qualify(e,{attrs:t}){return t.textWrap==null||!_(t.textWrap)},set(e,{view:t,elem:n,attrs:r}){let i=`x6-text`,a=Jo(n,i),o=e=>{try{return JSON.parse(e)}catch{return e}},s={x:r.x,eol:r.eol,annotations:o(r.annotations),textPath:o(r[`text-path`]||r.textPath),textVerticalAnchor:r[`text-vertical-anchor`]||r.textVerticalAnchor,displayEmpty:(r[`display-empty`]||r.displayEmpty)===`true`,lineHeight:r[`line-height`]||r.lineHeight},c=r[`font-size`]||r.fontSize,l=JSON.stringify([e,s]);if(c&&n.setAttribute(`font-size`,c),a==null||a!==l){let r=s.textPath;if(typeof r==`object`&&r){let e=r.selector;if(typeof e==`string`){let n=t.find(e)[0];n instanceof SVGPathElement&&(Ka(n),s.textPath=Object.assign({"xlink:href":`#${n.id}`},r))}}es(n,`${e}`,s),Jo(n,i,l)}}},Rl={qualify:_,set(e,{view:t,elem:n,attrs:r,refBBox:i}){let a=e,o=a.width||0;_a(o)?i.width*=parseFloat(o)/100:o<=0?i.width+=o:i.width=o;let s=a.height||0;_a(s)?i.height*=parseFloat(s)/100:s<=0?i.height+=s:i.height=s;let c,l=a.text;l??=r.text||n?.textContent,c=l==null?``:rs(`${l}`,i,{"font-weight":r[`font-weight`]||r.fontWeight,"font-size":r[`font-size`]||r.fontSize,"font-family":r[`font-family`]||r.fontFamily,lineHeight:r.lineHeight},{ellipsis:a.ellipsis}),O(Ll.set,this,c,{view:t,elem:n,attrs:r,refBBox:i,cell:t.cell})}},zl=(e,{attrs:t})=>t.text!==void 0,Bl={qualify:zl},Vl={qualify:zl},Hl={qualify:zl},Ul={qualify:zl},Wl={qualify:zl},Gl={qualify:zl},Kl={qualify(e,{elem:t}){return t instanceof SVGElement},set(e,{elem:t}){let n=`x6-title`,r=`${e}`,i=Jo(t,n);if(i==null||i!==r){Jo(t,n,r);let e=t.firstChild;if(e&&e.tagName.toUpperCase()===`TITLE`){let t=e;t.textContent=r}else{let n=document.createElementNS(t.namespaceURI,`title`);n.textContent=r,t.insertBefore(n,e)}}}},ql={offset:Xl(`x`,`width`,`right`)},Jl={offset:Xl(`y`,`height`,`bottom`)},Yl={offset(e,{refBBox:t}){return e?{x:-t.x,y:-t.y}:{x:0,y:0}}};function Xl(e,t,n){return(r,{refBBox:i})=>{let a=new z,o;return o=r===`middle`?i[t]/2:r===n?i[t]:typeof r==`number`&&Number.isFinite(r)?r>-1&&r<1?-i[t]*r:-r:_a(r)?i[t]*parseFloat(r)/100:0,a[e]=-(i[e]+o),a}}const Zl={qualify:_,set(e,{elem:t}){Wo(t,e)}},Ql={set(e,{elem:t}){t.innerHTML=`${e}`}},$l={qualify:_,set(e,{view:t}){return`url(#${t.graph.defineFilter(e)})`}},eu={set(e){return typeof e==`object`&&e&&e.id?e.id:e}};function tu(e,t,n){let r,i;typeof t==`object`?(r=t.x,i=t.y):(r=t,i=n);let a=H.parse(e),o=a.bbox();if(o){let e=-o.height/2-o.y,t=-o.width/2-o.x;typeof r==`number`&&(t-=r),typeof i==`number`&&(e-=i),a.translate(t,e)}return a.serialize()}var nu=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(e!=null&&typeof Object.getOwnPropertySymbols==`function`)for(var i=0,r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]]);return n};const ru=e=>{var{size:t,width:n,height:r,offset:i,open:a}=e,o=nu(e,[`size`,`width`,`height`,`offset`,`open`]);return au({size:t,width:n,height:r,offset:i},a===!0,!0,void 0,o)},iu=e=>{var{size:t,width:n,height:r,offset:i,factor:a}=e,o=nu(e,[`size`,`width`,`height`,`offset`,`factor`]);return au({size:t,width:n,height:r,offset:i},!1,!1,a,o)};function au(e,t,n,r=3/4,i={}){let a=e.size||10,o=e.width||a,s=e.height||a,c=new H,l={};if(t)c.moveTo(o,0).lineTo(0,s/2).lineTo(o,s),l.fill=`none`;else{if(c.moveTo(0,s/2),c.lineTo(o,0),!n){let e=lr(r,0,1);c.lineTo(o*e,s/2)}c.lineTo(o,s),c.close()}return Object.assign(Object.assign(Object.assign({},l),i),{tagName:`path`,d:tu(c.serialize(),{x:e.offset==null?-o/2:e.offset})})}var ou=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(e!=null&&typeof Object.getOwnPropertySymbols==`function`)for(var i=0,r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]]);return n};const su=e=>{var{size:t,width:n,height:r,offset:i}=e,a=ou(e,[`size`,`width`,`height`,`offset`]);let o=t||10,s=n||o,c=r||o,l=new H;return l.moveTo(0,c/2).lineTo(s/2,0).lineTo(s,c/2).lineTo(s/2,c).close(),Object.assign(Object.assign({},a),{tagName:`path`,d:tu(l.serialize(),i??-s/2)})};var cu=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(e!=null&&typeof Object.getOwnPropertySymbols==`function`)for(var i=0,r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]]);return n};const lu=e=>{var{d:t,offsetX:n,offsetY:r}=e,i=cu(e,[`d`,`offsetX`,`offsetY`]);return Object.assign(Object.assign({},i),{tagName:`path`,d:tu(t,n,r)})};var uu=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(e!=null&&typeof Object.getOwnPropertySymbols==`function`)for(var i=0,r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]]);return n};const du=e=>{var{size:t,width:n,height:r,offset:i}=e,a=uu(e,[`size`,`width`,`height`,`offset`]);let o=t||10,s=n||o,c=r||o,l=new H;return l.moveTo(0,0).lineTo(s,c).moveTo(0,c).lineTo(s,0),Object.assign(Object.assign({},a),{tagName:`path`,fill:`none`,d:tu(l.serialize(),i||-s/2)})};var fu=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(e!=null&&typeof Object.getOwnPropertySymbols==`function`)for(var i=0,r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]]);return n};const pu=e=>{var{width:t,height:n,offset:r,open:i,flip:a}=e,o=fu(e,[`width`,`height`,`offset`,`open`,`flip`]);let s=n||6,c=t||10,l=i===!0,u=a===!0,d=Object.assign(Object.assign({},o),{tagName:`path`});u&&(s=-s);let f=new H;return f.moveTo(0,s).lineTo(c,0),l?d.fill=`none`:(f.lineTo(c,s),f.close()),d.d=tu(f.serialize(),{x:r||-c/2,y:s/2}),d};var mu=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(e!=null&&typeof Object.getOwnPropertySymbols==`function`)for(var i=0,r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]]);return n};const hu=e=>{var{r:t}=e,n=mu(e,[`r`]);let r=t||5;return Object.assign(Object.assign({cx:r},n),{tagName:`circle`,r})},gu=e=>{var{r:t}=e,n=mu(e,[`r`]);let r=t||5,i=new H;return i.moveTo(r,0).lineTo(r,r*2),i.moveTo(0,r).lineTo(r*2,r),{children:[Object.assign(Object.assign({},hu({r})),{fill:`none`}),Object.assign(Object.assign({},n),{tagName:`path`,d:tu(i.serialize(),-r)})]}};var _u=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(e!=null&&typeof Object.getOwnPropertySymbols==`function`)for(var i=0,r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]]);return n};const vu=e=>{var{rx:t,ry:n}=e,r=_u(e,[`rx`,`ry`]);let i=t||5,a=n||5;return Object.assign(Object.assign({cx:i},r),{tagName:`ellipse`,rx:i,ry:a})};var yu={};e(yu,{async:()=>pu,block:()=>ru,circle:()=>hu,circlePlus:()=>gu,classic:()=>iu,cross:()=>du,diamond:()=>su,ellipse:()=>vu,path:()=>lu});var bu;(function(e){e.presets=yu,e.registry=U.create({type:`marker`}),e.registry.register(e.presets,!0)})(bu||={}),function(e){e.normalize=tu}(bu||={});var xu=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(e!=null&&typeof Object.getOwnPropertySymbols==`function`)for(var i=0,r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]]);return n};function Su(e){return typeof e==`string`||_(e)}const Cu={qualify:Su,set(e,{view:t,attrs:n}){return Eu(`marker-start`,e,t,n)}},wu={qualify:Su,set(e,{view:t,attrs:n}){return Eu(`marker-end`,e,t,n,{transform:`rotate(180)`})}},Tu={qualify:Su,set(e,{view:t,attrs:n}){return Eu(`marker-mid`,e,t,n)}};function Eu(e,t,n,r,i={}){let a=typeof t==`string`?{name:t}:t,{name:o,args:s}=a,c=xu(a,[`name`,`args`]),l=c;if(o&&typeof o==`string`){let e=bu.registry.get(o);if(e)l=e(Object.assign(Object.assign({},c),s));else return bu.registry.onNotFound(o)}let u=Object.assign(Object.assign(Object.assign({},Du(r,e)),i),l);return{[e]:`url(#${n.graph.defineMarker(u)})`}}function Du(e,t){let n={},r=e.stroke;typeof r==`string`&&(n.stroke=r,n.fill=r);let i=e.strokeOpacity;if(i??=e[`stroke-opacity`],i??=e.opacity,i!=null&&(n[`stroke-opacity`]=i,n[`fill-opacity`]=i),t!==`marker-mid`){let r=parseFloat(e.strokeWidth||e[`stroke-width`]);if(Number.isFinite(r)&&r>1){let e=Math.ceil(r/2);n.refX=t===`marker-start`?e:-e}}return n}const Ou=(e,{view:t})=>t.cell.isEdge(),ku={qualify:Ou,set(e,t){var n,r,i,a;let o=t.view,s=e.reverse||!1,c=e.stubs||0,l;if(Number.isFinite(c)&&c!==0)if(s){let e,t,s=o.getConnectionLength()||0;c<0?(e=(s+c)/2,t=-c):(e=c,t=s-c*2);let u=o.getConnection();l=(a=(i=(r=(n=u?.divideAtLength(e))?.[1])?.divideAtLength(t))?.[0])?.serialize()}else{let e;if(c<0){let t=o.getConnectionLength()||0;e=(t+c)/2}else e=c;let t=o.getConnection();if(t){let n=t.divideAtLength(e),r=t.divideAtLength(-e);n&&r&&(l=`${n[0].serialize()} ${r[1].serialize()}`)}}return{d:l||o.getConnectionPathData()}}},Au={qualify:Ou,set:Iu(`getTangentAtLength`,{rotate:!0})},ju={qualify:Ou,set:Iu(`getTangentAtLength`,{rotate:!1})},Mu={qualify:Ou,set:Iu(`getTangentAtRatio`,{rotate:!0})},Nu={qualify:Ou,set:Iu(`getTangentAtRatio`,{rotate:!1})},Pu=Au,Fu=Mu;function Iu(e,t){let n={x:1,y:0};return(r,i)=>{let a,o,s=i.view,c=s[e](Number(r));return c?(o=t.rotate?c.vector().vectorAngle(n):0,a=c.start):(a=s.path.start,o=0),o===0?{transform:`translate(${a.x},${a.y}')`}:{transform:`translate(${a.x},${a.y}') rotate(${o})`}}}var Lu={};e(Lu,{annotations:()=>Ul,atConnectionLength:()=>Pu,atConnectionLengthIgnoreGradient:()=>ju,atConnectionLengthKeepGradient:()=>Au,atConnectionRatio:()=>Fu,atConnectionRatioIgnoreGradient:()=>Nu,atConnectionRatioKeepGradient:()=>Mu,connection:()=>ku,displayEmpty:()=>Gl,eol:()=>Wl,fill:()=>Fl,filter:()=>$l,html:()=>Ql,lineHeight:()=>Bl,port:()=>eu,ref:()=>ol,refCx:()=>_l,refCy:()=>vl,refD:()=>wl,refDKeepOffset:()=>bl,refDResetOffset:()=>yl,refDx:()=>ll,refDy:()=>ul,refHeight:()=>fl,refHeight2:()=>kl,refPoints:()=>Tl,refPointsKeepOffset:()=>Sl,refPointsResetOffset:()=>xl,refR:()=>Cl,refRCircumscribed:()=>gl,refRInscribed:()=>hl,refRx:()=>pl,refRy:()=>ml,refWidth:()=>dl,refWidth2:()=>Ol,refX:()=>sl,refX2:()=>El,refY:()=>cl,refY2:()=>Dl,resetOffset:()=>Yl,sourceMarker:()=>Cu,stroke:()=>Il,style:()=>Zl,targetMarker:()=>wu,text:()=>Ll,textPath:()=>Hl,textVerticalAnchor:()=>Vl,textWrap:()=>Rl,title:()=>Kl,vertexMarker:()=>Tu,xAlign:()=>ql,yAlign:()=>Jl});var Ru;(function(e){function t(e,t,n){return!!(e!=null&&(typeof e==`string`||typeof e.qualify!=`function`||O(e.qualify,this,t,n)))}e.isValidDefinition=t})(Ru||={}),function(e){e.presets=Object.assign(Object.assign({},al),Lu),e.registry=U.create({type:`attribute definition`}),e.registry.register(e.presets,!0)}(Ru||={});const G={prefixCls:`x6`,autoInsertCSS:!0,useCSSSelector:!0,prefix(e){return`${G.prefixCls}-${e}`}},zu=G.prefix(`highlighted`),Bu={highlight(e,t,n){let r=n&&n.className||zu;k(t,r)},unhighlight(e,t,n){let r=n&&n.className||zu;Ha(t,r)}},Vu=G.prefix(`highlight-opacity`),Hu={highlight(e,t){k(t,Vu)},unhighlight(e,t){Ha(t,Vu)}};var K;(function(e){e.normalizeMarker=tu;function t(e,t){let n=Ss(e.x,e.y).matrixTransform(t);return new z(n.x,n.y)}e.transformPoint=t;function n(e,n){return new V(t(e.start,n),t(e.end,n))}e.transformLine=n;function r(e,n){let r=e instanceof yc?e.points:e;return Array.isArray(r)||(r=[]),new yc(r.map(e=>t(e,n)))}e.transformPolyline=r;function i(e,t){let n=Za(`svg`),r=n.createSVGPoint();r.x=e.x,r.y=e.y;let i=r.matrixTransform(t);r.x=e.x+e.width,r.y=e.y;let a=r.matrixTransform(t);r.x=e.x+e.width,r.y=e.y+e.height;let o=r.matrixTransform(t);r.x=e.x,r.y=e.y+e.height;let s=r.matrixTransform(t),c=Math.min(i.x,a.x,o.x,s.x),l=Math.max(i.x,a.x,o.x,s.x),u=Math.min(i.y,a.y,o.y,s.y),d=Math.max(i.y,a.y,o.y,s.y);return new B(c,u,l-c,d-u)}e.transformRectangle=i;function a(e,t,n){let r,a=e.ownerSVGElement;if(!a)return new B(0,0,0,0);try{r=e.getBBox()}catch{r={x:e.clientLeft,y:e.clientTop,width:e.clientWidth,height:e.clientHeight}}if(t)return B.create(r);let o=Is(e,n||a);return i(r,o)}e.bbox=a;function o(e,t={}){let n,r=e.ownerSVGElement;if(!r||!qa(e)){if(mo(e)){let{left:t,top:n,width:r,height:i}=s(e);return new B(t,n,r,i)}return new B(0,0,0,0)}let a=t.target,c=t.recursive;if(!c){try{n=e.getBBox()}catch{n={x:e.clientLeft,y:e.clientTop,width:e.clientWidth,height:e.clientHeight}}if(!a)return B.create(n);let t=Is(e,a);return i(n,t)}{let t=e.childNodes,r=t.length;if(r===0)return o(e,{target:a});a||=e;for(let e=0;e<r;e+=1){let r=t[e],i;i=r.childNodes.length===0?o(r,{target:a}):o(r,{target:a,recursive:!0}),n=n?n.union(i):i}return n}}e.getBBox=o;function s(e){let t=0,n=0,r=0,i=0;if(e){let a=e;for(;a;)t+=a.offsetLeft,n+=a.offsetTop,a=a.offsetParent,a&&(t+=parseInt(Lo(a,`borderLeft`),10),n+=parseInt(Lo(a,`borderTop`),10));r=e.offsetWidth,i=e.offsetHeight}return{left:t,top:n,width:r,height:i}}e.getBoundingOffsetRect=s;function c(e){let t=t=>{let n=e.getAttribute(t),r=n?parseFloat(n):0;return Number.isNaN(r)?0:r};switch(e instanceof SVGElement&&e.nodeName.toLowerCase()){case`rect`:return new B(t(`x`),t(`y`),t(`width`),t(`height`));case`circle`:return new dc(t(`cx`),t(`cy`),t(`r`),t(`r`));case`ellipse`:return new dc(t(`cx`),t(`cy`),t(`rx`),t(`ry`));case`polyline`:{let t=fs(e);return new yc(t)}case`polygon`:{let t=fs(e);return t.length>1&&t.push(t[0]),new yc(t)}case`path`:{let t=e.getAttribute(`d`);return H.isValid(t)||(t=H.normalize(t)),H.parse(t)}case`line`:return new V(t(`x1`),t(`y1`),t(`x2`),t(`y2`));default:break}return o(e)}e.toGeometryShape=c;function l(e,t,n,r){let i=z.create(t),a=z.create(n);if(!r){let t=e instanceof SVGSVGElement?e:e.ownerSVGElement;r=t}let s=Fs(e);e.setAttribute(`transform`,``);let c=o(e,{target:r}).scale(s.sx,s.sy),l=Cs();l.setTranslate(-c.x-c.width/2,-c.y-c.height/2);let u=Cs(),d=i.angleBetween(a,i.clone().translate(1,0));d&&u.setRotate(d,0,0);let f=Cs(),p=i.clone().move(a,c.width/2);f.setTranslate(2*i.x-p.x,2*i.y-p.y);let m=Is(e,r),h=Cs();h.setMatrix(f.matrix.multiply(u.matrix.multiply(l.matrix.multiply(m.scale(s.sx,s.sy))))),e.setAttribute(`transform`,Ts(h.matrix))}e.translateAndAutoOrient=l;function u(e){if(e==null)return null;let t=e;do{let e=t.tagName;if(typeof e!=`string`)return null;if(e=e.toUpperCase(),Va(t,`x6-port`))t=t.nextElementSibling;else if(e===`G`)t=t.firstElementChild;else if(e===`TITLE`)t=t.nextElementSibling;else break}while(t);return t}e.findShapeNode=u;function d(e){let t=u(e);if(!qa(t)){if(mo(e)){let{left:t,top:n,width:r,height:i}=s(e);return new B(t,n,r,i)}return new B(0,0,0,0)}let n=c(t),r=n.bbox()||B.create();return r}e.getBBoxV2=d})(K||={});const Uu={padding:3,rx:0,ry:0,attrs:{"stroke-width":3,stroke:`#FEB663`}},Wu={highlight(e,t,n){let r=Gu.getHighlighterId(t,n);if(Gu.hasCache(r))return;n=Tr({},n,Uu);let i=M.create(t),a,o;try{a=i.toPathData()}catch{o=K.bbox(i.node,!0),a=gs(Object.assign(Object.assign({},n),o))}let s=Za(`path`);if(j(s,Object.assign({d:a,"pointer-events":`none`,"vector-effect":`non-scaling-stroke`,fill:`none`},n.attrs?xo(n.attrs):null)),e.isEdgeElement(t))j(s,`d`,e.getConnectionPathData());else{let t=i.getTransformToElement(e.container),r=n.padding;if(r){o??=K.bbox(i.node,!0);let e=o.x+o.width/2,n=o.y+o.height/2;o=K.transformRectangle(o,t);let a=Math.max(o.width,1),s=Math.max(o.height,1),c=(a+r)/a,l=(s+r)/s,u=P({a:c,b:0,c:0,d:l,e:e-c*e,f:n-l*n});t=t.multiply(u)}Ms(s,t)}k(s,G.prefix(`highlight-stroke`));let c=e.cell,l=()=>Gu.removeHighlighter(r);c.on(`removed`,l),c.model&&c.model.on(`reseted`,l),e.container.appendChild(s),Gu.setCache(r,s)},unhighlight(e,t,n){Gu.removeHighlighter(Gu.getHighlighterId(t,n))}};var Gu;(function(e){function t(e,t){return Ka(e),e.id+JSON.stringify(t)}e.getHighlighterId=t;let n={};function r(e,t){n[e]=t}e.setCache=r;function i(e){return n[e]!=null}e.hasCache=i;function a(e){let t=n[e];t&&(oo(t),delete n[e])}e.removeHighlighter=a})(Gu||={});var Ku={};e(Ku,{className:()=>Bu,opacity:()=>Hu,stroke:()=>Wu});var qu;(function(e){function t(e,t){if(typeof t.highlight!=`function`)throw Error(`Highlighter '${e}' is missing required \`highlight()\` method`);if(typeof t.unhighlight!=`function`)throw Error(`Highlighter '${e}' is missing required \`unhighlight()\` method`)}e.check=t})(qu||={}),function(e){e.presets=Ku,e.registry=U.create({type:`highlighter`}),e.registry.register(e.presets,!0)}(qu||={});function Ju(e,t={}){return new z(va(t.x,e.width),va(t.y,e.height))}function Yu(e,t,n){return Object.assign({angle:t,position:e.toJSON()},n)}const Xu=(e,t)=>e.map(({x:e,y:n,angle:r})=>Yu(Ju(t,{x:e,y:n}),r||0)),Zu=(e,t,n)=>{let r=n.start||0,i=n.step||20;return $u(e,t,r,(e,t)=>(e+.5-t/2)*i)},Qu=(e,t,n)=>{let r=n.start||0,i=n.step||360/e.length;return $u(e,t,r,e=>e*i)};function $u(e,t,n,r){let i=t.getCenter(),a=t.getTopCenter(),o=t.width/t.height,s=dc.fromRect(t),c=e.length;return e.map((e,t)=>{let l=n+r(t,c),u=a.clone().rotate(-l,i).scale(o,1,i),d=e.compensateRotate?-s.tangentTheta(u):0;return(e.dx||e.dy)&&u.translate(e.dx||0,e.dy||0),e.dr&&u.move(i,e.dr),Yu(u.round(),d,e)})}var ed=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(e!=null&&typeof Object.getOwnPropertySymbols==`function`)for(var i=0,r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]]);return n};const td=(e,t,n)=>{let r=Ju(t,n.start||t.getOrigin()),i=Ju(t,n.end||t.getCorner());return od(e,r,i,n)},nd=(e,t,n)=>od(e,t.getTopLeft(),t.getBottomLeft(),n),rd=(e,t,n)=>od(e,t.getTopRight(),t.getBottomRight(),n),id=(e,t,n)=>od(e,t.getTopLeft(),t.getTopRight(),n),ad=(e,t,n)=>od(e,t.getBottomLeft(),t.getBottomRight(),n);function od(e,t,n,r){let i=new V(t,n),a=e.length;return e.map((e,t)=>{var{strict:n}=e,o=ed(e,[`strict`]);let s=n||r.strict?(t+1)/(a+1):(t+.5)/a,c=i.pointAt(s);return(o.dx||o.dy)&&c.translate(o.dx||0,o.dy||0),Yu(c.round(),0,o)})}var sd={};e(sd,{absolute:()=>Xu,bottom:()=>ad,ellipse:()=>Zu,ellipseSpread:()=>Qu,left:()=>nd,line:()=>td,right:()=>rd,top:()=>id});var cd;(function(e){e.presets=sd,e.registry=U.create({type:`port layout`}),e.registry.register(e.presets,!0)})(cd||={});const ld={position:{x:0,y:0},angle:0,attrs:{".":{y:`0`,"text-anchor":`start`}}};function ud(e,t){let{x:n,y:r,angle:i,attrs:a}=t||{};return Tr({},{angle:i,attrs:a,position:{x:n,y:r}},e,ld)}const dd=(e,t,n)=>ud({position:t.getTopLeft()},n),fd=(e,t,n)=>ud({position:{x:-15,y:0},attrs:{".":{y:`.3em`,"text-anchor":`end`}}},n),pd=(e,t,n)=>ud({position:{x:15,y:0},attrs:{".":{y:`.3em`,"text-anchor":`start`}}},n),md=(e,t,n)=>ud({position:{x:0,y:-15},attrs:{".":{"text-anchor":`middle`}}},n),hd=(e,t,n)=>ud({position:{x:0,y:15},attrs:{".":{y:`.6em`,"text-anchor":`middle`}}},n),gd=(e,t,n)=>bd(e,t,!1,n),_d=(e,t,n)=>bd(e,t,!0,n),vd=(e,t,n)=>xd(e,t,!1,n),yd=(e,t,n)=>xd(e,t,!0,n);function bd(e,t,n,r){let i=r.offset==null?15:r.offset,a=t.getCenter().theta(e),o=Sd(t),s,c,l,u,d=0;return a<o[1]||a>o[2]?(s=`.3em`,c=i,l=0,u=`start`):a<o[0]?(s=`0`,c=0,l=-i,n?(d=-90,u=`start`):u=`middle`):a<o[3]?(s=`.3em`,c=-i,l=0,u=`end`):(s=`.6em`,c=0,l=i,n?(d=90,u=`start`):u=`middle`),ud({position:{x:Math.round(c),y:Math.round(l)},angle:d,attrs:{".":{y:s,"text-anchor":u}}},r)}function xd(e,t,n,r){let i=r.offset==null?15:r.offset,a=t.getCenter().theta(e),o=Sd(t),s,c,l,u,d=0;return a<o[1]||a>o[2]?(s=`.3em`,c=-i,l=0,u=`end`):a<o[0]?(s=`.6em`,c=0,l=i,n?(d=90,u=`start`):u=`middle`):a<o[3]?(s=`.3em`,c=i,l=0,u=`start`):(s=`0em`,c=0,l=-i,n?(d=-90,u=`start`):u=`middle`),ud({position:{x:Math.round(c),y:Math.round(l)},angle:d,attrs:{".":{y:s,"text-anchor":u}}},r)}function Sd(e){let t=e.getCenter(),n=t.theta(e.getTopLeft()),r=t.theta(e.getBottomLeft()),i=t.theta(e.getBottomRight()),a=t.theta(e.getTopRight());return[n,a,i,r]}const Cd=(e,t,n)=>Td(e.diff(t.getCenter()),!1,n),wd=(e,t,n)=>Td(e.diff(t.getCenter()),!0,n);function Td(e,t,n){let r=n.offset==null?20:n.offset,i=new z(0,0),a=-e.theta(i),o=e.clone().move(i,r).diff(e).round(),s=`.3em`,c,l=a;return(a+90)%180==0?(c=t?`end`:`middle`,!t&&a===-270&&(s=`0em`)):a>-270&&a<-90?(c=`start`,l=a-180):c=`end`,ud({position:o.round().toJSON(),angle:t?l:0,attrs:{".":{y:s,"text-anchor":c}}},n)}var Ed={};e(Ed,{bottom:()=>hd,inside:()=>vd,insideOriented:()=>yd,left:()=>fd,manual:()=>dd,outside:()=>gd,outsideOriented:()=>_d,radial:()=>Cd,radialOriented:()=>wd,right:()=>pd,top:()=>md});var Dd;(function(e){e.presets=Ed,e.registry=U.create({type:`port label layout`}),e.registry.register(e.presets,!0)})(Dd||={});var Od=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},q=class e extends ia{get priority(){return 2}get disposeContainer(){return!0}constructor(){super(),this.cid=kd.uniqueId(),e.views[this.cid]=this}confirmUpdate(e,t){return 0}empty(e=this.container){return so(e),this}unmount(e=this.container){return oo(e),this}remove(t=this.container){return t===this.container?(this.removeEventListeners(document),this.onRemove(),delete e.views[this.cid],this.disposeContainer&&this.unmount(t)):this.unmount(t),this}onRemove(){}setClass(e,t=this.container){t.classList.value=Array.isArray(e)?e.join(` `):e}addClass(e,t=this.container){return k(t,Array.isArray(e)?e.join(` `):e),this}removeClass(e,t=this.container){return Ha(t,Array.isArray(e)?e.join(` `):e),this}setStyle(e,t=this.container){return Wo(t,e),this}setAttrs(e,t=this.container){return e!=null&&t!=null&&j(t,e),this}findAttr(e,t=this.container){let n=t;for(;n&&n.nodeType===1;){let t=n.getAttribute(e);if(t!=null)return t;if(n===this.container)return null;n=n.parentNode}return null}find(t,n=this.container,r=this.selectors){return e.find(t,n,r).elems}findOne(e,t=this.container,n=this.selectors){let r=this.find(e,t,n);return r.length>0?r[0]:null}findByAttr(e,t=this.container){let n=t;for(;n&&n.getAttribute;){let t=n.getAttribute(e);if((t!=null||n===this.container)&&t!==`false`)return n;n=n.parentNode}return null}getSelector(e,t){let n;if(e===this.container)return typeof t==`string`&&(n=`> ${t}`),n;if(e){let r=to(e)+1;n=`${e.tagName.toLowerCase()}:nth-child(${r})`,t&&(n+=` > ${t}`),n=this.getSelector(e.parentNode,n)}return n}prefixClassName(e){return G.prefix(e)}delegateEvents(e,t){if(e==null)return this;t||this.undelegateEvents();let n=/^(\S+)\s*(.*)$/;return Object.keys(e).forEach(t=>{let r=t.match(n);if(r==null)return;let i=this.getEventHandler(e[t]);typeof i==`function`&&this.delegateEvent(r[1],r[2],i)}),this}undelegateEvents(){return I.off(this.container,this.getEventNamespace()),this}delegateDocumentEvents(e,t){return this.addEventListeners(document,e,t),this}undelegateDocumentEvents(){return this.removeEventListeners(document),this}delegateEvent(e,t,n){return I.on(this.container,e+this.getEventNamespace(),t,n),this}undelegateEvent(e,t,n){let r=e+this.getEventNamespace();return t==null?I.off(this.container,r):typeof t==`string`?I.off(this.container,r,t,n):I.off(this.container,r,t),this}addEventListeners(e,t,n){if(t==null)return this;let r=this.getEventNamespace();return Object.keys(t).forEach(i=>{let a=this.getEventHandler(t[i]);typeof a==`function`&&I.on(e,i+r,n,a)}),this}removeEventListeners(e){return e!=null&&I.off(e,this.getEventNamespace()),this}getEventNamespace(){return`.${G.prefixCls}-event-${this.cid}`}getEventHandler(e){let t;if(typeof e==`string`){let n=this[e];typeof n==`function`&&(t=(...e)=>n.call(this,...e))}else t=(...t)=>e.call(this,...t);return t}getEventTarget(e,t={}){let{target:n,type:r,clientX:i=0,clientY:a=0}=e;return t.fromPoint||r===`touchmove`||r===`touchend`?document.elementFromPoint(i,a):n}stopPropagation(e){return this.setEventData(e,{propagationStopped:!0}),this}isPropagationStopped(e){return this.getEventData(e).propagationStopped===!0}getEventData(e){return this.eventData(e)}setEventData(e,t){return this.eventData(e,t)}eventData(e,t){if(e==null)throw TypeError(`Event object required`);let n=e.data,r=`__${this.cid}__`;return t==null?n==null?{}:n[r]||{}:(n??=e.data={},n[r]==null?n[r]=Object.assign({},t):n[r]=Object.assign(Object.assign({},n[r]),t),n[r])}normalizeEvent(t){return e.normalizeEvent(t)}dispose(){this.remove()}};Od([q.dispose()],q.prototype,`dispose`,null),function(e){function t(e,t){return t?Za(e||`g`):Xa(e||`div`)}e.createElement=t;function n(e,t,n){if(!e||e===`.`)return{elems:[t]};if(n){let t=n[e];if(t)return{elems:Array.isArray(t)?t:[t]}}if(G.useCSSSelector){let n=e.includes(`>`)?`:scope ${e}`:e;return{isCSSSelector:!0,elems:Array.prototype.slice.call(t.querySelectorAll(n))}}return{elems:[]}}e.find=n;function r(e){let t=e,n=e.originalEvent,r=n&&n.changedTouches&&n.changedTouches[0];if(r){for(let t in e)r[t]===void 0&&(r[t]=e[t]);t=r}return t}e.normalizeEvent=r}(q||={}),function(e){e.views={};function t(t){return e.views[t]||null}e.getView=t}(q||={});var kd;(function(e){let t=0;function n(){let e=`v${t}`;return t+=1,e}e.uniqueId=n})(kd||={});var Ad=class{constructor(e){this.view=e,this.clean()}clean(){this.elemCache&&this.elemCache.dispose(),this.elemCache=new rc,this.pathCache={}}get(e){let t=this.elemCache;return t.has(e)||this.elemCache.set(e,{}),this.elemCache.get(e)}getData(e){let t=this.get(e);return t.data||={},t.data}getMatrix(e){let t=this.get(e);if(t.matrix==null){let n=this.view.container;t.matrix=Ls(e,n)}return P(t.matrix)}getShape(e){let t=this.get(e);return t.shape??=K.toGeometryShape(e),t.shape.clone()}getBoundingRect(e){let t=this.get(e);return t.boundingRect??=K.getBBoxV2(e),t.boundingRect.clone()}},J;(function(e){function t(e){return e!=null&&!n(e)}e.isJSONMarkup=t;function n(e){return e!=null&&typeof e==`string`}e.isStringMarkup=n;function r(e){return e==null||n(e)?e:y(e)}e.clone=r;function i(e){return`${e}`.trim().replace(/[\r|\n]/g,` `).replace(/>\s+</g,`><`)}e.sanitize=i;function a(e,t={ns:A.svg}){let n=document.createDocumentFragment(),r={},i={},a=[{markup:Array.isArray(e)?e:[e],parent:n,ns:t.ns}];for(;a.length>0;){let e=a.pop(),t=e.ns||A.svg,n=e.markup,o=e.parent;n.forEach(e=>{let n=e.tagName;if(!n)throw TypeError(`Invalid tagName`);e.ns&&(t=e.ns);let s=t?Xa(n,t):Ya(n),c=e.attrs;c&&j(s,xo(c));let l=e.style;l&&Wo(s,l);let u=e.className;u!=null&&s.setAttribute(`class`,Array.isArray(u)?u.join(` `):u),e.textContent&&(s.textContent=e.textContent);let d=e.selector;if(d!=null){if(i[d])throw TypeError(`Selector must be unique`);i[d]=s}if(e.groupSelector){let t=e.groupSelector;Array.isArray(t)||(t=[t]),t.forEach(e=>{r[e]||(r[e]=[]),r[e].push(s)})}o.appendChild(s);let f=e.children;Array.isArray(f)&&a.push({ns:t,markup:f,parent:s})})}return Object.keys(r).forEach(e=>{if(i[e])throw Error(`Ambiguous group selector`);i[e]=r[e]}),{fragment:n,selectors:i,groups:r}}e.parseJSONMarkup=a;function o(e){return e instanceof SVGElement?Za(`g`):Ya(`div`)}function s(e){if(n(e)){let t=M.createVectors(e),n=t.length;if(n===1)return{elem:t[0].node};if(n>1){let e=o(t[0].node);return t.forEach(t=>{e.appendChild(t.node)}),{elem:e}}return{}}let t=a(e),r=t.fragment,i=null;return r.childNodes.length>1?(i=o(r.firstChild),i.appendChild(r)):i=r.firstChild,{elem:i,selectors:t.selectors}}e.renderMarkup=s;function c(e){let t=M.createVectors(e),n=document.createDocumentFragment();for(let e=0,r=t.length;e<r;e+=1){let r=t[e].node;n.appendChild(r)}return{fragment:n,selectors:{}}}e.parseLabelStringMarkup=c})(J||={}),function(e){function t(e,n,r){if(e!=null){let i,a=e.tagName.toLowerCase();if(e===n)return i=typeof r==`string`?`> ${a} > ${r}`:`> ${a}`,i;let o=e.parentNode;if(o&&o.childNodes.length>1){let t=to(e)+1;i=`${a}:nth-child(${t})`}else i=a;return r&&(i+=` > ${r}`),t(e.parentNode,n,i)}return r}e.getSelector=t}(J||={}),function(e){function t(){return`g`}e.getPortContainerMarkup=t;function n(){return{tagName:`circle`,selector:`circle`,attrs:{r:10,fill:`#FFFFFF`,stroke:`#000000`}}}e.getPortMarkup=n;function r(){return{tagName:`text`,selector:`text`,attrs:{fill:`#000000`}}}e.getPortLabelMarkup=r}(J||={}),function(e){function t(){return[{tagName:`path`,selector:`wrap`,groupSelector:`lines`,attrs:{fill:`none`,cursor:`pointer`,stroke:`transparent`,strokeLinecap:`round`}},{tagName:`path`,selector:`line`,groupSelector:`lines`,attrs:{fill:`none`,pointerEvents:`none`}}]}e.getEdgeMarkup=t}(J||={}),function(e){function t(e=!1){return{tagName:`foreignObject`,selector:`fo`,children:[{ns:A.xhtml,tagName:`body`,selector:`foBody`,attrs:{xmlns:A.xhtml},style:{width:`100%`,height:`100%`,background:`transparent`},children:e?[]:[{tagName:`div`,selector:`foContent`,style:{width:`100%`,height:`100%`}}]}]}}e.getForeignObjectMarkup=t}(J||={});var jd=class{constructor(e){this.view=e}get cell(){return this.view.cell}getDefinition(e){return this.cell.getAttrDefinition(e)}processAttrs(e,t){let n,r,i,a,o=[];return Object.keys(t).forEach(r=>{let i=t[r],a=this.getDefinition(r),s=O(Ru.isValidDefinition,this.view,a,i,{elem:e,attrs:t,cell:this.cell,view:this.view});if(a&&s)typeof a==`string`?(n??={},n[a]=i):i!==null&&o.push({name:r,definition:a});else{n??={};let e=ho.includes(r)?r:oa(r);n[e]=i}}),o.forEach(({name:e,definition:n})=>{let o=t[e],s=n;typeof s.set==`function`&&(r??={},r[e]=o);let c=n;typeof c.offset==`function`&&(i??={},i[e]=o);let l=n;typeof l.position==`function`&&(a??={},a[e]=o)}),{raw:t,normal:n,set:r,offset:i,position:a}}mergeProcessedAttrs(e,t){e.set=Object.assign(Object.assign({},e.set),t.set),e.position=Object.assign(Object.assign({},e.position),t.position),e.offset=Object.assign(Object.assign({},e.offset),t.offset);let n=e.normal&&e.normal.transform;n!=null&&t.normal&&(t.normal.transform=n),e.normal=t.normal}findAttrs(e,t,n,r){let i=[],a=new rc;return Object.keys(e).forEach(o=>{let s=e[o];if(!_(s))return;let{isCSSSelector:c,elems:l}=q.find(o,t,r);n[o]=l;for(let e=0,t=l.length;e<t;e+=1){let n=l[e],u=r&&r[o]===n,d=a.get(n);if(d){d.array||(i.push(n),d.array=!0,d.attrs=[d.attrs],d.priority=[d.priority]);let e=d.attrs,r=d.priority;if(u)e.unshift(s),r.unshift(-1);else{let n=Di(r,c?-1:t);e.splice(n,0,s),r.splice(n,0,t)}}else a.set(n,{elem:n,attrs:s,priority:u?-1:t,array:!1})}}),i.forEach(e=>{let t=a.get(e),n=t.attrs;t.attrs=n.reduceRight((e,t)=>v(e,t),{})}),a}updateRelativeAttrs(e,t,n){let r=t.raw||{},i=t.normal||{},a=t.set,o=t.position,s=t.offset,c=()=>({elem:e,cell:this.cell,view:this.view,attrs:r,refBBox:n.clone()});if(a!=null&&Object.keys(a).forEach(e=>{let t=a[e],n=this.getDefinition(e);if(n!=null){let r=O(n.set,this.view,t,c());typeof r==`object`?i=Object.assign(Object.assign({},i),r):r!=null&&(i[e]=r)}}),e instanceof HTMLElement){this.view.setAttrs(i,e);return}let l=i.transform,u=l?`${l}`:null,d=ws(u),f=new z(d.e,d.f);l&&(delete i.transform,d.e=0,d.f=0);let p=!1;o!=null&&Object.keys(o).forEach(e=>{let t=o[e],n=this.getDefinition(e);if(n!=null){let e=O(n.position,this.view,t,c());e!=null&&(p=!0,f.translate(z.create(e)))}}),this.view.setAttrs(i,e);let m=!1;if(s!=null){let t=this.view.getBoundingRectOfElement(e);if(t.width>0&&t.height>0){let n=K.transformRectangle(t,d);Object.keys(s).forEach(t=>{let i=s[t],a=this.getDefinition(t);if(a!=null){let t=O(a.offset,this.view,i,{elem:e,cell:this.cell,view:this.view,attrs:r,refBBox:n});t!=null&&(m=!0,f.translate(z.create(t)))}})}}(l!=null||p||m)&&(f.round(1),d.e=f.x,d.f=f.y,e.setAttribute(`transform`,Ts(d)))}update(e,t,n){let r={},i=this.findAttrs(n.attrs||t,e,r,n.selectors),a=n.attrs?this.findAttrs(t,e,r,n.selectors):i,o=[];i.each(t=>{let i=t.elem,s=t.attrs,c=this.processAttrs(i,s);if(c.set==null&&c.position==null&&c.offset==null)this.view.setAttrs(c.normal,i);else{let t=a.get(i),l=t?t.attrs:null,u=l&&s.ref==null?l.ref:s.ref,d;if(u){if(d=(r[u]||this.view.find(u,e,n.selectors))[0],!d)throw Error(`"${u}" reference does not exist.`)}else d=null;let f={node:i,refNode:d,attributes:l,processedAttributes:c},p=o.findIndex(e=>e.refNode===i);p>-1?o.splice(p,0,f):o.push(f)}});let s=new rc,c;o.forEach(t=>{let r=t.node,i=t.refNode,a,o=i!=null&&n.rotatableNode!=null&&ao(n.rotatableNode,i);if(i&&(a=s.get(i)),!a){let t=o?n.rotatableNode:e;a=i?K.getBBox(i,{target:t}):n.rootBBox,i&&s.set(i,a)}let l;n.attrs&&t.attributes?(l=this.processAttrs(r,t.attributes),this.mergeProcessedAttrs(l,t.processedAttributes)):l=t.processedAttributes;let u=a;o&&n.rotatableNode!=null&&!n.rotatableNode.contains(r)&&(c||=ws(j(n.rotatableNode,`transform`)),u=K.transformRectangle(a,c)),this.updateRelativeAttrs(r,l,u)})}},Md=class{get cell(){return this.view.cell}constructor(e,t,n=[]){this.view=e;let r={},i={},a=0;Object.keys(t).forEach(e=>{let n=t[e];Array.isArray(n)||(n=[n]),n.forEach(t=>{let n=r[t];n||(a+=1,n=r[t]=1<<a),i[e]|=n})});let o=n;if(Array.isArray(o)||(o=[o]),o.forEach(e=>{r[e]||(a+=1,r[e]=1<<a)}),a>25)throw Error(`Maximum number of flags exceeded.`);this.flags=r,this.attrs=i,this.bootstrap=n}getFlag(e){let t=this.flags;return t==null?0:Array.isArray(e)?e.reduce((e,n)=>e|t[n],0):t[e]|0}hasAction(e,t){return e&this.getFlag(t)}removeAction(e,t){return e^e&this.getFlag(t)}getBootstrapFlag(){return this.getFlag(this.bootstrap)}getChangedFlag(){let e=0;return this.attrs&&Object.keys(this.attrs).forEach(t=>{this.cell.hasChanged(t)&&(e|=this.attrs[t])}),e}},Nd=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},Pd=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(e!=null&&typeof Object.getOwnPropertySymbols==`function`)for(var i=0,r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]]);return n},Fd=class e extends q{static getDefaults(){return this.defaults}static config(e){this.defaults=this.getOptions(e)}static getOptions(e){let t=(e,t)=>t==null?Array.isArray(e)?[...e]:[e]:Ii([...Array.isArray(e)?e:[e],...Array.isArray(t)?t:[t]]),n=y(this.getDefaults()),{bootstrap:r,actions:i,events:a,documentEvents:o}=e,s=Pd(e,[`bootstrap`,`actions`,`events`,`documentEvents`]);return r&&(n.bootstrap=t(n.bootstrap,r)),i&&Object.entries(i).forEach(([e,r])=>{let i=n.actions[e];r&&i?n.actions[e]=t(i,r):r&&(n.actions[e]=t(r))}),a&&(n.events=Object.assign(Object.assign({},n.events),a)),e.documentEvents&&(n.documentEvents=Object.assign(Object.assign({},n.documentEvents),o)),v(n,s)}get[Symbol.toStringTag](){return e.toStringTag}constructor(e,t={}){super(),this.cell=e,this.options=this.ensureOptions(t),this.graph=this.options.graph,this.attr=new jd(this),this.flag=new Md(this,this.options.actions,this.options.bootstrap),this.cache=new Ad(this),this.setContainer(this.ensureContainer()),this.setup(),this.init()}init(){}onRemove(){this.removeTools()}get priority(){return this.options.priority}get rootSelector(){return this.options.rootSelector}getConstructor(){return this.constructor}ensureOptions(e){return this.getConstructor().getOptions(e)}getContainerTagName(){return this.options.isSvgElement?`g`:`div`}getContainerStyle(){}getContainerAttrs(){return{"data-cell-id":this.cell.id,"data-shape":this.cell.shape}}getContainerClassName(){return this.prefixClassName(`cell`)}ensureContainer(){return q.createElement(this.getContainerTagName(),this.options.isSvgElement)}setContainer(e){if(this.container!==e){this.undelegateEvents(),this.container=e,this.options.events!=null&&this.delegateEvents(this.options.events);let t=this.getContainerAttrs();t!=null&&this.setAttrs(t,e);let n=this.getContainerStyle();n!=null&&this.setStyle(n,e);let r=this.getContainerClassName();r!=null&&this.addClass(r,e)}return this}isNodeView(){return!1}isEdgeView(){return!1}render(){return this}confirmUpdate(e,t={}){return 0}getBootstrapFlag(){return this.flag.getBootstrapFlag()}getFlag(e){return this.flag.getFlag(e)}hasAction(e,t){return this.flag.hasAction(e,t)}removeAction(e,t){return this.flag.removeAction(e,t)}handleAction(e,t,n,r){if(this.hasAction(e,t)){n();let i=[t];return r&&(typeof r==`string`?i.push(r):i.push(...r)),this.removeAction(e,i)}return e}setup(){this.cell.on(`changed`,this.onCellChanged,this)}onCellChanged({options:e}){this.onAttrsChange(e)}onAttrsChange(e){let t=this.flag.getChangedFlag();e.updated||!t||(e.dirty&&this.hasAction(t,`update`)&&(t|=this.getFlag(`render`)),e.toolId&&(e.async=!1),this.graph!=null&&this.graph.renderer.requestViewUpdate(this,t,e))}parseJSONMarkup(e,t){let n=J.parseJSONMarkup(e),r=n.selectors,i=this.rootSelector;if(t&&i){if(r[i])throw Error(`Invalid root selector`);r[i]=t}return n}can(e){let t=this.graph.options.interacting;if(typeof t==`function`&&(t=O(t,this.graph,this)),typeof t==`object`){let n=t[e];return typeof n==`function`&&(n=O(n,this.graph,this)),n!==!1}return typeof t==`boolean`?t:!1}cleanCache(){return this.cache.clean(),this}getCache(e){return this.cache.get(e)}getDataOfElement(e){return this.cache.getData(e)}getMatrixOfElement(e){return this.cache.getMatrix(e)}getShapeOfElement(e){return this.cache.getShape(e)}getBoundingRectOfElement(e){return this.cache.getBoundingRect(e)}getBBoxOfElement(e){let t=this.getBoundingRectOfElement(e),n=this.getMatrixOfElement(e),r=this.getRootRotatedMatrix(),i=this.getRootTranslatedMatrix();return K.transformRectangle(t,i.multiply(r).multiply(n))}getUnrotatedBBoxOfElement(e){let t=this.getBoundingRectOfElement(e),n=this.getMatrixOfElement(e),r=this.getRootTranslatedMatrix();return K.transformRectangle(t,r.multiply(n))}getBBox(e={}){let t;if(e.useCellGeometry){let e=this.cell,n=e.isNode()?e.getAngle():0;t=e.getBBox().bbox(n)}else t=this.getBBoxOfElement(this.container);return this.graph.coord.localToGraphRect(t)}getRootTranslatedMatrix(){let e=this.cell,t=e.isNode()?e.getPosition():{x:0,y:0};return P().translate(t.x,t.y)}getRootRotatedMatrix(){let e=P(),t=this.cell,n=t.isNode()?t.getAngle():0;if(n){let r=t.getBBox(),i=r.width/2,a=r.height/2;e=e.translate(i,a).rotate(n).translate(-i,-a)}return e}findMagnet(e=this.container){return this.findByAttr(`magnet`,e)}updateAttrs(e,t,n={}){n.rootBBox??=new B,n.selectors??=this.selectors,this.attr.update(e,t,n)}isEdgeElement(e){return this.cell.isEdge()&&(e==null||e===this.container)}prepareHighlight(e,t={}){let n=e||this.container;return t.partial=n===this.container,n}highlight(e,t={}){let n=this.prepareHighlight(e,t);return this.notify(`cell:highlight`,{magnet:n,options:t,view:this,cell:this.cell}),this.isEdgeView()?this.notify(`edge:highlight`,{magnet:n,options:t,view:this,edge:this.cell,cell:this.cell}):this.isNodeView()&&this.notify(`node:highlight`,{magnet:n,options:t,view:this,node:this.cell,cell:this.cell}),this}unhighlight(e,t={}){let n=this.prepareHighlight(e,t);return this.notify(`cell:unhighlight`,{magnet:n,options:t,view:this,cell:this.cell}),this.isNodeView()?this.notify(`node:unhighlight`,{magnet:n,options:t,view:this,node:this.cell,cell:this.cell}):this.isEdgeView()&&this.notify(`edge:unhighlight`,{magnet:n,options:t,view:this,edge:this.cell,cell:this.cell}),this}notifyUnhighlight(e,t){}getEdgeTerminal(e,t,n,r,i){let a=this.cell,o=this.findAttr(`port`,e),s=e.getAttribute(`data-selector`),c={cell:a.id};return s!=null&&(c.magnet=s),o==null?s==null&&this.container!==e&&(c.selector=this.getSelector(e)):(c.port=o,a.isNode()&&!a.hasPort(o)&&s==null&&(c.selector=this.getSelector(e))),c}getMagnetFromEdgeTerminal(e){let t=this.cell,n=this.container,r=e.port,i=e.magnet,a;return r!=null&&t.isNode()&&t.hasPort(r)?a=this.findPortElem(r,i)||n:(i||=e.selector,!i&&r!=null&&(i=`[port="${r}"]`),a=this.findOne(i,n,this.selectors)),a}hasTools(e){let t=this.tools;return t==null?!1:e==null?!0:t.name===e}addTools(e){if(this.removeTools(),e){if(!this.can(`toolsAddable`))return this;let t=Id.isToolsView(e)?e:new Id(e);this.tools=t,t.config({view:this}),t.mount()}return this}updateTools(e={}){return this.tools&&this.tools.update(e),this}removeTools(){return this.tools&&(this.tools.remove(),this.tools=null),this}hideTools(){return this.tools&&this.tools.hide(),this}showTools(){return this.tools&&this.tools.show(),this}renderTools(){let e=this.cell.getTools();return this.addTools(e),this}notify(e,t){return this.trigger(e,t),this.graph.trigger(e,t),this}getEventArgs(e,t,n){let r=this,i=r.cell;return t==null||n==null?{e,view:r,cell:i}:{e,x:t,y:n,view:r,cell:i}}onClick(e,t,n){this.notify(`cell:click`,this.getEventArgs(e,t,n))}onDblClick(e,t,n){this.notify(`cell:dblclick`,this.getEventArgs(e,t,n))}onContextMenu(e,t,n){this.notify(`cell:contextmenu`,this.getEventArgs(e,t,n))}onMouseDown(e,t,n){this.cell.model&&(this.cachedModelForMouseEvent=this.cell.model,this.cachedModelForMouseEvent.startBatch(`mouse`)),this.notify(`cell:mousedown`,this.getEventArgs(e,t,n))}onMouseUp(e,t,n){this.notify(`cell:mouseup`,this.getEventArgs(e,t,n)),this.cachedModelForMouseEvent&&(this.cachedModelForMouseEvent.stopBatch(`mouse`,{cell:this.cell}),this.cachedModelForMouseEvent=null)}onMouseMove(e,t,n){this.notify(`cell:mousemove`,this.getEventArgs(e,t,n))}onMouseOver(e){this.notify(`cell:mouseover`,this.getEventArgs(e))}onMouseOut(e){this.notify(`cell:mouseout`,this.getEventArgs(e))}onMouseEnter(e){this.notify(`cell:mouseenter`,this.getEventArgs(e))}onMouseLeave(e){this.notify(`cell:mouseleave`,this.getEventArgs(e))}onMouseWheel(e,t,n,r){this.notify(`cell:mousewheel`,Object.assign({delta:r},this.getEventArgs(e,t,n)))}onCustomEvent(e,t,n,r){this.notify(`cell:customevent`,Object.assign({name:t},this.getEventArgs(e,n,r))),this.notify(t,Object.assign({},this.getEventArgs(e,n,r)))}onMagnetMouseDown(e,t,n,r){}onMagnetDblClick(e,t,n,r){}onMagnetContextMenu(e,t,n,r){}onLabelMouseDown(e,t,n){}checkMouseleave(e){let t=this.getEventTarget(e,{fromPoint:!0}),n=this.graph.findViewByElem(t);n!==this&&(this.onMouseLeave(e),n&&n.onMouseEnter(e))}dispose(){this.cell.off(`changed`,this.onCellChanged,this)}};Fd.defaults={isSvgElement:!0,rootSelector:`root`,priority:0,bootstrap:[],actions:{}},Nd([Fd.dispose()],Fd.prototype,`dispose`,null),function(e){e.Flag=Md,e.Attr=jd}(Fd||={}),function(e){e.toStringTag=`X6.${e.name}`;function t(t){if(t==null)return!1;if(t instanceof e)return!0;let n=t[Symbol.toStringTag],r=t;return(n==null||n===e.toStringTag)&&typeof r.isNodeView==`function`&&typeof r.isEdgeView==`function`&&typeof r.confirmUpdate==`function`}e.isCellView=t}(Fd||={}),function(e){function t(e){return function(t){t.config({priority:e})}}e.priority=t;function n(e){return function(t){t.config({bootstrap:e})}}e.bootstrap=n}(Fd||={}),function(e){e.registry=U.create({type:`view`})}(Fd||={});var Id=class e extends q{get name(){return this.options.name}get graph(){return this.cellView.graph}get cell(){return this.cellView.cell}get[Symbol.toStringTag](){return e.toStringTag}constructor(e={}){super(),this.svgContainer=this.createContainer(!0,e),this.htmlContainer=this.createContainer(!1,e),this.config(e)}createContainer(e,t){let n=e?q.createElement(`g`,!0):q.createElement(`div`,!1);return k(n,this.prefixClassName(`cell-tools`)),t.className&&k(n,t.className),n}config(t){if(this.options=Object.assign(Object.assign({},this.options),t),!Fd.isCellView(t.view)||t.view===this.cellView)return this;this.cellView=t.view,this.cell.isEdge()?(k(this.svgContainer,this.prefixClassName(`edge-tools`)),k(this.htmlContainer,this.prefixClassName(`edge-tools`))):this.cell.isNode()&&(k(this.svgContainer,this.prefixClassName(`node-tools`)),k(this.htmlContainer,this.prefixClassName(`node-tools`))),this.svgContainer.setAttribute(`data-cell-id`,this.cell.id),this.htmlContainer.setAttribute(`data-cell-id`,this.cell.id),this.name&&(this.svgContainer.setAttribute(`data-tools-name`,this.name),this.htmlContainer.setAttribute(`data-tools-name`,this.name));let n=this.options.items;if(!Array.isArray(n))return this;this.tools=[];let r=[];n.forEach(t=>{if(e.ToolItem.isToolItem(t))t.name===`vertices`?r.unshift(t):r.push(t);else{let e=typeof t==`object`?t.name:t;e===`vertices`?r.unshift(t):r.push(t)}});for(let t=0;t<r.length;t+=1){let n=r[t],i;if(e.ToolItem.isToolItem(n))i=n;else{let e=typeof n==`object`?n.name:n,t=typeof n==`object`&&n.args||{};if(e){if(this.cell.isNode()){let n=uf.registry.get(e);if(n)i=new n(t);else return uf.registry.onNotFound(e)}else if(this.cell.isEdge()){let n=df.registry.get(e);if(n)i=new n(t);else return df.registry.onNotFound(e)}}}if(i){i.config(this.cellView,this),i.render();let e=i.options.isSVGElement===!1?this.htmlContainer:this.svgContainer;e.appendChild(i.container),this.tools.push(i)}}return this}update(e={}){let t=this.tools;return t&&t.forEach(t=>{e.toolId!==t.cid&&t.isVisible()&&t.update()}),this}focus(e){let t=this.tools;return t&&t.forEach(t=>{e===t?t.show():t.hide()}),this}blur(e){let t=this.tools;return t&&t.forEach(t=>{t!==e&&!t.isVisible()&&(t.show(),t.update())}),this}hide(){return this.focus(null)}show(){return this.blur(null)}remove(){let e=this.tools;return e&&(e.forEach(e=>e.remove()),this.tools=null),oo(this.svgContainer),oo(this.htmlContainer),super.remove()}mount(){let e=this.tools,t=this.cellView;if(t&&e){let n=e.some(e=>e.options.isSVGElement!==!1),r=e.some(e=>e.options.isSVGElement===!1);if(n){let e=this.options.local?t.container:t.graph.view.decorator;e.appendChild(this.svgContainer)}r&&this.graph.container.appendChild(this.htmlContainer)}return this}};(function(e){e.toStringTag=`X6.${e.name}`;function t(t){if(t==null)return!1;if(t instanceof e)return!0;let n=t[Symbol.toStringTag],r=t;return(n==null||n===e.toStringTag)&&r.graph!=null&&r.cell!=null&&typeof r.config==`function`&&typeof r.update==`function`&&typeof r.focus==`function`&&typeof r.blur==`function`&&typeof r.show==`function`&&typeof r.hide==`function`}e.isToolsView=t})(Id||={}),function(e){class t extends q{static getDefaults(){return this.defaults}static config(e){this.defaults=this.getOptions(e)}static getOptions(e){return v(y(this.getDefaults()),e)}get graph(){return this.cellView.graph}get cell(){return this.cellView.cell}get name(){return this.options.name}get[Symbol.toStringTag](){return t.toStringTag}constructor(e={}){super(),this.visible=!0,this.options=this.getOptions(e),this.container=q.createElement(this.options.tagName||`g`,this.options.isSVGElement!==!1),k(this.container,this.prefixClassName(`cell-tool`)),typeof this.options.className==`string`&&k(this.container,this.options.className),this.init()}init(){}getOptions(e){let t=this.constructor;return t.getOptions(e)}delegateEvents(){return this.options.events&&super.delegateEvents(this.options.events),this}config(e,t){return this.cellView=e,this.parent=t,this.stamp(this.container),this.cell.isEdge()?k(this.container,this.prefixClassName(`edge-tool`)):this.cell.isNode()&&k(this.container,this.prefixClassName(`node-tool`)),this.name&&this.container.setAttribute(`data-tool-name`,this.name),this.delegateEvents(),this}render(){this.empty();let e=this.options.markup;if(e){let t=J.parseJSONMarkup(e);this.container.appendChild(t.fragment),this.childNodes=t.selectors}return this.onRender(),this}onRender(){}update(){return this}stamp(e){e&&e.setAttribute(`data-cell-id`,this.cellView.cell.id)}show(){return this.container.style.display=``,this.visible=!0,this}hide(){return this.container.style.display=`none`,this.visible=!1,this}isVisible(){return this.visible}focus(){let e=this.options.focusOpacity;return e!=null&&Number.isFinite(e)&&(this.container.style.opacity=`${e}`),this.parent.focus(this),this}blur(){return this.container.style.opacity=``,this.parent.blur(this),this}guard(e){return this.graph==null||this.cellView==null?!0:this.graph.view.guard(e,this.cellView)}}t.defaults={isSVGElement:!0,tagName:`g`},e.ToolItem=t,function(e){let t=0;function n(e){return e?sa(e):(t+=1,`CustomTool${t}`)}function r(e){let t=Qi(n(e.name),this);return t.config(e),t}e.define=r}(t=e.ToolItem||={}),function(e){e.toStringTag=`X6.${e.name}`;function t(t){if(t==null)return!1;if(t instanceof e)return!0;let n=t[Symbol.toStringTag],r=t;return(n==null||n===e.toStringTag)&&r.graph!=null&&r.cell!=null&&typeof r.config==`function`&&typeof r.update==`function`&&typeof r.focus==`function`&&typeof r.blur==`function`&&typeof r.show==`function`&&typeof r.hide==`function`&&typeof r.isVisible==`function`}e.isToolItem=t}(t=e.ToolItem||={})}(Id||={});const Ld=e=>e;function Rd(e,t){return t===0?`0%`:`${Math.round(e/t*100)}%`}function zd(e){let t=(t,n,r,i)=>n.isEdgeElement(r)?Vd(e,t,n,r,i):Bd(e,t,n,r,i);return t}function Bd(e,t,n,r,i){let a=n.cell,o=a.getAngle(),s=n.getUnrotatedBBoxOfElement(r),c=a.getBBox().getCenter(),l=z.create(i).rotate(o,c),u=l.x-s.x,d=l.y-s.y;return e&&(u=Rd(u,s.width),d=Rd(d,s.height)),t.anchor={name:`topLeft`,args:{dx:u,dy:d,rotate:!0}},t}function Vd(e,t,n,r,i){let a=n.getConnection();if(!a)return t;let o=a.closestPointLength(i);if(e){let e=a.length();t.anchor={name:`ratio`,args:{ratio:o/e}}}else t.anchor={name:`length`,args:{length:o}};return t}const Hd=zd(!0),Ud=zd(!1);var Wd={};e(Wd,{noop:()=>Ld,pinAbsolute:()=>Ud,pinRelative:()=>Hd});var Gd;(function(e){e.presets=Wd,e.registry=U.create({type:`connection strategy`}),e.registry.register(e.presets,!0)})(Gd||={});function Kd(e,t,n,r){let i=O(Gd.presets.pinRelative,this.graph,{},t,n,e,this.cell,r,{});return i.anchor}function qd(e,t){return t?e.cell.getBBox():e.cell.isEdge()?e.getConnection().bbox():e.getUnrotatedBBoxOfElement(e.container)}var Jd=class extends Id.ToolItem{onRender(){k(this.container,this.prefixClassName(`cell-tool-button`)),this.update()}update(){return this.updatePosition(),this}updatePosition(){let e=this.cellView,t=e.cell.isEdge()?this.getEdgeMatrix():this.getNodeMatrix();Ms(this.container,t,{absolute:!0})}getNodeMatrix(){let e=this.cellView,t=this.options,{x:n=0,y:r=0}=t,{offset:i,useCellGeometry:a,rotate:o}=t,s=qd(e,a),c=e.cell.getAngle();o||(s=s.bbox(c));let l=0,u=0;typeof i==`number`?(l=i,u=i):typeof i==`object`&&(l=i.x,u=i.y),n=va(n,s.width),r=va(r,s.height);let d=P().translate(s.x+s.width/2,s.y+s.height/2);return o&&(d=d.rotate(c)),d=d.translate(n+l-s.width/2,r+u-s.height/2),d}getEdgeMatrix(){let e=this.cellView,t=this.options,{offset:n=0,distance:r=0,rotate:i}=t,a,o,s,c=va(r,1);a=c>=0&&c<=1?e.getTangentAtRatio(c):e.getTangentAtLength(c),a?(o=a.start,s=a.vector().vectorAngle(new z(1,0))||0):(o=e.getConnection().start,s=0);let l=P().translate(o.x,o.y).rotate(s);return l=typeof n==`object`?l.translate(n.x||0,n.y||0):l.translate(0,n),i||(l=l.rotate(-s)),l}onMouseDown(e){if(this.guard(e))return;e.stopPropagation(),e.preventDefault();let t=this.options.onClick;typeof t==`function`&&O(t,this.cellView,{e,view:this.cellView,cell:this.cellView.cell,btn:this})}};(function(e){e.config({name:`button`,useCellGeometry:!0,events:{mousedown:`onMouseDown`,touchstart:`onMouseDown`}})})(Jd||={}),function(e){e.Remove=e.define({name:`button-remove`,markup:[{tagName:`circle`,selector:`button`,attrs:{r:7,fill:`#FF1D00`,cursor:`pointer`}},{tagName:`path`,selector:`icon`,attrs:{d:`M -3 -3 3 3 M -3 3 3 -3`,fill:`none`,stroke:`#FFFFFF`,"stroke-width":2,"pointer-events":`none`}}],distance:60,offset:0,useCellGeometry:!0,onClick({view:e,btn:t}){t.parent.remove(),e.cell.remove({ui:!0,toolId:t.cid})}})}(Jd||={});var Yd=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(e!=null&&typeof Object.getOwnPropertySymbols==`function`)for(var i=0,r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]]);return n},Xd=class extends Id.ToolItem{onRender(){if(k(this.container,this.prefixClassName(`cell-tool-boundary`)),this.options.attrs){let e=this.options.attrs,{class:t}=e,n=Yd(e,[`class`]);j(this.container,xo(n)),t&&k(this.container,t)}this.update()}update(){let e=this.cellView,t=this.options,{useCellGeometry:n,rotate:r}=t,i=ya(t.padding),a=qd(e,n).moveAndExpand({x:-i.left,y:-i.top,width:i.left+i.right,height:i.top+i.bottom}),o=e.cell;if(o.isNode()){let e=o.getAngle();if(e)if(r){let t=o.getBBox().getCenter();Ps(this.container,e,t.x,t.y,{absolute:!0})}else a=a.bbox(e)}return j(this.container,a.toJSON()),this}};(function(e){e.config({name:`boundary`,tagName:`rect`,padding:10,useCellGeometry:!0,attrs:{fill:`none`,stroke:`#333`,"stroke-width":.5,"stroke-dasharray":`5, 5`,"pointer-events":`none`}})})(Xd||={});var Zd=class extends Id.ToolItem{constructor(){super(...arguments),this.handles=[]}get vertices(){return this.cellView.cell.getVertices()}onRender(){return this.addClass(this.prefixClassName(`edge-tool-vertices`)),this.options.addable&&this.updatePath(),this.resetHandles(),this.renderHandles(),this}update(){let e=this.vertices;return e.length===this.handles.length?this.updateHandles():(this.resetHandles(),this.renderHandles()),this.options.addable&&this.updatePath(),this}resetHandles(){let e=this.handles;this.handles=[],e&&e.forEach(e=>{this.stopHandleListening(e),e.remove()})}renderHandles(){let e=this.vertices;for(let t=0,n=e.length;t<n;t+=1){let n=e[t],r=this.options.createHandle,i=this.options.processHandle,a=r({index:t,graph:this.graph,guard:e=>this.guard(e),attrs:this.options.attrs||{}});i&&i(a),a.updatePosition(n.x,n.y),this.stamp(a.container),this.container.appendChild(a.container),this.handles.push(a),this.startHandleListening(a)}}updateHandles(){let e=this.vertices;for(let t=0,n=e.length;t<n;t+=1){let n=e[t],r=this.handles[t];r&&r.updatePosition(n.x,n.y)}}updatePath(){let e=this.childNodes.connection;e&&e.setAttribute(`d`,this.cellView.getConnectionPathData())}startHandleListening(e){let t=this.cellView;t.can(`vertexMovable`)&&(e.on(`change`,this.onHandleChange,this),e.on(`changing`,this.onHandleChanging,this),e.on(`changed`,this.onHandleChanged,this)),t.can(`vertexDeletable`)&&e.on(`remove`,this.onHandleRemove,this)}stopHandleListening(e){let t=this.cellView;t.can(`vertexMovable`)&&(e.off(`change`,this.onHandleChange,this),e.off(`changing`,this.onHandleChanging,this),e.off(`changed`,this.onHandleChanged,this)),t.can(`vertexDeletable`)&&e.off(`remove`,this.onHandleRemove,this)}getNeighborPoints(e){let t=this.cellView,n=this.vertices,r=e>0?n[e-1]:t.sourceAnchor,i=e<n.length-1?n[e+1]:t.targetAnchor;return{prev:z.create(r),next:z.create(i)}}getMouseEventArgs(e){let t=this.normalizeEvent(e),{x:n,y:r}=this.graph.snapToGrid(t.clientX,t.clientY);return{e:t,x:n,y:r}}onHandleChange({e}){this.focus();let t=this.cellView;if(t.cell.startBatch(`move-vertex`,{ui:!0,toolId:this.cid}),!this.options.stopPropagation){let{e:n,x:r,y:i}=this.getMouseEventArgs(e);this.eventData(n,{start:{x:r,y:i}}),t.notifyMouseDown(n,r,i)}}onHandleChanging({handle:e,e:t}){let n=this.cellView,r=e.options.index,{e:i,x:a,y:o}=this.getMouseEventArgs(t),s={x:a,y:o};this.snapVertex(s,r),n.cell.setVertexAt(r,s,{ui:!0,toolId:this.cid}),e.updatePosition(s.x,s.y),this.options.stopPropagation||n.notifyMouseMove(i,a,o)}stopBatch(e){this.cell.stopBatch(`move-vertex`,{ui:!0,toolId:this.cid}),e&&this.cell.stopBatch(`add-vertex`,{ui:!0,toolId:this.cid})}onHandleChanged({e}){let t=this.options,n=this.cellView;if(t.addable&&this.updatePath(),!t.removeRedundancies){this.stopBatch(this.eventData(e).vertexAdded);return}let r=n.removeRedundantLinearVertices({ui:!0,toolId:this.cid});r&&this.render(),this.blur(),this.stopBatch(this.eventData(e).vertexAdded);let{e:i,x:a,y:o}=this.getMouseEventArgs(e);if(!this.options.stopPropagation){n.notifyMouseUp(i,a,o);let{start:e}=this.eventData(i);if(e){let{x:t,y:r}=e;t===a&&r===o&&n.onClick(i,a,o)}}n.checkMouseleave(i),t.onChanged&&t.onChanged({edge:n.cell,edgeView:n})}snapVertex(e,t){let n=this.options.snapRadius||0;if(n>0){let r=this.getNeighborPoints(t),i=r.prev,a=r.next;Math.abs(e.x-i.x)<n?e.x=i.x:Math.abs(e.x-a.x)<n&&(e.x=a.x),Math.abs(e.y-i.y)<n?e.y=r.prev.y:Math.abs(e.y-a.y)<n&&(e.y=a.y)}}onHandleRemove({handle:e,e:t}){if(this.options.removable){let n=e.options.index,r=this.cellView;r.cell.removeVertexAt(n,{ui:!0}),this.options.addable&&this.updatePath(),r.checkMouseleave(this.normalizeEvent(t))}}allowAddVertex(e){let t=this.guard(e),n=this.options.addable&&this.cellView.can(`vertexAddable`),r=this.options.modifiers?ic.isMatch(e,this.options.modifiers):!0;return!t&&n&&r}onPathMouseDown(e){let t=this.cellView;if(!this.allowAddVertex(e))return;e.stopPropagation(),e.preventDefault();let n=this.normalizeEvent(e),r=this.graph.snapToGrid(n.clientX,n.clientY).toJSON();t.cell.startBatch(`add-vertex`,{ui:!0,toolId:this.cid});let i=t.getVertexIndex(r.x,r.y);this.snapVertex(r,i),t.cell.insertVertex(r,i,{ui:!0,toolId:this.cid}),this.render();let a=this.handles[i];this.eventData(n,{vertexAdded:!0}),a.onMouseDown(n)}onRemove(){this.resetHandles()}};(function(e){class t extends q{get graph(){return this.options.graph}constructor(e){super(),this.options=e,this.render(),this.delegateEvents({mousedown:`onMouseDown`,touchstart:`onMouseDown`,dblclick:`onDoubleClick`})}render(){this.container=q.createElement(`circle`,!0);let t=this.options.attrs;if(typeof t==`function`){let n=e.getDefaults();this.setAttrs(Object.assign(Object.assign({},n.attrs),t(this)))}else this.setAttrs(t);this.addClass(this.prefixClassName(`edge-tool-vertex`))}updatePosition(e,t){this.setAttrs({cx:e,cy:t})}onMouseDown(e){this.options.guard(e)||(e.stopPropagation(),e.preventDefault(),this.graph.view.undelegateEvents(),this.delegateDocumentEvents({mousemove:`onMouseMove`,touchmove:`onMouseMove`,mouseup:`onMouseUp`,touchend:`onMouseUp`,touchcancel:`onMouseUp`},e.data),this.emit(`change`,{e,handle:this}))}onMouseMove(e){this.emit(`changing`,{e,handle:this})}onMouseUp(e){this.emit(`changed`,{e,handle:this}),this.undelegateDocumentEvents(),this.graph.view.delegateEvents()}onDoubleClick(e){this.emit(`remove`,{e,handle:this})}}e.Handle=t})(Zd||={}),function(e){let t=G.prefix(`edge-tool-vertex-path`);e.config({name:`vertices`,snapRadius:20,addable:!0,removable:!0,removeRedundancies:!0,stopPropagation:!0,attrs:{r:6,fill:`#333`,stroke:`#fff`,cursor:`move`,"stroke-width":2},createHandle:t=>new e.Handle(t),markup:[{tagName:`path`,selector:`connection`,className:t,attrs:{fill:`none`,stroke:`transparent`,"stroke-width":10,cursor:`pointer`}}],events:{[`mousedown .${t}`]:`onPathMouseDown`,[`touchstart .${t}`]:`onPathMouseDown`}})}(Zd||={});var Qd=class extends Id.ToolItem{constructor(){super(...arguments),this.handles=[]}get vertices(){return this.cellView.cell.getVertices()}update(){return this.render(),this}onRender(){k(this.container,this.prefixClassName(`edge-tool-segments`)),this.resetHandles();let e=this.cellView,t=[...this.vertices];t.unshift(e.sourcePoint),t.push(e.targetPoint);for(let e=0,n=t.length;e<n-1;e+=1){let n=t[e],r=t[e+1],i=this.renderHandle(n,r,e);this.stamp(i.container),this.handles.push(i)}return this}renderHandle(e,t,n){let r=this.options.createHandle({index:n,graph:this.graph,guard:e=>this.guard(e),attrs:this.options.attrs||{}});return this.options.processHandle&&this.options.processHandle(r),this.updateHandle(r,e,t),this.container.appendChild(r.container),this.startHandleListening(r),r}startHandleListening(e){e.on(`change`,this.onHandleChange,this),e.on(`changing`,this.onHandleChanging,this),e.on(`changed`,this.onHandleChanged,this)}stopHandleListening(e){e.off(`change`,this.onHandleChange,this),e.off(`changing`,this.onHandleChanging,this),e.off(`changed`,this.onHandleChanged,this)}resetHandles(){let e=this.handles;this.handles=[],e&&e.forEach(e=>{this.stopHandleListening(e),e.remove()})}shiftHandleIndexes(e){let t=this.handles;for(let n=0,r=t.length;n<r;n+=1)t[n].options.index+=e}resetAnchor(e,t){let n=this.cellView.cell,r={ui:!0,toolId:this.cid};t?n.prop([e,`anchor`],t,r):n.removeProp([e,`anchor`],r)}snapHandle(e,t,n){let r=e.options.axis,i=e.options.index,a=this.cellView,o=a.cell,s=o.getVertices(),c=s[i-2]||n.sourceAnchor,l=s[i+1]||n.targetAnchor,u=this.options.snapRadius;return Math.abs(t[r]-c[r])<u?t[r]=c[r]:Math.abs(t[r]-l[r])<u&&(t[r]=l[r]),t}onHandleChanging({handle:e,e:t}){let n=this.graph,r=this.options,i=this.cellView,a=r.anchor,o=e.options.axis,s=e.options.index-1,c=this.getEventData(t),l=this.normalizeEvent(t),u=n.snapToGrid(l.clientX,l.clientY),d=this.snapHandle(e,u.clone(),c),f=y(this.vertices),p=f[s],m=f[s+1],h=i.sourceView,g=i.sourceBBox,_=!1,v=!1;if(p?s===0?g.containsPoint(p)?(f.shift(),this.shiftHandleIndexes(-1),_=!0):(p[o]=d[o],v=!0):p[o]=d[o]:(p=i.sourceAnchor.toJSON(),p[o]=d[o],g.containsPoint(p)?_=!0:(f.unshift(p),this.shiftHandleIndexes(1),v=!0)),typeof a==`function`&&h){if(_){let e=c.sourceAnchor.clone();e[o]=d[o];let t=O(a,i,e,h,i.sourceMagnet||h.container,`source`,i,this);this.resetAnchor(`source`,t)}v&&this.resetAnchor(`source`,c.sourceAnchorDef)}let b=i.targetView,x=i.targetBBox,S=!1,C=!1;if(m?s===f.length-2?x.containsPoint(m)?(f.pop(),S=!0):(m[o]=d[o],C=!0):m[o]=d[o]:(m=i.targetAnchor.toJSON(),m[o]=d[o],x.containsPoint(m)?S=!0:(f.push(m),C=!0)),typeof a==`function`&&b){if(S){let e=c.targetAnchor.clone();e[o]=d[o];let t=O(a,i,e,b,i.targetMagnet||b.container,`target`,i,this);this.resetAnchor(`target`,t)}C&&this.resetAnchor(`target`,c.targetAnchorDef)}z.equalPoints(f,this.vertices)||this.cellView.cell.setVertices(f,{ui:!0,toolId:this.cid}),this.updateHandle(e,p,m,0),r.stopPropagation||i.notifyMouseMove(l,u.x,u.y)}onHandleChange({handle:e,e:t}){let n=this.options,r=this.handles,i=this.cellView,a=e.options.index;if(Array.isArray(r)){for(let e=0,t=r.length;e<t;e+=1)e!==a&&r[e].hide();if(this.focus(),this.setEventData(t,{sourceAnchor:i.sourceAnchor.clone(),targetAnchor:i.targetAnchor.clone(),sourceAnchorDef:y(this.cell.prop([`source`,`anchor`])),targetAnchorDef:y(this.cell.prop([`target`,`anchor`]))}),this.cell.startBatch(`move-segment`,{ui:!0,toolId:this.cid}),!n.stopPropagation){let e=this.normalizeEvent(t),n=this.graph.snapToGrid(e.clientX,e.clientY);i.notifyMouseDown(e,n.x,n.y)}}}onHandleChanged({e}){let t=this.options,n=this.cellView;t.removeRedundancies&&n.removeRedundantLinearVertices({ui:!0,toolId:this.cid});let r=this.normalizeEvent(e),i=this.graph.snapToGrid(r.clientX,r.clientY);this.render(),this.blur(),this.cell.stopBatch(`move-segment`,{ui:!0,toolId:this.cid}),t.stopPropagation||n.notifyMouseUp(r,i.x,i.y),n.checkMouseleave(r),t.onChanged&&t.onChanged({edge:n.cell,edgeView:n})}updateHandle(e,t,n,r=0){let i=this.options.precision||0,a=Math.abs(t.x-n.x)<i,o=Math.abs(t.y-n.y)<i;if(a||o){let i=new V(t,n),o=i.length();if(o<this.options.threshold)e.hide();else{let t=i.getCenter(),n=a?`x`:`y`;t[n]+=r||0;let o=i.vector().vectorAngle(new z(1,0));e.updatePosition(t.x,t.y,o,this.cellView),e.show(),e.options.axis=n}}else e.hide()}onRemove(){this.resetHandles()}};(function(e){class t extends q{constructor(e){super(),this.options=e,this.render(),this.delegateEvents({mousedown:`onMouseDown`,touchstart:`onMouseDown`})}render(){this.container=q.createElement(`rect`,!0);let t=this.options.attrs;if(typeof t==`function`){let n=e.getDefaults();this.setAttrs(Object.assign(Object.assign({},n.attrs),t(this)))}else this.setAttrs(t);this.addClass(this.prefixClassName(`edge-tool-segment`))}updatePosition(e,t,n,r){let i=r.getClosestPoint(new z(e,t))||new z(e,t),a=P().translate(i.x,i.y);if(i.equals({x:e,y:t}))a=a.rotate(n);else{let n=new V(e,t,i.x,i.y),r=n.vector().vectorAngle(new z(1,0));r!==0&&(r+=90),a=a.rotate(r)}this.setAttrs({transform:Ts(a),cursor:n%180==0?`row-resize`:`col-resize`})}onMouseDown(e){this.options.guard(e)||(this.trigger(`change`,{e,handle:this}),e.stopPropagation(),e.preventDefault(),this.options.graph.view.undelegateEvents(),this.delegateDocumentEvents({mousemove:`onMouseMove`,touchmove:`onMouseMove`,mouseup:`onMouseUp`,touchend:`onMouseUp`,touchcancel:`onMouseUp`},e.data))}onMouseMove(e){this.emit(`changing`,{e,handle:this})}onMouseUp(e){this.emit(`changed`,{e,handle:this}),this.undelegateDocumentEvents(),this.options.graph.view.delegateEvents()}show(){this.container.style.display=``}hide(){this.container.style.display=`none`}}e.Handle=t})(Qd||={}),function(e){e.config({name:`segments`,precision:.5,threshold:40,snapRadius:10,stopPropagation:!0,removeRedundancies:!0,attrs:{width:20,height:8,x:-10,y:-4,rx:4,ry:4,fill:`#333`,stroke:`#fff`,"stroke-width":2},createHandle:t=>new e.Handle(t),anchor:Kd})}(Qd||={});var $d=class extends Id.ToolItem{get type(){return this.options.type}onRender(){k(this.container,this.prefixClassName(`edge-tool-${this.type}-anchor`)),this.toggleArea(!1),this.update()}update(){let e=this.type,t=this.cellView,n=t.getTerminalView(e);return n?(this.updateAnchor(),this.updateArea(),this.container.style.display=``):this.container.style.display=`none`,this}updateAnchor(){let e=this.childNodes;if(!e)return;let t=e.anchor;if(!t)return;let n=this.type,r=this.cellView,i=this.options,a=r.getTerminalAnchor(n),o=r.cell.prop([n,`anchor`]);t.setAttribute(`transform`,`translate(${a.x}, ${a.y})`);let s=o?i.customAnchorAttrs:i.defaultAnchorAttrs;s&&Object.keys(s).forEach(e=>{t.setAttribute(e,s[e])})}updateArea(){let e=this.childNodes;if(!e)return;let t=e.area;if(!t)return;let n=this.type,r=this.cellView,i=r.getTerminalView(n);if(i){let e=i.cell,a=r.getTerminalMagnet(n),o=this.options.areaPadding||0;Number.isFinite(o)||(o=0);let s,c,l;i.isEdgeElement(a)?(s=i.getBBox(),c=0,l=s.getCenter()):(s=i.getUnrotatedBBoxOfElement(a),c=e.getAngle(),l=s.getCenter(),c&&l.rotate(-c,e.getBBox().getCenter())),s.inflate(o),j(t,{x:-s.width/2,y:-s.height/2,width:s.width,height:s.height,transform:`translate(${l.x}, ${l.y}) rotate(${c})`})}}toggleArea(e){if(this.childNodes){let t=this.childNodes.area;t&&(t.style.display=e?``:`none`)}}onMouseDown(e){this.guard(e)||(e.stopPropagation(),e.preventDefault(),this.graph.view.undelegateEvents(),this.options.documentEvents&&this.delegateDocumentEvents(this.options.documentEvents),this.focus(),this.toggleArea(this.options.restrictArea),this.cell.startBatch(`move-anchor`,{ui:!0,toolId:this.cid}))}resetAnchor(e){let t=this.type,n=this.cell;e?n.prop([t,`anchor`],e,{rewrite:!0,ui:!0,toolId:this.cid}):n.removeProp([t,`anchor`],{ui:!0,toolId:this.cid})}onMouseMove(e){let t=this.type,n=this.cellView,r=n.getTerminalView(t);if(r==null)return;let i=this.normalizeEvent(e),a=r.cell,o=n.getTerminalMagnet(t),s=this.graph.coord.clientToLocalPoint(i.clientX,i.clientY),c=this.options.snap;if(typeof c==`function`){let e=O(c,n,s,r,o,t,n,this);s=z.create(e)}if(this.options.restrictArea)if(r.isEdgeElement(o)){let e=r.getClosestPoint(s);e&&(s=e)}else{let e=r.getUnrotatedBBoxOfElement(o),t=a.getAngle(),n=a.getBBox().getCenter(),i=s.clone().rotate(t,n);e.containsPoint(i)||(s=e.getNearestPointToPoint(i).rotate(-t,n))}let l,u=this.options.anchor;typeof u==`function`&&(l=O(u,n,s,r,o,t,n,this)),this.resetAnchor(l),this.update()}onMouseUp(e){this.graph.view.delegateEvents(),this.undelegateDocumentEvents(),this.blur(),this.toggleArea(!1);let t=this.cellView;this.options.removeRedundancies&&t.removeRedundantLinearVertices({ui:!0,toolId:this.cid}),this.cell.stopBatch(`move-anchor`,{ui:!0,toolId:this.cid})}onDblClick(){let e=this.options.resetAnchor;e&&this.resetAnchor(e===!0?void 0:e),this.update()}};(function(e){e.config({tagName:`g`,markup:[{tagName:`circle`,selector:`anchor`,attrs:{cursor:`pointer`}},{tagName:`rect`,selector:`area`,attrs:{"pointer-events":`none`,fill:`none`,stroke:`#33334F`,"stroke-dasharray":`2,4`,rx:5,ry:5}}],events:{mousedown:`onMouseDown`,touchstart:`onMouseDown`,dblclick:`onDblClick`},documentEvents:{mousemove:`onMouseMove`,touchmove:`onMouseMove`,mouseup:`onMouseUp`,touchend:`onMouseUp`,touchcancel:`onMouseUp`},customAnchorAttrs:{"stroke-width":4,stroke:`#33334F`,fill:`#FFFFFF`,r:5},defaultAnchorAttrs:{"stroke-width":2,stroke:`#FFFFFF`,fill:`#33334F`,r:6},areaPadding:6,snapRadius:10,resetAnchor:!0,restrictArea:!0,removeRedundancies:!0,anchor:Kd,snap(e,t,n,r,i,a){let o=a.options.snapRadius||0,s=r===`source`,c=s?0:-1,l=this.cell.getVertexAt(c)||this.getTerminalAnchor(s?`target`:`source`);return l&&(Math.abs(l.x-e.x)<o&&(e.x=l.x),Math.abs(l.y-e.y)<o&&(e.y=l.y)),e}})})($d||={});const ef=$d.define({name:`source-anchor`,type:`source`}),tf=$d.define({name:`target-anchor`,type:`target`});var nf=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(e!=null&&typeof Object.getOwnPropertySymbols==`function`)for(var i=0,r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]]);return n},rf=class extends Id.ToolItem{get type(){return this.options.type}get ratio(){return this.options.ratio}init(){if(this.options.attrs){let e=this.options.attrs,{class:t}=e,n=nf(e,[`class`]);this.setAttrs(n,this.container),t&&k(this.container,t)}}onRender(){k(this.container,this.prefixClassName(`edge-tool-${this.type}-arrowhead`)),this.update()}update(){let e=this.ratio,t=this.cellView,n=t.getTangentAtRatio(e),r=n?n.start:t.getPointAtRatio(e),i=n&&n.vector().vectorAngle(new z(1,0))||0;if(!r)return this;let a=P().translate(r.x,r.y).rotate(i);return Ms(this.container,a,{absolute:!0}),this}onMouseDown(e){if(this.guard(e))return;e.stopPropagation(),e.preventDefault();let t=this.cellView;if(t.can(`arrowheadMovable`)){t.cell.startBatch(`move-arrowhead`,{ui:!0,toolId:this.cid});let n=this.graph.snapToGrid(e.clientX,e.clientY),r=t.prepareArrowheadDragging(this.type,{x:n.x,y:n.y,options:Object.assign(Object.assign({},this.options),{toolId:this.cid})});this.cellView.setEventData(e,r),this.delegateDocumentEvents(this.options.documentEvents,e.data),t.graph.view.undelegateEvents(),this.container.style.pointerEvents=`none`}this.focus()}onMouseMove(e){let t=this.normalizeEvent(e),n=this.graph.snapToGrid(t.clientX,t.clientY);this.cellView.onMouseMove(t,n.x,n.y),this.update()}onMouseUp(e){this.undelegateDocumentEvents();let t=this.normalizeEvent(e),n=this.cellView,r=this.graph.snapToGrid(t.clientX,t.clientY);n.onMouseUp(t,r.x,r.y),this.graph.view.delegateEvents(),this.blur(),this.container.style.pointerEvents=``,n.cell.stopBatch(`move-arrowhead`,{ui:!0,toolId:this.cid})}};(function(e){e.config({tagName:`path`,isSVGElement:!0,events:{mousedown:`onMouseDown`,touchstart:`onMouseDown`},documentEvents:{mousemove:`onMouseMove`,touchmove:`onMouseMove`,mouseup:`onMouseUp`,touchend:`onMouseUp`,touchcancel:`onMouseUp`}})})(rf||={});const af=rf.define({name:`source-arrowhead`,type:`source`,ratio:0,attrs:{d:`M 10 -8 -10 0 10 8 Z`,fill:`#333`,stroke:`#fff`,"stroke-width":2,cursor:`move`}}),sf=rf.define({name:`target-arrowhead`,type:`target`,ratio:1,attrs:{d:`M -10 -8 10 0 -10 8 Z`,fill:`#333`,stroke:`#fff`,"stroke-width":2,cursor:`move`}});var cf=class extends Id.ToolItem{constructor(){super(...arguments),this.labelIndex=-1,this.distance=.5,this.dblClick=this.onCellDblClick.bind(this)}onRender(){let e=this.cellView;e&&e.on(`cell:dblclick`,this.dblClick)}createElement(){let e=[this.prefixClassName(`${this.cell.isEdge()?`edge`:`node`}-tool-editor`),this.prefixClassName(`cell-tool-editor`)];this.editor=Id.createElement(`div`,!1),this.addClass(e,this.editor),this.editor.contentEditable=`true`,this.container.appendChild(this.editor)}removeElement(){this.undelegateDocumentEvents(),this.editor&&(this.container.removeChild(this.editor),this.editor=null)}updateEditor(){let{cell:e,editor:t}=this;if(!t)return;let{style:n}=t;e.isNode()?this.updateNodeEditorTransform():e.isEdge()&&this.updateEdgeEditorTransform();let{attrs:r}=this.options;n.fontSize=`${r.fontSize}px`,n.fontFamily=r.fontFamily,n.color=r.color,n.backgroundColor=r.backgroundColor;let i=this.getCellText()||``;return t.innerText=i,this.setCellText(``),this}updateNodeEditorTransform(){let{graph:e,cell:t,editor:n}=this;if(!n)return;let r=z.create(),i=20,a=``,{x:o,y:s}=this.options,{width:c,height:l}=this.options;if(o!==void 0&&s!==void 0){let e=t.getBBox();o=va(o,e.width),s=va(s,e.height),r=e.topLeft.translate(o,s),i=e.width-o*2}else{let e=t.getBBox();r=e.center,i=e.width-4,a=`translate(-50%, -50%)`}let u=e.scale(),{style:d}=n;r=e.localToGraph(r),d.left=`${r.x}px`,d.top=`${r.y}px`,d.transform=`scale(${u.sx}, ${u.sy}) ${a}`,d.minWidth=`${i}px`,typeof c==`number`&&(d.width=`${c}px`),typeof l==`number`&&(d.height=`${l}px`)}updateEdgeEditorTransform(){if(!this.event)return;let{graph:e,editor:t}=this;if(!t)return;let n=z.create(),r=20,{style:i}=t,a=this.event.target,o=a.parentElement,s=o&&Va(o,this.prefixClassName(`edge-label`));if(s){let e=o.getAttribute(`data-index`)||`0`;this.labelIndex=parseInt(e,10);let t=o.getAttribute(`transform`),{translation:i}=Es(t);n=new z(i.tx,i.ty),r=K.getBBox(a).width}else{if(!this.options.labelAddable)return this;n=e.clientToLocal(z.create(this.event.clientX,this.event.clientY));let t=this.cellView,r=t.path.closestPointLength(n);this.distance=r,this.labelIndex=-1}n=e.localToGraph(n);let c=e.scale();i.left=`${n.x}px`,i.top=`${n.y}px`,i.minWidth=`${r}px`,i.transform=`scale(${c.sx}, ${c.sy}) translate(-50%, -50%)`}onDocumentMouseUp(e){if(this.editor&&e.target!==this.editor){let e=this.editor.innerText.replace(/\n$/,``)||``;this.setCellText(e===``?null:e),this.removeElement()}}onCellDblClick({e}){this.editor||(e.stopPropagation(),this.removeElement(),this.event=e,this.createElement(),this.updateEditor(),this.autoFocus(),this.delegateDocumentEvents(this.options.documentEvents))}onMouseDown(e){e.stopPropagation()}autoFocus(){setTimeout(()=>{this.editor&&(this.editor.focus(),this.selectText())})}selectText(){if(window.getSelection&&this.editor){let e=document.createRange(),t=window.getSelection();e.selectNodeContents(this.editor),t.removeAllRanges(),t.addRange(e)}}getCellText(){let{getText:e}=this.options;if(typeof e==`function`)return O(e,this.cellView,{cell:this.cell,index:this.labelIndex});if(typeof e==`string`){if(this.cell.isNode())return this.cell.attr(e);if(this.cell.isEdge()&&this.labelIndex!==-1)return this.cell.prop(`labels/${this.labelIndex}/attrs/${e}`)}}setCellText(e){let t=this.options.setText;if(typeof t==`function`){O(t,this.cellView,{cell:this.cell,value:e,index:this.labelIndex,distance:this.distance});return}if(typeof t==`string`){if(this.cell.isNode()){e!==null&&this.cell.attr(t,e);return}if(this.cell.isEdge()){let n=this.cell;if(this.labelIndex===-1){if(e){let r={position:{distance:this.distance},attrs:{}};ta(r,`attrs/${t}`,e),n.appendLabel(r)}}else e===null?typeof this.labelIndex==`number`&&n.removeLabelAt(this.labelIndex):n.prop(`labels/${this.labelIndex}/attrs/${t}`,e)}}}onRemove(){let e=this.cellView;e&&e.off(`cell:dblclick`,this.dblClick),this.removeElement()}};(function(e){e.config({tagName:`div`,isSVGElement:!1,events:{mousedown:`onMouseDown`,touchstart:`onMouseDown`},documentEvents:{mouseup:`onDocumentMouseUp`,touchend:`onDocumentMouseUp`,touchcancel:`onDocumentMouseUp`}})})(cf||={}),function(e){e.NodeEditor=e.define({attrs:{fontSize:14,fontFamily:`Arial, helvetica, sans-serif`,color:`#000`,backgroundColor:`#fff`},getText:`text/text`,setText:`text/text`}),e.EdgeEditor=e.define({attrs:{fontSize:14,fontFamily:`Arial, helvetica, sans-serif`,color:`#000`,backgroundColor:`#fff`},labelAddable:!0,getText:`label/text`,setText:`label/text`})}(cf||={});var lf=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(e!=null&&typeof Object.getOwnPropertySymbols==`function`)for(var i=0,r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]]);return n},uf;(function(e){e.presets={boundary:Xd,button:Jd,"button-remove":Jd.Remove,"node-editor":cf.NodeEditor},e.registry=U.create({type:`node tool`,process(e,t){if(typeof t==`function`)return t;let n=Id.ToolItem,{inherit:r}=t,i=lf(t,[`inherit`]);if(r){let e=this.get(r);e==null?this.onNotFound(r,`inherited`):n=e}return i.name??=e,n.define.call(n,i)}}),e.registry.register(e.presets,!0)})(uf||={});var df;(function(e){e.presets={boundary:Xd,vertices:Zd,segments:Qd,button:Jd,"button-remove":Jd.Remove,"source-anchor":ef,"target-anchor":tf,"source-arrowhead":af,"target-arrowhead":sf,"edge-editor":cf.EdgeEditor},e.registry=U.create({type:`edge tool`,process(e,t){if(typeof t==`function`)return t;let n=Id.ToolItem,{inherit:r}=t,i=lf(t,[`inherit`]);if(r){let e=this.get(r);e==null?this.onNotFound(r,`inherited`):n=e}return i.name??=e,n.define.call(n,i)}}),e.registry.register(e.presets,!0)})(df||={});const ff=xf(`center`),pf=xf(`topCenter`),mf=xf(`bottomCenter`),hf=xf(`leftMiddle`),gf=xf(`rightMiddle`),_f=xf(`topLeft`),vf=xf(`topRight`),yf=xf(`bottomLeft`),bf=xf(`bottomRight`);function xf(e){return function(t,n,r,i={}){let a=i.rotate?t.getUnrotatedBBoxOfElement(n):t.getBBoxOfElement(n),o=a[e];o.x+=va(i.dx,a.width),o.y+=va(i.dy,a.height);let s=t.cell;return i.rotate?o.rotate(-s.getAngle(),s.getBBox().getCenter()):o}}function Sf(e){return function(t,n,r,i){if(r instanceof Element){let a=this.graph.findViewByElem(r),o;if(a)if(a.isEdgeElement(r)){let e=i.fixedAt==null?`50%`:i.fixedAt;o=Cf(a,e)}else o=a.getBBoxOfElement(r).getCenter();else o=new z;return e.call(this,t,n,o,i)}return e.apply(this,arguments)}}function Cf(e,t){let n=_a(t),r=typeof t==`string`?parseFloat(t):t;return n?e.getPointAtRatio(r/100):e.getPointAtLength(r)}const wf=function(e,t,n,r){let i=L.normalize(e.cell.getAngle()),a=e.getBBoxOfElement(t),o=a.getCenter(),s=a.getTopLeft(),c=a.getBottomRight(),l=r.padding;if(Number.isFinite(l)||(l=0),s.y+l<=n.y&&n.y<=c.y-l){let e=n.y-o.y;o.x+=i===0||i===180?0:e*1/Math.tan(L.toRad(i)),o.y+=e}else if(s.x+l<=n.x&&n.x<=c.x-l){let e=n.x-o.x;o.y+=i===90||i===270?0:e*Math.tan(L.toRad(i)),o.x+=e}return o},Tf=Sf(wf),Ef=function(e,t,n,r,i){let a=e.cell.getConnectionPoint(this.cell,i);return(r.dx||r.dy)&&a.translate(r.dx||0,r.dy||0),a},Df=function(e,t,n,r){let i,a=0,o,s=e.cell;r.rotate?(i=e.getUnrotatedBBoxOfElement(t),o=s.getBBox().getCenter(),a=s.getAngle()):i=e.getBBoxOfElement(t);let c=r.padding;c!=null&&Number.isFinite(c)&&i.inflate(c),r.rotate&&n.rotate(a,o);let l=i.getNearestSideToPoint(n),u;switch(l){case`left`:u=i.getLeftMiddle();break;case`right`:u=i.getRightMiddle();break;case`top`:u=i.getTopCenter();break;case`bottom`:u=i.getBottomCenter();break;default:break}let d=r.direction;return d===`H`?(l===`top`||l===`bottom`)&&(u=n.x<=i.x+i.width?i.getLeftMiddle():i.getRightMiddle()):d===`V`&&(u=n.y<=i.y+i.height?i.getTopCenter():i.getBottomCenter()),r.rotate?u.rotate(-a,o):u},Of=Sf(Df);var kf={};e(kf,{bottom:()=>mf,bottomLeft:()=>yf,bottomRight:()=>bf,center:()=>ff,left:()=>hf,midSide:()=>Of,nodeCenter:()=>Ef,orth:()=>Tf,right:()=>gf,top:()=>pf,topLeft:()=>_f,topRight:()=>vf});var Af;(function(e){e.presets=kf,e.registry=U.create({type:`node endpoint`}),e.registry.register(e.presets,!0)})(Af||={});const jf=function(e,t,n,r){let i=r.ratio==null?.5:r.ratio;return i>1&&(i/=100),e.getPointAtRatio(i)},Mf=function(e,t,n,r){let i=r.length==null?20:r.length;return e.getPointAtLength(i)},Nf=function(e,t,n,r){let i=e.getClosestPoint(n);return i??new z},Pf=Sf(Nf),Ff=function(e,t,n,r){let i=1e6,a=e.getConnection(),o=e.getConnectionSubdivisions(),s=new V(n.clone().translate(0,i),n.clone().translate(0,-i)),c=new V(n.clone().translate(i,0),n.clone().translate(-i,0)),l=s.intersect(a,{segmentSubdivisions:o}),u=c.intersect(a,{segmentSubdivisions:o}),d=[];return l&&d.push(...l),u&&d.push(...u),d.length>0?n.closest(d):r.fallbackAt==null?O(Nf,this,e,t,n,r):Cf(e,r.fallbackAt)},If=Sf(Ff);var Lf={};e(Lf,{closest:()=>Pf,length:()=>Mf,orth:()=>If,ratio:()=>jf});var Rf;(function(e){e.presets=Lf,e.registry=U.create({type:`edge endpoint`}),e.registry.register(e.presets,!0)})(Rf||={});function zf(e,t,n){let r;if(typeof n==`object`){if(Number.isFinite(n.y)){let r=new V(t,e),{start:i,end:a}=r.parallel(n.y);t=i,e=a}r=n.x}else r=n;if(r==null||!Number.isFinite(r))return e;let i=e.distance(t);return r===0&&i>0?e:e.move(t,-Math.min(r,i-1))}function Bf(e){let t=e.getAttribute(`stroke-width`);return t===null?0:parseFloat(t)||0}function Vf(e){if(e==null)return null;let t=e;do{let e=t.tagName;if(typeof e!=`string`)return null;if(e=e.toUpperCase(),e===`G`)t=t.firstElementChild;else if(e===`TITLE`)t=t.nextElementSibling;else break}while(t);return t}const Hf=function(e,t,n,r){let i=t.getBBoxOfElement(n);r.stroked&&i.inflate(Bf(n)/2);let a=e.intersect(i),o=a&&a.length?e.start.closest(a):e.end;return zf(o,e.start,r.offset)},Uf=function(e,t,n,r,i){let a=t.cell,o=a.isNode()?a.getAngle():0;if(o===0)return O(Hf,this,e,t,n,r,i);let s=t.getUnrotatedBBoxOfElement(n);r.stroked&&s.inflate(Bf(n)/2);let c=s.getCenter(),l=e.clone().rotate(o,c),u=l.setLength(1e6).intersect(s),d=u&&u.length?l.start.closest(u).rotate(-o,c):e.end;return zf(d,e.start,r.offset)},Wf=function(e,t,n,r){let i,a,o=e.end,s=r.selector;if(i=typeof s==`string`?t.findOne(s):Array.isArray(s)?ea(n,s):Vf(n),!qa(i)){if(i===n||!qa(n))return o;i=n}let c=t.getShapeOfElement(i),l=t.getMatrixOfElement(i),u=t.getRootTranslatedMatrix(),d=t.getRootRotatedMatrix(),f=u.multiply(d).multiply(l),p=f.inverse(),m=K.transformLine(e,p),h=m.start.clone(),g=t.getDataOfElement(i);if(r.insideout===!1){g.shapeBBox??=c.bbox();let e=g.shapeBBox;if(e!=null&&e.containsPoint(h))return o}r.extrapolate===!0&&m.setLength(1e6);let _;if(H.isPath(c)){let e=r.precision||2;g.segmentSubdivisions??=c.getSegmentSubdivisions({precision:e}),_={precision:e,segmentSubdivisions:g.segmentSubdivisions},a=m.intersect(c,_)}else a=m.intersect(c);a?Array.isArray(a)&&(a=h.closest(a)):r.sticky===!0&&(a=B.isRectangle(c)?c.getNearestPointToPoint(h):dc.isEllipse(c)?c.intersectsWithLineFromCenterToPoint(h):c.closestPoint(h,_));let v=a?K.transformPoint(a,f):o,y=r.offset||0;return r.stroked!==!1&&(typeof y==`object`?(y=Object.assign({},y),y.x??=0,y.x+=Bf(i)/2):y+=Bf(i)/2),zf(v,e.start,y)};function Gf(e,t,n=0){let{start:r,end:i}=e,a,o,s,c;switch(t){case`left`:c=`x`,a=i,o=r,s=-1;break;case`right`:c=`x`,a=r,o=i,s=1;break;case`top`:c=`y`,a=i,o=r,s=-1;break;case`bottom`:c=`y`,a=r,o=i,s=1;break;default:return}r[c]<i[c]?a[c]=o[c]:o[c]=a[c],Number.isFinite(n)&&(a[c]+=s*n,o[c]+=s*n)}const Kf=function(e,t,n,r){let{alignOffset:i,align:a}=r;return a&&Gf(e,a,i),zf(e.end,e.start,r.offset)};var qf={};e(qf,{anchor:()=>Kf,bbox:()=>Hf,boundary:()=>Wf,rect:()=>Uf});var Jf;(function(e){e.presets=qf,e.registry=U.create({type:`connection point`}),e.registry.register(e.presets,!0)})(Jf||={});const Yf=function(e){return[...e]},Xf=function(e,t,n){let r=t.side||`bottom`,i=ya(t.padding||40),a=n.sourceBBox,o=n.targetBBox,s=a.getCenter(),c=o.getCenter(),l,u,d;switch(r){case`top`:d=-1,l=`y`,u=`height`;break;case`left`:d=-1,l=`x`,u=`width`;break;case`right`:d=1,l=`x`,u=`width`;break;case`bottom`:default:d=1,l=`y`,u=`height`;break}return s[l]+=d*(a[u]/2+i[r]),c[l]+=d*(o[u]/2+i[r]),d*(s[l]-c[l])>0?c[l]=s[l]:s[l]=c[l],[s.toJSON(),...e,c.toJSON()]};function Zf(e){return new B(e.x,e.y,0,0)}function Qf(e={}){let t=ya(e.padding||20);return{x:-t.left,y:-t.top,width:t.left+t.right,height:t.top+t.bottom}}function $f(e,t={}){return e.sourceBBox.clone().moveAndExpand(Qf(t))}function ep(e,t={}){return e.targetBBox.clone().moveAndExpand(Qf(t))}function tp(e,t={}){if(e.sourceAnchor)return e.sourceAnchor;let n=$f(e,t);return n.getCenter()}function np(e,t={}){if(e.targetAnchor)return e.targetAnchor;let n=ep(e,t);return n.getCenter()}const rp=function(e,t,n){let r=$f(n,t),i=ep(n,t),a=tp(n,t),o=np(n,t);r=r.union(Zf(a)),i=i.union(Zf(o));let s=e.map(e=>z.create(e));s.unshift(a),s.push(o);let c=null,l=[];for(let e=0,n=s.length-1;e<n;e+=1){let a=null,o=s[e],u=s[e+1],d=ip.getBearing(o,u)!=null;if(e===0)e+1===n?r.intersectsWithRect(i.clone().inflate(1))?a=ip.insideNode(o,u,r,i):d||(a=ip.nodeToNode(o,u,r,i)):r.containsPoint(u)?a=ip.insideNode(o,u,r,Zf(u).moveAndExpand(Qf(t))):d||(a=ip.nodeToVertex(o,u,r));else if(e+1===n){let e=d&&ip.getBearing(u,o)===c;i.containsPoint(o)||e?a=ip.insideNode(o,u,Zf(o).moveAndExpand(Qf(t)),i,c):d||(a=ip.vertexToNode(o,u,i,c))}else d||(a=ip.vertexToVertex(o,u,c));a?(l.push(...a.points),c=a.direction):c=ip.getBearing(o,u),e+1<n&&l.push(u)}return l};var ip;(function(e){let t={N:`S`,S:`N`,E:`W`,W:`E`},n={N:-Math.PI/2*3,S:-Math.PI/2,E:0,W:Math.PI};function r(e,t,n){let r=new z(e.x,t.y);return n.containsPoint(r)&&(r=new z(t.x,e.y)),r}function i(e,t){return e[t===`W`||t===`E`?`width`:`height`]}e.getBBoxSize=i;function a(e,t){return e.x===t.x?e.y>t.y?`N`:`S`:e.y===t.y?e.x>t.x?`W`:`E`:null}e.getBearing=a;function o(e,n,r){let i=new z(e.x,n.y),o=new z(n.x,e.y),s=a(e,i),c=a(e,o),l=r?t[r]:null,u=s===r||s!==l&&(c===l||c!==r)?i:o;return{points:[u],direction:a(u,n)}}e.vertexToVertex=o;function s(e,t,n){let i=r(e,t,n);return{points:[i],direction:a(i,t)}}e.nodeToVertex=s;function c(e,t,n,o){let s=[new z(e.x,t.y),new z(t.x,e.y)],c=s.filter(e=>!n.containsPoint(e)),l=c.filter(t=>a(t,e)!==o),u;if(l.length>0)return u=l.filter(t=>a(e,t)===o).pop(),u||=l[0],{points:[u],direction:a(u,t)};{u=Ar(s,c)[0];let l=z.create(t).move(u,-i(n,o)/2),d=r(l,e,n);return{points:[d,l],direction:a(l,t)}}}e.vertexToNode=c;function l(e,t,n,r){let c=s(t,e,r),l=c.points[0];if(n.containsPoint(l)){c=s(e,t,n);let u=c.points[0];if(r.containsPoint(u)){let d=z.create(e).move(u,-i(n,a(e,u))/2),f=z.create(t).move(l,-i(r,a(t,l))/2),p=new V(d,f).getCenter(),m=s(e,p,n),h=o(p,t,m.direction);c.points=[m.points[0],h.points[0]],c.direction=h.direction}}return c}e.nodeToNode=l;function u(e,t,i,o,s){let c=i.union(o).inflate(1),l=c.getCenter(),u=l.distance(t)>l.distance(e),d=u?t:e,f=u?e:t,p,m,h;s?(p=z.fromPolar(c.width+c.height,n[s],d),p=c.getNearestPointToPoint(p).move(p,-1)):p=c.getNearestPointToPoint(d).move(d,1),m=r(p,f,c);let g;p.round().equals(m.round())?(m=z.fromPolar(c.width+c.height,L.toRad(p.theta(d))+Math.PI/2,f),m=c.getNearestPointToPoint(m).move(f,1).round(),h=r(p,m,c),g=u?[m,h,p]:[p,h,m]):g=u?[m,p]:[p,m];let _=a(u?p:m,t);return{points:g,direction:_}}e.insideNode=u})(ip||={});const ap={step:10,maxLoopCount:2e3,precision:1,maxDirectionChange:90,perpendicular:!0,excludeTerminals:[],excludeNodes:[],excludeShapes:[],startDirections:[`top`,`right`,`bottom`,`left`],endDirections:[`top`,`right`,`bottom`,`left`],directionMap:{top:{x:0,y:-1},right:{x:1,y:0},bottom:{x:0,y:1},left:{x:-1,y:0}},cost(){let e=op(this.step,this);return e},directions(){let e=op(this.step,this),t=op(this.cost,this);return[{cost:t,offsetX:e,offsetY:0},{cost:t,offsetX:-e,offsetY:0},{cost:t,offsetX:0,offsetY:e},{cost:t,offsetX:0,offsetY:-e}]},penalties(){let e=op(this.step,this);return{0:0,45:e/2,90:e/2}},paddingBox(){let e=op(this.step,this);return{x:-e,y:-e,width:2*e,height:2*e}},fallbackRouter:rp,draggingRouter:null,snapToGrid:!0};function op(e,t){return typeof e==`function`?e.call(t):e}function sp(e){let t=Object.keys(e).reduce((t,n)=>{let r=t;return n===`fallbackRouter`||n===`draggingRouter`||n===`fallbackRoute`?r[n]=e[n]:r[n]=op(e[n],e),t},{});if(t.padding){let e=ya(t.padding);t.paddingBox={x:-e.left,y:-e.top,width:e.left+e.right,height:e.top+e.bottom}}return t.directions.forEach(e=>{let t=new z(0,0),n=new z(e.offsetX,e.offsetY);e.angle=L.normalize(t.theta(n))}),t}const cp=1,lp=2;var up=class{constructor(){this.items=[],this.hash={},this.values={}}add(e,t){this.hash[e]?this.items.splice(this.items.indexOf(e),1):this.hash[e]=cp,this.values[e]=t;let n=ki(this.items,e,e=>this.values[e]);this.items.splice(n,0,e)}pop(){let e=this.items.shift();return e&&(this.hash[e]=lp),e}isOpen(e){return this.hash[e]===cp}isClose(e){return this.hash[e]===lp}isEmpty(){return this.items.length===0}},dp=class{constructor(e){this.options=e,this.mapGridSize=100,this.map={}}build(e,t){let n=this.options,r=n.excludeTerminals.reduce((n,r)=>{let i=t[r];if(i){let t=e.getCell(i.cell);t&&n.push(t)}return n},[]),i=[],a=e.getCell(t.getSourceCellId());a&&(i=l(i,a.getAncestors().map(e=>e.id)));let o=e.getCell(t.getTargetCellId());o&&(i=l(i,o.getAncestors().map(e=>e.id)));let s=this.mapGridSize;return e.getNodes().reduce((e,t)=>{let a=r.some(e=>e.id===t.id),o=t.shape?n.excludeShapes.includes(t.shape):!1,c=n.excludeNodes.some(e=>typeof e==`string`?t.id===e:e===t),l=i.includes(t.id),u=o||a||c||l;if(t.isVisible()&&!u){let r=t.getBBox().moveAndExpand(n.paddingBox),i=r.getOrigin().snapToGrid(s),a=r.getCorner().snapToGrid(s);for(let t=i.x;t<=a.x;t+=s)for(let n=i.y;n<=a.y;n+=s){let i=new z(t,n).toString();e[i]??(e[i]=[]),e[i].push(r)}}return e},this.map),this}isAccessible(e){let t=e.clone().snapToGrid(this.mapGridSize).toString(),n=this.map[t];return n?n.every(t=>!t.containsPoint(e)):!0}};function fp(e,t){let n=e.sourceBBox.clone();return t&&t.paddingBox?n.moveAndExpand(t.paddingBox):n}function pp(e,t){let n=e.targetBBox.clone();return t&&t.paddingBox?n.moveAndExpand(t.paddingBox):n}function mp(e,t){if(e.sourceAnchor)return e.sourceAnchor;let n=fp(e,t);return n.getCenter()}function hp(e,t){if(e.targetAnchor)return e.targetAnchor;let n=pp(e,t);return n.getCenter()}function gp(e,t,n,r,i){let a=360/n,o=e.theta(_p(e,t,r,i)),s=L.normalize(o+a/2);return a*Math.floor(s/a)}function _p(e,t,n,r){let i=r.step,a=t.x-e.x,o=t.y-e.y,s=a/n.x,c=o/n.y,l=s*i,u=c*i;return new z(e.x+l,e.y+u)}function vp(e,t){let n=Math.abs(e-t);return n>180?360-n:n}function yp(e,t){let n=t.step;return t.directions.forEach(t=>{t.gridOffsetX=t.offsetX/n*e.x,t.gridOffsetY=t.offsetY/n*e.y}),t.directions}function bp(e,t,n){return{source:t.clone(),x:xp(n.x-t.x,e),y:xp(n.y-t.y,e)}}function xp(e,t){if(!e)return t;let n=Math.abs(e),r=Math.round(n/t);if(!r)return n;let i=r*t,a=n-i,o=a/r;return t+o}function Sp(e,t){let n=t.source,r=R.snapToGrid(e.x-n.x,t.x)+n.x,i=R.snapToGrid(e.y-n.y,t.y)+n.y;return new z(r,i)}function Cp(e,t){return e.round(t)}function wp(e,t,n){return Cp(Sp(e.clone(),t),n)}function Tp(e){return e.toString()}function Ep(e){return new z(e.x===0?0:Math.abs(e.x)/e.x,e.y===0?0:Math.abs(e.y)/e.y)}function Dp(e,t){let n=1/0;for(let r=0,i=t.length;r<i;r+=1){let i=e.manhattanDistance(t[r]);i<n&&(n=i)}return n}function Op(e,t,n,r,i){let a=i.precision,o=i.directionMap,s=e.diff(t.getCenter()),c=Object.keys(o).reduce((i,c)=>{if(n.includes(c)){let n=o[c],l=new z(e.x+n.x*(Math.abs(s.x)+t.width),e.y+n.y*(Math.abs(s.y)+t.height)),u=new V(e,l),d=u.intersect(t)||[],f,p=null;for(let t=0;t<d.length;t+=1){let n=d[t],r=e.squaredDistance(n);(f==null||r>f)&&(f=r,p=n)}if(p){let e=wp(p,r,a);t.containsPoint(e)&&(e=wp(e.translate(n.x*r.x,n.y*r.y),r,a)),i.push(e)}}return i},[]);return t.containsPoint(e)||c.push(wp(e,r,a)),c}function kp(e,t,n,r,i){let a=[],o=Ep(i.diff(n)),s=Tp(n),c=e[s],l;for(;c;){l=t[s];let n=Ep(l.diff(c));n.equals(o)||(a.unshift(l),o=n),s=Tp(c),c=e[s]}let u=t[s],d=Ep(u.diff(r));return d.equals(o)||a.unshift(u),a}function Ap(e,t,n,r,i){let a=i.precision,o,s;o=B.isRectangle(t)?Cp(mp(e,i).clone(),a):Cp(t.clone(),a),s=B.isRectangle(n)?Cp(hp(e,i).clone(),a):Cp(n.clone(),a);let c=bp(i.step,o,s),l=o,u=s,d,f;if(d=B.isRectangle(t)?Op(l,t,i.startDirections,c,i):[l],f=B.isRectangle(n)?Op(s,n,i.endDirections,c,i):[u],d=d.filter(e=>r.isAccessible(e)),f=f.filter(e=>r.isAccessible(e)),d.length>0&&f.length>0){let e=new up,t={},n={},o={};for(let n=0,r=d.length;n<r;n+=1){let r=d[n],i=Tp(r);e.add(i,Dp(r,f)),t[i]=r,o[i]=0}let s=i.previousDirectionAngle,p=s===void 0,m,h,g=yp(c,i),_=g.length,v=f.reduce((e,t)=>{let n=Tp(t);return e.push(n),e},[]),y=z.equalPoints(d,f),b=i.maxLoopCount;for(;!e.isEmpty()&&b>0;){let d=e.pop(),x=t[d],S=n[d],C=o[d],ee=x.equals(l),w=S==null,T;T=w?p?ee?null:gp(l,x,_,c,i):s:gp(S,x,_,c,i);let E=w&&y;if(!E&&v.indexOf(d)>=0)return i.previousDirectionAngle=T,kp(n,t,x,l,u);for(let s=0;s<_;s+=1){m=g[s];let l=m.angle;if(h=vp(T,l),!(p&&ee)&&h>i.maxDirectionChange)continue;let d=wp(x.clone().translate(m.gridOffsetX||0,m.gridOffsetY||0),c,a),y=Tp(d);if(e.isClose(y)||!r.isAccessible(d))continue;if(v.indexOf(y)>=0){let e=d.equals(u);if(!e){let e=gp(d,u,_,c,i),t=vp(l,e);if(t>i.maxDirectionChange)continue}}let b=m.cost,S=ee?0:i.penalties[h],w=C+b+S;(!e.isOpen(y)||w<o[y])&&(t[y]=d,n[y]=x,o[y]=w,e.add(y,w+Dp(d,f)))}--b}}return i.fallbackRoute?O(i.fallbackRoute,this,l,u,i):null}function jp(e,t=10){if(e.length<=1)return e;for(let n=0,r=e.length;n<r-1;n+=1){let r=e[n],i=e[n+1];if(r.x===i.x){let e=t*Math.round(r.x/t);r.x!==e&&(r.x=e,i.x=e)}else if(r.y===i.y){let e=t*Math.round(r.y/t);r.y!==e&&(r.y=e,i.y=e)}}return e}const Mp=function(e,t,n){let r=sp(t),i=fp(n,r),a=pp(n,r),o=mp(n,r),s=new dp(r).build(n.graph.model,n.cell),c=e.map(e=>z.create(e)),l=[],u=o,d,f;for(let t=0,p=c.length;t<=p;t+=1){let p=null;if(d=f||i,f=c[t],f==null){f=a;let e=n.cell,t=e.getSourceCellId()==null||e.getTargetCellId()==null;if(t&&typeof r.draggingRouter==`function`){let e=d===i?o:d,t=f.getOrigin();p=O(r.draggingRouter,n,e,t,r)}}if(p??=Ap(n,d,f,s,r),p===null)return console.warn(`Unable to execute manhattan algorithm, use orth instead`),O(r.fallbackRouter,this,e,r,n);let m=p[0];m&&m.equals(u)&&p.shift(),u=p[p.length-1]||u,l.push(...p)}return r.snapToGrid?jp(l,n.graph.grid.getGridSize()):l},Np=function(e,t,n){return O(Mp,this,e,Object.assign(Object.assign({},ap),t),n)},Pp={maxDirectionChange:45,directions(){let e=op(this.step,this),t=op(this.cost,this),n=Math.ceil(Math.sqrt(e*e<<1));return[{cost:t,offsetX:e,offsetY:0},{cost:n,offsetX:e,offsetY:e},{cost:t,offsetX:0,offsetY:e},{cost:n,offsetX:-e,offsetY:e},{cost:t,offsetX:-e,offsetY:0},{cost:n,offsetX:-e,offsetY:-e},{cost:t,offsetX:0,offsetY:-e},{cost:n,offsetX:e,offsetY:-e}]},fallbackRoute(e,t,n){let r=e.theta(t),i=[],a={x:t.x,y:e.y},o={x:e.x,y:t.y};if(r%180>90){let e=a;a=o,o=e}let s=r%90<45?a:o,c=new V(e,s),l=90*Math.ceil(r/90),u=z.fromPolar(c.squaredLength(),L.toRad(l+135),s),d=new V(t,u),f=c.intersectsWithLine(d),p=f||t,m=f?p:e,h=360/n.directions.length,g=m.theta(t),_=L.normalize(g+h/2),v=h*Math.floor(_/h);return n.previousDirectionAngle=v,p&&i.push(p.round()),i.push(t),i}},Fp=function(e,t,n){return O(Np,this,e,Object.assign(Object.assign({},Pp),t),n)},Ip=function(e,t,n){let r=t.offset||32,i=t.min==null?16:t.min,a=0,o=t.direction,s=n.sourceBBox,c=n.targetBBox,l=s.getCenter(),u=c.getCenter();if(typeof r==`number`&&(a=r),o==null){let e=c.left-s.right,t=c.top-s.bottom;e>=0&&t>=0?o=e>=t?`L`:`T`:e<=0&&t>=0?(e=s.left-c.right,o=e>=0&&e>=t?`R`:`T`):e>=0&&t<=0?(t=s.top-c.bottom,o=t>=0?e>=t?`L`:`B`:`L`):(e=s.left-c.right,t=s.top-c.bottom,o=e>=0&&t>=0?e>=t?`R`:`B`:e<=0&&t>=0?`B`:e>=0&&t<=0||Math.abs(e)>Math.abs(t)?`R`:`B`)}o===`H`?o=u.x-l.x>=0?`L`:`R`:o===`V`&&(o=u.y-l.y>=0?`T`:`B`),r===`center`&&(o===`L`?a=(c.left-s.right)/2:o===`R`?a=(s.left-c.right)/2:o===`T`?a=(c.top-s.bottom)/2:o===`B`&&(a=(s.top-c.bottom)/2));let d,f,p,m=o===`L`||o===`R`;if(m){if(u.y===l.y)return[...e];p=o===`L`?1:-1,d=`x`,f=`width`}else{if(u.x===l.x)return[...e];p=o===`T`?1:-1,d=`y`,f=`height`}let h=l.clone(),g=u.clone();if(h[d]+=p*(s[f]/2+a),g[d]-=p*(c[f]/2+a),m){let e=h.x,t=g.x,n=s.width/2+i,r=c.width/2+i;u.x>l.x?t<=e&&(h.x=Math.max(t,l.x+n),g.x=Math.min(e,u.x-r)):t>=e&&(h.x=Math.min(t,l.x-n),g.x=Math.max(e,u.x+r))}else{let e=h.y,t=g.y,n=s.height/2+i,r=c.height/2+i;u.y>l.y?t<=e&&(h.y=Math.max(t,l.y+n),g.y=Math.min(e,u.y-r)):t>=e&&(h.y=Math.min(t,l.y-n),g.y=Math.max(e,u.y+r))}return[h.toJSON(),...e,g.toJSON()]};function Lp(e,t){if(t!=null&&t!==!1){let n=typeof t==`boolean`?0:t;if(n>0){let t=z.create(e[1]).move(e[2],n),r=z.create(e[1]).move(e[0],n);return[t.toJSON(),...e,r.toJSON()]}{let t=e[1];return[Object.assign({},t),...e,Object.assign({},t)]}}return e}const Rp=function(e,t,n){let r=t.width||50,i=t.height||80,a=i/2,o=t.angle||`auto`,s=n.sourceAnchor,c=n.targetAnchor,l=n.sourceBBox,u=n.targetBBox;if(s.equals(c)){let e=e=>{let t=L.toRad(e),n=Math.sin(t),i=Math.cos(t),o=new z(s.x+i*r,s.y+n*r),c=new z(o.x-i*a,o.y-n*a),l=c.clone().rotate(-90,o),u=c.clone().rotate(90,o);return[l.toJSON(),o.toJSON(),u.toJSON()]},n=e=>{let t=s.clone().move(e,-1),n=new V(t,e);return!l.containsPoint(e)&&!l.intersectsWithLine(n)},i=[0,90,180,270,45,135,225,315];if(typeof o==`number`)return Lp(e(o),t.merge);let c=l.getCenter();if(c.equals(s))return Lp(e(0),t.merge);let u=c.angleBetween(s,c.clone().translate(1,0)),d=e(u);if(n(d[1]))return Lp(d,t.merge);for(let r=1,a=i.length;r<a;r+=1)if(d=e(u+i[r]),n(d[1]))return Lp(d,t.merge);return Lp(d,t.merge)}{let e=new V(s,c),i=e.parallel(-r),o=i.getCenter(),d=i.start.clone().move(i.end,a),f=i.end.clone().move(i.start,a),p=e.parallel(-1),m=new V(p.start,o),h=new V(p.end,o);if((l.containsPoint(o)||u.containsPoint(o)||l.intersectsWithLine(m)||l.intersectsWithLine(h)||u.intersectsWithLine(m)||u.intersectsWithLine(h))&&(i=e.parallel(r),o=i.getCenter(),d=i.start.clone().move(i.end,a),f=i.end.clone().move(i.start,a)),t.merge){let e=new V(s,c),t=new V(o,e.center).setLength(2**53-1),r=l.intersectsWithLine(t),i=u.intersectsWithLine(t),a=r?Array.isArray(r)?r:[r]:[];i&&(Array.isArray(i)?a.push(...i):a.push(i));let d=e.center.closest(a);d?(n.sourceAnchor=d.clone(),n.targetAnchor=d.clone()):(n.sourceAnchor=e.center.clone(),n.targetAnchor=e.center.clone())}return Lp([d.toJSON(),o.toJSON(),f.toJSON()],t.merge)}};var zp={};e(zp,{er:()=>Ip,loop:()=>Rp,manhattan:()=>Np,metro:()=>Fp,normal:()=>Yf,oneSide:()=>Xf,orth:()=>rp});var Bp;(function(e){e.presets=zp,e.registry=U.create({type:`router`}),e.registry.register(e.presets,!0)})(Bp||={});const Vp=function(e,t,n,r={}){let i=[e,...n,t],a=new yc(i),o=new H(a);return r.raw?o:o.serialize()},Hp=function(e,t,n,r={}){let i=n.length===3?0:1,a=z.create(n[0+i]),o=z.create(n[2+i]),s=z.create(n[1+i]);if(!z.equals(e,t)){let n=new z((e.x+t.x)/2,(e.y+t.y)/2),r=n.angleBetween(z.create(e).rotate(90,n),s);r>1&&(a.rotate(180-r,n),o.rotate(180-r,n),s.rotate(180-r,n))}let c=`
     M ${e.x} ${e.y}
     Q ${a.x} ${a.y} ${s.x} ${s.y}
     Q ${o.x} ${o.y} ${t.x} ${t.y}
  `;return r.raw?H.parse(c):c},Up=function(e,t,n,r={}){let i=new H;i.appendSegment(H.createSegment(`M`,e));let a=1/3,o=2/3,s=r.radius||10,c,l;for(let r=0,u=n.length;r<u;r+=1){let u=z.create(n[r]),d=n[r-1]||e,f=n[r+1]||t;c=l||u.distance(d)/2,l=u.distance(f)/2;let p=-Math.min(s,c),m=-Math.min(s,l),h=u.clone().move(d,p).round(),g=u.clone().move(f,m).round(),_=new z(a*h.x+o*u.x,o*u.y+a*h.y),v=new z(a*g.x+o*u.x,o*u.y+a*g.y);i.appendSegment(H.createSegment(`L`,h)),i.appendSegment(H.createSegment(`C`,_,v,g))}return i.appendSegment(H.createSegment(`L`,t)),r.raw?i:i.serialize()},Wp=function(e,t,n,r={}){let i,a=r.direction;if(n&&n.length!==0){let r=[e,...n,t],a=bc.throughPoints(r);i=new H(a)}else if(i=new H,i.appendSegment(H.createSegment(`M`,e)),a||=Math.abs(e.x-t.x)>=Math.abs(e.y-t.y)?`H`:`V`,a===`H`){let n=(e.x+t.x)/2;i.appendSegment(H.createSegment(`C`,n,e.y,n,t.y,t.x,t.y))}else{let n=(e.y+t.y)/2;i.appendSegment(H.createSegment(`C`,e.x,n,t.x,n,t.x,t.y))}return r.raw?i:i.serialize()},Gp=1,Kp=1/3,qp=2/3;function Jp(e){let t=e.graph._jumpOverUpdateList;if(t??(t=e.graph._jumpOverUpdateList=[],e.graph.on(`cell:mouseup`,()=>{let t=e.graph._jumpOverUpdateList;setTimeout(()=>{for(let e=0;e<t.length;e+=1)t[e].update()})}),e.graph.on(`model:reseted`,()=>{t=e.graph._jumpOverUpdateList=[]})),t.indexOf(e)<0){t.push(e);let n=()=>t.splice(t.indexOf(e),1);e.cell.once(`change:connector`,n),e.cell.once(`removed`,n)}}function Yp(e,t,n=[]){let r=[e,...n,t],i=[];return r.forEach((e,t)=>{let n=r[t+1];n!=null&&i.push(new V(e,n))}),i}function Xp(e,t){let n=[];return t.forEach(t=>{let r=e.intersectsWithLine(t);r&&n.push(r)}),n}function Zp(e,t){return new V(e,t).squaredLength()}function Qp(e,t,n){return t.reduce((r,i,a)=>{if(nm.includes(i))return r;let o=r.pop()||e,s=z.create(i).move(o.start,-n),c=z.create(i).move(o.start,+n),l=t[a+1];if(l!=null){let e=c.distance(l);e<=n&&(c=l.move(o.start,e),nm.push(l))}else{let e=s.distance(o.end);if(e<n*2+Gp)return r.push(o),r}let u=c.distance(o.start);if(u<n*2+Gp)return r.push(o),r;let d=new V(s,c);return tm.push(d),r.push(new V(o.start,s),d,new V(c,o.end)),r},[])}function $p(e,t,n,r){let i=new H,a;return a=H.createSegment(`M`,e[0].start),i.appendSegment(a),e.forEach((o,s)=>{if(tm.includes(o)){let e,r,s,c;if(n===`arc`){e=-90,r=o.start.diff(o.end);let t=r.x<0||r.x===0&&r.y<0;t&&(e+=180);let n=o.getCenter(),l=new V(n,o.end).rotate(e,n),u;u=new V(o.start,n),s=u.pointAt(2/3).rotate(e,o.start),c=l.pointAt(1/3).rotate(-e,l.end),a=H.createSegment(`C`,s,c,l.end),i.appendSegment(a),u=new V(n,o.end),s=l.pointAt(1/3).rotate(e,l.end),c=u.pointAt(1/3).rotate(-e,o.end),a=H.createSegment(`C`,s,c,o.end),i.appendSegment(a)}else if(n===`gap`)a=H.createSegment(`M`,o.end),i.appendSegment(a);else if(n===`cubic`){e=o.start.theta(o.end);let n=t*.6,l=t*1.35;r=o.start.diff(o.end);let u=r.x<0||r.x===0&&r.y<0;u&&(l*=-1),s=new z(o.start.x+n,o.start.y+l).rotate(e,o.start),c=new z(o.end.x-n,o.end.y+l).rotate(e,o.end),a=H.createSegment(`C`,s,c,o.end),i.appendSegment(a)}}else{let t=e[s+1];r===0||!t||tm.includes(t)?(a=H.createSegment(`L`,o.end),i.appendSegment(a)):em(r,i,o.end,o.start,t.end)}}),i}function em(e,t,n,r,i){let a=n.distance(r)/2,o=n.distance(i)/2,s=-Math.min(e,a),c=-Math.min(e,o),l=n.clone().move(r,s).round(),u=n.clone().move(i,c).round(),d=new z(Kp*l.x+qp*n.x,qp*n.y+Kp*l.y),f=new z(Kp*u.x+qp*n.x,qp*n.y+Kp*u.y),p;p=H.createSegment(`L`,l),t.appendSegment(p),p=H.createSegment(`C`,d,f,u),t.appendSegment(p)}let tm,nm;const rm=function(e,t,n,r={}){tm=[],nm=[],Jp(this);let i=r.size||5,a=r.type||`arc`,o=r.radius||0,s=r.ignoreConnectors||[`smooth`],c=this.graph,l=c.model,u=l.getEdges();if(u.length===1)return $p(Yp(e,t,n),i,a,o);let d=this.cell,f=u.indexOf(d),p=c.options.connecting.connector||{},m=u.filter((e,t)=>{let n=e.getConnector()||p;return s.includes(n.name)?!1:t>f?n.name!==`jumpover`:!0}),h=m.map(e=>c.findViewByCell(e)),g=Yp(e,t,n),_=h.map(e=>e==null?[]:e===this?g:Yp(e.sourcePoint,e.targetPoint,e.routePoints)),v=[];g.forEach(e=>{let t=m.reduce((t,n,r)=>{if(n!==d){let n=Xp(e,_[r]);t.push(...n)}return t},[]).sort((t,n)=>Zp(e.start,t)-Zp(e.start,n));t.length>0?v.push(...Qp(e,t,i)):v.push(e)});let y=$p(v,i,a,o);return tm=[],nm=[],r.raw?y:y.serialize()};var im={};e(im,{jumpover:()=>rm,loop:()=>Hp,normal:()=>Vp,rounded:()=>Up,smooth:()=>Wp});var am;(function(e){e.presets=im,e.registry=U.create({type:`connector`}),e.registry.register(e.presets,!0)})(am||={});var om=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},sm=class extends ia{constructor(e={}){super(),this.pending=!1,this.changing=!1,this.data={},this.mutate(y(e)),this.changed={}}mutate(e,t={}){let n=t.unset===!0,r=t.silent===!0,a=[],o=this.changing;this.changing=!0,o||(this.previous=y(this.data),this.changed={});let s=this.data,c=this.previous,l=this.changed;if(Object.keys(e).forEach(t=>{let r=t,o=e[r];i(s[r],o)||a.push(r),i(c[r],o)?delete l[r]:l[r]=o,n?delete s[r]:s[r]=o}),!r&&a.length>0&&(this.pending=!0,this.pendingOptions=t,a.forEach(e=>{this.emit(`change:*`,{key:e,options:t,store:this,current:s[e],previous:c[e]})})),o)return this;if(!r)for(;this.pending;)this.pending=!1,this.emit(`changed`,{current:s,previous:c,store:this,options:this.pendingOptions});return this.pending=!1,this.changing=!1,this.pendingOptions=null,this}get(e,t){if(e==null)return this.data;let n=this.data[e];return n??t}getPrevious(e){if(this.previous){let t=this.previous[e];return t??void 0}}set(e,t,n){return e!=null&&(typeof e==`object`?this.mutate(e,t):this.mutate({[e]:t},n)),this}remove(e,t){let n,r={},i;if(typeof e==`string`)r[e]=n,i=t;else if(Array.isArray(e))e.forEach(e=>r[e]=n),i=t;else{for(let e in this.data)r[e]=n;i=e}return this.mutate(r,Object.assign(Object.assign({},i),{unset:!0})),this}getByPath(e){return ea(this.data,e,`/`)}setByPath(e,t,n={}){let r=`/`,i=Array.isArray(e)?[...e]:e.split(r),a=Array.isArray(e)?e.join(r):e,o=i[0],s=i.length;if(n.propertyPath=a,n.propertyValue=t,n.propertyPathArray=i,s===1)this.set(o,t,n);else{let a={},c=a,l=o;for(let e=1;e<s;e+=1){let t=i[e],n=Number.isFinite(Number(t));c=c[l]=n?[]:{},l=t}ta(a,i,t,r);let u=y(this.data);n.rewrite&&na(u,e,r);let d=v(u,a);this.set(o,d[o],n)}return this}removeByPath(e,t){let n=Array.isArray(e)?e:e.split(`/`),r=n[0];if(n.length===1)this.remove(r,t);else{let e=n.slice(1),i=y(this.get(r));i&&na(i,e),this.set(r,i,t)}return this}hasChanged(e){return e==null?Object.keys(this.changed).length>0:e in this.changed}getChanges(e){if(e==null)return this.hasChanged()?y(this.changed):null;let t=this.changing?this.previous:this.data,n={},r;for(let a in e){let o=e[a];i(t[a],o)||(n[a]=o,r=!0)}return r?y(n):null}toJSON(){return y(this.data)}clone(){let e=this.constructor;return new e(this.data)}dispose(){this.off(),this.data={},this.previous={},this.changed={},this.pending=!1,this.changing=!1,this.pendingOptions=null,this.trigger(`disposed`,{store:this})}};om([ia.dispose()],sm.prototype,`dispose`,null);var cm=class e{constructor(e){this.cell=e,this.ids={},this.cache={}}get(){return Object.keys(this.ids)}start(t,n,r={},i=`/`){let a=this.cell.getPropByPath(t),o=yr(r,e.defaultOptions),s=this.getTiming(o.timing),c=this.getInterp(o.interp,a,n),l=0,u=Array.isArray(t)?t.join(i):t,d=Array.isArray(t)?t:t.split(i),f=()=>{let e=new Date().getTime();l===0&&(l=e);let t=e-l,n=t/o.duration;n<1?this.ids[u]=requestAnimationFrame(f):n=1;let i=c(s(n));this.cell.setPropByPath(d,i),r.progress&&r.progress(Object.assign({progress:n,currentValue:i},this.getArgs(u))),n===1&&(this.cell.notify(`transition:complete`,this.getArgs(u)),r.complete&&r.complete(this.getArgs(u)),this.cell.notify(`transition:finish`,this.getArgs(u)),r.finish&&r.finish(this.getArgs(u)),this.clean(u))};return setTimeout(()=>{this.stop(t,void 0,i),this.cache[u]={startValue:a,targetValue:n,options:o},this.ids[u]=requestAnimationFrame(f),this.cell.notify(`transition:start`,this.getArgs(u)),r.start&&r.start(this.getArgs(u))},r.delay),this.stop.bind(this,t,i,r)}stop(e,t={},n=`/`){let r=Array.isArray(e)?e:e.split(n);return Object.keys(this.ids).filter(e=>i(r,e.split(n).slice(0,r.length))).forEach(e=>{cancelAnimationFrame(this.ids[e]);let n=this.cache[e],r=this.getArgs(e),i=Object.assign(Object.assign({},n.options),t),a=i.jumpedToEnd;a&&n.targetValue!=null&&(this.cell.setPropByPath(e,n.targetValue),this.cell.notify(`transition:end`,Object.assign({},r)),this.cell.notify(`transition:complete`,Object.assign({},r)),i.complete&&i.complete(Object.assign({},r)));let o=Object.assign({jumpedToEnd:a},r);this.cell.notify(`transition:stop`,Object.assign({},o)),i.stop&&i.stop(Object.assign({},o)),this.cell.notify(`transition:finish`,Object.assign({},r)),i.finish&&i.finish(Object.assign({},r)),this.clean(e)}),this}clean(e){delete this.ids[e],delete this.cache[e]}getTiming(e){return typeof e==`string`?ac[e]:e}getInterp(e,t,n){return e?e(t,n):typeof n==`number`?oc.number(t,n):typeof n==`string`?n[0]===`#`?oc.color(t,n):oc.unit(t,n):oc.object(t,n)}getArgs(e){let t=this.cache[e];return{path:e,startValue:t.startValue,targetValue:t.targetValue,cell:this.cell}}};(function(e){e.defaultOptions={delay:10,duration:100,timing:`linear`}})(cm||={});var lm=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},um=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(e!=null&&typeof Object.getOwnPropertySymbols==`function`)for(var i=0,r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]]);return n},Y=class e extends ia{static config(e){let{markup:t,propHooks:n,attrHooks:r}=e,i=um(e,[`markup`,`propHooks`,`attrHooks`]);t!=null&&(this.markup=t),n&&(this.propHooks=this.propHooks.slice(),Array.isArray(n)?this.propHooks.push(...n):typeof n==`function`?this.propHooks.push(n):Object.values(n).forEach(e=>{typeof e==`function`&&this.propHooks.push(e)})),r&&(this.attrHooks=Object.assign(Object.assign({},this.attrHooks),r)),this.defaults=v({},this.defaults,i)}static getMarkup(){return this.markup}static getDefaults(e){return e?this.defaults:y(this.defaults)}static getAttrHooks(){return this.attrHooks}static applyPropHooks(e,t){return this.propHooks.reduce((t,n)=>n?O(n,e,t):t,t)}get[Symbol.toStringTag](){return e.toStringTag}constructor(e={}){super();let t=this.constructor,n=t.getDefaults(!0),r=v({},this.preprocess(n),this.preprocess(e));this.id=r.id||ma(),this.store=new sm(r),this.animation=new cm(this),this.setup(),this.init(),this.postprocess(e)}init(){}get model(){return this._model}set model(e){this._model!==e&&(this._model=e)}preprocess(e,t){let n=e.id,r=this.constructor,i=r.applyPropHooks(this,e);return n==null&&t!==!0&&(i.id=ma()),i}postprocess(e){}setup(){this.store.on(`change:*`,e=>{let{key:t,current:n,previous:r,options:i}=e;this.notify(`change:*`,{key:t,options:i,current:n,previous:r,cell:this}),this.notify(`change:${t}`,{options:i,current:n,previous:r,cell:this});let a=t;(a===`source`||a===`target`)&&this.notify(`change:terminal`,{type:a,current:n,previous:r,options:i,cell:this})}),this.store.on(`changed`,({options:e})=>this.notify(`changed`,{options:e,cell:this}))}notify(e,t){this.trigger(e,t);let n=this.model;return n&&(n.notify(`cell:${e}`,t),this.isNode()?n.notify(`node:${e}`,Object.assign(Object.assign({},t),{node:this})):this.isEdge()&&n.notify(`edge:${e}`,Object.assign(Object.assign({},t),{edge:this}))),this}isNode(){return!1}isEdge(){return!1}isSameStore(e){return this.store===e.store}get view(){return this.store.get(`view`)}get shape(){return this.store.get(`shape`,``)}getProp(e,t){return e==null?this.store.get():this.store.get(e,t)}setProp(e,t,n){if(typeof e==`string`)this.store.set(e,t,n);else{let n=this.preprocess(e,!0);this.store.set(v({},this.getProp(),n),t),this.postprocess(e)}return this}removeProp(e,t){return typeof e==`string`||Array.isArray(e)?this.store.removeByPath(e,t):this.store.remove(t),this}hasChanged(e){return e==null?this.store.hasChanged():this.store.hasChanged(e)}getPropByPath(e){return this.store.getByPath(e)}setPropByPath(e,t,n={}){return this.model&&(e===`children`?this._children=t?t.map(e=>this.model.getCell(e)).filter(e=>e!=null):null:e===`parent`&&(this._parent=t?this.model.getCell(t):null)),this.store.setByPath(e,t,n),this}removePropByPath(e,t={}){let n=Array.isArray(e)?e:e.split(`/`);return n[0]===`attrs`&&(t.dirty=!0),this.store.removeByPath(n,t),this}prop(e,t,n){return e==null?this.getProp():typeof e==`string`||Array.isArray(e)?arguments.length===1?this.getPropByPath(e):t==null?this.removePropByPath(e,n||{}):this.setPropByPath(e,t,n||{}):this.setProp(e,t||{})}previous(e){return this.store.getPrevious(e)}get zIndex(){return this.getZIndex()}set zIndex(e){e==null?this.removeZIndex():this.setZIndex(e)}getZIndex(){return this.store.get(`zIndex`)}setZIndex(e,t={}){return this.store.set(`zIndex`,e,t),this}removeZIndex(e={}){return this.store.remove(`zIndex`,e),this}toFront(e={}){let t=this.model;if(t){let n=t.getMaxZIndex(),r;e.deep?(r=this.getDescendants({deep:!0,breadthFirst:!0}),r.unshift(this)):r=[this],n=n-r.length+1;let i=t.total(),a=t.indexOf(this)!==i-r.length;a||=r.some((e,t)=>e.getZIndex()!==n+t),a&&this.batchUpdate(`to-front`,()=>{n+=r.length,r.forEach((t,r)=>{t.setZIndex(n+r,e)})})}return this}toBack(e={}){let t=this.model;if(t){let n=t.getMinZIndex(),r;e.deep?(r=this.getDescendants({deep:!0,breadthFirst:!0}),r.unshift(this)):r=[this];let i=t.indexOf(this)!==0;i||=r.some((e,t)=>e.getZIndex()!==n+t),i&&this.batchUpdate(`to-back`,()=>{n-=r.length,r.forEach((t,r)=>{t.setZIndex(n+r,e)})})}return this}get markup(){return this.getMarkup()}set markup(e){e==null?this.removeMarkup():this.setMarkup(e)}getMarkup(){let e=this.store.get(`markup`);if(e==null){let t=this.constructor;e=t.getMarkup()}return e}setMarkup(e,t={}){return this.store.set(`markup`,e,t),this}removeMarkup(e={}){return this.store.remove(`markup`,e),this}get attrs(){return this.getAttrs()}set attrs(e){e==null?this.removeAttrs():this.setAttrs(e)}getAttrs(){let e=this.store.get(`attrs`);return e?Object.assign({},e):{}}setAttrs(e,t={}){if(e==null)this.removeAttrs(t);else{let n=e=>this.store.set(`attrs`,e,t);if(t.overwrite===!0)n(e);else{let r=this.getAttrs();t.deep===!1?n(Object.assign(Object.assign({},r),e)):n(v({},r,e))}}return this}replaceAttrs(e,t={}){return this.setAttrs(e,Object.assign(Object.assign({},t),{overwrite:!0}))}updateAttrs(e,t={}){return this.setAttrs(e,Object.assign(Object.assign({},t),{deep:!1}))}removeAttrs(e={}){return this.store.remove(`attrs`,e),this}getAttrDefinition(e){if(!e)return null;let t=this.constructor,n=t.getAttrHooks()||{},r=n[e]||Ru.registry.get(e);if(!r){let t=ar(e);r=n[t]||Ru.registry.get(t)}return r||null}getAttrByPath(e){return e==null||e===``?this.getAttrs():this.getPropByPath(this.prefixAttrPath(e))}setAttrByPath(e,t,n={}){return this.setPropByPath(this.prefixAttrPath(e),t,n),this}removeAttrByPath(e,t={}){return this.removePropByPath(this.prefixAttrPath(e),t),this}prefixAttrPath(e){return Array.isArray(e)?[`attrs`].concat(e):`attrs/${e}`}attr(e,t,n){return e==null?this.getAttrByPath():typeof e==`string`||Array.isArray(e)?arguments.length===1?this.getAttrByPath(e):t==null?this.removeAttrByPath(e,n||{}):this.setAttrByPath(e,t,n||{}):this.setAttrs(e,t||{})}get visible(){return this.isVisible()}set visible(e){this.setVisible(e)}setVisible(e,t={}){return this.store.set(`visible`,e,t),this}isVisible(){return this.store.get(`visible`)!==!1}show(e={}){return this.isVisible()||this.setVisible(!0,e),this}hide(e={}){return this.isVisible()&&this.setVisible(!1,e),this}toggleVisible(e,t={}){let n=typeof e==`boolean`?e:!this.isVisible(),r=typeof e==`boolean`?t:e;return n?this.show(r):this.hide(r),this}get data(){return this.getData()}set data(e){this.setData(e)}getData(){return this.store.get(`data`)}setData(e,t={}){if(e==null)this.removeData(t);else{let n=e=>this.store.set(`data`,e,t);if(t.overwrite===!0)n(e);else{let r=this.getData();t.deep===!1?n(typeof e==`object`?Object.assign(Object.assign({},r),e):e):n(v({},r,e))}}return this}replaceData(e,t={}){return this.setData(e,Object.assign(Object.assign({},t),{overwrite:!0}))}updateData(e,t={}){return this.setData(e,Object.assign(Object.assign({},t),{deep:!1}))}removeData(e={}){return this.store.remove(`data`,e),this}get parent(){return this.getParent()}get children(){return this.getChildren()}getParentId(){return this.store.get(`parent`)}getParent(){let e=this.getParentId();if(e&&this.model){let t=this.model.getCell(e);return this._parent=t,t}return null}getChildren(){let e=this.store.get(`children`);if(e&&e.length&&this.model){let t=e.map(e=>{var t;return(t=this.model)?.getCell(e)}).filter(e=>e!=null);return this._children=t,[...t]}return null}hasParent(){return this.parent!=null}isParentOf(e){return e!=null&&e.getParent()===this}isChildOf(e){return e!=null&&this.getParent()===e}eachChild(e,t){return this.children&&this.children.forEach(e,t),this}filterChild(e,t){return this.children?this.children.filter(e,t):[]}getChildCount(){return this.children==null?0:this.children.length}getChildIndex(e){return this.children==null?-1:this.children.indexOf(e)}getChildAt(e){return this.children!=null&&e>=0?this.children[e]:null}getAncestors(e={}){let t=[],n=this.getParent();for(;n;)t.push(n),n=e.deep===!1?null:n.getParent();return t}getDescendants(e={}){if(e.deep!==!1){if(e.breadthFirst){let e=[],t=this.getChildren()||[];for(;t.length>0;){let n=t.shift(),r=n.getChildren();e.push(n),r&&t.push(...r)}return e}{let t=this.getChildren()||[];return t.forEach(n=>{t.push(...n.getDescendants(e))}),t}}return this.getChildren()||[]}isDescendantOf(e,t={}){if(e==null)return!1;if(t.deep!==!1){let t=this.getParent();for(;t;){if(t===e)return!0;t=t.getParent()}return!1}return this.isChildOf(e)}isAncestorOf(e,t={}){return e==null?!1:e.isDescendantOf(this,t)}contains(e){return this.isAncestorOf(e)}getCommonAncestor(...t){return e.getCommonAncestor(this,...t)}setParent(e,t={}){return this._parent=e,e?this.store.set(`parent`,e.id,t):this.store.remove(`parent`,t),this}setChildren(e,t={}){return this._children=e,e==null?this.store.remove(`children`,t):this.store.set(`children`,e.map(e=>e.id),t),this}unembed(e,t={}){let n=this.children;if(n!=null&&e!=null){let r=this.getChildIndex(e);r!==-1&&(n.splice(r,1),e.setParent(null,t),this.setChildren(n,t))}return this}embed(e,t={}){return e.addTo(this,t),this}addTo(t,n={}){return e.isCell(t)?t.addChild(this,n):t.addCell(this,n),this}insertTo(e,t,n={}){return e.insertChild(this,t,n),this}addChild(e,t={}){return this.insertChild(e,void 0,t)}insertChild(e,t,n={}){if(e!=null&&e!==this){let r=e.getParent(),i=this!==r,a=t;if(a??(a=this.getChildCount(),i||--a),r){let t=r.getChildren();if(t){let i=t.indexOf(e);i>=0&&(e.setParent(null,n),t.splice(i,1),r.setChildren(t,n))}}let o=this.children;if(o==null?(o=[],o.push(e)):o.splice(a,0,e),e.setParent(this,n),this.setChildren(o,n),i&&this.model){let e=this.model.getIncomingEdges(this),t=this.model.getOutgoingEdges(this);e&&e.forEach(e=>e.updateParent(n)),t&&t.forEach(e=>e.updateParent(n))}this.model&&this.model.addCell(e,n)}return this}removeFromParent(e={}){let t=this.getParent();if(t!=null){let n=t.getChildIndex(this);t.removeChildAt(n,e)}return this}removeChild(e,t={}){let n=this.getChildIndex(e);return this.removeChildAt(n,t)}removeChildAt(e,t={}){let n=this.getChildAt(e),r=this.children;return r!=null&&n!=null&&(this.unembed(n,t),n.remove(t)),n}remove(e={}){return this.batchUpdate(`remove`,()=>{let t=this.getParent();t&&t.removeChild(this,e),e.deep!==!1&&this.eachChild(t=>t.remove(e)),this.model&&this.model.removeCell(this,e)}),this}transition(e,t,n={},r=`/`){return this.animation.start(e,t,n,r)}stopTransition(e,t,n=`/`){return this.animation.stop(e,t,n),this}getTransitions(){return this.animation.get()}translate(e,t,n){return this}scale(e,t,n,r){return this}addTools(e,t,n){let r=Array.isArray(e)?e:[e],i=typeof t==`string`?t:null,a=typeof t==`object`?t:typeof n==`object`?n:{};if(a.reset)return this.setTools({name:i,items:r,local:a.local},a);let o=y(this.getTools());if(o==null||i==null||o.name===i)return o??={},o.items||=[],o.name=i,o.items=[...o.items,...r],this.setTools(Object.assign({},o),a)}setTools(t,n={}){return t==null?this.removeTools():this.store.set(`tools`,e.normalizeTools(t),n),this}getTools(){return this.store.get(`tools`)}removeTools(e={}){return this.store.remove(`tools`,e),this}hasTools(e){let t=this.getTools();return t==null?!1:e==null?!0:t.name===e}hasTool(e){let t=this.getTools();return t==null?!1:t.items.some(t=>typeof t==`string`?t===e:t.name===e)}removeTool(e,t={}){let n=y(this.getTools());if(n){let r=!1,i=n.items.slice(),a=e=>{i.splice(e,1),r=!0};if(typeof e==`number`)a(e);else for(let t=i.length-1;t>=0;--t){let n=i[t],r=typeof n==`string`?n===e:n.name===e;r&&a(t)}r&&(n.items=i,this.setTools(n,t))}return this}getBBox(e){return new B}getConnectionPoint(e,t){return new z}toJSON(e={}){let t=Object.assign({},this.store.get()),n=Object.prototype.toString,r=this.isNode()?`node`:this.isEdge()?`edge`:`cell`;if(!t.shape){let e=this.constructor;throw Error(`Unable to serialize ${r} missing "shape" prop, check the ${r} "${e.name||n.call(e)}"`)}let a=this.constructor,o=e.diff===!0,s=t.attrs||{},c=a.getDefaults(!0),l=o?this.preprocess(c,!0):c,u=l.attrs||{},d={};Object.entries(t).forEach(([e,a])=>{if(a!=null&&!Array.isArray(a)&&typeof a==`object`&&!_(a))throw Error(`Can only serialize ${r} with plain-object props, but got a "${n.call(a)}" type of key "${e}" on ${r} "${this.id}"`);if(e!==`attrs`&&e!==`shape`&&o){let n=l[e];i(a,n)&&delete t[e]}}),Object.keys(s).forEach(e=>{let t=s[e],n=u[e];Object.keys(t).forEach(r=>{let a=t[r],o=n?n[r]:null;typeof a==`object`&&a&&!Array.isArray(a)?Object.keys(a).forEach(t=>{let s=a[t];if(n==null||o==null||!ke(o)||!i(o[t],s)){d[e]??(d[e]={}),d[e][r]??(d[e][r]={});let n=d[e][r];n[t]=s}}):(n==null||!i(o,a))&&(d[e]??(d[e]={}),d[e][r]=a)})});let f=Object.assign(Object.assign({},t),{attrs:Jr(d)?void 0:d});f.attrs??delete f.attrs;let p=f;return p.angle===0&&delete p.angle,y(p)}clone(t={}){if(!t.deep){let e=Object.assign({},this.store.get());t.keepId||delete e.id,delete e.parent,delete e.children;let n=this.constructor;return new n(e)}let n=e.deepClone(this);return n[this.id]}findView(e){return e.findViewByCell(this)}startBatch(e,t={},n=this.model){return this.notify(`batch:start`,{name:e,data:t,cell:this}),n&&n.startBatch(e,Object.assign(Object.assign({},t),{cell:this})),this}stopBatch(e,t={},n=this.model){return n&&n.stopBatch(e,Object.assign(Object.assign({},t),{cell:this})),this.notify(`batch:stop`,{name:e,data:t,cell:this}),this}batchUpdate(e,t,n){let r=this.model;this.startBatch(e,n,r);let i=t();return this.stopBatch(e,n,r),i}dispose(){this.removeFromParent(),this.store.dispose()}};Y.defaults={},Y.attrHooks={},Y.propHooks=[],lm([ia.dispose()],Y.prototype,`dispose`,null),function(e){function t(e){return typeof e==`string`?{items:[e]}:Array.isArray(e)?{items:e}:e.items?e:{items:[e]}}e.normalizeTools=t}(Y||={}),function(e){e.toStringTag=`X6.${e.name}`;function t(t){if(t==null)return!1;if(t instanceof e)return!0;let n=t[Symbol.toStringTag],r=t;return(n==null||n===e.toStringTag)&&typeof r.isNode==`function`&&typeof r.isEdge==`function`&&typeof r.prop==`function`&&typeof r.attr==`function`}e.isCell=t}(Y||={}),function(e){function t(...e){let t=e.filter(e=>e!=null).map(e=>e.getAncestors()).sort((e,t)=>e.length-t.length),n=t.shift();return n.find(e=>t.every(t=>t.includes(e)))||null}e.getCommonAncestor=t;function n(e,t={}){let n=null;for(let r=0,i=e.length;r<i;r+=1){let i=e[r],a=i.getBBox(t);if(a){if(i.isNode()){let e=i.getAngle();e!=null&&e!==0&&(a=a.bbox(e))}n=n==null?a:n.union(a)}}return n}e.getCellsBBox=n;function r(t){let n=[t,...t.getDescendants({deep:!0})];return e.cloneCells(n)}e.deepClone=r;function i(e){let t=Ii(e),n=t.reduce((e,t)=>(e[t.id]=t.clone(),e),{});return t.forEach(e=>{let t=n[e.id];if(t.isEdge()){let e=t.getSourceCellId(),r=t.getTargetCellId();e&&n[e]&&t.setSource(Object.assign(Object.assign({},t.getSource()),{cell:n[e].id})),r&&n[r]&&t.setTarget(Object.assign(Object.assign({},t.getTarget()),{cell:n[r].id}))}let r=e.getParent();r&&n[r.id]&&t.setParent(n[r.id]);let i=e.getChildren();if(i&&i.length){let e=i.reduce((e,t)=>(n[t.id]&&e.push(n[t.id]),e),[]);e.length>0&&t.setChildren(e)}}),n}e.cloneCells=i}(Y||={}),function(e){e.config({propHooks(t){var{tools:n}=t,r=um(t,[`tools`]);return n&&(r.tools=e.normalizeTools(n)),r}})}(Y||={});var dm;(function(e){let t,n;function r(e,r){return r?t!=null&&t.exist(e):n!=null&&n.exist(e)}e.exist=r;function i(e){t=e}e.setEdgeRegistry=i;function a(e){n=e}e.setNodeRegistry=a})(dm||={});var fm=class{constructor(e){this.ports=[],this.groups={},this.init(y(e))}getPorts(){return this.ports}getGroup(e){return e==null?null:this.groups[e]}getPortsByGroup(e){return this.ports.filter(t=>t.group===e||t.group==null&&e==null)}getPortsLayoutByGroup(e,t){let n=this.getPortsByGroup(e),r=e?this.getGroup(e):null,i=r?r.position:null,a=i?i.name:null,o;if(a!=null){let e=cd.registry.get(a);if(e==null)return cd.registry.onNotFound(a);o=e}else o=cd.presets.left;let s=n.map(e=>e&&e.position&&e.position.args||{}),c=i&&i.args||{},l=o(s,t,c);return l.map((e,r)=>{let i=n[r];return{portLayout:e,portId:i.id,portSize:i.size,portAttrs:i.attrs,labelSize:i.label.size,labelLayout:this.getPortLabelLayout(i,z.create(e.position),t)}})}init(e){let{groups:t,items:n}=e;t!=null&&Object.keys(t).forEach(e=>{this.groups[e]=this.parseGroup(t[e])}),Array.isArray(n)&&n.forEach(e=>{this.ports.push(this.parsePort(e))})}parseGroup(e){return Object.assign(Object.assign({},e),{label:this.getLabel(e,!0),position:this.getPortPosition(e.position,!0)})}parsePort(e){let t=Object.assign({},e),n=this.getGroup(e.group)||{};return t.markup=t.markup||n.markup,t.attrs=v({},n.attrs,t.attrs),t.position=this.createPosition(n,t),t.label=v({},n.label,this.getLabel(t)),t.zIndex=this.getZIndex(n,t),t.size=Object.assign(Object.assign({},n.size),t.size),t}getZIndex(e,t){return typeof t.zIndex==`number`?t.zIndex:typeof e.zIndex==`number`||e.zIndex===`auto`?e.zIndex:`auto`}createPosition(e,t){return v({name:`left`,args:{}},e.position,{args:t.args})}getPortPosition(e,t=!1){if(e==null){if(t)return{name:`left`,args:{}}}else{if(typeof e==`string`)return{name:e,args:{}};if(Array.isArray(e))return{name:`absolute`,args:{x:e[0],y:e[1]}};if(typeof e==`object`)return e}return{args:{}}}getPortLabelPosition(e,t=!1){if(e==null){if(t)return{name:`left`,args:{}}}else{if(typeof e==`string`)return{name:e,args:{}};if(typeof e==`object`)return e}return{args:{}}}getLabel(e,t=!1){let n=e.label||{};return n.position=this.getPortLabelPosition(n.position,t),n}getPortLabelLayout(e,t,n){let r=e.label.position.name||`left`,i=e.label.position.args||{},a=Dd.registry.get(r)||Dd.presets.left;return a?a(t,n,i):null}},pm=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(e!=null&&typeof Object.getOwnPropertySymbols==`function`)for(var i=0,r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]]);return n},X=class e extends Y{get[Symbol.toStringTag](){return e.toStringTag}constructor(e={}){super(e),this.initPorts()}preprocess(e,t){let{x:n,y:r,width:i,height:a}=e,o=pm(e,[`x`,`y`,`width`,`height`]);if(n!=null||r!=null){let e=o.position;o.position=Object.assign(Object.assign({},e),{x:n??(e?e.x:0),y:r??(e?e.y:0)})}if(i!=null||a!=null){let e=o.size;o.size=Object.assign(Object.assign({},e),{width:i??(e?e.width:0),height:a??(e?e.height:0)})}return super.preprocess(o,t)}isNode(){return!0}size(e,t,n){return e===void 0?this.getSize():typeof e==`number`?this.setSize(e,t,n):this.setSize(e,t)}getSize(){let e=this.store.get(`size`);return e?Object.assign({},e):{width:1,height:1}}setSize(e,t,n){return typeof e==`object`?this.resize(e.width,e.height,t):this.resize(e,t,n),this}resize(e,t,n={}){this.startBatch(`resize`,n);let r=n.direction;if(r){let i=this.getSize();switch(r){case`left`:case`right`:t=i.height;break;case`top`:case`bottom`:e=i.width;break;default:break}let a={right:0,"top-right":0,top:1,"top-left":1,left:2,"bottom-left":2,bottom:3,"bottom-right":3},o=a[r],s=L.normalize(this.getAngle()||0);n.absolute&&(o+=Math.floor((s+45)/90),o%=4);let c=this.getBBox(),l;l=o===0?c.getBottomLeft():o===1?c.getCorner():o===2?c.getTopRight():c.getOrigin();let u=l.clone().rotate(-s,c.getCenter()),d=Math.sqrt(e*e+t*t)/2,f=o*Math.PI/2;f+=Math.atan(o%2==0?t/e:e/t),f-=L.toRad(s);let p=z.fromPolar(d,f,u),m=p.clone().translate(e/-2,t/-2);this.store.set(`size`,{width:e,height:t},n),this.setPosition(m.x,m.y,n)}else this.store.set(`size`,{width:e,height:t},n);return this.stopBatch(`resize`,n),this}scale(e,t,n,r={}){let i=this.getBBox().scale(e,t,n??void 0);return this.startBatch(`scale`,r),this.setPosition(i.x,i.y,r),this.resize(i.width,i.height,r),this.stopBatch(`scale`),this}position(e,t,n){return typeof e==`number`?this.setPosition(e,t,n):this.getPosition(e)}getPosition(e={}){if(e.relative){let e=this.getParent();if(e!=null&&e.isNode()){let t=this.getPosition(),n=e.getPosition();return{x:t.x-n.x,y:t.y-n.y}}}let t=this.store.get(`position`);return t?Object.assign({},t):{x:0,y:0}}setPosition(e,t,n={}){let r,i,a;if(typeof e==`object`?(r=e.x,i=e.y,a=t||{}):(r=e,i=t,a=n||{}),a.relative){let e=this.getParent();if(e!=null&&e.isNode()){let t=e.getPosition();r+=t.x,i+=t.y}}if(a.deep){let e=this.getPosition();this.translate(r-e.x,i-e.y,a)}else this.store.set(`position`,{x:r,y:i},a);return this}translate(e=0,t=0,n={}){if(e===0&&t===0)return this;n.translateBy=n.translateBy||this.id;let r=this.getPosition();if(n.restrict!=null&&n.translateBy===this.id){let i=this.getBBox({deep:!0}),a=n.restrict,o=r.x-i.x,s=r.y-i.y,c=Math.max(a.x+o,Math.min(a.x+a.width+o-i.width,r.x+e)),l=Math.max(a.y+s,Math.min(a.y+a.height+s-i.height,r.y+t));e=c-r.x,t=l-r.y}let i={x:r.x+e,y:r.y+t};return n.tx=e,n.ty=t,n.transition?(typeof n.transition!=`object`&&(n.transition={}),this.transition(`position`,i,Object.assign(Object.assign({},n.transition),{interp:oc.object})),this.eachChild(r=>{var i;let a=(i=n.exclude)?.includes(r);a||r.translate(e,t,n)})):(this.startBatch(`translate`,n),this.store.set(`position`,i,n),this.eachChild(r=>{var i;let a=(i=n.exclude)?.includes(r);a||r.translate(e,t,n)}),this.stopBatch(`translate`,n)),this}angle(e,t){return e==null?this.getAngle():this.rotate(e,t)}getAngle(){return this.store.get(`angle`,0)}rotate(e,t={}){let n=this.getAngle();if(t.center){let r=this.getSize(),i=this.getPosition(),a=this.getBBox().getCenter();a.rotate(n-e,t.center);let o=a.x-r.width/2-i.x,s=a.y-r.height/2-i.y;this.startBatch(`rotate`,{angle:e,options:t}),this.setPosition(i.x+o,i.y+s,t),this.rotate(e,Object.assign(Object.assign({},t),{center:null})),this.stopBatch(`rotate`)}else this.store.set(`angle`,t.absolute?e:(n+e)%360,t);return this}getBBox(e={}){if(e.deep){let e=this.getDescendants({deep:!0,breadthFirst:!0});return e.push(this),Y.getCellsBBox(e)}return B.fromPositionAndSize(this.getPosition(),this.getSize())}getConnectionPoint(e,t){let n=this.getBBox(),r=n.getCenter(),i=e.getTerminal(t);if(i==null)return r;let a=i.port;if(!a||!this.hasPort(a))return r;let o=this.getPort(a);if(!o||!o.group)return r;let s=this.getPortsPosition(o.group),c=s[a].position,l=z.create(c).translate(n.getOrigin()),u=this.getAngle();return u&&l.rotate(-u,r),l}fit(e={}){let t=this.getChildren()||[],n=t.filter(e=>e.isNode());if(n.length===0)return this;this.startBatch(`fit-embeds`,e),e.deep&&n.forEach(t=>t.fit(e));let{x:r,y:i,width:a,height:o}=Y.getCellsBBox(n),s=ya(e.padding);return r-=s.left,i-=s.top,a+=s.left+s.right,o+=s.bottom+s.top,this.store.set({position:{x:r,y:i},size:{width:a,height:o}},e),this.stopBatch(`fit-embeds`),this}get portContainerMarkup(){return this.getPortContainerMarkup()}set portContainerMarkup(e){this.setPortContainerMarkup(e)}getDefaultPortContainerMarkup(){return this.store.get(`defaultPortContainerMarkup`)||J.getPortContainerMarkup()}getPortContainerMarkup(){return this.store.get(`portContainerMarkup`)||this.getDefaultPortContainerMarkup()}setPortContainerMarkup(e,t={}){return this.store.set(`portContainerMarkup`,J.clone(e),t),this}get portMarkup(){return this.getPortMarkup()}set portMarkup(e){this.setPortMarkup(e)}getDefaultPortMarkup(){return this.store.get(`defaultPortMarkup`)||J.getPortMarkup()}getPortMarkup(){return this.store.get(`portMarkup`)||this.getDefaultPortMarkup()}setPortMarkup(e,t={}){return this.store.set(`portMarkup`,J.clone(e),t),this}get portLabelMarkup(){return this.getPortLabelMarkup()}set portLabelMarkup(e){this.setPortLabelMarkup(e)}getDefaultPortLabelMarkup(){return this.store.get(`defaultPortLabelMarkup`)||J.getPortLabelMarkup()}getPortLabelMarkup(){return this.store.get(`portLabelMarkup`)||this.getDefaultPortLabelMarkup()}setPortLabelMarkup(e,t={}){return this.store.set(`portLabelMarkup`,J.clone(e),t),this}get ports(){let e=this.store.get(`ports`,{items:[]});return e.items??=[],e}getPorts(){return y(this.ports.items)}getPortsByGroup(e){return this.getPorts().filter(t=>t.group===e)}getPort(e){return y(this.ports.items.find(t=>t.id&&t.id===e))}getPortAt(e){return this.ports.items[e]||null}hasPorts(){return this.ports.items.length>0}hasPort(e){return this.getPortIndex(e)!==-1}getPortIndex(e){let t=typeof e==`string`?e:e.id;return t==null?-1:this.ports.items.findIndex(e=>e.id===t)}getPortsPosition(e){let t=this.getSize(),n=this.port.getPortsLayoutByGroup(e,new B(0,0,t.width,t.height));return n.reduce((e,t)=>{let n=t.portLayout;return e[t.portId]={position:Object.assign({},n.position),angle:n.angle||0},e},{})}getPortProp(e,t){return this.getPropByPath(this.prefixPortPath(e,t))}setPortProp(e,t,n,r){if(typeof t==`string`||Array.isArray(t)){let i=this.prefixPortPath(e,t),a=n;return this.setPropByPath(i,a,r)}let i=this.prefixPortPath(e),a=t;return this.setPropByPath(i,a,n)}removePortProp(e,t,n){return typeof t==`string`||Array.isArray(t)?this.removePropByPath(this.prefixPortPath(e,t),n):this.removePropByPath(this.prefixPortPath(e),t)}portProp(e,t,n,r){return t==null?this.getPortProp(e):typeof t==`string`||Array.isArray(t)?arguments.length===2?this.getPortProp(e,t):n==null?this.removePortProp(e,t,r):this.setPortProp(e,t,n,r):this.setPortProp(e,t,n)}prefixPortPath(e,t){let n=this.getPortIndex(e);if(n===-1)throw Error(`Unable to find port with id: "${e}"`);return t==null||t===``?[`ports`,`items`,`${n}`]:Array.isArray(t)?[`ports`,`items`,`${n}`,...t]:`ports/items/${n}/${t}`}addPort(e,t){let n=[...this.ports.items];return n.push(e),this.setPropByPath(`ports/items`,n,t),this}addPorts(e,t){return this.setPropByPath(`ports/items`,[...this.ports.items,...e],t),this}insertPort(e,t,n){let r=[...this.ports.items];return r.splice(e,0,t),this.setPropByPath(`ports/items`,r,n),this}removePort(e,t={}){return this.removePortAt(this.getPortIndex(e),t)}removePortAt(e,t={}){if(e>=0){let n=[...this.ports.items];n.splice(e,1),t.rewrite=!0,this.setPropByPath(`ports/items`,n,t)}return this}removePorts(e,t){let n;if(Array.isArray(e)){if(n=t||{},e.length){n.rewrite=!0;let t=[...this.ports.items],r=t.filter(t=>!e.some(e=>{let n=typeof e==`string`?e:e.id;return t.id===n}));this.setPropByPath(`ports/items`,r,n)}}else n=e||{},n.rewrite=!0,this.setPropByPath(`ports/items`,[],n);return this}getParsedPorts(){return this.port.getPorts()}getParsedGroups(){return this.port.groups}getPortsLayoutByGroup(e,t){return this.port.getPortsLayoutByGroup(e,t)}initPorts(){this.updatePortData(),this.on(`change:ports`,()=>{this.processRemovedPort(),this.updatePortData()})}processRemovedPort(){let e=this.ports,t={};e.items.forEach(e=>{e.id&&(t[e.id]=!0)});let n={},r=this.store.getPrevious(`ports`)||{items:[]};r.items.forEach(e=>{e.id&&!t[e.id]&&(n[e.id]=!0)});let i=this.model;if(i&&!Jr(n)){let e=i.getConnectedEdges(this,{incoming:!0});e.forEach(e=>{let t=e.getTargetPortId();t&&n[t]&&e.remove()});let t=i.getConnectedEdges(this,{outgoing:!0});t.forEach(e=>{let t=e.getSourcePortId();t&&n[t]&&e.remove()})}}validatePorts(){let e={},t=[];return this.ports.items.forEach(n=>{typeof n!=`object`&&t.push(`Invalid port ${n}.`),n.id??=this.generatePortId(),e[n.id]&&t.push(`Duplicitied port id.`),e[n.id]=!0}),t}generatePortId(){return ma()}updatePortData(){let e=this.validatePorts();if(e.length>0)throw this.store.set(`ports`,this.store.getPrevious(`ports`)),Error(e.join(` `));let t=this.port?this.port.getPorts():null;this.port=new fm(this.ports);let n=this.port.getPorts(),r=t?n.filter(e=>t.find(t=>t.id===e.id)?null:e):[...n],i=t?t.filter(e=>n.find(t=>t.id===e.id)?null:e):[];r.length>0&&this.notify(`ports:added`,{added:r,cell:this,node:this}),i.length>0&&this.notify(`ports:removed`,{removed:i,cell:this,node:this})}};X.defaults={angle:0,position:{x:0,y:0},size:{width:1,height:1}},function(e){e.toStringTag=`X6.${e.name}`;function t(t){if(t==null)return!1;if(t instanceof e)return!0;let n=t[Symbol.toStringTag],r=t;return(n==null||n===e.toStringTag)&&typeof r.isNode==`function`&&typeof r.isEdge==`function`&&typeof r.prop==`function`&&typeof r.attr==`function`&&typeof r.size==`function`&&typeof r.position==`function`}e.isNode=t}(X||={}),function(e){e.config({propHooks(e){var{ports:t}=e,n=pm(e,[`ports`]);return t&&(n.ports=Array.isArray(t)?{items:t}:t),n}})}(X||={}),function(e){e.registry=U.create({type:`node`,process(t,n){if(dm.exist(t,!0))throw Error(`Node with name '${t}' was registered by anthor Edge`);if(typeof n==`function`)return n.config({shape:t}),n;let r=e,{inherit:i}=n,a=pm(n,[`inherit`]);if(i)if(typeof i==`string`){let e=this.get(i);e==null?this.onNotFound(i,`inherited`):r=e}else r=i;a.constructorName??=t;let o=r.define.call(r,a);return o.config({shape:t}),o}}),dm.setNodeRegistry(e.registry)}(X||={}),function(e){let t=0;function n(e){return e?sa(e):(t+=1,`CustomNode${t}`)}function r(t){let{constructorName:r,overwrite:i}=t,a=pm(t,[`constructorName`,`overwrite`]),o=Qi(n(r||a.shape),this);return o.config(a),a.shape&&e.registry.register(a.shape,o,i),o}e.define=r;function i(t){let n=t.shape||`rect`,r=e.registry.get(n);return r?new r(t):e.registry.onNotFound(n)}e.create=i}(X||={});var mm=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(e!=null&&typeof Object.getOwnPropertySymbols==`function`)for(var i=0,r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]]);return n},Z=class e extends Y{get[Symbol.toStringTag](){return e.toStringTag}constructor(e={}){super(e)}preprocess(e,t){let{source:n,sourceCell:r,sourcePort:i,sourcePoint:a,target:o,targetCell:s,targetPort:c,targetPoint:l}=e,u=mm(e,[`source`,`sourceCell`,`sourcePort`,`sourcePoint`,`target`,`targetCell`,`targetPort`,`targetPoint`]),d=u,f=e=>typeof e==`string`||typeof e==`number`;if(n!=null)if(Y.isCell(n))d.source={cell:n.id};else if(f(n))d.source={cell:n};else if(z.isPoint(n))d.source=n.toJSON();else if(Array.isArray(n))d.source={x:n[0],y:n[1]};else{let e=n.cell;Y.isCell(e)?d.source=Object.assign(Object.assign({},n),{cell:e.id}):d.source=n}if(r!=null||i!=null){let e=d.source;if(r!=null){let t=f(r)?r:r.id;e?e.cell=t:e=d.source={cell:t}}i!=null&&e&&(e.port=i)}else a!=null&&(d.source=z.create(a).toJSON());if(o!=null)if(Y.isCell(o))d.target={cell:o.id};else if(f(o))d.target={cell:o};else if(z.isPoint(o))d.target=o.toJSON();else if(Array.isArray(o))d.target={x:o[0],y:o[1]};else{let e=o.cell;Y.isCell(e)?d.target=Object.assign(Object.assign({},o),{cell:e.id}):d.target=o}if(s!=null||c!=null){let e=d.target;if(s!=null){let t=f(s)?s:s.id;e?e.cell=t:e=d.target={cell:t}}c!=null&&e&&(e.port=c)}else l!=null&&(d.target=z.create(l).toJSON());return super.preprocess(d,t)}setup(){super.setup(),this.on(`change:labels`,e=>this.onLabelsChanged(e)),this.on(`change:vertices`,e=>this.onVertexsChanged(e))}isEdge(){return!0}disconnect(e={}){return this.store.set({source:{x:0,y:0},target:{x:0,y:0}},e),this}get source(){return this.getSource()}set source(e){this.setSource(e)}getSource(){return this.getTerminal(`source`)}getSourceCellId(){return this.source.cell}getSourcePortId(){return this.source.port}setSource(e,t,n={}){return this.setTerminal(`source`,e,t,n)}get target(){return this.getTarget()}set target(e){this.setTarget(e)}getTarget(){return this.getTerminal(`target`)}getTargetCellId(){return this.target.cell}getTargetPortId(){return this.target.port}setTarget(e,t,n={}){return this.setTerminal(`target`,e,t,n)}getTerminal(e){return Object.assign({},this.store.get(e))}setTerminal(e,t,n,r={}){if(Y.isCell(t))return this.store.set(e,v({},n,{cell:t.id}),r),this;let i=t;return z.isPoint(t)||i.x!=null&&i.y!=null?(this.store.set(e,v({},n,{x:i.x,y:i.y}),r),this):(this.store.set(e,y(t),r),this)}getSourcePoint(){return this.getTerminalPoint(`source`)}getTargetPoint(){return this.getTerminalPoint(`target`)}getTerminalPoint(e){let t=this[e];if(z.isPointLike(t))return z.create(t);let n=this.getTerminalCell(e);return n?n.getConnectionPoint(this,e):new z}getSourceCell(){return this.getTerminalCell(`source`)}getTargetCell(){return this.getTerminalCell(`target`)}getTerminalCell(e){if(this.model){let t=e===`source`?this.getSourceCellId():this.getTargetCellId();if(t)return this.model.getCell(t)}return null}getSourceNode(){return this.getTerminalNode(`source`)}getTargetNode(){return this.getTerminalNode(`target`)}getTerminalNode(e){let t=this,n={};for(;t&&t.isEdge();){if(n[t.id])return null;n[t.id]=!0,t=t.getTerminalCell(e)}return t&&t.isNode()?t:null}get router(){return this.getRouter()}set router(e){e==null?this.removeRouter():this.setRouter(e)}getRouter(){return this.store.get(`router`)}setRouter(e,t,n){return typeof e==`object`?this.store.set(`router`,e,t):this.store.set(`router`,{name:e,args:t},n),this}removeRouter(e={}){return this.store.remove(`router`,e),this}get connector(){return this.getConnector()}set connector(e){e==null?this.removeConnector():this.setConnector(e)}getConnector(){return this.store.get(`connector`)}setConnector(e,t,n){return typeof e==`object`?this.store.set(`connector`,e,t):this.store.set(`connector`,{name:e,args:t},n),this}removeConnector(e={}){return this.store.remove(`connector`,e)}getDefaultLabel(){let e=this.constructor,t=this.store.get(`defaultLabel`)||e.defaultLabel||{};return y(t)}get labels(){return this.getLabels()}set labels(e){this.setLabels(e)}getLabels(){return[...this.store.get(`labels`,[])].map(e=>this.parseLabel(e))}setLabels(e,t={}){return this.store.set(`labels`,Array.isArray(e)?e:[e],t),this}insertLabel(e,t,n={}){let r=this.getLabels(),i=r.length,a=t!=null&&Number.isFinite(t)?t:i;return a<0&&(a=i+a+1),r.splice(a,0,this.parseLabel(e)),this.setLabels(r,n)}appendLabel(e,t={}){return this.insertLabel(e,-1,t)}getLabelAt(e){let t=this.getLabels();return e!=null&&Number.isFinite(e)?this.parseLabel(t[e]):null}setLabelAt(e,t,n={}){if(e!=null&&Number.isFinite(e)){let r=this.getLabels();r[e]=this.parseLabel(t),this.setLabels(r,n)}return this}removeLabelAt(e,t={}){let n=this.getLabels(),r=e!=null&&Number.isFinite(e)?e:-1,i=n.splice(r,1);return this.setLabels(n,t),i.length?i[0]:null}parseLabel(e){if(typeof e==`string`){let t=this.constructor;return t.parseStringLabel(e)}return e}onLabelsChanged({previous:e,current:t}){let n=e&&t?t.filter(t=>e.find(e=>t===e||i(t,e))?null:t):t?[...t]:[],r=e&&t?e.filter(e=>t.find(t=>e===t||i(e,t))?null:e):e?[...e]:[];n.length>0&&this.notify(`labels:added`,{added:n,cell:this,edge:this}),r.length>0&&this.notify(`labels:removed`,{removed:r,cell:this,edge:this})}get vertices(){return this.getVertices()}set vertices(e){this.setVertices(e)}getVertices(){return[...this.store.get(`vertices`,[])]}setVertices(e,t={}){let n=Array.isArray(e)?e:[e];return this.store.set(`vertices`,n.map(e=>z.toJSON(e)),t),this}insertVertex(e,t,n={}){let r=this.getVertices(),i=r.length,a=t!=null&&Number.isFinite(t)?t:i;return a<0&&(a=i+a+1),r.splice(a,0,z.toJSON(e)),this.setVertices(r,n)}appendVertex(e,t={}){return this.insertVertex(e,-1,t)}getVertexAt(e){if(e!=null&&Number.isFinite(e)){let t=this.getVertices();return t[e]}return null}setVertexAt(e,t,n={}){if(e!=null&&Number.isFinite(e)){let r=this.getVertices();r[e]=t,this.setVertices(r,n)}return this}removeVertexAt(e,t={}){let n=this.getVertices(),r=e!=null&&Number.isFinite(e)?e:-1;return n.splice(r,1),this.setVertices(n,t)}onVertexsChanged({previous:e,current:t}){let n=e&&t?t.filter(t=>e.find(e=>z.equals(t,e))?null:t):t?[...t]:[],r=e&&t?e.filter(e=>t.find(t=>z.equals(e,t))?null:e):e?[...e]:[];n.length>0&&this.notify(`vertexs:added`,{added:n,cell:this,edge:this}),r.length>0&&this.notify(`vertexs:removed`,{removed:r,cell:this,edge:this})}getDefaultMarkup(){return this.store.get(`defaultMarkup`)||J.getEdgeMarkup()}getMarkup(){return super.getMarkup()||this.getDefaultMarkup()}translate(e,t,n={}){return n.translateBy=n.translateBy||this.id,n.tx=e,n.ty=t,this.applyToPoints(n=>({x:(n.x||0)+e,y:(n.y||0)+t}),n)}scale(e,t,n,r={}){return this.applyToPoints(r=>z.create(r).scale(e,t,n).toJSON(),r)}applyToPoints(e,t={}){let n={},r=this.getSource(),i=this.getTarget();z.isPointLike(r)&&(n.source=e(r)),z.isPointLike(i)&&(n.target=e(i));let a=this.getVertices();return a.length>0&&(n.vertices=a.map(e)),this.store.set(n,t),this}getBBox(){return this.getPolyline().bbox()}getConnectionPoint(){return this.getPolyline().pointAt(.5)}getPolyline(){let e=[this.getSourcePoint(),...this.getVertices().map(e=>z.create(e)),this.getTargetPoint()];return new yc(e)}updateParent(e){let t=null,n=this.getSourceCell(),r=this.getTargetCell(),i=this.getParent();return n&&r&&(t=n===r||n.isDescendantOf(r)?r:r.isDescendantOf(n)?n:Y.getCommonAncestor(n,r)),i&&t&&t.id!==i.id&&i.unembed(this,e),t&&(!i||i.id!==t.id)&&t.embed(this,e),t}hasLoop(e={}){let t=this.getSource(),n=this.getTarget(),r=t.cell,i=n.cell;if(!r||!i)return!1;let a=r===i;if(!a&&e.deep&&this._model){let t=this.getSourceCell(),n=this.getTargetCell();t&&n&&(a=t.isAncestorOf(n,e)||n.isAncestorOf(t,e))}return a}getFragmentAncestor(){let e=[this,this.getSourceNode(),this.getTargetNode()].filter(e=>e!=null);return this.getCommonAncestor(...e)}isFragmentDescendantOf(e){let t=this.getFragmentAncestor();return!!t&&(t.id===e.id||t.isDescendantOf(e))}};Z.defaults={},function(e){function t(e,t){let n=e,r=t;return n.cell===r.cell?n.port===r.port||n.port==null&&r.port==null:!1}e.equalTerminals=t}(Z||={}),function(e){e.defaultLabel={markup:[{tagName:`rect`,selector:`body`},{tagName:`text`,selector:`label`}],attrs:{text:{fill:`#000`,fontSize:14,textAnchor:`middle`,textVerticalAnchor:`middle`,pointerEvents:`none`},rect:{ref:`label`,fill:`#fff`,rx:3,ry:3,refWidth:1,refHeight:1,refX:0,refY:0}},position:{distance:.5}};function t(e){return{attrs:{label:{text:e}}}}e.parseStringLabel=t}(Z||={}),function(e){e.toStringTag=`X6.${e.name}`;function t(t){if(t==null)return!1;if(t instanceof e)return!0;let n=t[Symbol.toStringTag],r=t;return(n==null||n===e.toStringTag)&&typeof r.isNode==`function`&&typeof r.isEdge==`function`&&typeof r.prop==`function`&&typeof r.attr==`function`&&typeof r.disconnect==`function`&&typeof r.getSource==`function`&&typeof r.getTarget==`function`}e.isEdge=t}(Z||={}),function(e){e.registry=U.create({type:`edge`,process(t,n){if(dm.exist(t,!1))throw Error(`Edge with name '${t}' was registered by anthor Node`);if(typeof n==`function`)return n.config({shape:t}),n;let r=e,{inherit:i=`edge`}=n,a=mm(n,[`inherit`]);if(typeof i==`string`){let e=this.get(i||`edge`);e==null&&i?this.onNotFound(i,`inherited`):r=e}else r=i;a.constructorName??=t;let o=r.define.call(r,a);return o.config({shape:t}),o}}),dm.setEdgeRegistry(e.registry)}(Z||={}),function(e){let t=0;function n(e){return e?sa(e):(t+=1,`CustomEdge${t}`)}function r(t){let{constructorName:r,overwrite:i}=t,a=mm(t,[`constructorName`,`overwrite`]),o=Qi(n(r||a.shape),this);return o.config(a),a.shape&&e.registry.register(a.shape,o,i),o}e.define=r;function i(t){let n=t.shape||`edge`,r=e.registry.get(n);return r?new r(t):e.registry.onNotFound(n)}e.create=i}(Z||={}),function(e){let t=`basic.edge`;e.config({shape:t,propHooks(t){let{label:n,vertices:r}=t,i=mm(t,[`label`,`vertices`]);if(n){i.labels??=[];let t=typeof n==`string`?e.parseStringLabel(n):n;i.labels.push(t)}return r&&Array.isArray(r)&&(i.vertices=r.map(e=>z.create(e).toJSON())),i}}),e.registry.register(t,e)}(Z||={});var hm=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},gm=class extends ia{constructor(e,t={}){super(),this.length=0,this.comparator=t.comparator||`zIndex`,this.clean(),e&&this.reset(e,{silent:!0})}toJSON(){return this.cells.map(e=>e.toJSON())}add(e,t,n){let r,i;typeof t==`number`?(r=t,i=Object.assign({merge:!1},n)):(r=this.length,i=Object.assign({merge:!1},t)),r>this.length&&(r=this.length),r<0&&(r+=this.length+1);let a=Array.isArray(e)?e:[e],o=this.comparator&&typeof t!=`number`&&i.sort!==!1,s=this.comparator||null,c=!1,l=[],u=[];return a.forEach(e=>{let t=this.get(e);t?i.merge&&!e.isSameStore(t)&&(t.setProp(e.getProp(),n),u.push(t),o&&!c&&(c=s==null||typeof s==`function`?t.hasChanged():typeof s==`string`?t.hasChanged(s):s.some(e=>t.hasChanged(e)))):(l.push(e),this.reference(e))}),l.length&&(o&&(c=!0),this.cells.splice(r,0,...l),this.length=this.cells.length),c&&this.sort({silent:!0}),i.silent||(l.forEach((e,t)=>{let n={cell:e,index:r+t,options:i};this.trigger(`added`,n),i.dryrun||e.notify(`added`,Object.assign({},n))}),c&&this.trigger(`sorted`),(l.length||u.length)&&this.trigger(`updated`,{added:l,merged:u,removed:[],options:i})),this}remove(e,t={}){let n=Array.isArray(e)?e:[e],r=this.removeCells(n,t);return!t.silent&&r.length>0&&this.trigger(`updated`,{options:t,removed:r,added:[],merged:[]}),Array.isArray(e)?r:r[0]}removeCells(e,t){let n=[];for(let r=0;r<e.length;r+=1){let i=this.get(e[r]);if(i==null)continue;let a=this.cells.indexOf(i);this.cells.splice(a,1),--this.length,delete this.map[i.id],n.push(i),this.unreference(i),t.dryrun||i.remove(),t.silent||(this.trigger(`removed`,{cell:i,index:a,options:t}),t.dryrun||i.notify(`removed`,{cell:i,index:a,options:t}))}return n}reset(e,t={}){let n=this.cells.slice();if(n.forEach(e=>this.unreference(e)),this.clean(),this.add(e,Object.assign({silent:!0},t)),!t.silent){let e=this.cells.slice();this.trigger(`reseted`,{options:t,previous:n,current:e});let r=[],i=[];e.forEach(e=>{let t=n.some(t=>t.id===e.id);t||r.push(e)}),n.forEach(t=>{let n=e.some(e=>e.id===t.id);n||i.push(t)}),this.trigger(`updated`,{options:t,added:r,removed:i,merged:[]})}return this}push(e,t){return this.add(e,this.length,t)}pop(e){let t=this.at(this.length-1);return this.remove(t,e)}unshift(e,t){return this.add(e,0,t)}shift(e){let t=this.at(0);return this.remove(t,e)}get(e){if(e==null)return null;let t=typeof e==`string`||typeof e==`number`?e:e.id;return this.map[t]||null}has(e){return this.get(e)!=null}at(e){return e<0&&(e+=this.length),this.cells[e]||null}first(){return this.at(0)}last(){return this.at(-1)}indexOf(e){return this.cells.indexOf(e)}toArray(){return this.cells.slice()}sort(e={}){return this.comparator!=null&&(this.cells=hi(this.cells,this.comparator),e.silent||this.trigger(`sorted`)),this}clone(){let e=this.constructor;return new e(this.cells.slice(),{comparator:this.comparator})}reference(e){this.map[e.id]=e,e.on(`*`,this.notifyCellEvent,this)}unreference(e){e.off(`*`,this.notifyCellEvent,this),delete this.map[e.id]}notifyCellEvent(e,t){let n=t.cell;this.trigger(`cell:${e}`,t),n&&(n.isNode()?this.trigger(`node:${e}`,Object.assign(Object.assign({},t),{node:n})):n.isEdge()&&this.trigger(`edge:${e}`,Object.assign(Object.assign({},t),{edge:n})))}clean(){this.length=0,this.cells=[],this.map={}}dispose(){this.reset([])}};hm([gm.dispose()],gm.prototype,`dispose`,null);var _m=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},vm=class e extends ia{get[Symbol.toStringTag](){return e.toStringTag}constructor(e=[]){super(),this.batches={},this.addings=new WeakMap,this.nodes={},this.edges={},this.outgoings={},this.incomings={},this.collection=new gm(e),this.setup()}notify(e,t){this.trigger(e,t);let n=this.graph;return n&&(e===`sorted`||e===`reseted`||e===`updated`?n.trigger(`model:${e}`,t):n.trigger(e,t)),this}setup(){let e=this.collection;e.on(`sorted`,()=>this.notify(`sorted`,null)),e.on(`updated`,e=>this.notify(`updated`,e)),e.on(`cell:change:zIndex`,()=>this.sortOnChangeZ()),e.on(`added`,({cell:e})=>{this.onCellAdded(e)}),e.on(`removed`,e=>{let t=e.cell;this.onCellRemoved(t,e.options),this.notify(`cell:removed`,e),t.isNode()?this.notify(`node:removed`,Object.assign(Object.assign({},e),{node:t})):t.isEdge()&&this.notify(`edge:removed`,Object.assign(Object.assign({},e),{edge:t}))}),e.on(`reseted`,e=>{this.onReset(e.current),this.notify(`reseted`,e)}),e.on(`edge:change:source`,({edge:e})=>this.onEdgeTerminalChanged(e,`source`)),e.on(`edge:change:target`,({edge:e})=>{this.onEdgeTerminalChanged(e,`target`)})}sortOnChangeZ(){this.collection.sort()}onCellAdded(e){let t=e.id;e.isEdge()?(e.updateParent(),this.edges[t]=!0,this.onEdgeTerminalChanged(e,`source`),this.onEdgeTerminalChanged(e,`target`)):this.nodes[t]=!0}onCellRemoved(e,t){let n=e.id;if(e.isEdge()){delete this.edges[n];let t=e.getSource(),r=e.getTarget();if(t&&t.cell){let e=this.outgoings[t.cell],r=e?e.indexOf(n):-1;r>=0&&(e.splice(r,1),e.length===0&&delete this.outgoings[t.cell])}if(r&&r.cell){let e=this.incomings[r.cell],t=e?e.indexOf(n):-1;t>=0&&(e.splice(t,1),e.length===0&&delete this.incomings[r.cell])}}else delete this.nodes[n];t.clear||(t.disconnectEdges?this.disconnectConnectedEdges(e,t):this.removeConnectedEdges(e,t)),e.model===this&&(e.model=null)}onReset(e){this.nodes={},this.edges={},this.outgoings={},this.incomings={},e.forEach(e=>this.onCellAdded(e))}onEdgeTerminalChanged(e,t){let n=t===`source`?this.outgoings:this.incomings,r=e.previous(t);if(r&&r.cell){let t=Y.isCell(r.cell)?r.cell.id:r.cell,i=n[t],a=i?i.indexOf(e.id):-1;a>=0&&(i.splice(a,1),i.length===0&&delete n[t])}let i=e.getTerminal(t);if(i&&i.cell){let t=Y.isCell(i.cell)?i.cell.id:i.cell,r=n[t]||[],a=r.indexOf(e.id);a===-1&&r.push(e.id),n[t]=r}}prepareCell(e,t){return!e.model&&(!t||!t.dryrun)&&(e.model=this),e.zIndex??e.setZIndex(this.getMaxZIndex()+1,{silent:!0}),e}resetCells(e,t={}){return e.map(e=>this.prepareCell(e,Object.assign(Object.assign({},t),{dryrun:!0}))),this.collection.reset(e,t),e.map(e=>this.prepareCell(e,{options:t})),this}clear(e={}){let t=this.getCells();if(t.length===0)return this;let n=Object.assign(Object.assign({},e),{clear:!0});return this.batchUpdate(`clear`,()=>{let e=t.sort((e,t)=>{let n=e.isEdge()?1:2,r=t.isEdge()?1:2;return n-r});for(;e.length>0;){let t=e.shift();t&&t.remove(n)}},n),this}addNode(e,t={}){let n=X.isNode(e)?e:this.createNode(e);return this.addCell(n,t),n}updateNode(e,t={}){let n=this.createNode(e),r=n.getProp();return n.dispose(),this.updateCell(r,t)}createNode(e){return X.create(e)}addEdge(e,t={}){let n=Z.isEdge(e)?e:this.createEdge(e);return this.addCell(n,t),n}createEdge(e){return Z.create(e)}updateEdge(e,t={}){let n=this.createEdge(e),r=n.getProp();return n.dispose(),this.updateCell(r,t)}addCell(e,t={}){return Array.isArray(e)?this.addCells(e,t):(!this.collection.has(e)&&!this.addings.has(e)&&(this.addings.set(e,!0),this.collection.add(this.prepareCell(e,t),t),e.eachChild(e=>this.addCell(e,t)),this.addings.delete(e)),this)}addCells(e,t={}){let n=e.length;if(n===0)return this;let r=Object.assign(Object.assign({},t),{position:n-1,maxPosition:n-1});return this.startBatch(`add`,Object.assign(Object.assign({},r),{cells:e})),e.forEach(e=>{this.addCell(e,r),--r.position}),this.stopBatch(`add`,Object.assign(Object.assign({},r),{cells:e})),this}updateCell(e,t={}){let n=e.id&&this.getCell(e.id);return n?this.batchUpdate(`update`,()=>(Object.entries(e).forEach(([e,r])=>n.setProp(e,r,t)),!0),e):!1}removeCell(e,t={}){let n=typeof e==`string`?this.getCell(e):e;return n&&this.has(n)?this.collection.remove(n,t):null}updateCellId(e,t){if(e.id===t)return;this.startBatch(`update`,{id:t}),e.prop(`id`,t);let n=e.clone({keepId:!0});this.addCell(n);let r=this.getConnectedEdges(e);return r.forEach(n=>{let r=n.getSourceCell(),i=n.getTargetCell();r===e&&n.setSource(Object.assign(Object.assign({},n.getSource()),{cell:t})),i===e&&n.setTarget(Object.assign(Object.assign({},n.getTarget()),{cell:t}))}),this.removeCell(e),this.stopBatch(`update`,{id:t}),n}removeCells(e,t={}){return e.length?this.batchUpdate(`remove`,()=>e.map(e=>this.removeCell(e,t))):[]}removeConnectedEdges(e,t={}){let n=this.getConnectedEdges(e);return n.forEach(e=>{e.remove(t)}),n}disconnectConnectedEdges(e,t={}){let n=typeof e==`string`?e:e.id;this.getConnectedEdges(e).forEach(e=>{let r=e.getSourceCellId(),i=e.getTargetCellId();r===n&&e.setSource({x:0,y:0},t),i===n&&e.setTarget({x:0,y:0},t)})}has(e){return this.collection.has(e)}total(){return this.collection.length}indexOf(e){return this.collection.indexOf(e)}getCell(e){return this.collection.get(e)}getCells(){return this.collection.toArray()}getFirstCell(){return this.collection.first()}getLastCell(){return this.collection.last()}getMinZIndex(){let e=this.collection.first();return e&&e.getZIndex()||0}getMaxZIndex(){let e=this.collection.last();return e&&e.getZIndex()||0}getCellsFromCache(e){return e?Object.keys(e).map(e=>this.getCell(e)).filter(e=>e!=null):[]}getNodes(){return this.getCellsFromCache(this.nodes)}getEdges(){return this.getCellsFromCache(this.edges)}getOutgoingEdges(e){let t=typeof e==`string`?e:e.id,n=this.outgoings[t];return n?n.map(e=>this.getCell(e)).filter(e=>e&&e.isEdge()):null}getIncomingEdges(e){let t=typeof e==`string`?e:e.id,n=this.incomings[t];return n?n.map(e=>this.getCell(e)).filter(e=>e&&e.isEdge()):null}getConnectedEdges(e,t={}){let n=[],r=typeof e==`string`?this.getCell(e):e;if(r==null)return n;let i={},a=t.indirect,o=t.incoming,s=t.outgoing;o==null&&s==null&&(o=s=!0);let c=(e,t)=>{let r=t?this.getOutgoingEdges(e):this.getIncomingEdges(e);if(r?.forEach(e=>{i[e.id]||(n.push(e),i[e.id]=!0,a&&(o&&c(e,!1),s&&c(e,!0)))}),a&&e.isEdge()){let r=t?e.getTargetCell():e.getSourceCell();r&&r.isEdge()&&(i[r.id]||(n.push(r),c(r,t)))}};if(s&&c(r,!0),o&&c(r,!1),t.deep){let e=r.getDescendants({deep:!0}),a={};e.forEach(e=>{e.isNode()&&(a[e.id]=!0)});let c=(e,r)=>{let o=r?this.getOutgoingEdges(e.id):this.getIncomingEdges(e.id);o?.forEach(e=>{if(!i[e.id]){let r=e.getSourceCell(),o=e.getTargetCell();if(!t.enclosed&&r&&a[r.id]&&o&&a[o.id])return;n.push(e),i[e.id]=!0}})};e.forEach(e=>{e.isEdge()||(s&&c(e,!0),o&&c(e,!1))})}return n}isBoundary(e,t){let n=typeof e==`string`?this.getCell(e):e,r=t?this.getIncomingEdges(n):this.getOutgoingEdges(n);return r==null||r.length===0}getBoundaryNodes(e){let t=[];return Object.keys(this.nodes).forEach(n=>{if(this.isBoundary(n,e)){let e=this.getCell(n);e&&t.push(e)}}),t}getRoots(){return this.getBoundaryNodes(!0)}getLeafs(){return this.getBoundaryNodes(!1)}isRoot(e){return this.isBoundary(e,!0)}isLeaf(e){return this.isBoundary(e,!1)}getNeighbors(e,t={}){let n=t.incoming,r=t.outgoing;n==null&&r==null&&(n=r=!0);let i=this.getConnectedEdges(e,t),a=i.reduce((i,a)=>{let o=a.hasLoop(t),s=a.getSourceCell(),c=a.getTargetCell();return n&&s&&s.isNode()&&!i[s.id]&&(o||s!==e&&(!t.deep||!s.isDescendantOf(e)))&&(i[s.id]=s),r&&c&&c.isNode()&&!i[c.id]&&(o||c!==e&&(!t.deep||!c.isDescendantOf(e)))&&(i[c.id]=c),i},{});if(e.isEdge()){if(n){let t=e.getSourceCell();t&&t.isNode()&&!a[t.id]&&(a[t.id]=t)}if(r){let t=e.getTargetCell();t&&t.isNode()&&!a[t.id]&&(a[t.id]=t)}}return Object.keys(a).map(e=>a[e])}isNeighbor(e,t,n={}){let r=n.incoming,i=n.outgoing;return r==null&&i==null&&(r=i=!0),this.getConnectedEdges(e,n).some(e=>{let n=e.getSourceCell(),a=e.getTargetCell();return!!(r&&n&&n.id===t.id||i&&a&&a.id===t.id)})}getSuccessors(e,t={}){let n=[];return this.search(e,(r,i)=>{r!==e&&this.matchDistance(i,t.distance)&&n.push(r)},Object.assign(Object.assign({},t),{outgoing:!0})),n}isSuccessor(e,t,n={}){let r=!1;return this.search(e,(i,a)=>{if(i===t&&i!==e&&this.matchDistance(a,n.distance))return r=!0,!1},Object.assign(Object.assign({},n),{outgoing:!0})),r}getPredecessors(e,t={}){let n=[];return this.search(e,(r,i)=>{r!==e&&this.matchDistance(i,t.distance)&&n.push(r)},Object.assign(Object.assign({},t),{incoming:!0})),n}isPredecessor(e,t,n={}){let r=!1;return this.search(e,(i,a)=>{if(i===t&&i!==e&&this.matchDistance(a,n.distance))return r=!0,!1},Object.assign(Object.assign({},n),{incoming:!0})),r}matchDistance(e,t){return t==null?!0:typeof t==`function`?t(e):Array.isArray(t)&&t.includes(e)?!0:e===t}getCommonAncestor(...e){let t=[];return e.forEach(e=>{e&&(Array.isArray(e)?t.push(...e):t.push(e))}),Y.getCommonAncestor(...t)}getSubGraph(e,t={}){let n=[],r={},i=[],a=[],o=e=>{r[e.id]||(n.push(e),r[e.id]=e,e.isEdge()&&a.push(e),e.isNode()&&i.push(e))};return e.forEach(e=>{if(o(e),t.deep){let t=e.getDescendants({deep:!0});t.forEach(e=>o(e))}}),a.forEach(e=>{let t=e.getSourceCell(),a=e.getTargetCell();t&&!r[t.id]&&(n.push(t),r[t.id]=t,t.isNode()&&i.push(t)),a&&!r[a.id]&&(n.push(a),r[a.id]=a,a.isNode()&&i.push(a))}),i.forEach(e=>{let i=this.getConnectedEdges(e,t);i.forEach(e=>{let t=e.getSourceCell(),i=e.getTargetCell();!r[e.id]&&t&&r[t.id]&&i&&r[i.id]&&(n.push(e),r[e.id]=e)})}),n}cloneSubGraph(e,t={}){let n=this.getSubGraph(e,t);return this.cloneCells(n)}cloneCells(e){return Y.cloneCells(e)}getNodesFromPoint(e,t){let n=typeof e==`number`?{x:e,y:t||0}:e;return this.getNodes().filter(e=>e.getBBox().containsPoint(n))}getNodesInArea(e,t,n,r,i){let a=typeof e==`number`?new B(e,t,n,r):B.create(e),o=typeof e==`number`?i:t,s=o&&o.strict;return this.getNodes().filter(e=>{let t=e.getBBox();return s?a.containsRect(t):a.isIntersectWithRect(t)})}getEdgesInArea(e,t,n,r,i){let a=typeof e==`number`?new B(e,t,n,r):B.create(e),o=typeof e==`number`?i:t,s=o&&o.strict;return this.getEdges().filter(e=>{let t=e.getBBox();return t.width===0?t.inflate(1,0):t.height===0&&t.inflate(0,1),s?a.containsRect(t):a.isIntersectWithRect(t)})}getNodesUnderNode(e,t={}){let n=e.getBBox(),r=t.by==null||t.by===`bbox`?this.getNodesInArea(n):this.getNodesFromPoint(n[t.by]);return r.filter(t=>e.id!==t.id&&!t.isDescendantOf(e))}getAllCellsBBox(){return this.getCellsBBox(this.getCells())}getCellsBBox(e,t={}){return Y.getCellsBBox(e,t)}search(e,t,n={}){n.breadthFirst?this.breadthFirstSearch(e,t,n):this.depthFirstSearch(e,t,n)}breadthFirstSearch(e,t,n={}){let r=[],i={},a={};for(r.push(e),a[e.id]=0;r.length>0;){let e=r.shift();if(e==null||i[e.id]||(i[e.id]=!0,O(t,this,e,a[e.id])===!1))continue;let o=this.getNeighbors(e,n);o.forEach(t=>{a[t.id]=a[e.id]+1,r.push(t)})}}depthFirstSearch(e,t,n={}){let r=[],i={},a={};for(r.push(e),a[e.id]=0;r.length>0;){let e=r.pop();if(e==null||i[e.id]||(i[e.id]=!0,O(t,this,e,a[e.id])===!1))continue;let o=this.getNeighbors(e,n),s=r.length;o.forEach(t=>{a[t.id]=a[e.id]+1,r.splice(s,0,t)})}}getShortestPath(e,t,n={}){let r={};this.getEdges().forEach(e=>{let t=e.getSourceCellId(),i=e.getTargetCellId();t&&i&&(r[t]||(r[t]=[]),r[i]||(r[i]=[]),r[t].push(i),n.directed||r[i].push(t))});let i=typeof e==`string`?e:e.id,a=tc.run(r,i,n.weight),o=[],s=typeof t==`string`?t:t.id;for(a[s]&&o.push(s);s=a[s];)o.unshift(s);return o}translate(e,t,n){return this.getCells().filter(e=>!e.hasParent()).forEach(r=>r.translate(e,t,n)),this}resize(e,t,n){return this.resizeCells(e,t,this.getCells(),n)}resizeCells(e,t,n,r={}){let i=this.getCellsBBox(n);if(i){let a=Math.max(e/i.width,0),o=Math.max(t/i.height,0),s=i.getOrigin();n.forEach(e=>e.scale(a,o,s,r))}return this}toJSON(t={}){return e.toJSON(this.getCells(),t)}parseJSON(t){return e.fromJSON(t)}fromJSON(e,t={}){let n=this.parseJSON(e);return this.resetCells(n,t),this}startBatch(e,t={}){return this.batches[e]=(this.batches[e]||0)+1,this.notify(`batch:start`,{name:e,data:t}),this}stopBatch(e,t={}){return this.batches[e]=(this.batches[e]||0)-1,this.notify(`batch:stop`,{name:e,data:t}),this}batchUpdate(e,t,n={}){this.startBatch(e,n);let r=t();return this.stopBatch(e,n),r}hasActiveBatch(e=Object.keys(this.batches)){let t=Array.isArray(e)?e:[e];return t.some(e=>this.batches[e]>0)}dispose(){this.collection.dispose()}};_m([vm.dispose()],vm.prototype,`dispose`,null),function(e){e.toStringTag=`X6.${e.name}`;function t(t){if(t==null)return!1;if(t instanceof e)return!0;let n=t[Symbol.toStringTag],r=t;return(n==null||n===e.toStringTag)&&typeof r.addNode==`function`&&typeof r.addEdge==`function`&&r.collection!=null}e.isModel=t}(vm||={}),function(e){function t(e,t={}){return{cells:e.map(e=>e.toJSON(t))}}e.toJSON=t;function n(e){let t=[];return Array.isArray(e)?t.push(...e):(e.cells&&t.push(...e.cells),e.nodes&&e.nodes.forEach(e=>{e.shape??=`rect`,t.push(e)}),e.edges&&e.edges.forEach(e=>{e.shape??=`edge`,t.push(e)})),t.map(e=>{let t=e.shape;if(t){if(X.registry.exist(t))return X.create(e);if(Z.registry.exist(t))return Z.create(e)}throw Error("The `shape` should be specified when creating a node/edge instance")})}e.fromJSON=n}(vm||={});var ym=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(e!=null&&typeof Object.getOwnPropertySymbols==`function`)for(var i=0,r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]]);return n},bm=class extends X{get label(){return this.getLabel()}set label(e){this.setLabel(e)}getLabel(){return this.getAttrByPath(`text/text`)}setLabel(e,t){return e==null?this.removeLabel():this.setAttrByPath(`text/text`,e,t),this}removeLabel(){return this.removeAttrByPath(`text/text`),this}};(function(e){e.bodyAttr={fill:`#ffffff`,stroke:`#333333`,strokeWidth:2},e.labelAttr={fontSize:14,fill:`#000000`,refX:.5,refY:.5,textAnchor:`middle`,textVerticalAnchor:`middle`,fontFamily:`Arial, helvetica, sans-serif`},e.config({attrs:{text:Object.assign({},e.labelAttr)},propHooks(e){let{label:t}=e,n=ym(e,[`label`]);return t&&ta(n,`attrs/text/text`,t),n},visible:!0})})(bm||={});var xm=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(e!=null&&typeof Object.getOwnPropertySymbols==`function`)for(var i=0,r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]]);return n};function Sm(e,t=`body`){return[{tagName:e,selector:t},{tagName:`text`,selector:`label`}]}function Cm(e=`xlink:href`){let t=t=>{let{imageUrl:n,imageWidth:r,imageHeight:i}=t,a=xm(t,[`imageUrl`,`imageWidth`,`imageHeight`]);if(n!=null||r!=null||i!=null){let t=()=>{if(a.attrs){let t=a.attrs.image;n!=null&&(t[e]=n),r!=null&&(t.width=r),i!=null&&(t.height=i),a.attrs.image=t}};a.attrs?(a.attrs.image??(a.attrs.image={}),t()):(a.attrs={image:{}},t())}return a};return t}function wm(e,t,n={}){let r={constructorName:e,markup:Sm(e,n.selector),attrs:{[e]:Object.assign({},bm.bodyAttr)}},i=n.parent||bm;return i.define(v(r,t,{shape:e}))}const Tm=wm(`rect`,{attrs:{body:{refWidth:`100%`,refHeight:`100%`}}}),Em=Z.define({shape:`edge`,markup:[{tagName:`path`,selector:`wrap`,groupSelector:`lines`,attrs:{fill:`none`,cursor:`pointer`,stroke:`transparent`,strokeLinecap:`round`}},{tagName:`path`,selector:`line`,groupSelector:`lines`,attrs:{fill:`none`,pointerEvents:`none`}}],attrs:{lines:{connection:!0,strokeLinejoin:`round`},wrap:{strokeWidth:10},line:{stroke:`#333`,strokeWidth:2,targetMarker:`classic`}}}),Dm=wm(`ellipse`,{attrs:{body:{refCx:`50%`,refCy:`50%`,refRx:`50%`,refRy:`50%`}}});var Om=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(e!=null&&typeof Object.getOwnPropertySymbols==`function`)for(var i=0,r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]]);return n},km=class e extends bm{get points(){return this.getPoints()}set points(e){this.setPoints(e)}getPoints(){return this.getAttrByPath(`body/refPoints`)}setPoints(t,n){return t==null?this.removePoints():this.setAttrByPath(`body/refPoints`,e.pointsToString(t),n),this}removePoints(){return this.removeAttrByPath(`body/refPoints`),this}};(function(e){function t(e){return typeof e==`string`?e:e.map(e=>Array.isArray(e)?e.join(`,`):z.isPointLike(e)?`${e.x}, ${e.y}`:``).join(` `)}e.pointsToString=t,e.config({propHooks(e){let{points:n}=e,r=Om(e,[`points`]);if(n){let e=t(n);e&&ta(r,`attrs/body/refPoints`,e)}return r}})})(km||={});const Am=wm(`polygon`,{},{parent:km}),jm=wm(`polyline`,{},{parent:km});var Mm=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(e!=null&&typeof Object.getOwnPropertySymbols==`function`)for(var i=0,r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]]);return n};const Nm=bm.define({shape:`path`,markup:[{tagName:`rect`,selector:`bg`},{tagName:`path`,selector:`body`},{tagName:`text`,selector:`label`}],attrs:{bg:{refWidth:`100%`,refHeight:`100%`,fill:`none`,stroke:`none`,pointerEvents:`all`},body:{fill:`none`,stroke:`#000`,strokeWidth:2}},propHooks(e){let{path:t}=e,n=Mm(e,[`path`]);return t&&ta(n,`attrs/body/refD`,t),n}});var Pm=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(e!=null&&typeof Object.getOwnPropertySymbols==`function`)for(var i=0,r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]]);return n};const Fm=bm.define({shape:`text-block`,markup:[{tagName:`rect`,selector:`body`},Ia.SUPPORT_FOREIGNOBJECT?{tagName:`foreignObject`,selector:`foreignObject`,children:[{tagName:`div`,ns:A.xhtml,selector:`label`,style:{width:`100%`,height:`100%`,position:`static`,backgroundColor:`transparent`,textAlign:`center`,margin:0,padding:`0px 5px`,boxSizing:`border-box`,display:`flex`,alignItems:`center`,justifyContent:`center`}}]}:{tagName:`text`,selector:`label`,attrs:{textAnchor:`middle`}}],attrs:{body:Object.assign(Object.assign({},bm.bodyAttr),{refWidth:`100%`,refHeight:`100%`}),foreignObject:{refWidth:`100%`,refHeight:`100%`},label:{style:{fontSize:14}}},propHooks(e){let{text:t}=e,n=Pm(e,[`text`]);return t&&ta(n,`attrs/label/text`,t),n},attrHooks:{text:{set(e,{cell:t,view:n,refBBox:r,elem:i,attrs:a}){if(i instanceof HTMLElement)i.textContent=e;else{let o=a.style||{},s={text:e,width:-5,height:`100%`},c=Object.assign({textVerticalAnchor:`middle`},o),l=Ru.presets.textWrap;return O(l.set,this,s,{cell:t,view:n,elem:i,refBBox:r,attrs:c}),{fill:o.color||null}}},position(e,{refBBox:t,elem:n}){if(n instanceof SVGElement)return t.getCenter()}}}}),Im=wm(`image`,{attrs:{image:{refWidth:`100%`,refHeight:`100%`}},propHooks:Cm()},{selector:`image`}),Lm=wm(`circle`,{attrs:{body:{refCx:`50%`,refCy:`50%`,refR:`50%`}}});var Rm=class e extends Fd{constructor(){super(...arguments),this.portsCache={}}get[Symbol.toStringTag](){return e.toStringTag}getContainerClassName(){let e=[super.getContainerClassName(),this.prefixClassName(`node`)];return this.can(`nodeMovable`)||e.push(this.prefixClassName(`node-immovable`)),e.join(` `)}updateClassName(e){let t=e.target;if(t.hasAttribute(`magnet`)){let e=this.prefixClassName(`port-unconnectable`);this.can(`magnetConnectable`)?Ha(t,e):k(t,e)}else{let e=this.prefixClassName(`node-immovable`);this.can(`nodeMovable`)?this.removeClass(e):this.addClass(e)}}isNodeView(){return!0}confirmUpdate(e,t={}){let n=e;return this.hasAction(n,`ports`)&&(this.removePorts(),this.cleanPortsCache()),this.hasAction(n,`render`)?(this.render(),n=this.removeAction(n,[`render`,`update`,`resize`,`translate`,`rotate`,`ports`,`tools`])):(n=this.handleAction(n,`resize`,()=>this.resize(),`update`),n=this.handleAction(n,`update`,()=>this.update(),G.useCSSSelector?`ports`:null),n=this.handleAction(n,`translate`,()=>this.translate()),n=this.handleAction(n,`rotate`,()=>this.rotate()),n=this.handleAction(n,`ports`,()=>this.renderPorts()),n=this.handleAction(n,`tools`,()=>{this.getFlag(`tools`)===e?this.renderTools():this.updateTools(t)})),n}update(e){this.cleanCache(),G.useCSSSelector&&this.removePorts();let t=this.cell,n=t.getSize(),r=t.getAttrs();this.updateAttrs(this.container,r,{attrs:e===r?null:e,rootBBox:new B(0,0,n.width,n.height),selectors:this.selectors}),G.useCSSSelector&&this.renderPorts()}renderMarkup(){let e=this.cell.markup;if(e){if(typeof e==`string`)throw TypeError(`Not support string markup.`);return this.renderJSONMarkup(e)}throw TypeError(`Invalid node markup.`)}renderJSONMarkup(e){let t=this.parseJSONMarkup(e,this.container);this.selectors=t.selectors,this.container.appendChild(t.fragment)}render(){return this.empty(),this.renderMarkup(),this.resize(),this.updateTransform(),G.useCSSSelector||this.renderPorts(),this.renderTools(),this}resize(){this.cell.getAngle()&&this.rotate(),this.update()}translate(){this.updateTransform()}rotate(){this.updateTransform()}getTranslationString(){let e=this.cell.getPosition();return`translate(${e.x},${e.y})`}getRotationString(){let e=this.cell.getAngle();if(e){let t=this.cell.getSize();return`rotate(${e},${t.width/2},${t.height/2})`}}updateTransform(){let e=this.getTranslationString(),t=this.getRotationString();t&&(e+=` ${t}`),this.container.setAttribute(`transform`,e)}findPortElem(e,t){let n=e?this.portsCache[e]:null;if(!n)return null;let r=n.portContentElement,i=n.portContentSelectors||{};return this.findOne(t,r,i)}cleanPortsCache(){this.portsCache={}}removePorts(){Object.values(this.portsCache).forEach(e=>{oo(e.portElement)})}renderPorts(){let e=this.container,t=[];e.childNodes.forEach(e=>{t.push(e)});let n=this.cell.getParsedPorts(),r=Pr(n,`zIndex`),i=`auto`;r[i]&&r[i].forEach(n=>{let r=this.getPortElement(n);e.append(r),t.push(r)}),Object.keys(r).forEach(e=>{if(e!==i){let n=parseInt(e,10);this.appendPorts(r[e],n,t)}}),this.updatePorts()}appendPorts(e,t,n){let r=e.map(e=>this.getPortElement(e));n[t]||t<0?uo(n[Math.max(t,0)],r):co(this.container,r)}getPortElement(e){let t=this.portsCache[e.id];return t?t.portElement:this.createPortElement(e)}createPortElement(e){let t=J.renderMarkup(this.cell.getPortContainerMarkup()),n=t.elem;if(n==null)throw Error(`Invalid port container markup.`);t=J.renderMarkup(this.getPortMarkup(e));let r=t.elem,i=t.selectors;if(r==null)throw Error(`Invalid port markup.`);this.setAttrs({port:e.id,"port-group":e.group},r);let a=`x6-port`;e.group&&(a+=` x6-port-${e.group}`),k(n,a),k(n,`x6-port`),k(r,`x6-port-body`),n.appendChild(r);let o=i,s,c,l=this.existPortLabel(e);if(l){if(t=J.renderMarkup(this.getPortLabelMarkup(e.label)),s=t.elem,c=t.selectors,s==null)throw Error(`Invalid port label markup.`);if(i&&c){for(let e in c)if(i[e]&&e!==this.rootSelector)throw Error(`Selectors within port must be unique.`);o=Object.assign(Object.assign({},i),c)}k(s,`x6-port-label`),n.appendChild(s)}return this.portsCache[e.id]={portElement:n,portSelectors:o,portLabelElement:s,portLabelSelectors:c,portContentElement:r,portContentSelectors:i},this.graph.options.onPortRendered&&this.graph.options.onPortRendered({port:e,node:this.cell,container:n,selectors:o,labelContainer:s,labelSelectors:c,contentContainer:r,contentSelectors:i}),n}updatePorts(){let e=this.cell.getParsedGroups(),t=Object.keys(e);t.length===0?this.updatePortGroup():t.forEach(e=>this.updatePortGroup(e))}updatePortGroup(e){let t=B.fromSize(this.cell.getSize()),n=this.cell.getPortsLayoutByGroup(e,t);for(let e=0,t=n.length;e<t;e+=1){let t=n[e],r=t.portId,i=this.portsCache[r]||{},a=t.portLayout;if(this.applyPortTransform(i.portElement,a),t.portAttrs!=null){let e={selectors:i.portSelectors||{}};t.portSize&&(e.rootBBox=B.fromSize(t.portSize)),this.updateAttrs(i.portElement,t.portAttrs,e)}let o=t.labelLayout;if(o&&i.portLabelElement&&(this.applyPortTransform(i.portLabelElement,o,-(a.angle||0)),o.attrs)){let e={selectors:i.portLabelSelectors||{}};t.labelSize&&(e.rootBBox=B.fromSize(t.labelSize)),this.updateAttrs(i.portLabelElement,o.attrs,e)}}}applyPortTransform(e,t,n=0){let r=t.angle,i=t.position,a=P().rotate(n).translate(i.x||0,i.y||0).rotate(r||0);Ms(e,a,{absolute:!0})}getPortMarkup(e){return e.markup||this.cell.portMarkup}getPortLabelMarkup(e){return e.markup||this.cell.portLabelMarkup}existPortLabel(e){return e.attrs&&e.attrs.text}getEventArgs(e,t,n){let r=this,i=r.cell,a=i;return t==null||n==null?{e,view:r,node:i,cell:a}:{e,x:t,y:n,view:r,node:i,cell:a}}getPortEventArgs(e,t,n){let r=this,i=r.cell,a=i;return n?{e,x:n.x,y:n.y,view:r,node:i,cell:a,port:t}:{e,view:r,node:i,cell:a,port:t}}notifyMouseDown(e,t,n){super.onMouseDown(e,t,n),this.notify(`node:mousedown`,this.getEventArgs(e,t,n))}notifyMouseMove(e,t,n){super.onMouseMove(e,t,n),this.notify(`node:mousemove`,this.getEventArgs(e,t,n))}notifyMouseUp(e,t,n){super.onMouseUp(e,t,n),this.notify(`node:mouseup`,this.getEventArgs(e,t,n))}notifyPortEvent(e,t,n){let r=this.findAttr(`port`,t.target);if(r){let i=t.type;e===`node:port:mouseenter`?t.type=`mouseenter`:e===`node:port:mouseleave`&&(t.type=`mouseleave`),this.notify(e,this.getPortEventArgs(t,r,n)),t.type=i}}onClick(e,t,n){super.onClick(e,t,n),this.notify(`node:click`,this.getEventArgs(e,t,n)),this.notifyPortEvent(`node:port:click`,e,{x:t,y:n})}onDblClick(e,t,n){super.onDblClick(e,t,n),this.notify(`node:dblclick`,this.getEventArgs(e,t,n)),this.notifyPortEvent(`node:port:dblclick`,e,{x:t,y:n})}onContextMenu(e,t,n){super.onContextMenu(e,t,n),this.notify(`node:contextmenu`,this.getEventArgs(e,t,n)),this.notifyPortEvent(`node:port:contextmenu`,e,{x:t,y:n})}onMouseDown(e,t,n){this.isPropagationStopped(e)||(this.notifyMouseDown(e,t,n),this.notifyPortEvent(`node:port:mousedown`,e,{x:t,y:n}),this.startNodeDragging(e,t,n))}onMouseMove(e,t,n){let r=this.getEventData(e),i=r.action;if(i===`magnet`)this.dragMagnet(e,t,n);else{if(i===`move`){let i=r,a=i.targetView||this;a.dragNode(e,t,n),a.notify(`node:moving`,{e,x:t,y:n,view:a,cell:a.cell,node:a.cell})}this.notifyMouseMove(e,t,n),this.notifyPortEvent(`node:port:mousemove`,e,{x:t,y:n})}this.setEventData(e,r)}onMouseUp(e,t,n){let r=this.getEventData(e),i=r.action;if(i===`magnet`)this.stopMagnetDragging(e,t,n);else if(this.notifyMouseUp(e,t,n),this.notifyPortEvent(`node:port:mouseup`,e,{x:t,y:n}),i===`move`){let i=r,a=i.targetView||this;a.stopNodeDragging(e,t,n)}let a=r.targetMagnet;a&&this.onMagnetClick(e,a,t,n),this.checkMouseleave(e)}onMouseOver(e){super.onMouseOver(e),this.notify(`node:mouseover`,this.getEventArgs(e)),this.notifyPortEvent(`node:port:mouseenter`,e),this.notifyPortEvent(`node:port:mouseover`,e)}onMouseOut(e){super.onMouseOut(e),this.notify(`node:mouseout`,this.getEventArgs(e)),this.notifyPortEvent(`node:port:mouseleave`,e),this.notifyPortEvent(`node:port:mouseout`,e)}onMouseEnter(e){this.updateClassName(e),super.onMouseEnter(e),this.notify(`node:mouseenter`,this.getEventArgs(e))}onMouseLeave(e){super.onMouseLeave(e),this.notify(`node:mouseleave`,this.getEventArgs(e))}onMouseWheel(e,t,n,r){super.onMouseWheel(e,t,n,r),this.notify(`node:mousewheel`,Object.assign({delta:r},this.getEventArgs(e,t,n)))}onMagnetClick(e,t,n,r){let i=this.graph,a=i.view.getMouseMovedCount(e);a>i.options.clickThreshold||this.notify(`node:magnet:click`,Object.assign({magnet:t},this.getEventArgs(e,n,r)))}onMagnetDblClick(e,t,n,r){this.notify(`node:magnet:dblclick`,Object.assign({magnet:t},this.getEventArgs(e,n,r)))}onMagnetContextMenu(e,t,n,r){this.notify(`node:magnet:contextmenu`,Object.assign({magnet:t},this.getEventArgs(e,n,r)))}onMagnetMouseDown(e,t,n,r){this.startMagnetDragging(e,n,r)}onCustomEvent(e,t,n,r){this.notify(`node:customevent`,Object.assign({name:t},this.getEventArgs(e,n,r))),super.onCustomEvent(e,t,n,r)}prepareEmbedding(e){let t=this.graph,n=this.getEventData(e),r=n.cell||this.cell,i=t.findViewByCell(r),a=t.snapToGrid(e.clientX,e.clientY);this.notify(`node:embed`,{e,node:r,view:i,cell:r,x:a.x,y:a.y,currentParent:r.getParent()})}processEmbedding(e,t){let n=t.cell||this.cell,r=t.graph||this.graph,i=r.options.embedding,a=i.findParent,o=typeof a==`function`?O(a,r,{view:this,node:this.cell}).filter(e=>Y.isCell(e)&&this.cell.id!==e.id&&!e.isDescendantOf(this.cell)):r.model.getNodesUnderNode(n,{by:a});if(i.frontOnly&&o.length>0){let e=Pr(o,`zIndex`),t=ai(Object.keys(e).map(e=>parseInt(e,10)));t&&(o=e[t])}o=o.filter(e=>e.visible);let s=null,c=t.candidateEmbedView,l=i.validate;for(let e=o.length-1;e>=0;--e){let t=o[e];if(c&&c.cell.id===t.id){s=c;break}else{let e=t.findView(r);if(l&&O(l,r,{child:this.cell,parent:e.cell,childView:this,parentView:e})){s=e;break}}}this.clearEmbedding(t),s&&s.highlight(null,{type:`embedding`}),t.candidateEmbedView=s;let u=r.snapToGrid(e.clientX,e.clientY);this.notify(`node:embedding`,{e,cell:n,node:n,view:r.findViewByCell(n),x:u.x,y:u.y,currentParent:n.getParent(),candidateParent:s?s.cell:null})}clearEmbedding(e){let t=e.candidateEmbedView;t&&(t.unhighlight(null,{type:`embedding`}),e.candidateEmbedView=null)}finalizeEmbedding(e,t){this.graph.startBatch(`embedding`);let n=t.cell||this.cell,r=t.graph||this.graph,i=r.findViewByCell(n),a=n.getParent(),o=t.candidateEmbedView;if(o?(o.unhighlight(null,{type:`embedding`}),t.candidateEmbedView=null,(a==null||a.id!==o.cell.id)&&o.cell.insertChild(n,void 0,{ui:!0})):a&&a.unembed(n,{ui:!0}),r.model.getConnectedEdges(n,{deep:!0}).forEach(e=>{e.updateParent({ui:!0})}),i&&o){let t=r.snapToGrid(e.clientX,e.clientY);i.notify(`node:embedded`,{e,cell:n,x:t.x,y:t.y,node:n,view:r.findViewByCell(n),previousParent:a,currentParent:n.getParent()})}this.graph.stopBatch(`embedding`)}getDelegatedView(){let e=this.cell,t=this;for(;t&&!e.isEdge();){if(!e.hasParent()||t.can(`stopDelegateOnDragging`))return t;e=e.getParent(),t=this.graph.findViewByCell(e)}return null}validateMagnet(e,t,n){if(t.getAttribute(`magnet`)!==`passive`){let r=this.graph.options.connecting.validateMagnet;return r?O(r,this.graph,{e:n,magnet:t,view:e,cell:e.cell}):!0}return!1}startMagnetDragging(e,t,n){if(!this.can(`magnetConnectable`))return;e.stopPropagation();let r=e.currentTarget,i=this.graph;this.setEventData(e,{targetMagnet:r}),this.validateMagnet(this,r,e)?(i.options.magnetThreshold<=0&&this.startConnectting(e,r,t,n),this.setEventData(e,{action:`magnet`}),this.stopPropagation(e)):this.onMouseDown(e,t,n),i.view.delegateDragEvents(e,this)}startConnectting(e,t,n,r){this.graph.model.startBatch(`add-edge`);let i=this.createEdgeFromMagnet(t,n,r);i.setEventData(e,i.prepareArrowheadDragging(`target`,{x:n,y:r,isNewEdge:!0,fallbackAction:`remove`})),this.setEventData(e,{edgeView:i}),i.notifyMouseDown(e,n,r)}getDefaultEdge(e,t){let n,r=this.graph.options.connecting.createEdge;return r&&(n=O(r,this.graph,{sourceMagnet:t,sourceView:e,sourceCell:e.cell})),n}createEdgeFromMagnet(e,t,n){let r=this.graph,i=r.model,a=this.getDefaultEdge(this,e);return a.setSource(Object.assign(Object.assign({},a.getSource()),this.getEdgeTerminal(e,t,n,a,`source`))),a.setTarget(Object.assign(Object.assign({},a.getTarget()),{x:t,y:n})),a.addTo(i,{async:!1,ui:!0}),a.findView(r)}dragMagnet(e,t,n){let r=this.getEventData(e),i=r.edgeView;if(i)i.onMouseMove(e,t,n),this.autoScrollGraph(e.clientX,e.clientY);else{let i=this.graph,a=i.options.magnetThreshold,o=this.getEventTarget(e),s=r.targetMagnet;if(a===`onleave`){if(s===o||s.contains(o))return}else if(i.view.getMouseMovedCount(e)<=a)return;this.startConnectting(e,s,t,n)}}stopMagnetDragging(e,t,n){let r=this.eventData(e),i=r.edgeView;i&&(i.onMouseUp(e,t,n),this.graph.model.stopBatch(`add-edge`))}notifyUnhandledMouseDown(e,t,n){this.notify(`node:unhandled:mousedown`,{e,x:t,y:n,view:this,cell:this.cell,node:this.cell})}notifyNodeMove(e,t,n,r,i){let a=[i],o=this.graph.getPlugin(`selection`);if(o&&o.isSelectionMovable()){let e=o.getSelectedCells();e.includes(i)&&(a=e.filter(e=>e.isNode()))}a.forEach(i=>{this.notify(e,{e:t,x:n,y:r,cell:i,node:i,view:i.findView(this.graph)})})}getRestrictArea(e){let t=this.graph.options.translating.restrict,n=typeof t==`function`?O(t,this.graph,e):t;return typeof n==`number`?this.graph.transform.getGraphArea().inflate(n):n===!0?this.graph.transform.getGraphArea():n||null}startNodeDragging(e,t,n){let r=this.getDelegatedView();if(r==null||!r.can(`nodeMovable`))return this.notifyUnhandledMouseDown(e,t,n);this.setEventData(e,{targetView:r,action:`move`});let i=z.create(r.cell.getPosition());r.setEventData(e,{moving:!1,offset:i.diff(t,n),restrict:this.getRestrictArea(r)})}dragNode(e,t,n){let r=this.cell,i=this.graph,a=i.getGridSize(),o=this.getEventData(e),s=o.offset,c=o.restrict;o.moving||(o.moving=!0,this.addClass(`node-moving`),this.notifyNodeMove(`node:move`,e,t,n,this.cell)),this.autoScrollGraph(e.clientX,e.clientY);let l=R.snapToGrid(t+s.x,a),u=R.snapToGrid(n+s.y,a);r.setPosition(l,u,{restrict:c,deep:!0,ui:!0}),i.options.embedding.enabled&&(o.embedding||(this.prepareEmbedding(e),o.embedding=!0),this.processEmbedding(e,o))}stopNodeDragging(e,t,n){let r=this.getEventData(e);r.embedding&&this.finalizeEmbedding(e,r),r.moving&&(this.removeClass(`node-moving`),this.notifyNodeMove(`node:moved`,e,t,n,this.cell)),r.moving=!1,r.embedding=!1}autoScrollGraph(e,t){let n=this.graph.getPlugin(`scroller`);n&&n.autoScroll(e,t)}};(function(e){e.toStringTag=`X6.${e.name}`;function t(t){if(t==null)return!1;if(t instanceof e)return!0;let n=t[Symbol.toStringTag],r=t;return(n==null||n===e.toStringTag)&&typeof r.isNodeView==`function`&&typeof r.isEdgeView==`function`&&typeof r.confirmUpdate==`function`&&typeof r.update==`function`&&typeof r.findPortElem==`function`&&typeof r.resize==`function`&&typeof r.rotate==`function`&&typeof r.translate==`function`}e.isNodeView=t})(Rm||={}),Rm.config({isSvgElement:!0,priority:0,bootstrap:[`render`],actions:{view:[`render`],markup:[`render`],attrs:[`update`],size:[`resize`,`ports`,`tools`],angle:[`rotate`,`tools`],position:[`translate`,`tools`],ports:[`ports`],tools:[`tools`]}}),Rm.registry.register(`node`,Rm,!0);var zm=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(e!=null&&typeof Object.getOwnPropertySymbols==`function`)for(var i=0,r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]]);return n},Bm=class e extends Fd{constructor(){super(...arguments),this.POINT_ROUNDING=2,this.labelDestroyFn={}}get[Symbol.toStringTag](){return e.toStringTag}getContainerClassName(){return[super.getContainerClassName(),this.prefixClassName(`edge`)].join(` `)}get sourceBBox(){let e=this.sourceView;if(!e){let e=this.cell.getSource();return new B(e.x,e.y)}let t=this.sourceMagnet;return e.isEdgeElement(t)?new B(this.sourceAnchor.x,this.sourceAnchor.y):e.getBBoxOfElement(t||e.container)}get targetBBox(){let e=this.targetView;if(!e){let e=this.cell.getTarget();return new B(e.x,e.y)}let t=this.targetMagnet;return e.isEdgeElement(t)?new B(this.targetAnchor.x,this.targetAnchor.y):e.getBBoxOfElement(t||e.container)}isEdgeView(){return!0}confirmUpdate(e,t={}){let n=e;if(this.hasAction(n,`source`)){if(!this.updateTerminalProperties(`source`))return n;n=this.removeAction(n,`source`)}if(this.hasAction(n,`target`)){if(!this.updateTerminalProperties(`target`))return n;n=this.removeAction(n,`target`)}return this.hasAction(n,`render`)?(this.render(),n=this.removeAction(n,[`render`,`update`,`labels`,`tools`]),n):(n=this.handleAction(n,`update`,()=>this.update(t)),n=this.handleAction(n,`labels`,()=>this.onLabelsChange(t)),n=this.handleAction(n,`tools`,()=>this.renderTools()),n)}render(){return this.empty(),this.renderMarkup(),this.labelContainer=null,this.renderLabels(),this.update(),this.renderTools(),this}renderMarkup(){let e=this.cell.markup;if(e){if(typeof e==`string`)throw TypeError(`Not support string markup.`);return this.renderJSONMarkup(e)}throw TypeError(`Invalid edge markup.`)}renderJSONMarkup(e){let t=this.parseJSONMarkup(e,this.container);this.selectors=t.selectors,this.container.append(t.fragment)}customizeLabels(){if(this.labelContainer){let e=this.cell,t=e.labels;for(let n=0,r=t.length;n<r;n+=1){let r=t[n],i=this.labelCache[n],a=this.labelSelectors[n],o=this.graph.options.onEdgeLabelRendered;if(o){let t=o({edge:e,label:r,container:i,selectors:a});t&&(this.labelDestroyFn[n]=t)}}}}destroyCustomizeLabels(){let e=this.cell.labels;if(this.labelCache&&this.labelSelectors&&this.labelDestroyFn)for(let t=0,n=e.length;t<n;t+=1){let n=this.labelDestroyFn[t],r=this.labelCache[t],i=this.labelSelectors[t];n&&r&&i&&n({edge:this.cell,label:e[t],container:r,selectors:i})}this.labelDestroyFn={}}renderLabels(){let e=this.cell,t=e.getLabels(),n=t.length,r=this.labelContainer;if(this.labelCache={},this.labelSelectors={},n<=0)return r&&r.parentNode&&r.parentNode.removeChild(r),this;r?this.empty(r):(r=Za(`g`),this.addClass(this.prefixClassName(`edge-labels`),r),this.labelContainer=r);for(let n=0,i=t.length;n<i;n+=1){let i=t[n],a=this.normalizeLabelMarkup(this.parseLabelMarkup(i.markup)),o,s;if(a)o=a.node,s=a.selectors;else{let t=e.getDefaultLabel(),n=this.normalizeLabelMarkup(this.parseLabelMarkup(t.markup));o=n.node,s=n.selectors}o.setAttribute(`data-index`,`${n}`),r.appendChild(o);let c=this.rootSelector;if(s[c])throw Error(`Ambiguous label root selector.`);s[c]=o,this.labelCache[n]=o,this.labelSelectors[n]=s}return r.parentNode??this.container.appendChild(r),this.updateLabels(),this.customizeLabels(),this}onLabelsChange(e={}){this.destroyCustomizeLabels(),this.shouldRerenderLabels(e)?this.renderLabels():this.updateLabels(),this.updateLabelPositions()}shouldRerenderLabels(e={}){let t=this.cell.previous(`labels`);if(t==null)return!0;if(`propertyPathArray`in e&&`propertyValue`in e){let n=e.propertyPathArray||[],r=n.length;if(r>1){let i=n[1];if(t[i]){if(r===2)return typeof e.propertyValue==`object`&&Hr(e.propertyValue,`markup`);if(n[2]!==`markup`)return!1}}}return!0}parseLabelMarkup(e){return e?typeof e==`string`?this.parseLabelStringMarkup(e):this.parseJSONMarkup(e):null}parseLabelStringMarkup(e){let t=M.createVectors(e),n=document.createDocumentFragment();for(let e=0,r=t.length;e<r;e+=1){let r=t[e].node;n.appendChild(r)}return{fragment:n,selectors:{}}}normalizeLabelMarkup(e){if(e==null)return;let t=e.fragment;if(!(t instanceof DocumentFragment)||!t.hasChildNodes())throw Error(`Invalid label markup.`);let n,r=t.childNodes;return n=r.length>1||r[0].nodeName.toUpperCase()!==`G`?M.create(`g`).append(t):M.create(r[0]),n.addClass(this.prefixClassName(`edge-label`)),{node:n.node,selectors:e.selectors}}updateLabels(){if(this.labelContainer){let e=this.cell,t=e.labels,n=this.can(`edgeLabelMovable`),r=e.getDefaultLabel();for(let e=0,i=t.length;e<i;e+=1){let i=this.labelCache[e],a=this.labelSelectors[e];i.setAttribute(`cursor`,n?`move`:`default`);let o=t[e],s=v({},r.attrs,o.attrs);this.updateAttrs(i,s,{selectors:a,rootBBox:o.size?B.fromSize(o.size):void 0})}}}renderTools(){let e=this.cell.getTools();return this.addTools(e),this}update(e={}){this.cleanCache(),this.updateConnection(e);let t=this.cell.getAttrs(),{text:n}=t,r=zm(t,[`text`]);return r!=null&&this.updateAttrs(this.container,r,{selectors:this.selectors}),this.updateLabelPositions(),this.updateTools(e),this}removeRedundantLinearVertices(e={}){let t=this.cell,n=t.getVertices(),r=[this.sourceAnchor,...n,this.targetAnchor],i=r.length,a=new yc(r);a.simplify({threshold:.01});let o=a.points.map(e=>e.toJSON()),s=o.length;return i===s?0:(t.setVertices(o.slice(1,s-1),e),i-s)}getTerminalView(e){switch(e){case`source`:return this.sourceView||null;case`target`:return this.targetView||null;default:throw Error(`Unknown terminal type '${e}'`)}}getTerminalAnchor(e){switch(e){case`source`:return z.create(this.sourceAnchor);case`target`:return z.create(this.targetAnchor);default:throw Error(`Unknown terminal type '${e}'`)}}getTerminalConnectionPoint(e){switch(e){case`source`:return z.create(this.sourcePoint);case`target`:return z.create(this.targetPoint);default:throw Error(`Unknown terminal type '${e}'`)}}getTerminalMagnet(e,t={}){switch(e){case`source`:{if(t.raw)return this.sourceMagnet;let e=this.sourceView;return e?this.sourceMagnet||e.container:null}case`target`:{if(t.raw)return this.targetMagnet;let e=this.targetView;return e?this.targetMagnet||e.container:null}default:throw Error(`Unknown terminal type '${e}'`)}}updateConnection(e={}){let t=this.cell;if(e.translateBy&&t.isFragmentDescendantOf(e.translateBy)){let t=e.tx||0,n=e.ty||0;this.routePoints=new yc(this.routePoints).translate(t,n).points,this.translateConnectionPoints(t,n),this.path.translate(t,n)}else{let e=t.getVertices(),n=this.findAnchors(e);this.sourceAnchor=n.source,this.targetAnchor=n.target,this.routePoints=this.findRoutePoints(e);let r=this.findConnectionPoints(this.routePoints,this.sourceAnchor,this.targetAnchor);this.sourcePoint=r.source,this.targetPoint=r.target;let i=this.findMarkerPoints(this.routePoints,this.sourcePoint,this.targetPoint);this.path=this.findPath(this.routePoints,i.source||this.sourcePoint,i.target||this.targetPoint)}this.cleanCache()}findAnchors(e){let t=this.cell,n=t.source,r=t.target,i=e[0],a=e[e.length-1];return r.priority&&!n.priority?this.findAnchorsOrdered(`target`,a,`source`,i):this.findAnchorsOrdered(`source`,i,`target`,a)}findAnchorsOrdered(e,t,n,r){let i,a,o=this.cell,s=o[e],c=o[n],l=this.getTerminalView(e),u=this.getTerminalView(n),d=this.getTerminalMagnet(e),f=this.getTerminalMagnet(n);if(l){let n;n=t?z.create(t):u?f:z.create(c),i=this.getAnchor(s.anchor,l,d,n,e)}else i=z.create(s);if(u){let e=z.create(r||i);a=this.getAnchor(c.anchor,u,f,e,n)}else a=z.isPointLike(c)?z.create(c):new z;return{[e]:i,[n]:a}}getAnchor(e,t,n,r,i){let a=t.isEdgeElement(n),o=this.graph.options.connecting,s=typeof e==`string`?{name:e}:e;if(!s){let e=a?(i===`source`?o.sourceEdgeAnchor:o.targetEdgeAnchor)||o.edgeAnchor:(i===`source`?o.sourceAnchor:o.targetAnchor)||o.anchor;s=typeof e==`string`?{name:e}:e}if(!s)throw Error(`Anchor should be specified.`);let c,l=s.name;if(a){let e=Rf.registry.get(l);if(typeof e!=`function`)return Rf.registry.onNotFound(l);c=O(e,this,t,n,r,s.args||{},i)}else{let e=Af.registry.get(l);if(typeof e!=`function`)return Af.registry.onNotFound(l);c=O(e,this,t,n,r,s.args||{},i)}return c?c.round(this.POINT_ROUNDING):new z}findRoutePoints(e=[]){let t=this.graph.options.connecting.router||Bp.presets.normal,n=this.cell.getRouter()||t,r;if(typeof n==`function`)r=O(n,this,e,{},this);else{let t=typeof n==`string`?n:n.name,i=typeof n==`string`?{}:n.args||{},a=t?Bp.registry.get(t):Bp.presets.normal;if(typeof a!=`function`)return Bp.registry.onNotFound(t);r=O(a,this,e,i,this)}return r==null?e.map(e=>z.create(e)):r.map(e=>z.create(e))}findConnectionPoints(e,t,n){let r=this.cell,i=this.graph.options.connecting,a=r.getSource(),o=r.getTarget(),s=this.sourceView,c=this.targetView,l=e[0],u=e[e.length-1],d;if(s&&!s.isEdgeElement(this.sourceMagnet)){let e=this.sourceMagnet||s.container,r=l||n,o=new V(r,t),c=a.connectionPoint||i.sourceConnectionPoint||i.connectionPoint;d=this.getConnectionPoint(c,s,e,o,`source`)}else d=t;let f;if(c&&!c.isEdgeElement(this.targetMagnet)){let e=this.targetMagnet||c.container,r=o.connectionPoint||i.targetConnectionPoint||i.connectionPoint,a=u||t,s=new V(a,n);f=this.getConnectionPoint(r,c,e,s,`target`)}else f=n;return{source:d,target:f}}getConnectionPoint(e,t,n,r,i){let a=r.end;if(e==null)return a;let o=typeof e==`string`?e:e.name,s=typeof e==`string`?{}:e.args,c=Jf.registry.get(o);if(typeof c!=`function`)return Jf.registry.onNotFound(o);let l=O(c,this,r,t,n,s||{},i);return l?l.round(this.POINT_ROUNDING):a}findMarkerPoints(e,t,n){let r=e=>{let t=this.cell.getAttrs(),n=Object.keys(t);for(let r=0,i=n.length;r<i;r+=1){let i=t[n[r]];if(i[`${e}Marker`]||i[`${e}-marker`]){let e=i.strokeWidth||i[`stroke-width`];if(e)return parseFloat(e);break}}return null},i=e[0],a=e[e.length-1],o,s,c=r(`source`);c&&(o=t.clone().move(i||n,-c));let l=r(`target`);return l&&(s=n.clone().move(a||t,-l)),this.sourceMarkerPoint=o||t.clone(),this.targetMarkerPoint=s||n.clone(),{source:o,target:s}}findPath(e,t,n){let r=this.cell.getConnector()||this.graph.options.connecting.connector,i,a,o;if(typeof r==`string`?i=r:(i=r.name,a=r.args),i){let e=am.registry.get(i);if(typeof e!=`function`)return am.registry.onNotFound(i);o=e}else o=am.presets.normal;let s=O(o,this,t,n,e,Object.assign(Object.assign({},a),{raw:!0}),this);return typeof s==`string`?H.parse(s):s}translateConnectionPoints(e,t){this.sourcePoint.translate(e,t),this.targetPoint.translate(e,t),this.sourceAnchor.translate(e,t),this.targetAnchor.translate(e,t),this.sourceMarkerPoint.translate(e,t),this.targetMarkerPoint.translate(e,t)}updateLabelPositions(){if(this.labelContainer==null)return this;let e=this.path;if(!e)return this;let t=this.cell,n=t.getLabels();if(n.length===0)return this;let r=t.getDefaultLabel(),i=this.normalizeLabelPosition(r.position);for(let e=0,t=n.length;e<t;e+=1){let t=n[e],r=this.labelCache[e];if(!r)continue;let a=this.normalizeLabelPosition(t.position),o=v({},i,a),s=this.getLabelTransformationMatrix(o);r.setAttribute(`transform`,Ts(s))}return this}updateTerminalProperties(e){let t=this.cell,n=this.graph,r=t[e],i=r&&r.cell,a=`${e}View`;if(!i)return this[a]=null,this.updateTerminalMagnet(e),!0;let o=n.getCellById(i);if(!o)throw Error(`Edge's ${e} node with id "${i}" not exists`);let s=o.findView(n);return s?(this[a]=s,this.updateTerminalMagnet(e),!0):!1}updateTerminalMagnet(e){let t=`${e}Magnet`,n=this.getTerminalView(e);if(n){let r=n.getMagnetFromEdgeTerminal(this.cell[e]);r===n.container&&(r=null),this[t]=r}else this[t]=null}getLabelPositionAngle(e){let t=this.cell.getLabelAt(e);return t&&t.position&&typeof t.position==`object`&&t.position.angle||0}getLabelPositionArgs(e){let t=this.cell.getLabelAt(e);if(t&&t.position&&typeof t.position==`object`)return t.position.options}getDefaultLabelPositionArgs(){let e=this.cell.getDefaultLabel();if(e&&e.position&&typeof e.position==`object`)return e.position.options}mergeLabelPositionArgs(e,t){return e===null?null:e===void 0?t===null?null:t:v({},t,e)}getConnection(){return this.path==null?null:this.path.clone()}getConnectionPathData(){if(this.path==null)return``;let e=this.cache.pathCache;return Hr(e,`data`)||(e.data=this.path.serialize()),e.data||``}getConnectionSubdivisions(){if(this.path==null)return null;let e=this.cache.pathCache;return Hr(e,`segmentSubdivisions`)||(e.segmentSubdivisions=this.path.getSegmentSubdivisions()),e.segmentSubdivisions}getConnectionLength(){if(this.path==null)return 0;let e=this.cache.pathCache;return Hr(e,`length`)||(e.length=this.path.length({segmentSubdivisions:this.getConnectionSubdivisions()})),e.length}getPointAtLength(e){return this.path==null?null:this.path.pointAtLength(e,{segmentSubdivisions:this.getConnectionSubdivisions()})}getPointAtRatio(e){return this.path==null?null:(_a(e)&&(e=parseFloat(e)/100),this.path.pointAt(e,{segmentSubdivisions:this.getConnectionSubdivisions()}))}getTangentAtLength(e){return this.path==null?null:this.path.tangentAtLength(e,{segmentSubdivisions:this.getConnectionSubdivisions()})}getTangentAtRatio(e){return this.path==null?null:this.path.tangentAt(e,{segmentSubdivisions:this.getConnectionSubdivisions()})}getClosestPoint(e){return this.path==null?null:this.path.closestPoint(e,{segmentSubdivisions:this.getConnectionSubdivisions()})}getClosestPointLength(e){return this.path==null?null:this.path.closestPointLength(e,{segmentSubdivisions:this.getConnectionSubdivisions()})}getClosestPointRatio(e){return this.path==null?null:this.path.closestPointNormalizedLength(e,{segmentSubdivisions:this.getConnectionSubdivisions()})}getLabelPosition(e,t,n,r){let i={distance:0},a=0,o;typeof n==`number`?(a=n,o=r):o=n,o!=null&&(i.options=o);let s=o&&o.absoluteOffset,c=!(o&&o.absoluteDistance),l=o&&o.absoluteDistance&&o.reverseDistance,u=this.path,d={segmentSubdivisions:this.getConnectionSubdivisions()},f=new z(e,t),p=u.closestPointT(f,d),m=this.getConnectionLength()||0,h=u.lengthAtT(p,d);c&&(h=m>0?h/m:0),l&&(h=-1*(m-h)||1),i.distance=h;let g;s||(g=u.tangentAtT(p));let _;if(g)_=g.pointOffset(f);else{let e=u.pointAtT(p),t=f.diff(e);_={x:t.x,y:t.y}}return i.offset=_,i.angle=a,i}normalizeLabelPosition(e){return typeof e==`number`?{distance:e}:e}getLabelTransformationMatrix(e){let t=this.normalizeLabelPosition(e),n=t.options||{},r=t.angle||0,i=t.distance,a=i>0&&i<=1,o=0,s={x:0,y:0},c=t.offset;c&&(typeof c==`number`?o=c:(c.x!=null&&(s.x=c.x),c.y!=null&&(s.y=c.y)));let l=s.x!==0||s.y!==0||o===0,u=n.keepGradient,d=n.ensureLegibility,f=this.path,p={segmentSubdivisions:this.getConnectionSubdivisions()},m=a?i*this.getConnectionLength():i,h=f.tangentAtLength(m,p),g,_=r;if(h){if(l)g=h.start,g.translate(s);else{let e=h.clone();e.rotate(-90,h.start),e.setLength(o),g=e.end}u&&(_=h.angle()+r,d&&(_=L.normalize((_+90)%180-90)))}else g=f.start,l&&g.translate(s);return P().translate(g.x,g.y).rotate(_)}getVertexIndex(e,t){let n=this.cell,r=n.getVertices(),i=this.getClosestPointLength(new z(e,t)),a=0;if(i!=null)for(let e=r.length;a<e;a+=1){let e=r[a],t=this.getClosestPointLength(e);if(t!=null&&i<t)break}return a}getEventArgs(e,t,n){let r=this,i=r.cell,a=i;return t==null||n==null?{e,view:r,edge:i,cell:a}:{e,x:t,y:n,view:r,edge:i,cell:a}}notifyUnhandledMouseDown(e,t,n){this.notify(`edge:unhandled:mousedown`,{e,x:t,y:n,view:this,cell:this.cell,edge:this.cell})}notifyMouseDown(e,t,n){super.onMouseDown(e,t,n),this.notify(`edge:mousedown`,this.getEventArgs(e,t,n))}notifyMouseMove(e,t,n){super.onMouseMove(e,t,n),this.notify(`edge:mousemove`,this.getEventArgs(e,t,n))}notifyMouseUp(e,t,n){super.onMouseUp(e,t,n),this.notify(`edge:mouseup`,this.getEventArgs(e,t,n))}onClick(e,t,n){super.onClick(e,t,n),this.notify(`edge:click`,this.getEventArgs(e,t,n))}onDblClick(e,t,n){super.onDblClick(e,t,n),this.notify(`edge:dblclick`,this.getEventArgs(e,t,n))}onContextMenu(e,t,n){super.onContextMenu(e,t,n),this.notify(`edge:contextmenu`,this.getEventArgs(e,t,n))}onMouseDown(e,t,n){this.notifyMouseDown(e,t,n),this.startEdgeDragging(e,t,n)}onMouseMove(e,t,n){let r=this.getEventData(e);switch(r.action){case`drag-label`:this.dragLabel(e,t,n);break;case`drag-arrowhead`:this.dragArrowhead(e,t,n);break;case`drag-edge`:this.dragEdge(e,t,n);break;default:break}return this.notifyMouseMove(e,t,n),r}onMouseUp(e,t,n){let r=this.getEventData(e);switch(r.action){case`drag-label`:this.stopLabelDragging(e,t,n);break;case`drag-arrowhead`:this.stopArrowheadDragging(e,t,n);break;case`drag-edge`:this.stopEdgeDragging(e,t,n);break;default:break}return this.notifyMouseUp(e,t,n),this.checkMouseleave(e),r}onMouseOver(e){super.onMouseOver(e),this.notify(`edge:mouseover`,this.getEventArgs(e))}onMouseOut(e){super.onMouseOut(e),this.notify(`edge:mouseout`,this.getEventArgs(e))}onMouseEnter(e){super.onMouseEnter(e),this.notify(`edge:mouseenter`,this.getEventArgs(e))}onMouseLeave(e){super.onMouseLeave(e),this.notify(`edge:mouseleave`,this.getEventArgs(e))}onMouseWheel(e,t,n,r){super.onMouseWheel(e,t,n,r),this.notify(`edge:mousewheel`,Object.assign({delta:r},this.getEventArgs(e,t,n)))}onCustomEvent(e,t,n,r){let i=io(e.target,`edge-tool`,this.container);if(i){if(e.stopPropagation(),this.can(`useEdgeTools`)){if(t===`edge:remove`){this.cell.remove({ui:!0});return}this.notify(`edge:customevent`,Object.assign({name:t},this.getEventArgs(e,n,r)))}this.notifyMouseDown(e,n,r)}else this.notify(`edge:customevent`,Object.assign({name:t},this.getEventArgs(e,n,r))),super.onCustomEvent(e,t,n,r)}onLabelMouseDown(e,t,n){this.notifyMouseDown(e,t,n),this.startLabelDragging(e,t,n);let r=this.getEventData(e).stopPropagation;r&&e.stopPropagation()}startEdgeDragging(e,t,n){if(!this.can(`edgeMovable`)){this.notifyUnhandledMouseDown(e,t,n);return}this.setEventData(e,{x:t,y:n,moving:!1,action:`drag-edge`})}dragEdge(e,t,n){let r=this.getEventData(e);r.moving||(r.moving=!0,this.addClass(`edge-moving`),this.notify(`edge:move`,{e,x:t,y:n,view:this,cell:this.cell,edge:this.cell})),this.cell.translate(t-r.x,n-r.y,{ui:!0}),this.setEventData(e,{x:t,y:n}),this.notify(`edge:moving`,{e,x:t,y:n,view:this,cell:this.cell,edge:this.cell})}stopEdgeDragging(e,t,n){let r=this.getEventData(e);r.moving&&(this.removeClass(`edge-moving`),this.notify(`edge:moved`,{e,x:t,y:n,view:this,cell:this.cell,edge:this.cell})),r.moving=!1}prepareArrowheadDragging(e,t){let n=this.getTerminalMagnet(e),r={action:`drag-arrowhead`,x:t.x,y:t.y,isNewEdge:t.isNewEdge===!0,terminalType:e,initialMagnet:n,initialTerminal:de(this.cell[e]),fallbackAction:t.fallbackAction||`revert`,getValidateConnectionArgs:this.createValidateConnectionArgs(e),options:t.options};return this.beforeArrowheadDragging(r),r}createValidateConnectionArgs(e){let t=[];t[4]=e,t[5]=this;let n,r=0,i=0;e===`source`?(r=2,n=`target`):(i=2,n=`source`);let a=this.cell[n],o=a.cell;if(o){let e,n=t[r]=this.graph.findViewByCell(o);n&&(e=n.getMagnetFromEdgeTerminal(a),e===n.container&&(e=void 0)),t[r+1]=e}return(e,n)=>(t[i]=e,t[i+1]=e.container===n?void 0:n,t)}beforeArrowheadDragging(e){e.zIndex=this.cell.zIndex,this.cell.toFront();let t=this.container.style;e.pointerEvents=t.pointerEvents,t.pointerEvents=`none`,this.graph.options.connecting.highlight&&this.highlightAvailableMagnets(e)}afterArrowheadDragging(e){e.zIndex!=null&&(this.cell.setZIndex(e.zIndex,{ui:!0}),e.zIndex=null);let t=this.container;t.style.pointerEvents=e.pointerEvents||``,this.graph.options.connecting.highlight&&this.unhighlightAvailableMagnets(e)}validateConnection(t,n,r,i,a,o,s){let c=this.graph.options.connecting,l=c.allowLoop,u=c.allowNode,d=c.allowEdge,f=c.allowPort,p=c.allowMulti,m=c.validateConnection,h=o?o.cell:null,g=a===`target`?r:t,_=a===`target`?i:n,v=!0,y=e=>{let c=a===`source`?s?s.port:null:h?h.getSourcePortId():null,l=a===`target`?s?s.port:null:h?h.getTargetPortId():null;return O(e,this.graph,{edge:h,edgeView:o,sourceView:t,targetView:r,sourcePort:c,targetPort:l,sourceMagnet:n,targetMagnet:i,sourceCell:t?t.cell:null,targetCell:r?r.cell:null,type:a})};if(l!=null&&(typeof l==`boolean`?!l&&t===r&&(v=!1):v=y(l)),v&&f!=null&&(typeof f==`boolean`?!f&&_&&(v=!1):v=y(f)),v&&d!=null&&(typeof d==`boolean`?!d&&e.isEdgeView(g)&&(v=!1):v=y(d)),v&&u!=null&&_==null&&(typeof u==`boolean`?!u&&Rm.isNodeView(g)&&(v=!1):v=y(u)),v&&p!=null&&o){let e=o.cell,t=a===`source`?s:e.getSource(),n=a===`target`?s:e.getTarget(),r=s?this.graph.getCellById(s.cell):null;if(t&&n&&t.cell&&n.cell&&r)if(typeof p==`function`)v=y(p);else{let e=this.graph.model.getConnectedEdges(r,{outgoing:a===`source`,incoming:a===`target`});if(e.length){if(p===`withPort`){let r=e.some(e=>{let r=e.getSource(),i=e.getTarget();return r&&i&&r.cell===t.cell&&i.cell===n.cell&&r.port!=null&&r.port===t.port&&i.port!=null&&i.port===n.port});r&&(v=!1)}else if(!p){let r=e.some(e=>{let r=e.getSource(),i=e.getTarget();return r&&i&&r.cell===t.cell&&i.cell===n.cell});r&&(v=!1)}}}}return v&&m!=null&&(v=y(m)),v}allowConnectToBlank(e){let t=this.graph,n=t.options.connecting,r=n.allowBlank;if(typeof r!=`function`)return!!r;let i=t.findViewByCell(e),a=e.getSourceCell(),o=e.getTargetCell(),s=t.findViewByCell(a),c=t.findViewByCell(o);return O(r,t,{edge:e,edgeView:i,sourceCell:a,targetCell:o,sourceView:s,targetView:c,sourcePort:e.getSourcePortId(),targetPort:e.getTargetPortId(),sourceMagnet:i.sourceMagnet,targetMagnet:i.targetMagnet})}validateEdge(e,t,n){let r=this.graph;if(!this.allowConnectToBlank(e)){let t=e.getSourceCellId(),n=e.getTargetCellId();if(!(t&&n))return!1}let i=r.options.connecting.validateEdge;return i?O(i,r,{edge:e,type:t,previous:n}):!0}arrowheadDragging(e,t,n,r){r.x=t,r.y=n,r.currentTarget!==e&&(r.currentMagnet&&r.currentView&&r.currentView.unhighlight(r.currentMagnet,{type:`magnetAdsorbed`}),r.currentView=this.graph.findViewByElem(e),r.currentView?(r.currentMagnet=r.currentView.findMagnet(e),r.currentMagnet&&this.validateConnection(...r.getValidateConnectionArgs(r.currentView,r.currentMagnet),r.currentView.getEdgeTerminal(r.currentMagnet,t,n,this.cell,r.terminalType))?r.currentView.highlight(r.currentMagnet,{type:`magnetAdsorbed`}):r.currentMagnet=null):r.currentMagnet=null),r.currentTarget=e,this.cell.prop(r.terminalType,{x:t,y:n},Object.assign(Object.assign({},r.options),{ui:!0}))}arrowheadDragged(e,t,n){let r=e.currentView,i=e.currentMagnet;if(!i||!r)return;r.unhighlight(i,{type:`magnetAdsorbed`});let a=e.terminalType,o=r.getEdgeTerminal(i,t,n,this.cell,a);this.cell.setTerminal(a,o,{ui:!0})}snapArrowhead(e,t,n){let r=this.graph,{snap:i,allowEdge:a}=r.options.connecting,o=typeof i==`object`&&i.radius||50,s=typeof i==`object`&&i.anchor||`center`,c=r.renderer.findViewsInArea({x:e-o,y:t-o,width:2*o,height:2*o},{nodeOnly:!0});if(a){let n=r.renderer.findEdgeViewsFromPoint({x:e,y:t},o).filter(e=>e!==this);c.push(...n)}let l=n.closestView||null,u=n.closestMagnet||null;n.closestView=null,n.closestMagnet=null;let d,f=2**53-1,p=new z(e,t);c.forEach(r=>{if(r.container.getAttribute(`magnet`)!==`false`){if(r.isNodeView())d=s===`center`?r.cell.getBBox().getCenter().distance(p):r.cell.getBBox().getNearestPointToPoint(p).distance(p);else if(r.isEdgeView()){let e=r.getClosestPoint(p);d=e?e.distance(p):2**53-1}d<o&&d<f&&(u===r.container||this.validateConnection(...n.getValidateConnectionArgs(r,null),r.getEdgeTerminal(r.container,e,t,this.cell,n.terminalType)))&&(f=d,n.closestView=r,n.closestMagnet=r.container)}r.container.querySelectorAll(`[magnet]`).forEach(i=>{if(i.getAttribute(`magnet`)!==`false`){let a=r.getBBoxOfElement(i);d=p.distance(a.getCenter()),d<o&&d<f&&(u===i||this.validateConnection(...n.getValidateConnectionArgs(r,i),r.getEdgeTerminal(i,e,t,this.cell,n.terminalType)))&&(f=d,n.closestView=r,n.closestMagnet=i)}})});let m,h=n.terminalType,g=n.closestView,_=n.closestMagnet,v=u!==_;if(l&&v&&l.unhighlight(u,{type:`magnetAdsorbed`}),g){if(!v)return;g.highlight(_,{type:`magnetAdsorbed`}),m=g.getEdgeTerminal(_,e,t,this.cell,h)}else m={x:e,y:t};this.cell.setTerminal(h,m,{},Object.assign(Object.assign({},n.options),{ui:!0}))}snapArrowheadEnd(e){let t=e.closestView,n=e.closestMagnet;t&&n&&(t.unhighlight(n,{type:`magnetAdsorbed`}),e.currentMagnet=t.findMagnet(n)),e.closestView=null,e.closestMagnet=null}finishEmbedding(e){this.graph.options.embedding.enabled&&this.cell.updateParent()&&(e.zIndex=null)}fallbackConnection(e){switch(e.fallbackAction){case`remove`:this.cell.remove({ui:!0});break;case`revert`:default:this.cell.prop(e.terminalType,e.initialTerminal,{ui:!0});break}}notifyConnectionEvent(e,t){let n=e.terminalType,r=e.initialTerminal,i=this.cell[n],a=i&&!Z.equalTerminals(r,i);if(a){let a=this.graph,o=r,s=o.cell?a.getCellById(o.cell):null,c=o.port,l=s?a.findViewByCell(s):null,u=s||e.isNewEdge?null:z.create(r).toJSON(),d=i,f=d.cell?a.getCellById(d.cell):null,p=d.port,m=f?a.findViewByCell(f):null,h=f?null:z.create(i).toJSON();this.notify(`edge:connected`,{e:t,previousCell:s,previousPort:c,previousView:l,previousPoint:u,currentCell:f,currentView:m,currentPort:p,currentPoint:h,previousMagnet:e.initialMagnet,currentMagnet:e.currentMagnet,edge:this.cell,view:this,type:n,isNew:e.isNewEdge})}}highlightAvailableMagnets(e){let t=this.graph,n=t.model.getCells();e.marked={};for(let r=0,i=n.length;r<i;r+=1){let i=t.findViewByCell(n[r]);if(!i||i.cell.id===this.cell.id)continue;let a=Array.prototype.slice.call(i.container.querySelectorAll(`[magnet]`));i.container.getAttribute(`magnet`)!==`false`&&a.push(i.container);let o=a.filter(t=>this.validateConnection(...e.getValidateConnectionArgs(i,t),i.getEdgeTerminal(t,e.x,e.y,this.cell,e.terminalType)));if(o.length>0){for(let e=0,t=o.length;e<t;e+=1)i.highlight(o[e],{type:`magnetAvailable`});i.highlight(null,{type:`nodeAvailable`}),e.marked[i.cell.id]=o}}}unhighlightAvailableMagnets(e){let t=e.marked||{};Object.keys(t).forEach(e=>{let n=this.graph.findViewByCell(e);if(n){let r=t[e];r.forEach(e=>{n.unhighlight(e,{type:`magnetAvailable`})}),n.unhighlight(null,{type:`nodeAvailable`})}}),e.marked=null}startArrowheadDragging(e,t,n){if(!this.can(`arrowheadMovable`)){this.notifyUnhandledMouseDown(e,t,n);return}let r=e.target,i=r.getAttribute(`data-terminal`),a=this.prepareArrowheadDragging(i,{x:t,y:n});this.setEventData(e,a)}dragArrowhead(e,t,n){let r=this.getEventData(e);this.graph.options.connecting.snap?this.snapArrowhead(t,n,r):this.arrowheadDragging(this.getEventTarget(e),t,n,r)}stopArrowheadDragging(e,t,n){let r=this.graph,i=this.getEventData(e);r.options.connecting.snap?this.snapArrowheadEnd(i):this.arrowheadDragged(i,t,n);let a=this.validateEdge(this.cell,i.terminalType,i.initialTerminal);a?(this.finishEmbedding(i),this.notifyConnectionEvent(i,e)):this.fallbackConnection(i),this.afterArrowheadDragging(i)}startLabelDragging(e,t,n){if(this.can(`edgeLabelMovable`)){let t=e.currentTarget,n=parseInt(t.getAttribute(`data-index`),10),r=this.getLabelPositionAngle(n),i=this.getLabelPositionArgs(n),a=this.getDefaultLabelPositionArgs(),o=this.mergeLabelPositionArgs(i,a);this.setEventData(e,{index:n,positionAngle:r,positionArgs:o,stopPropagation:!0,action:`drag-label`})}else this.setEventData(e,{stopPropagation:!0});this.graph.view.delegateDragEvents(e,this)}dragLabel(e,t,n){let r=this.getEventData(e),i=this.cell.getLabelAt(r.index),a=v({},i,{position:this.getLabelPosition(t,n,r.positionAngle,r.positionArgs)});this.cell.setLabelAt(r.index,a)}stopLabelDragging(e,t,n){}};(function(e){e.toStringTag=`X6.${e.name}`;function t(t){if(t==null)return!1;if(t instanceof e)return!0;let n=t[Symbol.toStringTag],r=t;return(n==null||n===e.toStringTag)&&typeof r.isNodeView==`function`&&typeof r.isEdgeView==`function`&&typeof r.confirmUpdate==`function`&&typeof r.update==`function`&&typeof r.getConnection==`function`}e.isEdgeView=t})(Bm||={}),Bm.config({isSvgElement:!0,priority:1,bootstrap:[`render`,`source`,`target`],actions:{view:[`render`],markup:[`render`],attrs:[`update`],source:[`source`,`update`],target:[`target`,`update`],router:[`update`],connector:[`update`],labels:[`labels`],defaultLabel:[`labels`],tools:[`tools`],vertices:[`vertices`,`update`]}}),Bm.registry.register(`edge`,Bm,!0);var Vm=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},Hm=class e extends q{get disposeContainer(){return!1}get options(){return this.graph.options}constructor(t){super(),this.graph=t;let{selectors:n,fragment:r}=J.parseJSONMarkup(e.markup);this.background=n.background,this.grid=n.grid,this.svg=n.svg,this.defs=n.defs,this.viewport=n.viewport,this.primer=n.primer,this.stage=n.stage,this.decorator=n.decorator,this.overlay=n.overlay,this.container=this.options.container,this.restore=e.snapshoot(this.container),k(this.container,this.prefixClassName(`graph`)),co(this.container,r),this.delegateEvents()}delegateEvents(){let e=this.constructor;return super.delegateEvents(e.events),this}guard(e,t){return e.type===`mousedown`&&e.button===2||this.options.guard&&this.options.guard(e,t)?!0:e.data&&e.data.guarded!==void 0?e.data.guarded:!(t&&t.cell&&Y.isCell(t.cell)||this.svg===e.target||this.container===e.target||this.svg.contains(e.target))}findView(e){return this.graph.findViewByElem(e)}onDblClick(e){this.options.preventDefaultDblClick&&e.preventDefault();let t=this.normalizeEvent(e),n=this.findView(t.target);if(this.guard(t,n))return;let r=this.graph.snapToGrid(t.clientX,t.clientY);n?n.onDblClick(t,r.x,r.y):this.graph.trigger(`blank:dblclick`,{e:t,x:r.x,y:r.y})}onClick(e){if(this.getMouseMovedCount(e)<=this.options.clickThreshold){let t=this.normalizeEvent(e),n=this.findView(t.target);if(this.guard(t,n))return;let r=this.graph.snapToGrid(t.clientX,t.clientY);n?n.onClick(t,r.x,r.y):this.graph.trigger(`blank:click`,{e:t,x:r.x,y:r.y})}}isPreventDefaultContextMenu(e){let t=this.options.preventDefaultContextMenu;return typeof t==`function`&&(t=O(t,this.graph,{view:e})),t}onContextMenu(e){let t=this.normalizeEvent(e),n=this.findView(t.target);if(this.isPreventDefaultContextMenu(n)&&e.preventDefault(),this.guard(t,n))return;let r=this.graph.snapToGrid(t.clientX,t.clientY);n?n.onContextMenu(t,r.x,r.y):this.graph.trigger(`blank:contextmenu`,{e:t,x:r.x,y:r.y})}delegateDragEvents(e,t){e.data??={},this.setEventData(e,{currentView:t||null,mouseMovedCount:0,startPosition:{x:e.clientX,y:e.clientY}});let n=this.constructor;this.delegateDocumentEvents(n.documentEvents,e.data),this.undelegateEvents()}getMouseMovedCount(e){let t=this.getEventData(e);return t.mouseMovedCount||0}onMouseDown(e){let t=this.normalizeEvent(e),n=this.findView(t.target);if(this.guard(t,n))return;this.options.preventDefaultMouseDown&&e.preventDefault();let r=this.graph.snapToGrid(t.clientX,t.clientY);n?n.onMouseDown(t,r.x,r.y):(this.options.preventDefaultBlankAction&&[`touchstart`].includes(t.type)&&e.preventDefault(),this.graph.trigger(`blank:mousedown`,{e:t,x:r.x,y:r.y})),this.delegateDragEvents(t,n)}onMouseMove(e){let t=this.getEventData(e),n=t.startPosition;if(n&&n.x===e.clientX&&n.y===e.clientY)return;t.mouseMovedCount??=0,t.mouseMovedCount+=1;let r=t.mouseMovedCount;if(r<=this.options.moveThreshold)return;let i=this.normalizeEvent(e),a=this.graph.snapToGrid(i.clientX,i.clientY),o=t.currentView;o?o.onMouseMove(i,a.x,a.y):this.graph.trigger(`blank:mousemove`,{e:i,x:a.x,y:a.y}),this.setEventData(i,t)}onMouseUp(e){this.undelegateDocumentEvents();let t=this.normalizeEvent(e),n=this.graph.snapToGrid(t.clientX,t.clientY),r=this.getEventData(e),i=r.currentView;if(i?i.onMouseUp(t,n.x,n.y):this.graph.trigger(`blank:mouseup`,{e:t,x:n.x,y:n.y}),!e.isPropagationStopped()){let t=new Vs(e,{type:`click`,data:e.data});this.onClick(t)}e.stopImmediatePropagation(),this.delegateEvents()}onMouseOver(e){let t=this.normalizeEvent(e),n=this.findView(t.target);if(!this.guard(t,n))if(n)n.onMouseOver(t);else{if(this.container===t.target)return;this.graph.trigger(`blank:mouseover`,{e:t})}}onMouseOut(e){let t=this.normalizeEvent(e),n=this.findView(t.target);if(!this.guard(t,n))if(n)n.onMouseOut(t);else{if(this.container===t.target)return;this.graph.trigger(`blank:mouseout`,{e:t})}}onMouseEnter(e){let t=this.normalizeEvent(e),n=this.findView(t.target);if(this.guard(t,n))return;let r=this.graph.findViewByElem(t.relatedTarget);if(n){if(r===n)return;n.onMouseEnter(t)}else{if(r)return;this.graph.trigger(`graph:mouseenter`,{e:t})}}onMouseLeave(e){let t=this.normalizeEvent(e),n=this.findView(t.target);if(this.guard(t,n))return;let r=this.graph.findViewByElem(t.relatedTarget);if(n){if(r===n)return;n.onMouseLeave(t)}else{if(r)return;this.graph.trigger(`graph:mouseleave`,{e:t})}}onMouseWheel(e){let t=this.normalizeEvent(e),n=this.findView(t.target);if(this.guard(t,n))return;let r=t.originalEvent,i=this.graph.snapToGrid(r.clientX,r.clientY),a=Math.max(-1,Math.min(1,r.wheelDelta||-r.detail));n?n.onMouseWheel(t,i.x,i.y,a):this.graph.trigger(`blank:mousewheel`,{e:t,delta:a,x:i.x,y:i.y})}onCustomEvent(e){let t=e.currentTarget,n=t.getAttribute(`event`)||t.getAttribute(`data-event`);if(n){let r=this.findView(t);if(r){let t=this.normalizeEvent(e);if(this.guard(t,r))return;let i=this.graph.snapToGrid(t.clientX,t.clientY);r.onCustomEvent(t,n,i.x,i.y)}}}handleMagnetEvent(e,t){let n=e.currentTarget,r=n.getAttribute(`magnet`);if(r&&r.toLowerCase()!==`false`){let r=this.findView(n);if(r){let i=this.normalizeEvent(e);if(this.guard(i,r))return;let a=this.graph.snapToGrid(i.clientX,i.clientY);O(t,this.graph,r,i,n,a.x,a.y)}}}onMagnetMouseDown(e){this.handleMagnetEvent(e,(e,t,n,r,i)=>{e.onMagnetMouseDown(t,n,r,i)})}onMagnetDblClick(e){this.handleMagnetEvent(e,(e,t,n,r,i)=>{e.onMagnetDblClick(t,n,r,i)})}onMagnetContextMenu(e){let t=this.findView(e.target);this.isPreventDefaultContextMenu(t)&&e.preventDefault(),this.handleMagnetEvent(e,(e,t,n,r,i)=>{e.onMagnetContextMenu(t,n,r,i)})}onLabelMouseDown(e){let t=e.currentTarget,n=this.findView(t);if(n){let t=this.normalizeEvent(e);if(this.guard(t,n))return;let r=this.graph.snapToGrid(t.clientX,t.clientY);n.onLabelMouseDown(t,r.x,r.y)}}onImageDragStart(){return!1}dispose(){this.undelegateEvents(),this.undelegateDocumentEvents(),this.restore(),this.restore=()=>{}}};Vm([q.dispose()],Hm.prototype,`dispose`,null),function(e){let t=`${G.prefixCls}-graph`;e.markup=[{ns:A.xhtml,tagName:`div`,selector:`background`,className:`${t}-background`},{ns:A.xhtml,tagName:`div`,selector:`grid`,className:`${t}-grid`},{ns:A.svg,tagName:`svg`,selector:`svg`,className:`${t}-svg`,attrs:{width:`100%`,height:`100%`,"xmlns:xlink":A.xlink},children:[{tagName:`defs`,selector:`defs`},{tagName:`g`,selector:`viewport`,className:`${t}-svg-viewport`,children:[{tagName:`g`,selector:`primer`,className:`${t}-svg-primer`},{tagName:`g`,selector:`stage`,className:`${t}-svg-stage`},{tagName:`g`,selector:`decorator`,className:`${t}-svg-decorator`},{tagName:`g`,selector:`overlay`,className:`${t}-svg-overlay`}]}]}];function n(e){let t=e.cloneNode();return e.childNodes.forEach(e=>t.appendChild(e)),()=>{for(so(e);e.attributes.length>0;)e.removeAttribute(e.attributes[0].name);for(let n=0,r=t.attributes.length;n<r;n+=1){let r=t.attributes[n];e.setAttribute(r.name,r.value)}t.childNodes.forEach(t=>e.appendChild(t))}}e.snapshoot=n}(Hm||={}),function(e){let t=G.prefixCls;e.events={dblclick:`onDblClick`,contextmenu:`onContextMenu`,touchstart:`onMouseDown`,mousedown:`onMouseDown`,mouseover:`onMouseOver`,mouseout:`onMouseOut`,mouseenter:`onMouseEnter`,mouseleave:`onMouseLeave`,mousewheel:`onMouseWheel`,DOMMouseScroll:`onMouseWheel`,[`mouseenter  .${t}-cell`]:`onMouseEnter`,[`mouseleave  .${t}-cell`]:`onMouseLeave`,[`mouseenter  .${t}-cell-tools`]:`onMouseEnter`,[`mouseleave  .${t}-cell-tools`]:`onMouseLeave`,[`mousedown   .${t}-cell [event]`]:`onCustomEvent`,[`touchstart  .${t}-cell [event]`]:`onCustomEvent`,[`mousedown   .${t}-cell [data-event]`]:`onCustomEvent`,[`touchstart  .${t}-cell [data-event]`]:`onCustomEvent`,[`dblclick    .${t}-cell [magnet]`]:`onMagnetDblClick`,[`contextmenu .${t}-cell [magnet]`]:`onMagnetContextMenu`,[`mousedown   .${t}-cell [magnet]`]:`onMagnetMouseDown`,[`touchstart  .${t}-cell [magnet]`]:`onMagnetMouseDown`,[`dblclick    .${t}-cell [data-magnet]`]:`onMagnetDblClick`,[`contextmenu .${t}-cell [data-magnet]`]:`onMagnetContextMenu`,[`mousedown   .${t}-cell [data-magnet]`]:`onMagnetMouseDown`,[`touchstart  .${t}-cell [data-magnet]`]:`onMagnetMouseDown`,[`dragstart   .${t}-cell image`]:`onImageDragStart`,[`mousedown   .${t}-edge .${t}-edge-label`]:`onLabelMouseDown`,[`touchstart  .${t}-edge .${t}-edge-label`]:`onLabelMouseDown`},e.documentEvents={mousemove:`onMouseMove`,touchmove:`onMouseMove`,mouseup:`onMouseUp`,touchend:`onMouseUp`,touchcancel:`onMouseUp`}}(Hm||={});const Um=`.x6-graph {
  position: relative;
  overflow: hidden;
  outline: none;
  touch-action: none;
}
.x6-graph-background,
.x6-graph-grid,
.x6-graph-svg {
  position: absolute;
  top: 0;
  right: 0;
  bottom: 0;
  left: 0;
}
.x6-graph-background-stage,
.x6-graph-grid-stage,
.x6-graph-svg-stage {
  user-select: none;
}
.x6-graph.x6-graph-pannable {
  cursor: grab;
  cursor: -moz-grab;
  cursor: -webkit-grab;
}
.x6-graph.x6-graph-panning {
  cursor: grabbing;
  cursor: -moz-grabbing;
  cursor: -webkit-grabbing;
  user-select: none;
}
.x6-node {
  cursor: move;
  /* stylelint-disable-next-line */
}
.x6-node.x6-node-immovable {
  cursor: default;
}
.x6-node * {
  -webkit-user-drag: none;
}
.x6-node .scalable * {
  vector-effect: non-scaling-stroke;
}
.x6-node [magnet='true'] {
  cursor: crosshair;
  transition: opacity 0.3s;
}
.x6-node [magnet='true']:hover {
  opacity: 0.7;
}
.x6-node foreignObject {
  display: block;
  overflow: visible;
  background-color: transparent;
}
.x6-node foreignObject > body {
  position: static;
  width: 100%;
  height: 100%;
  margin: 0;
  padding: 0;
  overflow: visible;
  background-color: transparent;
}
.x6-edge .source-marker,
.x6-edge .target-marker {
  vector-effect: non-scaling-stroke;
}
.x6-edge .connection {
  stroke-linejoin: round;
  fill: none;
}
.x6-edge .connection-wrap {
  cursor: move;
  opacity: 0;
  fill: none;
  stroke: #000;
  stroke-width: 15;
  stroke-linecap: round;
  stroke-linejoin: round;
}
.x6-edge .connection-wrap:hover {
  opacity: 0.4;
  stroke-opacity: 0.4;
}
.x6-edge .vertices {
  cursor: move;
  opacity: 0;
}
.x6-edge .vertices .vertex {
  fill: #1abc9c;
}
.x6-edge .vertices .vertex :hover {
  fill: #34495e;
  stroke: none;
}
.x6-edge .vertices .vertex-remove {
  cursor: pointer;
  fill: #fff;
}
.x6-edge .vertices .vertex-remove-area {
  cursor: pointer;
  opacity: 0.1;
}
.x6-edge .vertices .vertex-group:hover .vertex-remove-area {
  opacity: 1;
}
.x6-edge .arrowheads {
  cursor: move;
  opacity: 0;
}
.x6-edge .arrowheads .arrowhead {
  fill: #1abc9c;
}
.x6-edge .arrowheads .arrowhead :hover {
  fill: #f39c12;
  stroke: none;
}
.x6-edge .tools {
  cursor: pointer;
  opacity: 0;
}
.x6-edge .tools .tool-options {
  display: none;
}
.x6-edge .tools .tool-remove circle {
  fill: #f00;
}
.x6-edge .tools .tool-remove path {
  fill: #fff;
}
.x6-edge:hover .vertices,
.x6-edge:hover .arrowheads,
.x6-edge:hover .tools {
  opacity: 1;
}
.x6-highlight-opacity {
  opacity: 0.3;
}
.x6-cell-tool-editor {
  position: relative;
  display: inline-block;
  min-height: 1em;
  margin: 0;
  padding: 0;
  line-height: 1;
  white-space: normal;
  text-align: center;
  vertical-align: top;
  overflow-wrap: normal;
  outline: none;
  transform-origin: 0 0;
  -webkit-user-drag: none;
}
.x6-edge-tool-editor {
  border: 1px solid #275fc5;
  border-radius: 2px;
}
`;var Q=class extends zi{get options(){return this.graph.options}get model(){return this.graph.model}get view(){return this.graph.view}constructor(e){super(),this.graph=e,this.init()}init(){}},Wm=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},Gm=class extends Q{init(){G.autoInsertCSS&&cc(`core`,Um)}dispose(){lc(`core`)}};Wm([Gm.dispose()],Gm.prototype,`dispose`,null);var Km=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(e!=null&&typeof Object.getOwnPropertySymbols==`function`)for(var i=0,r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]]);return n},qm;(function(e){function t(t){let{grid:n,panning:r,mousewheel:i,embedding:a}=t,o=Km(t,[`grid`,`panning`,`mousewheel`,`embedding`]),s=t.container;if(s!=null)o.width??=s.clientWidth,o.height??=s.clientHeight;else throw Error(`Ensure the container of the graph is specified and valid`);let c=v({},e.defaults,o),l={size:10,visible:!1};typeof n==`number`?c.grid={size:n,visible:!1}:typeof n==`boolean`?c.grid=Object.assign(Object.assign({},l),{visible:n}):c.grid=Object.assign(Object.assign({},l),n);let u=[`panning`,`mousewheel`,`embedding`];return u.forEach(e=>{let n=t[e];typeof n==`boolean`?c[e].enabled=n:c[e]=Object.assign(Object.assign({},c[e]),n)}),c}e.get=t})(qm||={}),function(e){e.defaults={x:0,y:0,scaling:{min:.01,max:16},grid:{size:10,visible:!1},background:!1,panning:{enabled:!1,eventTypes:[`leftMouseDown`]},mousewheel:{enabled:!1,factor:1.2,zoomAtMousePosition:!0},highlighting:{default:{name:`stroke`,args:{padding:3}},nodeAvailable:{name:`className`,args:{className:G.prefix(`available-node`)}},magnetAvailable:{name:`className`,args:{className:G.prefix(`available-magnet`)}}},connecting:{snap:!1,allowLoop:!0,allowNode:!0,allowEdge:!1,allowPort:!0,allowBlank:!0,allowMulti:!0,highlight:!1,anchor:`center`,edgeAnchor:`ratio`,connectionPoint:`boundary`,router:`normal`,connector:`normal`,validateConnection({type:e,sourceView:t,targetView:n}){let r=e===`target`?n:t;return r!=null},createEdge(){return new Em}},translating:{restrict:!1},embedding:{enabled:!1,findParent:`bbox`,frontOnly:!0,validate:()=>!0},moveThreshold:0,clickThreshold:0,magnetThreshold:0,preventDefaultDblClick:!0,preventDefaultMouseDown:!1,preventDefaultContextMenu:!0,preventDefaultBlankAction:!0,interacting:{edgeLabelMovable:!1},async:!0,virtual:!1,guard:()=>!1}}(qm||={});var Jm=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},Ym=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(e!=null&&typeof Object.getOwnPropertySymbols==`function`)for(var i=0,r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]]);return n},Xm=class extends Q{get elem(){return this.view.grid}get grid(){return this.options.grid}init(){this.startListening(),this.draw(this.grid)}startListening(){this.graph.on(`scale`,this.update,this),this.graph.on(`translate`,this.update,this)}stopListening(){this.graph.off(`scale`,this.update,this),this.graph.off(`translate`,this.update,this)}setVisible(e){this.grid.visible!==e&&(this.grid.visible=e,this.update())}getGridSize(){return this.grid.size}setGridSize(e){this.grid.size=Math.max(e,1),this.update()}show(){this.setVisible(!0),this.update()}hide(){this.setVisible(!1),this.update()}clear(){this.elem.style.backgroundImage=``}draw(e){this.clear(),this.instance=null,Object.assign(this.grid,e),this.patterns=this.resolveGrid(e),this.update()}update(e={}){let t=this.grid.size;if(t<=1||!this.grid.visible)return this.clear();let n=this.graph.matrix(),r=this.getInstance(),i=Array.isArray(e)?e:[e];this.patterns.forEach((e,a)=>{let o=`pattern_${a}`,s=n.a||1,c=n.d||1,{update:l,markup:u}=e,d=Ym(e,[`update`,`markup`]),f=Object.assign(Object.assign(Object.assign({},d),i[a]),{sx:s,sy:c,ox:n.e||0,oy:n.f||0,width:t*s,height:t*c});r.has(o)||r.add(o,M.create(`pattern`,{id:o,patternUnits:`userSpaceOnUse`},M.createVectors(u)).node);let p=r.get(o);typeof l==`function`&&l(p.childNodes[0],f);let m=f.ox%f.width;m<0&&(m+=f.width);let h=f.oy%f.height;h<0&&(h+=f.height),j(p,{x:m,y:h,width:f.width,height:f.height})});let a=new XMLSerializer().serializeToString(r.root),o=`url(data:image/svg+xml;base64,${btoa(a)})`;this.elem.style.backgroundImage=o}getInstance(){return this.instance||=new Rc,this.instance}resolveGrid(e){if(!e)return[];let t=e.type;if(t==null)return[Object.assign(Object.assign({},Rc.presets.dot),e.args)];let n=Rc.registry.get(t);if(n){let t=e.args||[];return Array.isArray(t)||(t=[t]),Array.isArray(n)?n.map((e,n)=>Object.assign(Object.assign({},e),t[n])):[Object.assign(Object.assign({},n),t[0])]}return Rc.registry.onNotFound(t)}dispose(){this.stopListening(),this.clear()}};Jm([Q.dispose()],Xm.prototype,`dispose`,null);var Zm=class extends Q{get container(){return this.graph.view.container}get viewport(){return this.graph.view.viewport}get stage(){return this.graph.view.stage}init(){this.resize()}getMatrix(){let e=this.viewport.getAttribute(`transform`);return e!==this.viewportTransformString&&(this.viewportMatrix=this.viewport.getCTM(),this.viewportTransformString=e),P(this.viewportMatrix)}setMatrix(e){let t=P(e),n=Ts(t);this.viewport.setAttribute(`transform`,n),this.viewportMatrix=t,this.viewportTransformString=n}resize(e,t){let n=e===void 0?this.options.width:e,r=t===void 0?this.options.height:t;this.options.width=n,this.options.height=r,typeof n==`number`&&(n=Math.round(n)),typeof r==`number`&&(r=Math.round(r)),this.container.style.width=n==null?``:`${n}px`,this.container.style.height=r==null?``:`${r}px`;let i=this.getComputedSize();return this.graph.trigger(`resize`,Object.assign({},i)),this}getComputedSize(){let e=this.options.width,t=this.options.height;return Zr(e)||(e=this.container.clientWidth),Zr(t)||(t=this.container.clientHeight),{width:e,height:t}}getScale(){return ks(this.getMatrix())}scale(e,t=e,n=0,r=0){if(e=this.clampScale(e),t=this.clampScale(t),n||r){let i=this.getTranslation(),a=i.tx-n*(e-1),o=i.ty-r*(t-1);(a!==i.tx||o!==i.ty)&&this.translate(a,o)}let i=this.getMatrix();return i.a=e,i.d=t,this.setMatrix(i),this.graph.trigger(`scale`,{sx:e,sy:t,ox:n,oy:r}),this}clampScale(e){let t=this.graph.options.scaling;return lr(e,t.min||.01,t.max||16)}getZoom(){return this.getScale().sx}zoom(e,t){t||={};let n=e,r=e,i=this.getScale(),a=this.getComputedSize(),o=a.width/2,s=a.height/2;if(t.absolute||(n+=i.sx,r+=i.sy),t.scaleGrid&&(n=Math.round(n/t.scaleGrid)*t.scaleGrid,r=Math.round(r/t.scaleGrid)*t.scaleGrid),t.maxScale&&(n=Math.min(t.maxScale,n),r=Math.min(t.maxScale,r)),t.minScale&&(n=Math.max(t.minScale,n),r=Math.max(t.minScale,r)),t.center&&(o=t.center.x,s=t.center.y),n=this.clampScale(n),r=this.clampScale(r),o||s){let e=this.getTranslation(),t=o-(o-e.tx)*(n/i.sx),a=s-(s-e.ty)*(r/i.sy);(t!==e.tx||a!==e.ty)&&this.translate(t,a)}return this.scale(n,r),this}getRotation(){return As(this.getMatrix())}rotate(e,t,n){if(t==null||n==null){let e=K.getBBox(this.stage);t=e.width/2,n=e.height/2}let r=this.getMatrix().translate(t,n).rotate(e).translate(-t,-n);return this.setMatrix(r),this}getTranslation(){return js(this.getMatrix())}translate(e,t){let n=this.getMatrix();n.e=e||0,n.f=t||0,this.setMatrix(n);let r=this.getTranslation();return this.options.x=r.tx,this.options.y=r.ty,this.graph.trigger(`translate`,Object.assign({},r)),this}setOrigin(e,t){return this.translate(e||0,t||0)}fitToContent(e,t,n,r){if(typeof e==`object`){let i=e;e=i.gridWidth||1,t=i.gridHeight||1,n=i.padding||0,r=i}else e||=1,t||=1,n||=0,r??={};let i=ya(n),a=r.border||0,o=r.contentArea?B.create(r.contentArea):this.getContentArea(r);a>0&&o.inflate(a);let s=this.getScale(),c=this.getTranslation(),l=s.sx,u=s.sy;o.x*=l,o.y*=u,o.width*=l,o.height*=u;let d=Math.max(Math.ceil((o.width+o.x)/e),1)*e,f=Math.max(Math.ceil((o.height+o.y)/t),1)*t,p=0,m=0;(r.allowNewOrigin===`negative`&&o.x<0||r.allowNewOrigin===`positive`&&o.x>=0||r.allowNewOrigin===`any`)&&(p=Math.ceil(-o.x/e)*e,p+=i.left,d+=p),(r.allowNewOrigin===`negative`&&o.y<0||r.allowNewOrigin===`positive`&&o.y>=0||r.allowNewOrigin===`any`)&&(m=Math.ceil(-o.y/t)*t,m+=i.top,f+=m),d+=i.right,f+=i.bottom,d=Math.max(d,r.minWidth||0),f=Math.max(f,r.minHeight||0),d=Math.min(d,r.maxWidth||2**53-1),f=Math.min(f,r.maxHeight||2**53-1);let h=this.getComputedSize(),g=d!==h.width||f!==h.height,_=p!==c.tx||m!==c.ty;return _&&this.translate(p,m),g&&this.resize(d,f),new B(-p/l,-m/u,d/l,f/u)}scaleContentToFit(e={}){this.scaleContentToFitImpl(e)}scaleContentToFitImpl(e={},t=!0){let n,r;if(e.contentArea){let t=e.contentArea;n=this.graph.localToGraph(t),r=z.create(t)}else n=this.getContentBBox(e),r=this.graph.graphToLocal(n);if(!n.width||!n.height)return;let i=ya(e.padding),a=e.minScale||0,o=e.maxScale||2**53-1,s=e.minScaleX||a,c=e.maxScaleX||o,l=e.minScaleY||a,u=e.maxScaleY||o,d;if(e.viewportArea)d=e.viewportArea;else{let e=this.getComputedSize(),t=this.getTranslation();d={x:t.tx,y:t.ty,width:e.width,height:e.height}}d=B.create(d).moveAndExpand({x:i.left,y:i.top,width:-i.left-i.right,height:-i.top-i.bottom});let f=this.getScale(),p=d.width/n.width*f.sx,m=d.height/n.height*f.sy;e.preserveAspectRatio!==!1&&(p=m=Math.min(p,m));let h=e.scaleGrid;if(h&&(p=h*Math.floor(p/h),m=h*Math.floor(m/h)),p=lr(p,s,c),m=lr(m,l,u),this.scale(p,m),t){let e=this.options,t=d.x-r.x*p-e.x,n=d.y-r.y*m-e.y;this.translate(t,n)}}getContentArea(e={}){return e.useCellGeometry===!1?K.getBBox(this.stage):this.model.getAllCellsBBox()||new B}getContentBBox(e={}){return this.graph.localToGraph(this.getContentArea(e))}getGraphArea(){let e=B.fromSize(this.getComputedSize());return this.graph.graphToLocal(e)}zoomToRect(e,t={}){let n=B.create(e),r=this.graph;t.contentArea=n,t.viewportArea??={x:r.options.x,y:r.options.y,width:this.options.width,height:this.options.height},this.scaleContentToFitImpl(t,!1);let i=n.getCenter();return this.centerPoint(i.x,i.y),this}zoomToFit(e={}){return this.zoomToRect(this.getContentArea(e),e)}centerPoint(e,t){let n=this.getComputedSize(),r=this.getScale(),i=this.getTranslation(),a=n.width/2,o=n.height/2;e=typeof e==`number`?e:a,t=typeof t==`number`?t:o,e=a-e*r.sx,t=o-t*r.sy,(i.tx!==e||i.ty!==t)&&this.translate(e,t)}centerContent(e){let t=this.graph.getContentArea(e),n=t.getCenter();this.centerPoint(n.x,n.y)}centerCell(e){return this.positionCell(e,`center`)}positionPoint(e,t,n){let r=this.getComputedSize();t=va(t,Math.max(0,r.width)),t<0&&(t=r.width+t),n=va(n,Math.max(0,r.height)),n<0&&(n=r.height+n);let i=this.getTranslation(),a=this.getScale(),o=t-e.x*a.sx,s=n-e.y*a.sy;(i.tx!==o||i.ty!==s)&&this.translate(o,s)}positionRect(e,t){let n=B.create(e);switch(t){case`center`:return this.positionPoint(n.getCenter(),`50%`,`50%`);case`top`:return this.positionPoint(n.getTopCenter(),`50%`,0);case`top-right`:return this.positionPoint(n.getTopRight(),`100%`,0);case`right`:return this.positionPoint(n.getRightMiddle(),`100%`,`50%`);case`bottom-right`:return this.positionPoint(n.getBottomRight(),`100%`,`100%`);case`bottom`:return this.positionPoint(n.getBottomCenter(),`50%`,`100%`);case`bottom-left`:return this.positionPoint(n.getBottomLeft(),0,`100%`);case`left`:return this.positionPoint(n.getLeftMiddle(),0,`50%`);case`top-left`:return this.positionPoint(n.getTopLeft(),0,0);default:return this}}positionCell(e,t){let n=e.getBBox();return this.positionRect(n,t)}positionContent(e,t){let n=this.graph.getContentArea(t);return this.positionRect(n,e)}},Qm=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},$m=class extends Q{get elem(){return this.view.background}init(){this.startListening(),this.options.background&&this.draw(this.options.background)}startListening(){this.graph.on(`scale`,this.update,this),this.graph.on(`translate`,this.update,this)}stopListening(){this.graph.off(`scale`,this.update,this),this.graph.off(`translate`,this.update,this)}updateBackgroundImage(e={}){let t=e.size||`auto auto`,n=e.position||`center`,r=this.graph.transform.getScale(),i=this.graph.translate();if(typeof n==`object`){let e=i.tx+r.sx*(n.x||0),t=i.ty+r.sy*(n.y||0);n=`${e}px ${t}px`}typeof t==`object`&&(t=B.fromSize(t).scale(r.sx,r.sy),t=`${t.width}px ${t.height}px`),this.elem.style.backgroundSize=t,this.elem.style.backgroundPosition=n}drawBackgroundImage(e,t={}){if(!(e instanceof HTMLImageElement)){this.elem.style.backgroundImage=``;return}let n=this.optionsCache;if(n&&n.image!==t.image)return;let r,i=t.opacity,a=t.size,o=t.repeat||`no-repeat`,s=Wc.registry.get(o);if(typeof s==`function`){let n=t.quality||1;e.width*=n,e.height*=n;let i=s(e,t);if(!(i instanceof HTMLCanvasElement))throw Error(`Background pattern must return an HTML Canvas instance`);r=i.toDataURL(`image/png`),o=t.repeat&&o!==t.repeat?t.repeat:`repeat`,typeof a==`object`?(a.width*=i.width/e.width,a.height*=i.height/e.height):a===void 0&&(t.size={width:i.width/n,height:i.height/n})}else r=e.src,a===void 0&&(t.size={width:e.width,height:e.height});n!=null&&typeof t.size==`object`&&t.image===n.image&&t.repeat===n.repeat&&t.quality===n.quality&&(n.size=de(t.size));let c=this.elem.style;c.backgroundImage=`url(${r})`,c.backgroundRepeat=o,c.opacity=i==null||i>=1?``:`${i}`,this.updateBackgroundImage(t)}updateBackgroundColor(e){this.elem.style.backgroundColor=e||``}updateBackgroundOptions(e){this.graph.options.background=e}update(){this.optionsCache&&this.updateBackgroundImage(this.optionsCache)}draw(e){let t=e||{};if(this.updateBackgroundOptions(e),this.updateBackgroundColor(t.color),t.image){this.optionsCache=de(t);let n=document.createElement(`img`);n.onload=()=>this.drawBackgroundImage(n,e),n.setAttribute(`crossorigin`,`anonymous`),n.src=t.image}else this.drawBackgroundImage(null),this.optionsCache=null}clear(){this.draw()}dispose(){this.clear(),this.stopListening()}};Qm([Q.dispose()],$m.prototype,`dispose`,null);var eh=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},th=class extends Q{get widgetOptions(){return this.options.panning}get pannable(){return this.widgetOptions&&this.widgetOptions.enabled===!0}init(){this.onRightMouseDown=this.onRightMouseDown.bind(this),this.onSpaceKeyDown=this.onSpaceKeyDown.bind(this),this.onSpaceKeyUp=this.onSpaceKeyUp.bind(this),this.startListening(),this.updateClassName()}startListening(){this.graph.on(`blank:mousedown`,this.onMouseDown,this),this.graph.on(`node:unhandled:mousedown`,this.onMouseDown,this),this.graph.on(`edge:unhandled:mousedown`,this.onMouseDown,this),I.on(this.graph.container,`mousedown`,this.onRightMouseDown),I.on(document.body,{keydown:this.onSpaceKeyDown,keyup:this.onSpaceKeyUp}),this.mousewheelHandle=new Ks(this.graph.container,this.onMouseWheel.bind(this),this.allowMouseWheel.bind(this)),this.mousewheelHandle.enable()}stopListening(){this.graph.off(`blank:mousedown`,this.onMouseDown,this),this.graph.off(`node:unhandled:mousedown`,this.onMouseDown,this),this.graph.off(`edge:unhandled:mousedown`,this.onMouseDown,this),I.off(this.graph.container,`mousedown`,this.onRightMouseDown),I.off(document.body,{keydown:this.onSpaceKeyDown,keyup:this.onSpaceKeyUp}),this.mousewheelHandle&&this.mousewheelHandle.disable()}allowPanning(e,t){return e.spaceKey=this.isSpaceKeyPressed,this.pannable&&ic.isMatch(e,this.widgetOptions.modifiers,t)}startPanning(e){let t=this.view.normalizeEvent(e);this.clientX=t.clientX,this.clientY=t.clientY,this.panning=!0,this.updateClassName(),I.on(document.body,{"mousemove.panning touchmove.panning":this.pan.bind(this),"mouseup.panning touchend.panning":this.stopPanning.bind(this),"mouseleave.panning":this.stopPanning.bind(this)}),I.on(window,`mouseup.panning`,this.stopPanning.bind(this))}pan(e){let t=this.view.normalizeEvent(e),n=t.clientX-this.clientX,r=t.clientY-this.clientY;this.clientX=t.clientX,this.clientY=t.clientY,this.graph.translateBy(n,r)}stopPanning(e){this.panning=!1,this.updateClassName(),I.off(document.body,`.panning`),I.off(window,`.panning`)}updateClassName(){let e=this.view.container,t=this.view.prefixClassName(`graph-panning`),n=this.view.prefixClassName(`graph-pannable`);this.pannable?this.panning?(k(e,t),Ha(e,n)):(Ha(e,t),k(e,n)):(Ha(e,t),Ha(e,n))}onMouseDown({e}){if(!this.allowBlankMouseDown(e))return;let t=this.graph.getPlugin(`selection`),n=t&&t.allowRubberband(e,!0);(this.allowPanning(e,!0)||this.allowPanning(e)&&!n)&&this.startPanning(e)}onRightMouseDown(e){let t=this.widgetOptions.eventTypes;t?.includes(`rightMouseDown`)&&e.button===2&&this.allowPanning(e,!0)&&this.startPanning(e)}onMouseWheel(e,t,n){this.graph.translateBy(-t,-n)}onSpaceKeyDown(e){e.which===32&&(this.isSpaceKeyPressed=!0)}onSpaceKeyUp(e){e.which===32&&(this.isSpaceKeyPressed=!1)}allowBlankMouseDown(e){let t=this.widgetOptions.eventTypes;return t?.includes(`leftMouseDown`)&&e.button===0||t?.includes(`mouseWheelDown`)&&e.button===1}allowMouseWheel(e){var t;return this.pannable&&!e.ctrlKey&&(t=this.widgetOptions.eventTypes)?.includes(`mouseWheel`)}autoPanning(e,t){let n=10,r=this.graph.getGraphArea(),i=0,a=0;e<=r.left+n&&(i=-n),t<=r.top+n&&(a=-n),e>=r.right-n&&(i=n),t>=r.bottom-n&&(a=n),(i!==0||a!==0)&&this.graph.translateBy(-i,-a)}enablePanning(){this.pannable||(this.widgetOptions.enabled=!0,this.updateClassName())}disablePanning(){this.pannable&&(this.widgetOptions.enabled=!1,this.updateClassName())}dispose(){this.stopListening()}};eh([Q.dispose()],th.prototype,`dispose`,null);var nh=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},rh=class extends Q{constructor(){super(...arguments),this.cumulatedFactor=1}get widgetOptions(){return this.options.mousewheel}init(){this.container=this.graph.container,this.target=this.widgetOptions.global?document:this.container,this.mousewheelHandle=new Ks(this.target,this.onMouseWheel.bind(this),this.allowMouseWheel.bind(this)),this.widgetOptions.enabled&&this.enable(!0)}get disabled(){return this.widgetOptions.enabled!==!0}enable(e){(this.disabled||e)&&(this.widgetOptions.enabled=!0,this.mousewheelHandle.enable())}disable(){this.disabled||(this.widgetOptions.enabled=!1,this.mousewheelHandle.disable())}allowMouseWheel(e){let t=this.widgetOptions.guard;return(t==null||t(e))&&ic.isMatch(e,this.widgetOptions.modifiers)}onMouseWheel(e){let t=this.widgetOptions.guard;if((t==null||t(e))&&ic.isMatch(e,this.widgetOptions.modifiers)){let t=this.widgetOptions.factor||1.2;this.currentScale??(this.startPos={x:e.clientX,y:e.clientY},this.currentScale=this.graph.transform.getScale().sx);let n=e.deltaY;n<0?this.currentScale<.15?this.cumulatedFactor=(this.currentScale+.01)/this.currentScale:(this.cumulatedFactor=Math.round(this.currentScale*t*20)/20/this.currentScale,this.cumulatedFactor===1&&(this.cumulatedFactor=1.05)):this.currentScale<=.15?this.cumulatedFactor=(this.currentScale-.01)/this.currentScale:(this.cumulatedFactor=Math.round(this.currentScale*(1/t)*20)/20/this.currentScale,this.cumulatedFactor===1&&(this.cumulatedFactor=.95)),this.cumulatedFactor=Math.max(.01,Math.min(this.currentScale*this.cumulatedFactor,160)/this.currentScale);let r=this.currentScale,i=this.graph.transform.clampScale(r*this.cumulatedFactor),a=this.widgetOptions.minScale||-(2**53-1),o=this.widgetOptions.maxScale||2**53-1;if(i=lr(i,a,o),i!==r)if(this.widgetOptions.zoomAtMousePosition){let e=!!this.graph.getPlugin(`scroller`),t=e?this.graph.clientToLocal(this.startPos):this.graph.clientToGraph(this.startPos);this.graph.zoom(i,{absolute:!0,center:t.clone()})}else this.graph.zoom(i,{absolute:!0});this.currentScale=null,this.cumulatedFactor=1}}dispose(){this.disable()}};nh([zi.dispose()],rh.prototype,`dispose`,null);var ih=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},ah=class extends Q{init(){this.resetRenderArea=Pi(this.resetRenderArea,200,{leading:!0}),this.resetRenderArea(),this.startListening()}startListening(){this.graph.on(`translate`,this.resetRenderArea,this),this.graph.on(`scale`,this.resetRenderArea,this),this.graph.on(`resize`,this.resetRenderArea,this)}stopListening(){this.graph.off(`translate`,this.resetRenderArea,this),this.graph.off(`scale`,this.resetRenderArea,this),this.graph.off(`resize`,this.resetRenderArea,this)}enableVirtualRender(){this.options.virtual=!0,this.resetRenderArea()}disableVirtualRender(){this.options.virtual=!1,this.graph.renderer.setRenderArea(void 0)}resetRenderArea(){if(this.options.virtual){let e=this.graph.getGraphArea();this.graph.renderer.setRenderArea(e)}}dispose(){this.stopListening()}};ih([Q.dispose()],ah.prototype,`dispose`,null);var oh=class{constructor(){this.isFlushing=!1,this.isFlushPending=!1,this.scheduleId=0,this.queue=[],this.frameInterval=33,this.initialTime=Date.now()}queueJob(e){if(e.priority&sh.PRIOR)e.cb();else{let t=this.findInsertionIndex(e);t>=0&&this.queue.splice(t,0,e)}}queueFlush(){!this.isFlushing&&!this.isFlushPending&&(this.isFlushPending=!0,this.scheduleJob())}queueFlushSync(){!this.isFlushing&&!this.isFlushPending&&(this.isFlushPending=!0,this.flushJobsSync())}clearJobs(){this.queue.length=0,this.isFlushing=!1,this.isFlushPending=!1,this.cancelScheduleJob()}flushJobs(){this.isFlushPending=!1,this.isFlushing=!0;let e=this.getCurrentTime(),t;for(;(t=this.queue.shift())&&(t.cb(),!(this.getCurrentTime()-e>=this.frameInterval)););this.isFlushing=!1,this.queue.length&&this.queueFlush()}flushJobsSync(){this.isFlushPending=!1,this.isFlushing=!0;let e;for(;e=this.queue.shift();)try{e.cb()}catch(e){console.log(e)}this.isFlushing=!1}findInsertionIndex(e){let t=0,n=this.queue.length,r=n-1,i=e.priority;for(;t<=r;){let e=(r-t>>1)+t;i<=this.queue[e].priority?t=e+1:(n=e,r=e-1)}return n}scheduleJob(){`requestIdleCallback`in window?(this.scheduleId&&this.cancelScheduleJob(),this.scheduleId=window.requestIdleCallback(this.flushJobs.bind(this),{timeout:100})):(this.scheduleId&&this.cancelScheduleJob(),this.scheduleId=window.setTimeout(this.flushJobs.bind(this)))}cancelScheduleJob(){`cancelIdleCallback`in window?(this.scheduleId&&window.cancelIdleCallback(this.scheduleId),this.scheduleId=0):(this.scheduleId&&clearTimeout(this.scheduleId),this.scheduleId=0)}getCurrentTime(){let e=typeof performance==`object`&&typeof performance.now==`function`;return e?performance.now():Date.now()-this.initialTime}},sh;(function(e){e[e.Update=2]=`Update`,e[e.RenderEdge=4]=`RenderEdge`,e[e.RenderNode=8]=`RenderNode`,e[e.PRIOR=1048576]=`PRIOR`})(sh||={});var ch=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},lh=class e extends zi{get model(){return this.graph.model}get container(){return this.graph.view.stage}constructor(e){super(),this.views={},this.willRemoveViews={},this.queue=new oh,this.graph=e,this.init()}init(){this.startListening(),this.renderViews(this.model.getCells())}startListening(){this.model.on(`reseted`,this.onModelReseted,this),this.model.on(`cell:added`,this.onCellAdded,this),this.model.on(`cell:removed`,this.onCellRemoved,this),this.model.on(`cell:change:zIndex`,this.onCellZIndexChanged,this),this.model.on(`cell:change:visible`,this.onCellVisibleChanged,this)}stopListening(){this.model.off(`reseted`,this.onModelReseted,this),this.model.off(`cell:added`,this.onCellAdded,this),this.model.off(`cell:removed`,this.onCellRemoved,this),this.model.off(`cell:change:zIndex`,this.onCellZIndexChanged,this),this.model.off(`cell:change:visible`,this.onCellVisibleChanged,this)}onModelReseted({options:e}){this.queue.clearJobs(),this.removeZPivots(),this.resetViews();let t=this.model.getCells();this.renderViews(t,Object.assign(Object.assign({},e),{queue:t.map(e=>e.id)}))}onCellAdded({cell:e,options:t}){this.renderViews([e],t)}onCellRemoved({cell:e}){this.removeViews([e])}onCellZIndexChanged({cell:t,options:n}){let r=this.views[t.id];r&&this.requestViewUpdate(r.view,e.FLAG_INSERT,n,sh.Update,!0)}onCellVisibleChanged({cell:e,current:t}){this.toggleVisible(e,!!t)}requestViewUpdate(e,t,n={},r=sh.Update,i=!0){let a=e.cell.id,o=this.views[a];if(!o)return;o.flag=t,o.options=n;let s=e.hasAction(t,[`translate`,`resize`,`rotate`]);(s||n.async===!1)&&(r=sh.PRIOR,i=!1),this.queue.queueJob({id:a,priority:r,cb:()=>{this.renderViewInArea(e,t,n);let r=n.queue;if(r){let t=r.indexOf(e.cell.id);t>=0&&r.splice(t,1),r.length===0&&this.graph.trigger(`render:done`)}}});let c=this.getEffectedEdges(e);c.forEach(e=>{this.requestViewUpdate(e.view,e.flag,n,r,!1)}),i&&this.flush()}setRenderArea(e){this.renderArea=e,this.flushWaitingViews()}isViewMounted(t){if(t==null)return!1;let n=this.views[t.cell.id];return n?n.state===e.ViewState.MOUNTED:!1}renderViews(t,n={}){t.sort((e,t)=>e.isNode()&&t.isEdge()?-1:0),t.forEach(t=>{let r=t.id,i=this.views,a=0,o=i[r];if(o)a=e.FLAG_INSERT;else{let i=this.createCellView(t);i&&(i.graph=this.graph,a=e.FLAG_INSERT|i.getBootstrapFlag(),o={view:i,flag:a,options:n,state:e.ViewState.CREATED},this.views[r]=o)}o&&this.requestViewUpdate(o.view,a,n,this.getRenderPriority(o.view),!1)}),this.flush()}renderViewInArea(t,n,r={}){let i=t.cell,a=i.id,o=this.views[a];if(!o)return;let s=0;this.isUpdatable(t)||o.state===e.ViewState.MOUNTED?(s=this.updateView(t,n,r),o.flag=s):o.state=e.ViewState.WAITING,s&&i.isEdge()&&(s&t.getFlag([`source`,`target`]))===0&&this.queue.queueJob({id:a,priority:sh.RenderEdge,cb:()=>{this.updateView(t,n,r)}})}removeViews(e){e.forEach(e=>{let t=e.id,n=this.views[t];n&&(this.willRemoveViews[t]=n,delete this.views[t],this.queue.queueJob({id:t,priority:this.getRenderPriority(n.view),cb:()=>{this.removeView(n.view)}}))}),this.flush()}flush(){this.graph.options.async?this.queue.queueFlush():this.queue.queueFlushSync()}flushWaitingViews(){Object.values(this.views).forEach(t=>{if(t&&t.state===e.ViewState.WAITING){let{view:e,flag:n,options:r}=t;this.requestViewUpdate(e,n,r,this.getRenderPriority(e),!1)}}),this.flush()}updateView(t,n,r={}){if(t==null)return 0;if(Fd.isCellView(t)){if(n&e.FLAG_REMOVE)return this.removeView(t.cell),0;n&e.FLAG_INSERT&&(this.insertView(t),n^=e.FLAG_INSERT)}return n?t.confirmUpdate(n,r):0}insertView(t){let n=this.views[t.cell.id];if(n){let r=t.cell.getZIndex(),i=this.addZPivot(r);this.container.insertBefore(t.container,i),t.cell.isVisible()||this.toggleVisible(t.cell,!1),n.state=e.ViewState.MOUNTED,this.graph.trigger(`view:mounted`,{view:t})}}resetViews(){this.willRemoveViews=Object.assign(Object.assign({},this.views),this.willRemoveViews),Object.values(this.willRemoveViews).forEach(e=>{e&&this.removeView(e.view)}),this.views={},this.willRemoveViews={}}removeView(e){let t=e.cell,n=this.willRemoveViews[t.id];n&&e&&(n.view.remove(),delete this.willRemoveViews[t.id],this.graph.trigger(`view:unmounted`,{view:e}))}toggleVisible(e,t){let n=this.model.getConnectedEdges(e);for(let e=0,r=n.length;e<r;e+=1){let r=n[e];if(t){let e=r.getSourceCell(),t=r.getTargetCell();if(e&&!e.isVisible()||t&&!t.isVisible())continue;this.toggleVisible(r,!0)}else this.toggleVisible(r,!1)}let r=this.views[e.id];r&&Wo(r.view.container,{display:t?`unset`:`none`})}addZPivot(e=0){this.zPivots??={};let t=this.zPivots,n=t[e];if(n)return n;n=t[e]=document.createComment(`z-index:${e+1}`);let r=-1/0;for(let n in t){let t=+n;if(t<e&&t>r&&(r=t,r===e-1))continue}let i=this.container;if(r!==-1/0){let e=t[r];i.insertBefore(n,e.nextSibling)}else i.insertBefore(n,i.firstChild);return n}removeZPivots(){this.zPivots&&Object.values(this.zPivots).forEach(e=>{e&&e.parentNode&&e.parentNode.removeChild(e)}),this.zPivots={}}createCellView(e){let t={graph:this.graph},n=this.graph.options.createCellView;if(n){let r=O(n,this.graph,e);if(r)return new r(e,t);if(r===null)return null}let r=e.view;if(r!=null&&typeof r==`string`){let n=Fd.registry.get(r);return n?new n(e,t):Fd.registry.onNotFound(r)}return e.isNode()?new Rm(e,t):e.isEdge()?new Bm(e,t):null}getEffectedEdges(e){let t=[],n=e.cell,r=this.model.getConnectedEdges(n);for(let e=0,i=r.length;e<i;e+=1){let i=r[e],a=this.views[i.id];if(!a)continue;let o=a.view;if(!this.isViewMounted(o))continue;let s=[`update`];i.getTargetCell()===n&&s.push(`target`),i.getSourceCell()===n&&s.push(`source`),t.push({id:i.id,view:o,flag:o.getFlag(s)})}return t}isUpdatable(e){if(e.isNodeView())return this.renderArea?this.renderArea.isIntersectWithRect(e.cell.getBBox()):!0;if(e.isEdgeView()){let t=e.cell,n=t.getSourceCell(),r=t.getTargetCell();if(this.renderArea&&n&&r)return this.renderArea.isIntersectWithRect(n.getBBox())||this.renderArea.isIntersectWithRect(r.getBBox())}return!0}getRenderPriority(e){return e.cell.isNode()?sh.RenderNode:sh.RenderEdge}dispose(){this.stopListening(),Object.keys(this.views).forEach(e=>{this.views[e].view.dispose()}),this.views={}}};ch([zi.dispose()],lh.prototype,`dispose`,null),function(e){e.FLAG_INSERT=1<<30,e.FLAG_REMOVE=1<<29,e.FLAG_RENDER=(1<<26)-1}(lh||={}),function(e){let t;(function(e){e[e.CREATED=0]=`CREATED`,e[e.MOUNTED=1]=`MOUNTED`,e[e.WAITING=2]=`WAITING`})(t=e.ViewState||={})}(lh||={});var uh=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},dh=class extends Q{constructor(){super(...arguments),this.schedule=new lh(this.graph)}requestViewUpdate(e,t,n={}){this.schedule.requestViewUpdate(e,t,n)}isViewMounted(e){return this.schedule.isViewMounted(e)}setRenderArea(e){this.schedule.setRenderArea(e)}findViewByElem(e){if(e==null)return null;let t=this.options.container,n=typeof e==`string`?t.querySelector(e):e instanceof Element?e:e[0];if(n){let e=this.graph.view.findAttr(`data-cell-id`,n);if(e){let t=this.schedule.views;if(t[e])return t[e].view}}return null}findViewByCell(e){if(e==null)return null;let t=Y.isCell(e)?e.id:e,n=this.schedule.views;return n[t]?n[t].view:null}findViewsFromPoint(e){let t={x:e.x,y:e.y};return this.model.getCells().map(e=>this.findViewByCell(e)).filter(e=>e==null?!1:K.getBBox(e.container,{target:this.view.stage}).containsPoint(t))}findEdgeViewsFromPoint(e,t=5){return this.model.getEdges().map(e=>this.findViewByCell(e)).filter(n=>{if(n!=null){let r=n.getClosestPoint(e);if(r)return r.distance(e)<=t}return!1})}findViewsInArea(e,t={}){let n=B.create(e);return this.model.getCells().map(e=>this.findViewByCell(e)).filter(e=>{if(e){if(t.nodeOnly&&!e.isNodeView())return!1;let r=K.getBBox(e.container,{target:this.view.stage});return r.width===0?r.inflate(1,0):r.height===0&&r.inflate(0,1),t.strict?n.containsRect(r):n.isIntersectWithRect(r)}return!1})}dispose(){this.schedule.dispose()}};uh([Q.dispose()],dh.prototype,`dispose`,null);var fh=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(e!=null&&typeof Object.getOwnPropertySymbols==`function`)for(var i=0,r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]]);return n},ph=class extends Q{get cid(){return this.graph.view.cid}get svg(){return this.view.svg}get defs(){return this.view.defs}isDefined(e){return this.svg.getElementById(e)!=null}filter(e){let t=e.id,n=e.name;if(t||=`filter-${n}-${this.cid}-${pa(JSON.stringify(e))}`,!this.isDefined(t)){let r=il.registry.get(n);if(r==null)return il.registry.onNotFound(n);let i=r(e.args||{}),a=Object.assign(Object.assign({x:-1,y:-1,width:3,height:3,filterUnits:`objectBoundingBox`},e.attrs),{id:t});M.create(J.sanitize(i),a).appendTo(this.defs)}return t}gradient(e){let t=e.id,n=e.type;if(t||=`gradient-${n}-${this.cid}-${pa(JSON.stringify(e))}`,!this.isDefined(t)){let r=e.stops,i=r.map(e=>{let t=e.opacity!=null&&Number.isFinite(e.opacity)?e.opacity:1;return`<stop offset="${e.offset}" stop-color="${e.color}" stop-opacity="${t}"/>`}),a=`<${n}>${i.join(``)}</${n}>`,o=Object.assign({id:t},e.attrs);M.create(a,o).appendTo(this.defs)}return t}marker(e){let{id:t,refX:n,refY:r,markerUnits:i,markerOrient:a,tagName:o,children:s}=e,c=fh(e,[`id`,`refX`,`refY`,`markerUnits`,`markerOrient`,`tagName`,`children`]),l=t;if(l||=`marker-${this.cid}-${pa(JSON.stringify(e))}`,!this.isDefined(l)){o!==`path`&&delete c.d;let e=M.create(`marker`,{refX:n,refY:r,id:l,overflow:`visible`,orient:a??`auto`,markerUnits:i||`userSpaceOnUse`},s?s.map(e=>{var{tagName:t}=e,n=fh(e,[`tagName`]);return M.create(`${t}`||`path`,xo(Object.assign(Object.assign({},c),n)))}):[M.create(o||`path`,xo(c))]);this.defs.appendChild(e.node)}return l}remove(e){let t=this.svg.getElementById(e);t&&t.parentNode&&t.parentNode.removeChild(t)}},mh=class extends Q{getClientMatrix(){return P(this.view.stage.getScreenCTM())}getClientOffset(){let e=this.view.svg.getBoundingClientRect();return new z(e.left,e.top)}getPageOffset(){return this.getClientOffset().translate(window.scrollX,window.scrollY)}snapToGrid(e,t){let n=typeof e==`number`?this.clientToLocalPoint(e,t):this.clientToLocalPoint(e.x,e.y);return n.snapToGrid(this.graph.getGridSize())}localToGraphPoint(e,t){let n=z.create(e,t);return K.transformPoint(n,this.graph.matrix())}localToClientPoint(e,t){let n=z.create(e,t);return K.transformPoint(n,this.getClientMatrix())}localToPagePoint(e,t){let n=typeof e==`number`?this.localToGraphPoint(e,t):this.localToGraphPoint(e);return n.translate(this.getPageOffset())}localToGraphRect(e,t,n,r){let i=B.create(e,t,n,r);return K.transformRectangle(i,this.graph.matrix())}localToClientRect(e,t,n,r){let i=B.create(e,t,n,r);return K.transformRectangle(i,this.getClientMatrix())}localToPageRect(e,t,n,r){let i=typeof e==`number`?this.localToGraphRect(e,t,n,r):this.localToGraphRect(e);return i.translate(this.getPageOffset())}graphToLocalPoint(e,t){let n=z.create(e,t);return K.transformPoint(n,this.graph.matrix().inverse())}clientToLocalPoint(e,t){let n=z.create(e,t);return K.transformPoint(n,this.getClientMatrix().inverse())}clientToGraphPoint(e,t){let n=z.create(e,t);return K.transformPoint(n,this.graph.matrix().multiply(this.getClientMatrix().inverse()))}pageToLocalPoint(e,t){let n=z.create(e,t),r=n.diff(this.getPageOffset());return this.graphToLocalPoint(r)}graphToLocalRect(e,t,n,r){let i=B.create(e,t,n,r);return K.transformRectangle(i,this.graph.matrix().inverse())}clientToLocalRect(e,t,n,r){let i=B.create(e,t,n,r);return K.transformRectangle(i,this.getClientMatrix().inverse())}clientToGraphRect(e,t,n,r){let i=B.create(e,t,n,r);return K.transformRectangle(i,this.graph.matrix().multiply(this.getClientMatrix().inverse()))}pageToLocalRect(e,t,n,r){let i=B.create(e,t,n,r),a=this.getPageOffset();return i.x-=a.x,i.y-=a.y,this.graphToLocalRect(i)}},hh=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},gh=class extends Q{constructor(){super(...arguments),this.highlights={}}init(){this.startListening()}startListening(){this.graph.on(`cell:highlight`,this.onCellHighlight,this),this.graph.on(`cell:unhighlight`,this.onCellUnhighlight,this)}stopListening(){this.graph.off(`cell:highlight`,this.onCellHighlight,this),this.graph.off(`cell:unhighlight`,this.onCellUnhighlight,this)}onCellHighlight({view:e,magnet:t,options:n={}}){let r=this.resolveHighlighter(n);if(!r)return;let i=this.getHighlighterId(t,r);if(!this.highlights[i]){let n=r.highlighter;n.highlight(e,t,Object.assign({},r.args)),this.highlights[i]={cellView:e,magnet:t,highlighter:n,args:r.args}}}onCellUnhighlight({magnet:e,options:t={}}){let n=this.resolveHighlighter(t);if(!n)return;let r=this.getHighlighterId(e,n);this.unhighlight(r)}resolveHighlighter(e){let t=this.options,n=e.highlighter;if(n==null){let r=e.type;n=r&&t.highlighting[r]||t.highlighting.default}if(n==null)return null;let r=typeof n==`string`?{name:n}:n,i=r.name,a=qu.registry.get(i);return a==null?qu.registry.onNotFound(i):(qu.check(i,a),{name:i,highlighter:a,args:r.args||{}})}getHighlighterId(e,t){return Ka(e),t.name+e.id+JSON.stringify(t.args)}unhighlight(e){let t=this.highlights[e];t&&(t.highlighter.unhighlight(t.cellView,t.magnet,t.args),delete this.highlights[e])}dispose(){Object.keys(this.highlights).forEach(e=>this.unhighlight(e)),this.stopListening()}};hh([gh.dispose()],gh.prototype,`dispose`,null);var _h=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},vh=class extends Q{getScroller(){let e=this.graph.getPlugin(`scroller`);return e&&e.options.enabled?e:null}getContainer(){let e=this.getScroller();return e?e.container.parentElement:this.graph.container.parentElement}getSensorTarget(){let e=this.options.autoResize;if(e)return typeof e==`boolean`?this.getContainer():e}init(){let e=this.options.autoResize;if(e){let e=this.getSensorTarget();e&&$s.bind(e,()=>{let t=e.offsetWidth,n=e.offsetHeight;this.resize(t,n)})}}resize(e,t){let n=this.getScroller();n?n.resize(e,t):this.graph.transform.resize(e,t)}dispose(){$s.clear(this.graph.container)}};_h([Q.dispose()],vh.prototype,`dispose`,null);var yh=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},$=class e extends ia{get container(){return this.options.container}get[Symbol.toStringTag](){return e.toStringTag}constructor(e){super(),this.installedPlugins=new Set,this.options=qm.get(e),this.css=new Gm(this),this.view=new Hm(this),this.defs=new ph(this),this.coord=new mh(this),this.transform=new Zm(this),this.highlight=new gh(this),this.grid=new Xm(this),this.background=new $m(this),this.options.model?this.model=this.options.model:(this.model=new vm,this.model.graph=this),this.renderer=new dh(this),this.panning=new th(this),this.mousewheel=new rh(this),this.virtualRender=new ah(this),this.size=new vh(this)}isNode(e){return e.isNode()}isEdge(e){return e.isEdge()}resetCells(e,t={}){return this.model.resetCells(e,t),this}clearCells(e={}){return this.model.clear(e),this}toJSON(e={}){return this.model.toJSON(e)}parseJSON(e){return this.model.parseJSON(e)}fromJSON(e,t={}){return this.model.fromJSON(e,t),this}getCellById(e){return this.model.getCell(e)}addNode(e,t={}){return this.model.addNode(e,t)}addNodes(e,t={}){return this.addCell(e.map(e=>X.isNode(e)?e:this.createNode(e)),t)}createNode(e){return this.model.createNode(e)}removeNode(e,t={}){return this.model.removeCell(e,t)}addEdge(e,t={}){return this.model.addEdge(e,t)}addEdges(e,t={}){return this.addCell(e.map(e=>Z.isEdge(e)?e:this.createEdge(e)),t)}removeEdge(e,t={}){return this.model.removeCell(e,t)}createEdge(e){return this.model.createEdge(e)}addCell(e,t={}){return this.model.addCell(e,t),this}removeCell(e,t={}){return this.model.removeCell(e,t)}removeCells(e,t={}){return this.model.removeCells(e,t)}removeConnectedEdges(e,t={}){return this.model.removeConnectedEdges(e,t)}disconnectConnectedEdges(e,t={}){return this.model.disconnectConnectedEdges(e,t),this}hasCell(e){return this.model.has(e)}getCells(){return this.model.getCells()}getCellCount(){return this.model.total()}getNodes(){return this.model.getNodes()}getEdges(){return this.model.getEdges()}getOutgoingEdges(e){return this.model.getOutgoingEdges(e)}getIncomingEdges(e){return this.model.getIncomingEdges(e)}getConnectedEdges(e,t={}){return this.model.getConnectedEdges(e,t)}getRootNodes(){return this.model.getRoots()}getLeafNodes(){return this.model.getLeafs()}isRootNode(e){return this.model.isRoot(e)}isLeafNode(e){return this.model.isLeaf(e)}getNeighbors(e,t={}){return this.model.getNeighbors(e,t)}isNeighbor(e,t,n={}){return this.model.isNeighbor(e,t,n)}getSuccessors(e,t={}){return this.model.getSuccessors(e,t)}isSuccessor(e,t,n={}){return this.model.isSuccessor(e,t,n)}getPredecessors(e,t={}){return this.model.getPredecessors(e,t)}isPredecessor(e,t,n={}){return this.model.isPredecessor(e,t,n)}getCommonAncestor(...e){return this.model.getCommonAncestor(...e)}getSubGraph(e,t={}){return this.model.getSubGraph(e,t)}cloneSubGraph(e,t={}){return this.model.cloneSubGraph(e,t)}cloneCells(e){return this.model.cloneCells(e)}getNodesFromPoint(e,t){return this.model.getNodesFromPoint(e,t)}getNodesInArea(e,t,n,r,i){return this.model.getNodesInArea(e,t,n,r,i)}getNodesUnderNode(e,t={}){return this.model.getNodesUnderNode(e,t)}searchCell(e,t,n={}){return this.model.search(e,t,n),this}getShortestPath(e,t,n={}){return this.model.getShortestPath(e,t,n)}getAllCellsBBox(){return this.model.getAllCellsBBox()}getCellsBBox(e,t={}){return this.model.getCellsBBox(e,t)}startBatch(e,t={}){this.model.startBatch(e,t)}stopBatch(e,t={}){this.model.stopBatch(e,t)}batchUpdate(e,t,n){let r=typeof e==`string`?e:`update`,i=typeof e==`string`?t:e,a=typeof t==`function`?n:t;this.startBatch(r,a);let o=i();return this.stopBatch(r,a),o}updateCellId(e,t){return this.model.updateCellId(e,t)}findView(e){return Y.isCell(e)?this.findViewByCell(e):this.findViewByElem(e)}findViews(e){return B.isRectangleLike(e)?this.findViewsInArea(e):z.isPointLike(e)?this.findViewsFromPoint(e):[]}findViewByCell(e){return this.renderer.findViewByCell(e)}findViewByElem(e){return this.renderer.findViewByElem(e)}findViewsFromPoint(e,t){let n=typeof e==`number`?{x:e,y:t}:e;return this.renderer.findViewsFromPoint(n)}findViewsInArea(e,t,n,r,i){let a=typeof e==`number`?{x:e,y:t,width:n,height:r}:e,o=typeof e==`number`?i:t;return this.renderer.findViewsInArea(a,o)}matrix(e){return e===void 0?this.transform.getMatrix():(this.transform.setMatrix(e),this)}resize(e,t){let n=this.getPlugin(`scroller`);return n?n.resize(e,t):this.transform.resize(e,t),this}scale(e,t=e,n=0,r=0){return e===void 0?this.transform.getScale():(this.transform.scale(e,t,n,r),this)}zoom(e,t){let n=this.getPlugin(`scroller`);if(n){if(e===void 0)return n.zoom();n.zoom(e,t)}else{if(e===void 0)return this.transform.getZoom();this.transform.zoom(e,t)}return this}zoomTo(e,t={}){let n=this.getPlugin(`scroller`);return n?n.zoom(e,Object.assign(Object.assign({},t),{absolute:!0})):this.transform.zoom(e,Object.assign(Object.assign({},t),{absolute:!0})),this}zoomToRect(e,t={}){let n=this.getPlugin(`scroller`);return n?n.zoomToRect(e,t):this.transform.zoomToRect(e,t),this}zoomToFit(e={}){let t=this.getPlugin(`scroller`);return t?t.zoomToFit(e):this.transform.zoomToFit(e),this}rotate(e,t,n){return e===void 0?this.transform.getRotation():(this.transform.rotate(e,t,n),this)}translate(e,t){return e===void 0?this.transform.getTranslation():(this.transform.translate(e,t),this)}translateBy(e,t){let n=this.translate(),r=n.tx+e,i=n.ty+t;return this.translate(r,i)}getGraphArea(){return this.transform.getGraphArea()}getContentArea(e={}){return this.transform.getContentArea(e)}getContentBBox(e={}){return this.transform.getContentBBox(e)}fitToContent(e,t,n,r){return this.transform.fitToContent(e,t,n,r)}scaleContentToFit(e={}){return this.transform.scaleContentToFit(e),this}center(e){return this.centerPoint(e)}centerPoint(e,t,n){let r=this.getPlugin(`scroller`);return r?r.centerPoint(e,t,n):this.transform.centerPoint(e,t),this}centerContent(e){let t=this.getPlugin(`scroller`);return t?t.centerContent(e):this.transform.centerContent(e),this}centerCell(e,t){let n=this.getPlugin(`scroller`);return n?n.centerCell(e,t):this.transform.centerCell(e),this}positionPoint(e,t,n,r={}){let i=this.getPlugin(`scroller`);return i?i.positionPoint(e,t,n,r):this.transform.positionPoint(e,t,n),this}positionRect(e,t,n){let r=this.getPlugin(`scroller`);return r?r.positionRect(e,t,n):this.transform.positionRect(e,t),this}positionCell(e,t,n){let r=this.getPlugin(`scroller`);return r?r.positionCell(e,t,n):this.transform.positionCell(e,t),this}positionContent(e,t){let n=this.getPlugin(`scroller`);return n?n.positionContent(e,t):this.transform.positionContent(e,t),this}snapToGrid(e,t){return this.coord.snapToGrid(e,t)}pageToLocal(e,t,n,r){return B.isRectangleLike(e)?this.coord.pageToLocalRect(e):typeof e==`number`&&typeof t==`number`&&typeof n==`number`&&typeof r==`number`?this.coord.pageToLocalRect(e,t,n,r):this.coord.pageToLocalPoint(e,t)}localToPage(e,t,n,r){return B.isRectangleLike(e)?this.coord.localToPageRect(e):typeof e==`number`&&typeof t==`number`&&typeof n==`number`&&typeof r==`number`?this.coord.localToPageRect(e,t,n,r):this.coord.localToPagePoint(e,t)}clientToLocal(e,t,n,r){return B.isRectangleLike(e)?this.coord.clientToLocalRect(e):typeof e==`number`&&typeof t==`number`&&typeof n==`number`&&typeof r==`number`?this.coord.clientToLocalRect(e,t,n,r):this.coord.clientToLocalPoint(e,t)}localToClient(e,t,n,r){return B.isRectangleLike(e)?this.coord.localToClientRect(e):typeof e==`number`&&typeof t==`number`&&typeof n==`number`&&typeof r==`number`?this.coord.localToClientRect(e,t,n,r):this.coord.localToClientPoint(e,t)}localToGraph(e,t,n,r){return B.isRectangleLike(e)?this.coord.localToGraphRect(e):typeof e==`number`&&typeof t==`number`&&typeof n==`number`&&typeof r==`number`?this.coord.localToGraphRect(e,t,n,r):this.coord.localToGraphPoint(e,t)}graphToLocal(e,t,n,r){return B.isRectangleLike(e)?this.coord.graphToLocalRect(e):typeof e==`number`&&typeof t==`number`&&typeof n==`number`&&typeof r==`number`?this.coord.graphToLocalRect(e,t,n,r):this.coord.graphToLocalPoint(e,t)}clientToGraph(e,t,n,r){return B.isRectangleLike(e)?this.coord.clientToGraphRect(e):typeof e==`number`&&typeof t==`number`&&typeof n==`number`&&typeof r==`number`?this.coord.clientToGraphRect(e,t,n,r):this.coord.clientToGraphPoint(e,t)}defineFilter(e){return this.defs.filter(e)}defineGradient(e){return this.defs.gradient(e)}defineMarker(e){return this.defs.marker(e)}getGridSize(){return this.grid.getGridSize()}setGridSize(e){return this.grid.setGridSize(e),this}showGrid(){return this.grid.show(),this}hideGrid(){return this.grid.hide(),this}clearGrid(){return this.grid.clear(),this}drawGrid(e){return this.grid.draw(e),this}updateBackground(){return this.background.update(),this}drawBackground(e,t){let n=this.getPlugin(`scroller`);return n!=null&&(this.options.background==null||!t)?n.drawBackground(e,t):this.background.draw(e),this}clearBackground(e){let t=this.getPlugin(`scroller`);return t!=null&&(this.options.background==null||!e)?t.clearBackground(e):this.background.clear(),this}enableVirtualRender(){return this.virtualRender.enableVirtualRender(),this}disableVirtualRender(){return this.virtualRender.disableVirtualRender(),this}isMouseWheelEnabled(){return!this.mousewheel.disabled}enableMouseWheel(){return this.mousewheel.enable(),this}disableMouseWheel(){return this.mousewheel.disable(),this}toggleMouseWheel(e){return e==null?this.isMouseWheelEnabled()?this.disableMouseWheel():this.enableMouseWheel():e?this.enableMouseWheel():this.disableMouseWheel(),this}isPannable(){let e=this.getPlugin(`scroller`);return e?e.isPannable():this.panning.pannable}enablePanning(){let e=this.getPlugin(`scroller`);return e?e.enablePanning():this.panning.enablePanning(),this}disablePanning(){let e=this.getPlugin(`scroller`);return e?e.disablePanning():this.panning.disablePanning(),this}togglePanning(e){return e==null?this.isPannable()?this.disablePanning():this.enablePanning():e!==this.isPannable()&&(e?this.enablePanning():this.disablePanning()),this}use(e,...t){return this.installedPlugins.has(e)||(this.installedPlugins.add(e),e.init(this,...t)),this}getPlugin(e){return Array.from(this.installedPlugins).find(t=>t.name===e)}getPlugins(e){return Array.from(this.installedPlugins).filter(t=>e.includes(t.name))}enablePlugins(e){let t=e;Array.isArray(t)||(t=[t]);let n=this.getPlugins(t);return n?.forEach(e=>{var t;(t=e?.enable)==null||t.call(e)}),this}disablePlugins(e){let t=e;Array.isArray(t)||(t=[t]);let n=this.getPlugins(t);return n?.forEach(e=>{var t;(t=e?.disable)==null||t.call(e)}),this}isPluginEnabled(e){var t;let n=this.getPlugin(e);return(t=n?.isEnabled)?.call(n)}disposePlugins(e){let t=e;Array.isArray(t)||(t=[t]);let n=this.getPlugins(t);return n?.forEach(e=>{e.dispose(),this.installedPlugins.delete(e)}),this}dispose(e=!0){e&&this.model.dispose(),this.css.dispose(),this.defs.dispose(),this.grid.dispose(),this.coord.dispose(),this.transform.dispose(),this.highlight.dispose(),this.background.dispose(),this.mousewheel.dispose(),this.panning.dispose(),this.view.dispose(),this.renderer.dispose(),this.installedPlugins.forEach(e=>{e.dispose()})}};yh([ia.dispose()],$.prototype,`dispose`,null),function(e){e.View=Hm,e.Renderer=dh,e.MouseWheel=rh,e.DefsManager=ph,e.GridManager=Xm,e.CoordManager=mh,e.TransformManager=Zm,e.HighlightManager=gh,e.BackgroundManager=$m,e.PanningManager=th}($||={}),function(e){e.toStringTag=`X6.${e.name}`;function t(t){if(t==null)return!1;if(t instanceof e)return!0;let n=t[Symbol.toStringTag];return n==null||n===e.toStringTag}e.isGraph=t}($||={}),function(e){function t(t,n){let r=t instanceof HTMLElement?new e({container:t}):new e(t);return n!=null&&r.fromJSON(n),r}e.render=t}($||={}),function(e){e.registerNode=X.registry.register,e.registerEdge=Z.registry.register,e.registerView=Fd.registry.register,e.registerAttr=Ru.registry.register,e.registerGrid=Rc.registry.register,e.registerFilter=il.registry.register,e.registerNodeTool=uf.registry.register,e.registerEdgeTool=df.registry.register,e.registerBackground=Wc.registry.register,e.registerHighlighter=qu.registry.register,e.registerPortLayout=cd.registry.register,e.registerPortLabelLayout=Dd.registry.register,e.registerMarker=bu.registry.register,e.registerRouter=Bp.registry.register,e.registerConnector=am.registry.register,e.registerAnchor=Af.registry.register,e.registerEdgeAnchor=Rf.registry.register,e.registerConnectionPoint=Jf.registry.register}($||={}),function(e){e.unregisterNode=X.registry.unregister,e.unregisterEdge=Z.registry.unregister,e.unregisterView=Fd.registry.unregister,e.unregisterAttr=Ru.registry.unregister,e.unregisterGrid=Rc.registry.unregister,e.unregisterFilter=il.registry.unregister,e.unregisterNodeTool=uf.registry.unregister,e.unregisterEdgeTool=df.registry.unregister,e.unregisterBackground=Wc.registry.unregister,e.unregisterHighlighter=qu.registry.unregister,e.unregisterPortLayout=cd.registry.unregister,e.unregisterPortLabelLayout=Dd.registry.unregister,e.unregisterMarker=bu.registry.unregister,e.unregisterRouter=Bp.registry.unregister,e.unregisterConnector=am.registry.unregister,e.unregisterAnchor=Af.registry.unregister,e.unregisterEdgeAnchor=Rf.registry.unregister,e.unregisterConnectionPoint=Jf.registry.unregister}($||={});var bh=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},xh=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(e!=null&&typeof Object.getOwnPropertySymbols==`function`)for(var i=0,r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]]);return n},Sh=class extends X{};(function(e){class t extends Rm{init(){super.init(),this.cell.on(`change:*`,this.onCellChangeAny,this)}onCellChangeAny({key:t}){let n=e.shapeMaps[this.cell.shape];if(n){let{effect:e}=n;(!e||e.includes(t))&&this.renderHTMLComponent()}}confirmUpdate(e){let n=super.confirmUpdate(e);return this.handleAction(n,t.action,()=>this.renderHTMLComponent())}renderHTMLComponent(){let t=this.selectors&&this.selectors.foContent;if(t){so(t);let n=e.shapeMaps[this.cell.shape];if(!n)return;let{html:r}=n;typeof r==`function`&&(r=r(this.cell)),r&&(typeof r==`string`?t.innerHTML=r:co(t,r))}}dispose(){this.cell.off(`change:*`,this.onCellChangeAny,this)}}bh([t.dispose()],t.prototype,`dispose`,null),e.View=t,function(e){e.action=`html`,e.config({bootstrap:[e.action],actions:{html:e.action}}),Rm.registry.register(`html-view`,e,!0)}(t=e.View||={})})(Sh||={}),function(e){e.config({view:`html-view`,markup:[{tagName:`rect`,selector:`body`},Object.assign({},J.getForeignObjectMarkup()),{tagName:`text`,selector:`label`}],attrs:{body:{fill:`none`,stroke:`none`,refWidth:`100%`,refHeight:`100%`},fo:{refWidth:`100%`,refHeight:`100%`}}}),X.registry.register(`html`,e,!0)}(Sh||={}),function(e){e.shapeMaps={};function t(t){let{shape:n,html:r,effect:i,inherit:a}=t,o=xh(t,[`shape`,`html`,`effect`,`inherit`]);if(!n)throw Error(`should specify shape in config`);e.shapeMaps[n]={html:r,effect:i},$.registerNode(n,Object.assign({inherit:a||`html`},o),!0)}e.register=t}(Sh||={});const Ch=200,wh=22;var Th={grid:!0,panning:{enabled:!0,eventTypes:[`mouseWheel`,`leftMouseDown`]},mousewheel:{factor:1.01,enabled:!0,modifiers:`Ctrl`},scaling:{min:.5,max:3},connecting:{allowBlank:!1,snap:{radius:50},connector:{name:`rounded`,args:{radius:50}},router:{name:`er`,args:{offset:25,direction:`H`}},createEdge(){return null}}},Eh=class extends X{};(function(e){function t(e){let t=[],n=J.getForeignObjectMarkup();return e?t.push({tagName:e,selector:`body`},n):t.push(n),t}e.config({view:`vue-shape-view`,markup:t(),attrs:{body:{fill:`none`,stroke:`none`,refWidth:`100%`,refHeight:`100%`},fo:{refWidth:`100%`,refHeight:`100%`}},propHooks(e){if(e.markup==null){let n=e.primer;if(n){e.markup=t(n);let r={};switch(n){case`circle`:r={refCx:`50%`,refCy:`50%`,refR:`50%`};break;case`ellipse`:r={refCx:`50%`,refCy:`50%`,refRx:`50%`,refRy:`50%`};break;default:break}e.attrs=v({},{body:Object.assign({refWidth:null,refHeight:null},r)},e.attrs||{})}}return e}}),X.registry.register(`vue-shape`,e,!0)})(Eh||={});var Dh=!1,Oh=!0,kh=void 0,Ah=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(e!=null&&typeof Object.getOwnPropertySymbols==`function`)for(var i=0,r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]]);return n};const jh={};function Mh(e){let{shape:t,component:n,inherit:r}=e,i=Ah(e,[`shape`,`component`,`inherit`]);if(!t)throw Error(`should specify shape in config`);jh[t]={component:n},$.registerNode(t,Object.assign({inherit:r||`vue-shape`},i),!0)}let Nh=!1;const Ph=Le({});function Fh(e,t,n,r,i){Nh&&(Ph[e]=Ne(ve({render:()=>be(w,{to:n},[be(t,{node:r,graph:i})]),provide:()=>({getNode:()=>r,getGraph:()=>i})})))}function Ih(e){Nh&&delete Ph[e]}function Lh(){return Nh}var Rh=class e extends Rm{getComponentContainer(){return this.selectors&&this.selectors.foContent}confirmUpdate(t){let n=super.confirmUpdate(t);return this.handleAction(n,e.action,()=>{this.renderVueComponent()})}targetId(){return`${this.graph.view.cid}:${this.cell.id}`}renderVueComponent(){this.unmountVueComponent();let e=this.getComponentContainer(),t=this.cell,n=this.graph;if(e){let{component:r}=jh[t.shape];if(r)if(Dh){let i=kh;this.vm=new i({el:e,render(e){return e(r,{node:t,graph:n})},provide(){return{getNode:()=>t,getGraph:()=>n}}})}else Oh&&(Lh()?Fh(this.targetId(),r,e,t,n):(this.vm=fe({render(){return be(r,{node:t,graph:n})},provide(){return{getNode:()=>t,getGraph:()=>n}}}),this.vm.mount(e)))}}unmountVueComponent(){let e=this.getComponentContainer();return this.vm&&(Dh&&this.vm.$destroy(),Oh&&this.vm.unmount(),this.vm=null),e&&(e.innerHTML=``),e}onMouseDown(e,t,n){let r=e.target,i=r.tagName.toLowerCase();if(i===`input`){let e=r.getAttribute(`type`);if(e==null||[`text`,`password`,`number`,`email`,`search`,`tel`,`url`].includes(e))return}super.onMouseDown(e,t,n)}unmount(){return Lh()&&Ih(this.targetId()),this.unmountVueComponent(),super.unmount(),this}};(function(e){e.action=`vue`,e.config({bootstrap:[e.action],actions:{component:e.action}}),Rm.registry.register(`vue-shape-view`,e,!0)})(Rh||={});const zh=[`title`],Bh={class:`content fact`},Vh={class:`head`},Hh={class:`flex text-ellipsis`},Uh={class:`text-ellipsis`},Wh={class:`body`},Gh={class:`name`},Kh={key:0,class:`codicon-key yellow top-1 mr-[1px]`},qh={key:1,class:`codicon-symbol-reference blue top-1 mr-[1px]`},Jh={class:`type absolute right-0`};var Yh=ve({__name:`erNode`,setup(e){let t=Ce(`getNode`),n=Re(0),r=Re(``),i=Re([]);return Fe(()=>{let e=t();n.value=e.zIndex,r.value=e.id,i.value=e.port.ports.map(e=>e.attrs.column)}),(e,t)=>(Ie(),he(`div`,{class:Pe([`entity-container fact`,{main:n.value==3}]),title:r.value},[D(`div`,Bh,[D(`div`,Vh,[D(`div`,Hh,[t[0]||=D(`span`,{class:`mr-1 top-1`},[D(`i`,{class:`codicon-layout-sidebar-right-off`})],-1),D(`span`,Uh,He(r.value),1)])]),D(`div`,Wh,[(Ie(!0),he(ee,null,ze(i.value,e=>(Ie(),he(`div`,{key:e.name,class:`body-item relative`},[D(`div`,Gh,[e.isPrimary?(Ie(),he(`i`,Kh)):me(``,!0),e.referenced_table?(Ie(),he(`i`,qh)):me(``,!0),ge(` `+He(e.name),1)]),D(`div`,Jh,He(e.originType),1)]))),128))])])],10,zh))}}),Xh=Yh;function Zh(){Mh({shape:`custom-er-node`,component:Xh,ports:{groups:{list:{markup:[{tagName:`rect`,selector:`portBody`}],attrs:{portBody:{width:Ch-2,height:wh,fill:`none`,magnet:!0}},zIndex:0,position:`erPortPosition`}}}})}function Qh(){$.registerPortLayout(`erPortPosition`,e=>e.map((e,t)=>({position:{x:1,y:(t+1)*wh+wh/3},angle:0})),!0)}function $h(e){let t=50,n=e.map(tg);eg(n);let r=Je.grouping(n,{keepSingle:!0,keyGenerator:e=>e.position.x,groupGenerator:()=>[]});for(let e of r.values()){if(!Array.isArray(e))continue;let n=e.sort((e,t)=>e.height-t.height);for(let e=0;e<n.length;e++){if(e==0){n.length>1&&(n[0].position.y=20);continue}let r=n[e];r.position.y=n[e-1].position.y+n[e-1].height+t}}return n}function eg(e){let t,n=e.find(e=>e.zIndex==3),r=n.position.x-20;if(e.every(e=>n.position.x>=e.position.x)&&(t=`right`),e.every(e=>n.position.x<=e.position.x)&&(t=`left`),!(!t||e.length<=2))for(let n of e)t==`right`&&(n.position.x+=r),t==`left`&&(n.position.x-=r)}function tg(e){let t=26+wh*e.columns.length+9,n=window.innerWidth/2-Ch/2,r=Math.max(50,window.innerHeight/2-t);return{id:e.name,shape:`custom-er-node`,label:e.name,width:Ch,height:t,zIndex:e.main?3:2,position:{x:n+e.offset.x*(Ch+150),y:r},ports:e.columns.map(e=>({id:e.name,group:`list`,attrs:{column:e,portNameLabel:{text:e.name},portTypeLabel:{text:e.type}}}))}}function ng(e){return{id:`${e.from}:${e.fromColumns}-${e.target}:${e.targetColumns}`,shape:`edge`,source:{cell:e.from,port:e.fromColumns},target:{cell:e.target,port:e.targetColumns},attrs:{line:{strokeWidth:2.5,stroke:`#6c7075`}},zIndex:0}}const rg={class:`mb-2`},ig={class:`flex gap-x-3 items-center justify-center`},ag={class:`shrink-0`};var og=ve({__name:`erExportDialog`,props:[`option`],emits:[`export`],setup(e,{emit:t}){let n=t;return(t,r)=>{let i=S,a=C,o=Ve(`vsc-button`),s=x;return Ie(),pe(s,{"show-close":!1,title:t.$t(`result.exportOption`),"model-value":e.option.visible,width:`300px`,center:``,class:`remove-min-width disable-animation`,onClose:r[3]||=t=>e.option.visible=!1},{footer:Ke(()=>[_e(o,{type:`secondary`,onClick:r[1]||=t=>e.option.visible=!1},{default:Ke(()=>[ge(He(t.$t(`common.close`)),1)]),_:1}),_e(o,{type:`primary`,onClick:r[2]||=e=>n(`export`)},{default:Ke(()=>[ge(He(t.$t(`result.export`)),1)]),_:1})]),default:Ke(()=>[D(`div`,rg,[D(`div`,ig,[D(`span`,ag,He(t.$t(`result.exportType`)),1),_e(a,{modelValue:e.option.type,"onUpdate:modelValue":r[0]||=t=>e.option.type=t,type:`relax`},{default:Ke(()=>[_e(i,{value:`PNG`,label:`PNG`}),_e(i,{value:`JPG`,label:`JPG`}),_e(i,{value:`SVG`,label:`SVG`})]),_:1},8,[`modelValue`])])])]),_:1},8,[`title`,`model-value`])}}}),sg=og;const cg={class:`absolute top-0`},lg={class:`er-toolbar fixed top-8 left-0 flex gap-x-3 items-center`};var ug=ve({__name:`erToolbar`,props:[`graph`],setup(e){let t=e,n=Le({scale:2.5,type:`PNG`,visible:!1});xe.on(`erData`,()=>{n.visible=!1});let r=()=>t.graph.zoom(.1),i=()=>t.graph.zoom(-.1),a=()=>{n.visible=!1,setTimeout(()=>{let e=t.graph.zoom(),{type:r,scale:i}=n,a=t.graph.toSVG;switch(r){case`PNG`:a=t.graph.toPNG,t.graph.zoomTo(i);break;case`JPG`:a=t.graph.toJPEG,t.graph.zoomTo(i);break}a.call(t.graph,n=>{t.graph.zoomTo(e);let r=n.startsWith(`<svg`),i=r?`svg`:`png`;if(n.startsWith(`<svg`)){xe.emit(`exportImg`,{type:i,data:n});return}fetch(n).then(e=>e.blob()).then(e=>e.arrayBuffer()).then(e=>{xe.emit(`exportImg`,{type:i,data:[...new Uint8Array(e)]})})},{padding:30,quality:1})},10)};return(t,o)=>{let s=Ve(`vsc-button`),c=Ve(`vsc-tooltip`);return Ie(),he(`div`,cg,[D(`div`,lg,[_e(s,{type:`secondary`,onClick:o[0]||=e=>We(xe).emit(`refreshCache`)},{default:Ke(()=>[ge(He(t.$t(`common.refresh`)),1)]),_:1}),_e(c,{title:`Zoom In`},{default:Ke(()=>[D(`i`,{class:`codicon-zoom-in`,onClick:r})]),_:1}),_e(c,{title:`Zoom Out`},{default:Ke(()=>[D(`i`,{class:`codicon-zoom-out`,onClick:i})]),_:1}),_e(c,{title:`Center`},{default:Ke(()=>[D(`i`,{class:`codicon-home`,onClick:o[1]||=t=>e.graph.center()})]),_:1}),_e(c,{title:`Export Image`},{default:Ke(()=>[D(`i`,{class:`codicon-arrow-down`,onClick:o[2]||=e=>n.visible=!0})]),_:1})]),_e(sg,{option:n,onExport:a},null,8,[`option`])])}}}),dg=T(ug,[[`__scopeId`,`data-v-bc50ec97`]]);$.prototype.toSVG=function(e,t){let n=this.getPlugin(`export`);n&&n.toSVG(e,t)},$.prototype.toPNG=function(e,t){let n=this.getPlugin(`export`);n&&n.toPNG(e,t)},$.prototype.toJPEG=function(e,t){let n=this.getPlugin(`export`);n&&n.toJPEG(e,t)},$.prototype.exportPNG=function(e,t){let n=this.getPlugin(`export`);n&&n.exportPNG(e,t)},$.prototype.exportJPEG=function(e,t){let n=this.getPlugin(`export`);n&&n.exportJPEG(e,t)},$.prototype.exportSVG=function(e,t){let n=this.getPlugin(`export`);n&&n.exportSVG(e,t)};var fg=function(e,t,n,r){var i=arguments.length,a=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect==`object`&&typeof Reflect.decorate==`function`)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},pg=class extends ia{constructor(){super(),this.name=`export`}get view(){return this.graph.view}init(e){this.graph=e}exportPNG(e=`chart`,t={}){this.toPNG(t=>{Eo.downloadDataUri(t,e)},t)}exportJPEG(e=`chart`,t={}){this.toPNG(t=>{Eo.downloadDataUri(t,e)},t)}exportSVG(e=`chart`,t={}){this.toSVG(t=>{Eo.downloadDataUri(Eo.svgToDataUrl(t),e)},t)}toSVG(e,t={}){this.notify(`before:export`,t);let n=this.view.svg,r=M.create(n).clone(),i=r.node,a=r.findOne(`.${this.view.prefixClassName(`graph-svg-stage`)}`),o=t.viewBox||this.graph.graphToLocal(this.graph.getContentBBox()),s=t.preserveDimensions;if(s){let e=typeof s==`boolean`?o:s;r.attr({width:e.width,height:e.height})}if(r.removeAttribute(`style`).attr(`viewBox`,[o.x,o.y,o.width,o.height].join(` `)),a.removeAttribute(`transform`),t.copyStyles!==!1){let e=n.ownerDocument,t=Array.from(n.querySelectorAll(`*`)),r=Array.from(i.querySelectorAll(`*`)),a=e.styleSheets.length,o=[];for(let t=a-1;t>=0;--t)o[t]=e.styleSheets[t],e.styleSheets[t].disabled=!0;let s={};t.forEach((e,t)=>{let n=window.getComputedStyle(e,null),r={};Object.keys(n).forEach(e=>{r[e]=n.getPropertyValue(e)}),s[t]=r}),a!==e.styleSheets.length&&o.forEach((t,n)=>{e.styleSheets[n]=t});for(let t=0;t<a;t+=1)e.styleSheets[t].disabled=!1;let c={};t.forEach((e,t)=>{let n=window.getComputedStyle(e,null),r=s[t],i={};Object.keys(n).forEach(e=>{!Zr(e)&&n.getPropertyValue(e)!==r[e]&&(i[e]=n.getPropertyValue(e))}),c[t]=i}),r.forEach((e,t)=>{Wo(e,c[t])})}let c=t.stylesheet;if(typeof c==`string`){let e=n.ownerDocument.implementation.createDocument(null,`xml`,null).createCDATASection(c);r.prepend(M.create(`style`,{type:`text/css`},[e]))}let l=()=>{let n=t.beforeSerialize;if(typeof n==`function`){let e=O(n,this.graph,i);e instanceof SVGSVGElement&&(i=e)}let r=new XMLSerializer().serializeToString(i).replace(/&nbsp;/g,`\xA0`);this.notify(`after:export`,t),e(r)};if(t.serializeImages){let e=r.find(`image`).map(e=>new Promise(t=>{let n=e.attr(`xlink:href`)||e.attr(`href`);Eo.imageToDataUri(n,(n,r)=>{!n&&r&&e.attr(`xlink:href`,r),t()})}));Promise.all(e).then(l)}else l()}toDataURL(e,t){let n=t.viewBox||this.graph.getContentBBox(),r=ya(t.padding);t.width&&t.height&&(r.left+r.right>=t.width&&(r.left=r.right=0),r.top+r.bottom>=t.height&&(r.top=r.bottom=0));let i=new B(-r.left,-r.top,r.left+r.right,r.top+r.bottom);if(t.width&&t.height){let e=n.width+r.left+r.right,a=n.height+r.top+r.bottom;i.scale(e/t.width,a/t.height)}n=B.create(n).moveAndExpand(i);let a=typeof t.width==`number`&&typeof t.height==`number`?{width:t.width,height:t.height}:n,o=t.ratio?parseFloat(t.ratio):1;(!Number.isFinite(o)||o===0)&&(o=1);let s={width:Math.max(Math.round(a.width*o),1),height:Math.max(Math.round(a.height*o),1)};{let e=document.createElement(`canvas`),t=e.getContext(`2d`);e.width=s.width,e.height=s.height;let n=s.width-1,r=s.height-1;t.fillStyle=`rgb(1,1,1)`,t.fillRect(n,r,1,1);let i=t.getImageData(n,r,1,1).data;if(i[0]!==1||i[1]!==1||i[2]!==1)throw Error(`size exceeded`)}let c=new Image;c.onload=()=>{let n=document.createElement(`canvas`);n.width=s.width,n.height=s.height;let r=n.getContext(`2d`);r.fillStyle=t.backgroundColor||`white`,r.fillRect(0,0,s.width,s.height);try{r.drawImage(c,0,0,s.width,s.height);let i=n.toDataURL(t.type,t.quality);e(i)}catch{}},this.toSVG(e=>{c.src=`data:image/svg+xml,${encodeURIComponent(e)}`},Object.assign(Object.assign({},t),{viewBox:n,serializeImages:!0,preserveDimensions:Object.assign({},s)}))}toPNG(e,t={}){this.toDataURL(e,Object.assign(Object.assign({},t),{type:`image/png`}))}toJPEG(e,t={}){this.toDataURL(e,Object.assign(Object.assign({},t),{type:`image/jpeg`}))}notify(e,t){this.trigger(e,t),this.graph.trigger(e,t)}dispose(){this.off()}};fg([ia.dispose()],pg.prototype,`dispose`,null);const mg={},hg={class:`absolute top-0 w-full h-full z-50 overlay`};function gg(e,t){return Ie(),he(`div`,hg,[Be(e.$slots,`default`,{},void 0,!0)])}var _g=T(mg,[[`render`,gg],[`__scopeId`,`data-v-5aa57048`]]),vg=class{constructor(){this.activeCells=[]}bindGraph(e,t){e.on(`edge:mousedown`,({edge:e})=>{this.reset(),this.setActiveCellByEdge(e)}),e.on(`node:mousedown`,({e,cell:n})=>{this.reset(),this.setActiveCells(this.getTargetCell(e.target));for(let e of t){let t=e.source.cell,r=e.target.cell;(t==n.id||r==n.id)&&this.setActiveCellByEdge(e)}}),e.on(`blank:dblclick`,()=>{this.reset()})}setActiveCellByEdge(e){this.setActiveCells(document.querySelector(`g[data-cell-id="${e.id}"]`),document.querySelector(`g[data-cell-id="${e.source.cell}"]`),document.querySelector(`g[data-cell-id="${e.target.cell}"]`))}getTargetCell(e){for(;e!=null&&!e.classList.contains(`x6-cell`);)e=e.parentElement;return e}setActiveCells(...e){this.activeCells.push(...e);for(let t of e)t.classList.add(`active`)}reset(){for(let e of this.activeCells)e?.classList.remove(`active`);this.activeCells=[]}},yg=class extends q{get scroller(){return this.graph.getPlugin(`scroller`)}get graphContainer(){return this.scroller?this.scroller.container:this.graph.container}constructor(e){super(),this.name=`minimap`,this.options={...xg.defaultOptions,...e}}init(e){this.graph=e,this.updateViewport=r(this.updateViewport.bind(this),0),this.container=document.createElement(`div`),k(this.container,this.prefixClassName(bg.root));let t=document.createElement(`div`);this.container.appendChild(t),this.viewport=document.createElement(`div`),k(this.viewport,this.prefixClassName(bg.viewport)),this.options.scalable&&(this.zoomHandle=document.createElement(`div`),k(this.zoomHandle,this.prefixClassName(bg.zoom)),fo(this.zoomHandle,this.viewport)),co(this.container,this.viewport),Wo(this.container,{width:this.options.width,height:this.options.height,padding:this.options.padding}),this.options.container&&this.options.container.appendChild(this.container),this.sourceGraph=this.graph;let n={...this.options.graphOptions,container:t,model:this.sourceGraph.model,interacting:!1,grid:!1,background:!1,embedding:!1};this.targetGraph=this.options.createGraph?this.options.createGraph(n):new $(n),setTimeout(()=>{this.updatePaper(this.sourceGraph.options.width,this.sourceGraph.options.height)},10),this.startListening()}hide(){this.container.style.display=`none`}show(){this.container.style.display=``}updateMinimap(){setTimeout(()=>{this.updatePaper(this.sourceGraph.options.width,this.sourceGraph.options.height)},10)}startListening(){this.scroller?I.on(this.graphContainer,`scroll${this.getEventNamespace()}`,this.updateViewport):(this.sourceGraph.on(`translate`,this.onTransform,this),this.sourceGraph.on(`scale`,this.onTransform,this),this.sourceGraph.on(`model:updated`,this.onModelUpdated,this)),this.sourceGraph.on(`resize`,this.updatePaper,this),this.delegateEvents({mousedown:`startAction`,touchstart:`startAction`,[`mousedown .${this.prefixClassName(`graph`)}`]:`scrollTo`,[`touchstart .${this.prefixClassName(`graph`)}`]:`scrollTo`})}stopListening(){this.scroller?I.off(this.graphContainer,this.getEventNamespace()):(this.sourceGraph.off(`translate`,this.onTransform,this),this.sourceGraph.off(`scale`,this.onTransform,this),this.sourceGraph.off(`model:updated`,this.onModelUpdated,this)),this.sourceGraph.off(`resize`,this.updatePaper,this),this.undelegateEvents()}onRemove(){this.stopListening(),this.targetGraph.dispose(!1)}onTransform(e){(e.ui||this.targetGraphTransforming||!this.scroller)&&this.updateViewport()}onModelUpdated(){this.targetGraph.zoomToFit()}updatePaper(e,t){let n,r;typeof e==`object`?(n=e.width,r=e.height):(n=e,r=t);let i=this.sourceGraph.options,a=this.sourceGraph.transform.getScale(),o=this.options.width-2*this.options.padding,s=this.options.height-2*this.options.padding;n/=a.sx,r/=a.sy,this.ratio=Math.min(o/n,s/r);let c=this.ratio,l=i.x*c/a.sx,u=i.y*c/a.sy;return n*=c,r*=c,this.targetGraph.resize(n,r),this.targetGraph.translate(l,u),this.scroller?this.targetGraph.scale(c,c):this.targetGraph.zoomToFit(),this.updateViewport(),this}updateViewport(){let e=this.sourceGraph.transform.getScale(),t=this.targetGraph.transform.getScale(),n=null;n=this.scroller?this.scroller.clientToLocalPoint(0,0):this.graph.graphToLocal(0,0);let r=Js(this.targetGraph.container),i=this.targetGraph.translate();i.ty=i.ty||0,this.geometry={top:r.top+n.y*t.sy+i.ty,left:r.left+n.x*t.sx+i.tx,width:this.graphContainer.clientWidth*t.sx/e.sx,height:this.graphContainer.clientHeight*t.sy/e.sy},Wo(this.viewport,this.geometry)}startAction(e){let t=this.normalizeEvent(e),n=t.target===this.zoomHandle?`zooming`:`panning`,{tx:r,ty:i}=this.sourceGraph.translate(),a={action:n,clientX:t.clientX,clientY:t.clientY,scrollLeft:this.graphContainer.scrollLeft,scrollTop:this.graphContainer.scrollTop,zoom:this.sourceGraph.zoom(),scale:this.sourceGraph.transform.getScale(),geometry:this.geometry,translateX:r,translateY:i};this.targetGraphTransforming=!0,this.delegateDocumentEvents(xg.documentEvents,a)}doAction(e){let t=this.normalizeEvent(e),n=t.clientX,r=t.clientY,i=t.data;switch(i.action){case`panning`:{let e=Date.now(),{sx:t,sy:a}=this.sourceGraph.transform.getScale(),o=(n-i.clientX)*t,s=(r-i.clientY)*a;if(e-this.lastMoveTime<20)if(this.scroller)this.graphContainer.scrollLeft=i.scrollLeft+o/this.ratio,this.graphContainer.scrollTop=i.scrollTop+s/this.ratio;else{let{sx:e,sy:t}=this.targetGraph.scale(),i=(this.lastMovePosition.x-n)/e,a=(this.lastMovePosition.y-r)/t,{tx:o,ty:s}=this.sourceGraph.translate();this.sourceGraph.translate(o+i,s+a)}this.lastMoveTime=Date.now(),this.lastMovePosition={x:n,y:r};break}case`zooming`:{let e=i.scale,t=i.geometry,r=1+(i.clientX-n)/t.width/e.sx;i.frameId&&cancelAnimationFrame(i.frameId),i.frameId=requestAnimationFrame(()=>{this.sourceGraph.zoom(r*i.zoom,{absolute:!0,minScale:this.options.minScale,maxScale:this.options.maxScale})});break}default:break}}stopAction(){this.undelegateDocumentEvents(),this.targetGraphTransforming=!1}scrollTo(e){let t=this.normalizeEvent(e),n,r,i=this.targetGraph.translate();if(i.ty=i.ty||0,t.offsetX==null){let e=qs(this.targetGraph.container);n=t.pageX-e.left,r=t.pageY-e.top}else n=t.offsetX,r=t.offsetY;let{sx:a,sy:o}=this.targetGraph.scale(),s=(n-i.tx)/a,c=(r-i.ty)/o;this.sourceGraph.centerPoint(s,c)}dispose(){this.remove(),lc(this.name)}};let bg;(function(e){let t=e.root=`widget-minimap`,n=e.viewport=`${t}-viewport`,r=e.zoom=`${n}-zoom`})(bg||={});let xg;(function(e){let t=e.defaultOptions={width:300,height:200,padding:10,scalable:!0,minScale:.01,maxScale:16,graphOptions:{},createGraph:e=>new $(e)},n=e.documentEvents={mousemove:`doAction`,touchmove:`doAction`,mouseup:`stopAction`,touchend:`stopAction`}})(xg||={});const Sg={id:`er-container`},Cg={class:`red w-full top-32 text-center !text-lg`};var wg=ve({__name:`er`,setup(e){let t=Ge(),n=Re(null);return Fe(()=>{Zh(),Qh();let e=new $({...Th,container:document.getElementById(`container`)}),t=new vg;e.use(new pg);let r=new yg({container:document.getElementById(`minimap`),graphOptions:{scaling:{max:.6}}});e.use(r),n.value=e,xe.emit(`erData`).on(`single_table`,()=>xe.emit(`erData`)).on(`erData`,n=>{t.reset(),r.hide();let i=[],{nodes:a,edges:o}=n,s=$h(a);for(let t of s)i.push(e.createNode(t));for(let t=0;t<o.length;t++){let n=o[t];i.push(e.createEdge(ng(n)))}s.length>2&&r.show(),t.bindGraph(e,i.filter(e=>e.isEdge())),e.resetCells(i),e.center(),r.updateMinimap()}),qe(15,[`tableTab`],t=>{e.resize(window.innerWidth,t)})}),(e,r)=>(Ie(),he(`div`,Sg,[r[0]||=D(`div`,{id:`container`,class:`bg-white w-[100vw] h-[100vh]`},null,-1),_e(dg,{graph:n.value},null,8,[`graph`]),r[1]||=D(`div`,{id:`minimap`},null,-1),We(t).isPay?me(``,!0):(Ie(),pe(_g,{key:0},{default:Ke(()=>[D(`div`,Cg,He(e.$t(`table.erDiagramNotice`)),1)]),_:1}))]))}}),Tg=T(wg,[[`__scopeId`,`data-v-ab44922a`]]);export{Tg as default};