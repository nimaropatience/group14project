import"./isEqual-DUAGDpZY.js";import{ElOption as e,ElSelect as t}from"./select-DBPzawsW.js";import"./_baseFindIndex-Ctm2P5pj.js";import"./isArrayLikeObject-DWAcihF8.js";import"./merge-XDSJ7w6H.js";import"./_baseIteratee-t-25AuYs.js";import{ElTable as n,ElTableColumn as r}from"./table-Db0XwM4K.js";import"./use-empty-values-iILzsRnu.js";import"./click-outside-CeocQVdO.js";import"./checkbox-C8nKweXK.js";import"./tag-ByueM0Jv.js";import{ElForm as i,ElFormItem as a,Fragment as o,computed as s,createBaseVNode as c,createBlock as l,createCommentVNode as u,createElementBlock as d,createTextVNode as f,createVNode as p,defineComponent as m,error as h,handler as g,onMounted as _,openBlock as v,reactive as y,ref as b,renderList as x,resolveComponent as S,success as C,toDisplayString as w,withCtx as T}from"./app-ctFZFRv9.js";const E={class:`opt-panel`},D=[`src`],O={class:`opt-panel`},k=[`src`],A={key:0,class:`bg-secondBg pl-5 pt-3`},j={class:`mb-3`};var M=m({__name:`structDiff`,setup(m){let M=b([{value:`MySQL`,icon:`resources/icon/server/mysql_dark.svg`},{value:`MariaDB`,icon:`resources/icon/server/mariadb.svg`},{value:`PostgreSQL`,icon:`resources/icon/server/pgsql.svg`}]),N=b(null),P=b([]),F=y({dbLoading:!1,dbList:[]}),I=y({dbLoading:!1,dbList:[]}),L=y({from:{connection:null,database:null,db:null},to:{connection:null,database:null,db:null}}),R=y({compare:!1,sync:!1}),z=y({sqlList:null}),B=s(()=>window.outerHeight-340);_(()=>{g.on(`nodes`,e=>{P.value=e}).on(`sourceDB`,e=>{F.dbList=e,F.dbLoading=!1}).on(`targetDB`,e=>{I.dbList=e,I.dbLoading=!1}).on(`compareResult`,e=>{e.sqlList=e,R.compare=!1}).on(`syncSuccess`,()=>{C(`syncSuccess`),R.sync=!1}).on(`success`,()=>{J()}).on(`error`,e=>{h(e),R.sync=!1}).init()});let V=e=>{for(let t of M.value)if(t.value==e)return t.icon;return`icon/server/mysql_dark.svg`},H=e=>{g.emit(`loadDB`,{key:e}),F.dbLoading=!0,F.dbList=[],L.from.db=null,L.from.database=null},U=e=>{g.emit(`loadDB`,{key:e,isTarget:!0}),I.dbLoading=!0,I.dbList=[],L.to.db=null,L.to.database=null},W=(e,t)=>{let n=t?F.dbList:I.dbList;for(let r of n)r.label==e&&(t?L.from.db=r:L.to.db=r)},G=()=>{R.compare=!0,g.emit(`start`,L)},K=()=>{let e=N.value.getCheckboxRecords();if(!e||e.length==0){h(`Need to select at least one sql!`);return}R.sync=!0,g.emit(`sync`,{sqlList:e,option:L})},q=e=>{console.log(`selectionChange`,e)},J=()=>{g.emit(`init`)};return(s,m)=>{let h=e,g=t,_=a,y=i,b=S(`vsc-button`),C=r,M=n;return v(),d(`div`,null,[m[8]||=c(`div`,{style:{margin:`30px 20px`}},` Structure sync is being refactored and is currently unavailable `,-1),c(`div`,E,[p(y,null,{default:T(()=>[p(_,{"label-width":`80px`,label:`Target`},{default:T(()=>[p(g,{modelValue:L.from.connection,"onUpdate:modelValue":m[0]||=e=>L.from.connection=e,filterable:``,onChange:H},{default:T(()=>[(v(!0),d(o,null,x(P.value,e=>(v(),l(h,{key:e.key,label:e.label,value:e.key},{default:T(()=>[c(`img`,{src:V(e.dbType),class:`inline-block`,style:{width:`13px`,height:`13px`,position:`relative`,left:`-2px`,top:`-1px`}},null,8,D),f(` `+w(e.label),1)]),_:2},1032,[`label`,`value`]))),128))]),_:1},8,[`modelValue`])]),_:1}),p(_,{"label-width":`80px`,label:`database`},{default:T(()=>[p(g,{modelValue:L.from.database,"onUpdate:modelValue":m[1]||=e=>L.from.database=e,loading:F.dbLoading,filterable:``,onChange:m[2]||=e=>W(e,!0)},{default:T(()=>[(v(!0),d(o,null,x(F.dbList,e=>(v(),l(h,{key:e.label,label:e.label,value:e.label},null,8,[`label`,`value`]))),128))]),_:1},8,[`modelValue`,`loading`])]),_:1})]),_:1})]),c(`div`,O,[p(y,null,{default:T(()=>[p(_,{"label-width":`90px`,label:`Sync From`},{default:T(()=>[p(g,{modelValue:L.to.connection,"onUpdate:modelValue":m[3]||=e=>L.to.connection=e,filterable:``,onChange:U},{default:T(()=>[(v(!0),d(o,null,x(P.value,e=>(v(),l(h,{key:e.key,label:e.label,value:e.key},{default:T(()=>[c(`img`,{src:V(e.dbType),class:`inline-block`,style:{width:`13px`,height:`13px`,position:`relative`,left:`-2px`,top:`-1px`}},null,8,k),f(` `+w(e.label),1)]),_:2},1032,[`label`,`value`]))),128))]),_:1},8,[`modelValue`])]),_:1}),p(_,{"label-width":`90px`,label:`database`},{default:T(()=>[p(g,{modelValue:L.to.database,"onUpdate:modelValue":m[4]||=e=>L.to.database=e,loading:I.dbLoading,filterable:``,onChange:m[5]||=e=>W(e,!1)},{default:T(()=>[(v(!0),d(o,null,x(I.dbList,e=>(v(),l(h,{key:e.label,label:e.label,value:e.label},null,8,[`label`,`value`]))),128))]),_:1},8,[`modelValue`,`loading`])]),_:1})]),_:1})]),p(b,{style:{"margin-left":`250px`},class:`m-2`,loading:R.compare,title:`Start Compare`,onClick:G},{default:T(()=>m[6]||=[f(` Compare `)]),_:1},8,[`loading`]),c(`div`,null,[z.sqlList?(v(),d(`div`,A,[c(`div`,j,[p(b,{loading:R.sync,title:`Confrim Sync`,onClick:K},{default:T(()=>m[7]||=[f(` Sync `)]),_:1},8,[`loading`])]),p(M,{ref_key:`dataTable`,ref:N,data:z.sqlList,height:B.value,style:{width:`100%`},onSelectionChange:q},{default:T(()=>[p(C,{type:`checkbox`,width:`40`,fixed:`left`}),p(C,{align:`center`,width:`60`,field:`type`,label:`type`}),p(C,{align:`center`,field:`sql`,label:`sql`})]),_:1},8,[`data`,`height`])])):u(``,!0)])])}}}),N=M;export{N as default};