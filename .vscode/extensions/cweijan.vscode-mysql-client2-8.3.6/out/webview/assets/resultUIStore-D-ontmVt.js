import{defaultState as e,defineStore as t,handler as n}from"./app-ctFZFRv9.js";import{DatabaseType as r}from"./constants-36FjBj35.js";import{isBinaryType as i,wrapByDb as a}from"./wrapper-D-Es_PY1.js";import{ArrayUtil as o}from"./arrayUtil-SL5L5q5A.js";const s=Symbol(`isNew`),c=Symbol(`index`),l=t(`result`,{state:()=>({data:[],backupData:[],isArrayResult:!1,fields:[],dbType:null,costTime:0,sql:``,transId:null,hasTruncate:!1,readonly:!1,reverseData:!1,columnList:null,columnTypeMap:null,database:null,table:null,withDot:null,tableCount:null,pageNum:null,pageSize:null}),getters:{noTable(e){return e.tableCount!=1},primaryKeyList(e){var t;return[r.ES,r.MONGO_DB].includes(e.dbType)?[{name:`_id`,type:`text`}]:(t=e.columnList)?.filter(e=>e.isPrimary)},hasPK(){var e;return(e=this.primaryKeyList)?.length},isNoSQL(){return[`ElasticSearch`,`MongoDB`].includes(this.dbType)},newData(){return this.data.filter(e=>e[s])}},actions:{onDataChange(e){this.backupData=o.clone(e);for(let t=0;t<e.length;t++)e[t][c]=t},getTypeByField(e){var t;if(this.dbType==r.ES&&e.name==`_id`)return`text`;let n=(t=this.columnTypeMap)?.[e.name];if(n){let{type:e,originType:t,maximum_length:r}=n;if(i(e)&&r>65535)return t}return n?.type},clearNewData(){for(let e=this.data.length-1;e>0;e--){let t=this.data[e];t[s]&&this.data.splice(e,1)}}}});function u(e,t){if(!e)return null;let n=l();return n.withDot?a(e,t):e.split(`.`).map(e=>a(e,t)).join(`.`)}var d=class{constructor(){this.commands=[],this.index=0}push(e){this.commands.push(e),this.index=this.commands.length-1}previous(){if(this.commands.length!=0){if(this.index--<0){this.index=0;return}return this.commands[this.index]}}next(){if(this.commands.length!=0){if(this.index++>=this.commands.length){this.index=this.commands.length-1;return}return this.commands[this.index]}}};const f=l(),p=t(`UI`,{state:()=>({showSQLPanel:!1,history:new d,state:{...e},viewColumn:2,viewType:`Default`,info:{sql:null,message:null,error:!1,errorSQL:null},tableStatus:{remainHeight:0,doNotClear:!1,loadingTimeout:null,rawColumnWidth:500},table:{search:``,loading:!1,start:new Date().getTime(),loadingTimer:null,widthItem:{},sort:{ascIndex:null,descIndex:null},sortKeys:[],filterKeys:{},expandKeys:[],selectedRows:[],selectedRowKeys:[]},page:{pageNum:1,pageSize:-1,total:0},aggregate:{sum:0,avg:0,min:0,max:0,count:0},dialog:{importVisible:!1,exportVisible:!1,detailScope:null,detailVisible:!1},toolbar:{sql:null,saveLoading:!1,filter:{},showColumns:[]},deleteConfirm:{sql:``,visible:!1,skipForeignCheck:!1},monitorStatus:{dashBoard:!1,processList:!1,variableList:!1,statusList:!1,hasAnyMonitor:!1}}),getters:{hasResult(){var e;return(e=f.fields)?.length>0},notAllowUpdate(){return f.tableCount!=1||f.readonly||!this.hasResult},notAllowUpdateLevel2(){return this.notAllowUpdate||this.reverseData},isSplitView(){return this.viewColumn>=2},reverseData(){return this.viewType==`Reverse`}},actions:{checkShowSQLPanel(){if(this.isSplitView){var e;if([r.ES].includes(f.dbType)||window.innerHeight<500||((e=this.toolbar)==null||(e=e.sql)==null||(e=e.match(/\n/g))==null?void 0:e.length)>1)return this.showSQLPanel=!1}this.showSQLPanel=!0},resetConfig(){this.viewType=`Default`;for(let t of Object.keys(e))this.state[t]=e[t],n.emit(`upState`,{key:t,value:e[t],ignore:!0});document.querySelector(`.codemirror-container`).style.height=`40px`},closeConfig(){n.emitImmediately(`closeConfig`)},refresh(){this.execute(f.sql)},execute(e,t={}){e&&(n.emit(`executeSQL`,{sql:e,...t}),this.table.start=new Date().getTime(),this.queueLoading())},queueLoading(){this.tableStatus.doNotClear||(this.info.message=null),clearTimeout(this.tableStatus.loadingTimeout),this.tableStatus.loadingTimeout=setTimeout(()=>{this.table.loading=!0,f.costTime=0,clearInterval(this.table.loadingTimer),this.table.loadingTimer=setInterval(()=>{f.costTime=new Date().getTime()-this.table.start},79)},100)},upState(e,t=this.state[e]){n.emit(`upState`,{key:e,value:t})}}});export{c as indexSymbol,s as isNewSymbol,l as useResultStore,p as useResultUIStore,u as wrapFront};