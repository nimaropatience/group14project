import"./isEqual-DUAGDpZY.js";import{ElOption as e,ElSelect as t}from"./select-DBPzawsW.js";import"./_baseFindIndex-Ctm2P5pj.js";import"./isArrayLikeObject-DWAcihF8.js";import"./merge-XDSJ7w6H.js";import"./_baseIteratee-t-25AuYs.js";import{ElTable as n,ElTableColumn as r}from"./table-Db0XwM4K.js";import{ElDialog as i}from"./dialog-BxcJDRn2.js";import"./use-empty-values-iILzsRnu.js";import"./click-outside-CeocQVdO.js";import"./checkbox-C8nKweXK.js";import"./tag-ByueM0Jv.js";import{ElPagination as a,useDialogStore as o}from"./dialogStore-1x0Z9Jaw.js";import{$t as s,ElForm as c,ElFormItem as l,ElInput as u,Fragment as d,__plugin_vue_export_helper_default as f,computed as p,confirmEl as m,createBaseVNode as h,createBlock as g,createCommentVNode as _,createElementBlock as v,createTextVNode as y,createVNode as b,defineComponent as x,defineStore as S,error as C,handler as w,isCompose as T,normalizeStyle as E,onBeforeMount as D,openBlock as O,ref as k,renderList as A,resolveComponent as j,storeToRefs as M,success as N,toDisplayString as P,unref as F,vShow as I,withCtx as L,withDirectives as R,withKeys as z}from"./app-ctFZFRv9.js";import{RedisType as B}from"./constants-36FjBj35.js";import{copyContent as V,listenHeight as H,parse as U,stringify as W}from"./common_view_utils-DtJZIhkt.js";import{deepClone as G}from"./objectUtil-DGxGSfnv.js";import{codemirror_default as K,supportedLanguages as q}from"./codemirror-DjzVERIP.js";const J=S(`redis`,{state:()=>({stack:!1,remainHeight:0,edit:{name:``,ttl:-1,content:null},key:{name:``,ttl:-1,content:null,count:null,type:null},itemModel:{old:null,key:null,index:null,score:null,value:null}}),actions:{saveListItem(e){if(e!=null&&(this.itemModel.value=e),!this.edit.name)return C(`Key name cannot be null!`);w.emit(`saveItem`,{...this.itemModel,keyName:this.edit.name,type:this.key.type})}}}),ee={id:`panel`,class:`flex pt-2 pb-4 justify-between pr-4 flex-wrap gap-3`},Y={key:1,class:`key-label key-detail-type`};var X=x({__name:`RedisKeyInfo`,setup(n){let r=k(!1),i=J(),{key:a,edit:o}=M(i),c=()=>{m(s(`confirm.deleteRedisKey`)).then(()=>{w.emit(`del`,{key:{name:i.key.name}}),i.key={},i.edit={}})},l=()=>{w.emit(`rename`,{key:{name:i.key.name,newName:i.edit.name}})},d=()=>{w.emit(`ttl`,{key:{name:i.key.name,ttl:i.edit.ttl}})};return w.on(`new`,()=>{r.value=!0}),w.on(`detail`,()=>{r.value=!1}),setInterval(()=>{document.activeElement.tagName!==`INPUT`&&o.value.ttl>0&&--o.value.ttl},1e3),(n,f)=>{let p=e,m=t,y=u,x=j(`vsc-button`),S=j(`vsc-tooltip`);return O(),v(`div`,ee,[h(`div`,null,[b(y,{ref:`keyNameInput`,modelValue:F(o).name,"onUpdate:modelValue":f[1]||=e=>F(o).name=e,size:`small`,placeholder:`Please input key name`,style:{width:`500px`},onKeyup:z(l,[`enter`])},{prepend:L(()=>[r.value?(O(),g(m,{key:0,modelValue:F(a).type,"onUpdate:modelValue":f[0]||=e=>F(a).type=e,placeholder:`Forever`,size:`small`,style:{width:`100px`}},{default:L(()=>[b(p,{value:`string`,label:`STRING`}),F(i).stack?(O(),g(p,{key:0,value:`ReJSON-RL`,label:`ReJSON-RL`})):_(``,!0),b(p,{value:`list`,label:`LIST`}),b(p,{value:`set`,label:`SET`}),b(p,{value:`zset`,label:`ZSET`}),b(p,{value:`hash`,label:`HASH`}),b(p,{value:`stream`,label:`STREAM`})]),_:1},8,[`modelValue`])):(O(),v(`span`,Y,P(F(a).type),1))]),_:1},8,[`modelValue`]),b(S,{title:F(s)(`result.copy`),placement:`top`},{default:L(()=>[b(x,{class:`ml-1`,size:`mini`,icon:`el-icon-document-copy`,onClick:f[2]||=e=>F(V)(F(o).name)})]),_:1},8,[`title`])]),h(`div`,null,[b(y,{modelValue:F(o).ttl,"onUpdate:modelValue":f[3]||=e=>F(o).ttl=e,size:`small`,class:`mr-1`,style:{width:`220px`},onKeyup:z(d,[`enter`])},{prepend:L(()=>f[4]||=[h(`span`,{class:`key-label`},`TTL`,-1)]),_:1},8,[`modelValue`]),b(x,{icon:`codicon codicon-save`,size:`mini`,onClick:d}),b(x,{icon:`el-icon-delete`,size:`mini`,type:`secondary`,onClick:c})])])}}}),Z=f(X,[[`__scopeId`,`data-v-ae794ec1`]]);const Q={key:0},te={id:`listPanel`},ne=[`title`,`textContent`];var re=x({__name:`RedisListView`,setup(e){let t=J(),{key:o,itemModel:d,remainHeight:f}=M(t),x=k(``),S=k(``),C=k(1),T=k(100),E=k(0),D=k(!1);w.on(`detail`,e=>{D.value=!1,C.value=e.page.pageNum,T.value=e.page.pageSize}).on(`pagination`,e=>{t.key.content=e}).on(`success`,()=>{D.value=!1});let A=p(()=>{let e=t.itemModel.old,n=o.value.type;return n=n.charAt(0).toUpperCase()+n.slice(1),`${e?`Edit`:`Add to`} ${n}`}),I=p(()=>{let e=o.value.type;switch(e){case`list`:return`Element`;case`hash`:return`Value`;case`set`:case`zset`:return`Member`;case`stream`:return`Entry`;default:return e.charAt(0).toUpperCase()+e.slice(1)}}),R=(e,t)=>{w.emit(`changePage`,t?e:C.value+e)},z=()=>{D.value=!0,t.itemModel={old:null,key:null,index:null,score:null,value:null}},B=p(()=>{o.value.content||(o.value.content=[]);let e=x.value,t=S.value,n=o.value.content.filter(n=>{if(e&&o.value.type==`hash`&&!`${n.key}`.match(new RegExp(e,`i`)))return!1;if(t){let e=`${n.value??n}`;if(!e.match(new RegExp(t,`i`)))return!1}return!0});return E.value=o.value.count??n.length,n}),V=e=>{m(s(`confirm.deleteRedisKey`)).then(()=>{w.emit(`deleteLine`,e)})},H=e=>{navigator.clipboard.writeText(e.value??e),N(s(`common.copied`))},U=e=>{t.itemModel={...e,old:{...e}},D.value=!0};return(e,p)=>{let m=u,k=j(`vsc-button`),M=j(`vsc-tooltip`),N=a,W=l,G=c,K=i,q=r,J=n;return[`list`,`hash`,`set`,`zset`,`stream`].includes(F(o).type)?(O(),v(`div`,Q,[h(`div`,te,[F(o).type==`hash`?(O(),g(m,{key:0,modelValue:x.value,"onUpdate:modelValue":p[0]||=e=>x.value=e,class:`filter-input mb-2 mr-2`,size:`small`,style:{width:`120px`},placeholder:F(s)(`result.searchField`),clearable:!0},null,8,[`modelValue`,`placeholder`])):_(``,!0),b(m,{modelValue:S.value,"onUpdate:modelValue":p[1]||=e=>S.value=e,class:`filter-input mb-2`,size:`small`,style:{width:`200px`},placeholder:F(s)(`result.searchNotice`),clearable:!0},null,8,[`modelValue`,`placeholder`]),b(M,{title:F(s)(`common.refresh`),placement:`top`},{default:L(()=>[b(k,{type:`icon`,icon:`codicon-refresh text-lg`,class:`ml-2`,onClick:p[2]||=e=>{F(w).emit(`refresh`)}})]),_:1},8,[`title`]),b(M,{title:`Add new key`},{default:L(()=>[F(o).type==`stream`?_(``,!0):(O(),g(k,{key:0,type:`icon`,icon:`codicon-add text-lg`,class:`inline-block !ml-1`,style:{color:`var(--vscode-terminal-ansiYellow)`},onClick:p[3]||=e=>z()}))]),_:1}),b(N,{"page-size":T.value,"onUpdate:pageSize":p[4]||=e=>T.value=e,"current-page":C.value,"onUpdate:currentPage":p[5]||=e=>C.value=e,small:!0,total:E.value,"page-sizes":[20,50,100,200,300],layout:`prev,pager, next, total`,onCurrentChange:p[6]||=e=>R(e,!0),onNextClick:p[7]||=()=>R(1),onPrevClick:p[8]||=()=>R(-1)},null,8,[`page-size`,`current-page`,`total`]),b(K,{modelValue:D.value,"onUpdate:modelValue":p[15]||=e=>D.value=e,"show-close":!1,title:A.value,closeOnClickModal:!1,"close-on-press-escape":!1,width:`30%`,class:`new-item-dialog`},{footer:L(()=>[b(k,{type:`secondary`,onClick:p[13]||=e=>D.value=!1},{default:L(()=>[y(P(F(s)(`common.cancel`)),1)]),_:1}),b(k,{type:`primary`,onClick:p[14]||=e=>F(t).saveListItem()},{default:L(()=>p[16]||=[y(`Confirm`)]),_:1})]),default:L(()=>[b(G,{"label-width":`60px`},{default:L(()=>[F(o).type==`list`?(O(),g(W,{key:0,label:`Index`},{default:L(()=>[b(m,{modelValue:F(d).index,"onUpdate:modelValue":p[9]||=e=>F(d).index=e,size:`small`,disabled:``},null,8,[`modelValue`])]),_:1})):_(``,!0),F(o).type==`hash`?(O(),g(W,{key:1,label:`Field`},{default:L(()=>[b(m,{modelValue:F(d).key,"onUpdate:modelValue":p[10]||=e=>F(d).key=e,size:`small`},null,8,[`modelValue`])]),_:1})):_(``,!0),F(o).type==`zset`?(O(),g(W,{key:2,label:`Score`},{default:L(()=>[b(m,{modelValue:F(d).score,"onUpdate:modelValue":p[11]||=e=>F(d).score=e,size:`small`},null,8,[`modelValue`])]),_:1})):_(``,!0),b(W,{label:I.value},{default:L(()=>[b(m,{modelValue:F(d).value,"onUpdate:modelValue":p[12]||=e=>F(d).value=e,size:`small`},null,8,[`modelValue`])]),_:1},8,[`label`])]),_:1})]),_:1},8,[`modelValue`,`title`])]),h(`div`,null,[b(J,{data:B.value,height:F(f),border:``},{default:L(()=>[F(o).type==`list`?(O(),g(q,{key:0,label:`Index`,prop:`index`,sortable:``,width:`90`,align:`center`})):_(``,!0),F(o).type==`hash`?(O(),g(q,{key:1,"sort-by":`key`,resizable:``,sortable:``,label:`Field`,align:`center`,width:`200`,prop:`key`})):_(``,!0),F(o).type==`zset`?(O(),g(q,{key:2,"sort-by":`score`,resizable:``,sortable:``,label:`Score`,align:`center`,width:`200`,prop:`score`})):_(``,!0),F(o).type==`stream`?(O(),g(q,{key:3,"sort-by":`id`,resizable:``,sortable:``,label:`id`,align:`center`,width:`200`,prop:`id`})):_(``,!0),b(q,{"sort-by":`value`,resizable:``,sortable:``,label:I.value,align:`center`},{default:L(e=>{var t;return[h(`span`,{class:`item-value`,title:e.row.value,textContent:P((t=e.row)?.value||e.row)},null,8,ne)]}),_:1},8,[`label`]),b(q,{label:`Operation`,width:`150`,align:`center`},{default:L(e=>[b(k,{type:`icon`,icon:`codicon-copy`,title:`View On Dialog`,onClick:t=>{H(e.row)}},null,8,[`onClick`]),[`list`,`hash`,`set`,`zset`].includes(F(o).type)?(O(),g(k,{key:0,type:`icon`,icon:`codicon-edit text-base`,title:`edit`,style:{color:`var(--vscode-terminal-ansiYellow)`},onClick:t=>U(e.row)},null,8,[`onClick`])):_(``,!0),b(k,{class:`ml-3`,type:`icon`,icon:`el-icon-delete text-base`,style:{color:`#f56c6c`},title:`delete`,onClick:t=>V(e.row)},null,8,[`onClick`])]),_:1})]),_:1},8,[`data`,`height`])])])):_(``,!0)}}}),ie=re;function ae(e){if(e==null)return``;if(!Number.isFinite(e)&&(e=parseInt(e),!Number.isFinite(e)))return`${e}`;let t=e<0;t&&(e=-e);let n=[`B`,`K`,`M`,`G`,`T`,`P`,`E`,`Z`,`Y`];if(e<1)return`${t?`-`:``}${e} ${n[0]}`;let r=Math.min(Math.floor(Math.log(e)/Math.log(1024)),n.length-1);e/=1024**r;let i=Number(e.toPrecision(3));return`${t?`-`:``}${i}${n[r]}`}const oe={key:0,id:`stringPanel`,class:`flex pr-4 mb-2 gap-x-3 items-center ml-1`},se={key:0,class:`flex`},ce={class:`value-panel`};var le=x({__name:`RedisStringView`,setup(n){let r=J(),{key:i}=M(r),a=k(``),o=k(`Text`),s=k(q),l=p(()=>{var e;return ae((e=a.value)?.length||0)}),u=p(()=>[`string`,`ReJSON-RL`].includes(r.key.type));window.addEventListener(`keydown`,e=>{u.value&&T(e)&&e.code==`KeyS`&&f()});let f=()=>{if(!r.edit.name)return C(`Key name cannot be null!`);w.emit(`update`,{key:{name:r.key.name,newName:r.edit.name,type:r.key.type,ttl:r.edit.ttl,content:a.value}})};w.on(`detailNext`,()=>{m()});let m=()=>{if(!u.value)return a.value=``;let e=r.edit.content,t=e?.match(/^\s*[{[]/)!=null;o.value=t?`JSON`:`Text`,t?x(e):a.value=e},x=e=>{try{var t;a.value=W(U(e==null||(t=e.replace)==null?void 0:t.call(e,/ /g,` `)),null,2)}catch(t){console.error(t),a.value=e}};return(n,u)=>{let p=e,m=t,x=j(`vsc-button`),S=j(`vsc-tooltip`),C=c;return O(),v(d,null,[[`string`,`ReJSON-RL`].includes(F(i).type)?(O(),v(`div`,oe,[h(`div`,null,` Size: `+P(l.value),1),[`string`,`ReJSON-RL`].includes(F(i).type)?(O(),v(`div`,se,[b(m,{modelValue:o.value,"onUpdate:modelValue":u[0]||=e=>o.value=e,placeholder:`Default`,size:`small`,style:{width:`145px`},class:`mr-2`},{default:L(()=>[(O(!0),v(d,null,A(s.value,e=>(O(),g(p,{key:e,value:e},{default:L(()=>[y(P(e),1)]),_:2},1032,[`value`]))),128))]),_:1},8,[`modelValue`]),b(S,{title:n.$t(`common.refresh`),placement:`top`},{default:L(()=>[b(x,{type:`secondary`,size:`micro`,icon:`codicon-refresh`,onClick:u[1]||=e=>{F(w).emit(`refresh`)}})]),_:1},8,[`title`]),b(x,{icon:`codicon codicon-save`,style:{height:`27px`},onClick:f},{default:L(()=>u[3]||=[y(`Save`)]),_:1})])):_(``,!0)])):_(``,!0),R(b(C,null,{default:L(()=>[h(`div`,ce,[b(K,{ref:`cmEditor`,value:a.value,"onUpdate:value":u[2]||=e=>a.value=e,language:o.value,class:`json-panel`,style:E(`height:`+F(r).remainHeight+`px`)},null,8,[`value`,`language`,`style`])])]),_:1},512),[[I,[`string`,`ReJSON-RL`].includes(F(i).type)]])],64)}}}),ue=f(le,[[`__scopeId`,`data-v-1ea839f2`]]);const $={class:`redis-view-container`},de={key:0,style:{"text-align":`center`}},fe={class:`mx-2`};var pe=x({__name:`RedisView`,setup(e){let t=k(!0),n=J(),r=o();return D(()=>{H(100,[],e=>{n.remainHeight=e}),w.on(`new`,({prefix:e,stack:r})=>{t.value=!1,n.stack=r,n.key={name:e,type:B.STRING,ttl:-1},n.edit=G(n.key)}).on(`detail`,e=>{t.value=!1,n.key=e.res,n.edit=G(e.res),w.emitImmediately(`detailNext`)}).on(`error`,e=>{C(e)}).on(`success`,e=>{N(e)}),w.emit(`init`)}),(e,n)=>(O(),v(`div`,$,[t.value?(O(),v(`div`,de,` loading `)):_(``,!0),R(h(`div`,fe,[b(Z),b(ie),b(ue)],512),[[I,!t.value]])]))}}),me=pe;export{me as default};